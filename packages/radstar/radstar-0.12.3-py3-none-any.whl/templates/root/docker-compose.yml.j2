version: '3'
services:

  main:
    image: {{ repo }}:{{ tag | default('latest') }}
    init: true
    environment:
      - "RS_DB_CONNINFO=postgres://rs:password@db/rs"
      - "RS_FERNET_KEY=--CHANGE-ME-CHANGE-ME--CHANGE-ME-CHANGE-ME-="
      - "RS_INIT_DB=1"
      - "RS_REDIS_URL=redis://redis/"
      - "RS_WORKER_ARGS=-c 4"
    ports:
      - "127.0.0.1:7070:8080"
    depends_on:
      - db
      - redis
    restart: unless-stopped

  db:
    image: postgres:{{ versions['postgres'] }}
    environment:
      POSTGRES_USER: rs
      POSTGRES_PASSWORD: password
    restart: unless-stopped

  redis:
    image: redis
    restart: unless-stopped
