{"version":3,"file":"mod-tree-dev.js","names":["$","MyAMS","tree","switchTreeNode","evt","removeChildNodes","nodeId","each","idx","elt","row","data","dtTable","remove","draw","node","currentTarget","switcher","tr","parents","first","table","DataTable","tooltip","hasClass","html","removeClass","location","treeNodesTarget","sourceName","require","then","ajax","post","can_sort","is","result","length","newRow","add","core","initContent","addClass","switchTree","th","tableID","filter","target","deleteElement","form","options","console","debug","node_id","sortTree","details","amsReorderUrl","amsReorderSource","rowID","rowParentID","parent","prev","parentID","action","exists","localTarget","getFunctionByName","postData","child","order","JSON","stringify","listattr","call","startsWith","window","protocol","amsLocation","removeRow","removeChildRows","childs","childRow","childID","attr","status","handleJSON","oldRow","resultRow","setTimeout","removeData","env","bundle","config","modules","push"],"sources":["mod-tree.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS tree management\n */\n\nconst $ = MyAMS.$;\n\n\nexport const tree = {\n\n\t/**\n\t * Open/close tree node inside a table\n\t */\n\tswitchTreeNode: (evt) => {\n\n\t\tconst removeChildNodes = (nodeId) => {\n\t\t\t$(`tr[data-ams-tree-node-parent-id=\"${nodeId}\"]`).each((idx, elt) => {\n\t\t\t\tconst row = $(elt);\n\t\t\t\tremoveChildNodes(row.data('ams-tree-node-id'));\n\t\t\t\tdtTable.row(row).remove().draw();\n\t\t\t});\n\t\t}\n\n\t\tconst\n\t\t\tnode = $(evt.currentTarget),\n\t\t\tswitcher = $('.switcher', node),\n\t\t\ttr = node.parents('tr').first(),\n\t\t\ttable = tr.parents('table').first(),\n\t\t\tdtTable = table.DataTable();\n\t\tnode.tooltip('hide');\n\t\tif (switcher.hasClass('expanded')) {\n\t\t\tremoveChildNodes(tr.data('ams-tree-node-id'));\n\t\t\tswitcher.html('<i class=\"far fa-plus-square\"></i>')\n\t\t\t\t.removeClass('expanded');\n\t\t} else {\n\t\t\tconst\n\t\t\t\tlocation = tr.data('ams-location') || table.data('ams-location') || '',\n\t\t\t\ttreeNodesTarget = tr.data('ams-tree-nodes-target') ||\n\t\t\t\t\ttable.data('ams-tree-nodes-target') || 'get-tree-nodes.json',\n\t\t\t\tsourceName = tr.data('ams-element-name');\n\t\t\tswitcher.html('<i class=\"fas fa-spinner fa-spin\"></i>');\n\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\tMyAMS.ajax.post(`${location}/${sourceName}/${treeNodesTarget}`, {\n\t\t\t\t\tcan_sort: !$('td.sorter', tr).is(':empty')\n\t\t\t\t}).then((result) => {\n\t\t\t\t\tif (result.length > 0) {\n\t\t\t\t\t\tlet newRow;\n\t\t\t\t\t\tfor (const row of result) {\n\t\t\t\t\t\t\tnewRow = $(row);\n\t\t\t\t\t\t\tdtTable.row.add(newRow).draw();\n\t\t\t\t\t\t\tMyAMS.core.initContent(newRow).then();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tswitcher.html('<i class=\"far fa-minus-square\"></i>')\n\t\t\t\t\t\t.addClass('expanded');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/**\n\t * Open close all tree nodes\n\t */\n\tswitchTree: (evt) => {\n\t\tconst\n\t\t\tnode = $(evt.currentTarget),\n\t\t\tswitcher = $('.switcher', node),\n\t\t\tth = node.parents('th'),\n\t\t\ttable = th.parents('table').first(),\n\t\t\ttableID = table.data('ams-tree-node-id'),\n\t\t\tdtTable = table.DataTable();\n\t\tnode.tooltip('hide');\n\t\tif (switcher.hasClass('expanded')) {\n\t\t\t$('tr[data-ams-tree-node-parent-id]').filter(`tr[data-ams-tree-node-parent-id!=\"${tableID}\"]`).each((idx, elt) => {\n\t\t\t\tdtTable.row(elt).remove().draw();\n\t\t\t});\n\t\t\t$('.switcher', table).each((idx, elt) => {\n\t\t\t\t$(elt).html('<i class=\"far fa-plus-square\"></i>')\n\t\t\t\t\t.removeClass('expanded');\n\t\t\t});\n\t\t} else {\n\t\t\tconst\n\t\t\t\tlocation = table.data('ams-location') || '',\n\t\t\t\ttarget = table.data('ams-tree-nodes-target') || 'get-tree.json',\n\t\t\t\ttr = $('tbody tr', table.first());\n\t\t\tswitcher.html('<i class=\"fas fa-spinner fa-spin\"></i>');\n\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\tMyAMS.ajax.post(`${location}/${target}`, {\n\t\t\t\t\tcan_sort: !$('td.sorter', tr).is(':empty')\n\t\t\t\t}).then((result) => {\n\t\t\t\t\t$(`tr[data-ams-tree-node-id]`, table).each((idx, elt) => {\n\t\t\t\t\t\tdtTable.row(elt).remove().draw();\n\t\t\t\t\t});\n\t\t\t\t\t$(result).each((idx, elt) => {\n\t\t\t\t\t\tconst newRow = $(elt);\n\t\t\t\t\t\tdtTable.row.add(newRow).draw();\n\t\t\t\t\t});\n\t\t\t\t\tMyAMS.core.initContent(table).then();\n\t\t\t\t\tswitcher.html('<i class=\"far fa-minus-square\"></i>')\n\t\t\t\t\t\t.addClass('expanded');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\n\t/**\n\t * Custom tree element delete callback\n\t *\n\t * @param form: source form, which can be null if callback wasn't triggered from a form\n\t * @param options: callback options\n\t */\n\tdeleteElement: (form, options) => {\n\t\tconsole.debug(options);\n\t\tconst nodeId = options.node_id;\n\t\tif (nodeId) {\n\t\t\t$(`tr[data-ams-tree-node-parent-id=\"${nodeId}\"]`).each((idx, elt) => {\n\t\t\t\tconst\n\t\t\t\t\ttable = $(elt).parents('table'),\n\t\t\t\t\tdtTable  = table.DataTable();\n\t\t\t\tdtTable.row(elt).remove().draw();\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Sort and re-parent tree elements\n\t */\n\tsortTree: (evt, details) => {\n\t\tconst\n\t\t\ttable = $(evt.target),\n\t\t\tdtTable = table.DataTable(),\n\t\t\tdata = $(table).data();\n\t\tlet target = data.amsReorderUrl;\n\t\tif (target) {\n\t\t\t// Disable row click handler\n\t\t\tconst row = $(data.amsReorderSource.node);\n\t\t\trow.data('ams-disabled-handlers', 'click');\n\t\t\ttry {\n\t\t\t\t// Get root ID\n\t\t\t\tconst tableID = row.parents('table').first().data('ams-tree-node-id');\n\t\t\t\t// Get moved row ID\n\t\t\t\tconst rowID = row.data('ams-tree-node-id');\n\t\t\t\tconst rowParentID = row.data('ams-tree-node-parent-id');\n\t\t\t\t// Get new parent ID\n\t\t\t\tconst parent = row.prev('tr');\n\t\t\t\tlet parentID,\n\t\t\t\t\tswitcher,\n\t\t\t\t\taction;\n\t\t\t\tif (parent.exists()) {\n\t\t\t\t\t// Move below an existing row\n\t\t\t\t\tparentID = parent.data('ams-tree-node-id');\n\t\t\t\t\t// Check switcher state\n\t\t\t\t\tswitcher = $('.switch', parent);\n\t\t\t\t\tif (switcher.hasClass('minus')) {\n\t\t\t\t\t\t// Opened folder: move as child\n\t\t\t\t\t\tif (rowParentID === parentID) {\n\t\t\t\t\t\t\t// Don't change parent\n\t\t\t\t\t\t\taction = 'reorder';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Change parent\n\t\t\t\t\t\t\taction = 'reparent';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Closed folder or simple item: move as sibling\n\t\t\t\t\t\tparentID = parent.data('ams-tree-node-parent-id');\n\t\t\t\t\t\tif (rowParentID === parentID) {\n\t\t\t\t\t\t\t// Don't change parent\n\t\t\t\t\t\t\taction = 'reorder';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Change parent\n\t\t\t\t\t\t\taction = 'reparent';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Move to site root\n\t\t\t\t\tparentID = tableID;\n\t\t\t\t\tswitcher = null;\n\t\t\t\t\tif (rowParentID === parentID) {\n\t\t\t\t\t\t// Already child of site root\n\t\t\t\t\t\taction = 'reorder';\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Move from inner folder to site root\n\t\t\t\t\t\taction = 'reparent';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Call ordering target\n\t\t\t\tconst localTarget = MyAMS.core.getFunctionByName(target);\n\t\t\t\tconst postData = {\n\t\t\t\t\taction: action,\n\t\t\t\t\tchild: rowID,\n\t\t\t\t\tparent: parentID,\n\t\t\t\t\torder: JSON.stringify($('tr[data-ams-tree-node-id]').listattr('data-ams-tree-node-id')),\n\t\t\t\t\tcan_sort: !$('td.sorter', row).is(':empty')\n\t\t\t\t};\n\t\t\t\tif (typeof localTarget === 'function') {\n\t\t\t\t\tlocalTarget.call(table, dtTable, postData);\n\t\t\t\t} else {\n\t\t\t\t\tif (!target.startsWith(window.location.protocol)) {\n\t\t\t\t\t\tconst location = data.amsLocation;\n\t\t\t\t\t\tif (location) {\n\t\t\t\t\t\t\ttarget = `${location}/${target}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\t\tMyAMS.ajax.post(target, postData).then((result) => {\n\n\t\t\t\t\t\t\tconst removeRow = (rowID) => {\n\t\t\t\t\t\t\t\tconst row = $(`tr[data-ams-tree-node-id=\"${rowID}\"]`);\n\t\t\t\t\t\t\t\tdtTable.row(row).remove().draw();\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tconst removeChildRows = (rowID) => {\n\t\t\t\t\t\t\t\tconst childs = $(`tr[data-ams-tree-node-parent-id=\"${rowID}\"]`);\n\t\t\t\t\t\t\t\tchilds.each((idx, elt) => {\n\t\t\t\t\t\t\t\t\tconst\n\t\t\t\t\t\t\t\t\t\tchildRow = $(elt),\n\t\t\t\t\t\t\t\t\t\tchildID = childRow.attr('data-ams-tree-node-id');\n\t\t\t\t\t\t\t\t\tremoveChildRows(childID);\n\t\t\t\t\t\t\t\t\tdtTable.row(childRow).remove().draw();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (result.status) {\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Remove parent row if changed parent\n\t\t\t\t\t\t\t\tif (postData.action === 'reparent') {\n\t\t\t\t\t\t\t\t\tremoveRow(parentID);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Remove moved row children\n\t\t\t\t\t\t\t\tremoveChildRows(parentID);\n\t\t\t\t\t\t\t\tremoveChildRows(rowID);\n\t\t\t\t\t\t\t\tdtTable.row(row).remove().draw();\n\t\t\t\t\t\t\t\tlet newRow,\n\t\t\t\t\t\t\t\t\toldRow;\n\t\t\t\t\t\t\t\tfor (const resultRow of result) {\n\t\t\t\t\t\t\t\t\tnewRow = $(resultRow);\n\t\t\t\t\t\t\t\t\toldRow = $(`tr[id=\"${newRow.attr('id')}\"]`);\n\t\t\t\t\t\t\t\t\tdtTable.row(oldRow).remove().draw();\n\t\t\t\t\t\t\t\t\tdtTable.row.add(newRow).draw();\n\t\t\t\t\t\t\t\t\tMyAMS.core.initContent(newRow).then();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\t// Restore row click handler\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t$(row).removeData('ams-disabled-handlers');\n\t\t\t\t}, 50);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('tree');\n\t} else {\n\t\tMyAMS.tree = tree;\n\t\tconsole.debug(\"MyAMS: tree module loaded...\");\n\t}\n}\n"],"mappings":"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"}