{"version":3,"file":"mod-callbacks-dev.js","names":["$","MyAMS","_initialized","callbacks","init","initElement","element","Promise","resolve","reject","deferred","each","idx","elt","data","amsCallback","JSON","parse","e","split","isArray","callback","callname","callable","source","options","core","getFunctionByName","amsCallbackOptions","unserialize","push","getScript","then","console","warn","call","document","when","apply","window","env","bundle","config","modules","debug"],"sources":["mod-callbacks.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS callbacks management\n */\n\nconst $ = MyAMS.$;\n\nlet _initialized = false;\n\n\nexport const callbacks = {\n\n\tinit: () => {\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\t},\n\n\tinitElement: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst deferred = [];\n\t\t\t$('[data-ams-callback]', element).each((idx, elt) => {\n\t\t\t\tconst data = $(elt).data();\n\t\t\t\tlet callbacks = data.amsCallback;\n\t\t\t\tif (typeof callbacks === 'string') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcallbacks = JSON.parse(data.amsCallback);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tcallbacks = data.amsCallback.split(/[\\s,;]+/);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!$.isArray(callbacks)) {\n\t\t\t\t\tcallbacks = [callbacks];\n\t\t\t\t}\n\t\t\t\tfor (const callback of callbacks) {\n\t\t\t\t\tlet callname, callable, source, options;\n\t\t\t\t\tif (typeof callback === 'string') {\n\t\t\t\t\t\tcallname = callback;\n\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\tsource = data.amsCallbackOptions;\n\t\t\t\t\t\toptions = data.amsCallbackOptions;\n\t\t\t\t\t\tif (typeof options === 'string') {\n\t\t\t\t\t\t\toptions = options.unserialize();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {  // JSON object\n\t\t\t\t\t\tcallname = callback.callback;\n\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\tsource = callback.source;\n\t\t\t\t\t\toptions = callback.options;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callable === 'undefined') {\n\t\t\t\t\t\tif (source) {\n\t\t\t\t\t\t\tdeferred.push(MyAMS.core.getScript(source).then(() => {\n\t\t\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\t\t\tif (typeof callable === 'undefined') {\n\t\t\t\t\t\t\t\t\tconsole.warn(`Missing callback ${callname}!`);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcallable.call(document, elt, options);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn(`Missing source for undefined callback ${callback}!`)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.push(Promise.resolve(callable.call(document, elt, options)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t$.when.apply($, deferred).then(resolve, reject);\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('callbacks');\n\t} else {\n\t\tMyAMS.callbacks = callbacks;\n\t\tconsole.debug(\"MyAMS: callbacks module loaded...\");\n\t}\n}\n"],"mappings":"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"}