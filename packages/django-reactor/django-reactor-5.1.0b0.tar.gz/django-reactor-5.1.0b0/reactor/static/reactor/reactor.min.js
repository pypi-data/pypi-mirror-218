(()=>{var se=Object.create;var U=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var de=t=>U(t,"__esModule",{value:!0});var fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var he=(t,e,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of le(e))!ue.call(t,a)&&a!=="default"&&U(t,a,{get:()=>e[a],enumerable:!(i=ae(e,a))||i.enumerable});return t},pe=t=>he(de(U(t!=null?se(ce(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Y=fe(z=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):t.Idiomorph=t.Idiomorph||e()})(typeof self!="undefined"?self:z,function(){return function(){"use strict";let t=new Set;function e(n,r,o={}){n instanceof Document&&(n=n.documentElement),typeof r=="string"&&(r=H(r));let l=E(r),c=D(n,l,o);return i(n,l,c)}function i(n,r,o){if(o.head.block){let l=n.querySelector("head"),c=r.querySelector("head");if(l&&c){let u=p(c,l,o);Promise.all(u).then(function(){i(n,r,Object.assign(o,{head:{block:!1,ignore:!0}}))});return}}if(o.morphStyle==="innerHTML")return s(r,n,o),n.children;if(o.morphStyle==="outerHTML"||o.morphStyle==null){let l=T(r,n,o),c=l?.previousSibling,u=l?.nextSibling,m=a(n,l,o);return l?C(c,m,u):[]}else throw"Do not understand how to morph style "+o.morphStyle}function a(n,r,o){if(!(o.ignoreActive&&n===document.activeElement))return r==null?(o.callbacks.beforeNodeRemoved(n),n.remove(),o.callbacks.afterNodeRemoved(n),null):v(n,r)?(o.callbacks.beforeNodeMorphed(n,r),n instanceof HTMLHeadElement&&o.head.ignore||(n instanceof HTMLHeadElement&&o.head.style!=="morph"?p(r,n,o):(d(r,n),s(r,n,o))),o.callbacks.afterNodeMorphed(n,r),n):(o.callbacks.beforeNodeRemoved(n),o.callbacks.beforeNodeAdded(r),n.parentElement.replaceChild(r,n),o.callbacks.afterNodeAdded(r),o.callbacks.afterNodeRemoved(n),r)}function s(n,r,o){let l=n.firstChild,c=r.firstChild;for(;l;){let u=l;if(l=u.nextSibling,c==null)o.callbacks.beforeNodeAdded(u),r.appendChild(u),o.callbacks.afterNodeAdded(u);else if(R(u,c,o))a(c,u,o),c=c.nextSibling;else{let m=I(n,r,u,c,o);if(m)c=O(c,m,o),a(m,u,o);else{let b=P(n,r,u,c,o);b?(c=O(c,b,o),a(b,u,o)):(o.callbacks.beforeNodeAdded(u),r.insertBefore(u,c),o.callbacks.afterNodeAdded(u))}}j(o,u)}for(;c!==null;){let u=c;c=c.nextSibling,J(u,o)}}function d(n,r){let o=n.nodeType;if(o===1){let l=n.attributes,c=r.attributes;for(let u of l)r.getAttribute(u.name)!==u.value&&r.setAttribute(u.name,u.value);for(let u of c)n.hasAttribute(u.name)||r.removeAttribute(u.name)}if((o===8||o===3)&&r.nodeValue!==n.nodeValue&&(r.nodeValue=n.nodeValue),n instanceof HTMLInputElement&&r instanceof HTMLInputElement&&n.type!=="file"){let l=n.value,c=r.value;f(n,r,"checked"),f(n,r,"disabled"),n.hasAttribute("value")?l!==c&&(r.setAttribute("value",l),r.value=l):(r.value="",r.removeAttribute("value"))}else if(n instanceof HTMLOptionElement)f(n,r,"selected");else if(n instanceof HTMLTextAreaElement&&r instanceof HTMLTextAreaElement){let l=n.value,c=r.value;l!==c&&(r.value=l),r.firstChild&&r.firstChild.nodeValue!==l&&(r.firstChild.nodeValue=l)}}function f(n,r,o){n[o]!==r[o]&&(r[o]=n[o],n[o]?r.setAttribute(o,""):r.removeAttribute(o))}function p(n,r,o){let l=[],c=[],u=[],m=[],b=o.head.style,S=new Map;for(let _ of n.children)S.set(_.outerHTML,_);for(let _ of r.children){let g=S.has(_.outerHTML),A=o.head.shouldReAppend(_),B=o.head.shouldPreserve(_);g||B?A?c.push(_):(S.delete(_.outerHTML),u.push(_)):b==="append"?A&&(c.push(_),m.push(_)):o.head.shouldRemove(_)!==!1&&c.push(_)}m.push(...S.values()),h("to append: ",m);let x=[];for(let _ of m){h("adding: ",_);let g=document.createRange().createContextualFragment(_.outerHTML).firstChild;if(h(g),o.callbacks.beforeNodeAdded(g)!==!1){if(g.href||g.src){let A=null,B=new Promise(function(ie){A=ie});g.addEventListener("load",function(){A()}),x.push(B)}r.appendChild(g),o.callbacks.afterNodeAdded(g),l.push(g)}}for(let _ of c)o.callbacks.beforeNodeRemoved(_)!==!1&&(r.removeChild(_),o.callbacks.afterNodeRemoved(_));return o.head.afterHeadMorphed(r,{added:l,kept:u,removed:c}),x}function h(){}function y(){}function D(n,r,o){return{target:n,newContent:r,config:o,morphStyle:o.morphStyle,ignoreActive:o.ignoreActive,idMap:oe(n,r),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:y,afterNodeAdded:y,beforeNodeMorphed:y,afterNodeMorphed:y,beforeNodeRemoved:y,afterNodeRemoved:y},o.callbacks),head:Object.assign({style:"merge",shouldPreserve:function(l){return l.getAttribute("im-preserve")==="true"},shouldReAppend:function(l){return l.getAttribute("im-re-append")==="true"},shouldRemove:y,afterHeadMorphed:y},o.head)}}function R(n,r,o){return n==null||r==null?!1:n.nodeType===r.nodeType&&n.tagName===r.tagName?n.id!==""&&n.id===r.id?!0:M(o,n,r)>0:!1}function v(n,r){return n==null||r==null?!1:n.nodeType===r.nodeType&&n.tagName===r.tagName}function O(n,r,o){for(;n!==r;){let l=n;n=n.nextSibling,J(l,o)}return j(o,r),r.nextSibling}function I(n,r,o,l,c){let u=M(c,o,r),m=null;if(u>0){let b=l,S=0;for(;b!=null;){if(R(o,b,c))return b;if(S+=M(c,b,n),S>u)return null;b=b.nextSibling}}return m}function P(n,r,o,l,c){let u=l,m=o.nextSibling,b=0;for(;u!=null;){if(M(c,u,n)>0)return null;if(v(o,u))return u;if(v(m,u)&&(b++,m=m.nextSibling,b>=2))return null;u=u.nextSibling}return u}function H(n){let r=new DOMParser,o=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(o.match(/<\/html>/)||o.match(/<\/head>/)||o.match(/<\/body>/)){let l=r.parseFromString(n,"text/html");if(o.match(/<\/html>/))return l.generatedByIdiomorph=!0,l;{let c=l.firstChild;return c?(c.generatedByIdiomorph=!0,c):null}}else{let c=r.parseFromString("<body><template>"+n+"</template></body>","text/html").body.querySelector("template").content;return c.generatedByIdiomorph=!0,c}}function E(n){if(n==null)return document.createElement("div");if(n.generatedByIdiomorph)return n;if(n instanceof Node){let r=document.createElement("div");return r.append(n),r}else{let r=document.createElement("div");for(let o of[...n])r.append(o);return r}}function C(n,r,o){let l=[],c=[];for(;n!=null;)l.push(n),n=n.previousSibling;for(;l.length>0;){let u=l.pop();c.push(u),r.parentElement.insertBefore(u,r)}for(c.push(r);o!=null;)l.push(o),c.push(o),o=o.nextSibling;for(;l.length>0;)r.parentElement.insertBefore(l.pop(),r.nextSibling);return c}function T(n,r,o){let l;l=n.firstChild;let c=l,u=0;for(;l;){let m=N(l,r,o);m>u&&(c=l,u=m),l=l.nextSibling}return c}function N(n,r,o){return v(n,r)?.5+M(o,n,r):0}function J(n,r){j(r,n),r.callbacks.beforeNodeRemoved(n),n.remove(),r.callbacks.afterNodeRemoved(n)}function ne(n,r){return!n.deadIds.has(r)}function re(n,r,o){return(n.idMap.get(o)||t).has(r)}function j(n,r){let o=n.idMap.get(r)||t;for(let l of o)n.deadIds.add(l)}function M(n,r,o){let l=n.idMap.get(r)||t,c=0;for(let u of l)ne(n,u)&&re(n,u,o)&&++c;return c}function $(n,r){let o=n.parentElement,l=n.querySelectorAll("[id]");for(let c of l){let u=c;for(;u!==o&&u!=null;){let m=r.get(u);m==null&&(m=new Set,r.set(u,m)),m.add(c.id),u=u.parentElement}}}function oe(n,r){let o=new Map;return $(n,o),$(r,o),o}return{morph:e}}()})});var q=function(t,e){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,a){i.__proto__=a}||function(i,a){for(var s in a)a.hasOwnProperty(s)&&(i[s]=a[s])},q(t,e)};function Q(t,e){q(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}function me(t){var e=typeof Symbol=="function"&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function _e(t,e){var i=typeof Symbol=="function"&&t[Symbol.iterator];if(!i)return t;var a=i.call(t),s,d=[],f;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)d.push(s.value)}catch(p){f={error:p}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(f)throw f.error}}return d}function be(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(_e(arguments[e]));return t}var K=function(){function t(e,i){this.target=i,this.type=e}return t}(),ye=function(t){Q(e,t);function e(i,a){var s=t.call(this,"error",a)||this;return s.message=i.message,s.error=i,s}return e}(K),ge=function(t){Q(e,t);function e(i,a,s){i===void 0&&(i=1e3),a===void 0&&(a="");var d=t.call(this,"close",s)||this;return d.wasClean=!0,d.code=i,d.reason=a,d}return e}(K);var ve=function(){if(typeof WebSocket!="undefined")return WebSocket},Ee=function(t){return typeof t!="undefined"&&!!t&&t.CLOSING===2},k={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},we=function(){function t(e,i,a){var s=this;a===void 0&&(a={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(d){s._debug("open event");var f=s._options.minUptime,p=f===void 0?k.minUptime:f;clearTimeout(s._connectTimeout),s._uptimeTimeout=setTimeout(function(){return s._acceptOpen()},p),s._ws.binaryType=s._binaryType,s._messageQueue.forEach(function(h){return s._ws.send(h)}),s._messageQueue=[],s.onopen&&s.onopen(d),s._listeners.open.forEach(function(h){return s._callEventListener(d,h)})},this._handleMessage=function(d){s._debug("message event"),s.onmessage&&s.onmessage(d),s._listeners.message.forEach(function(f){return s._callEventListener(d,f)})},this._handleError=function(d){s._debug("error event",d.message),s._disconnect(void 0,d.message==="TIMEOUT"?"timeout":void 0),s.onerror&&s.onerror(d),s._debug("exec error listeners"),s._listeners.error.forEach(function(f){return s._callEventListener(d,f)}),s._connect()},this._handleClose=function(d){s._debug("close event"),s._clearTimeouts(),s._shouldReconnect&&s._connect(),s.onclose&&s.onclose(d),s._listeners.close.forEach(function(f){return s._callEventListener(d,f)})},this._url=e,this._protocols=i,this._options=a,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(i,a){return typeof a=="string"?i+=a.length:a instanceof Blob?i+=a.size:i+=a.byteLength,i},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(e,i){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,i)},t.prototype.reconnect=function(e,i){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,i),this._connect())},t.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var i=this._options.maxEnqueuedMessages,a=i===void 0?k.maxEnqueuedMessages:i;this._messageQueue.length<a&&(this._debug("enqueue",e),this._messageQueue.push(e))}},t.prototype.addEventListener=function(e,i){this._listeners[e]&&this._listeners[e].push(i)},t.prototype.dispatchEvent=function(e){var i,a,s=this._listeners[e.type];if(s)try{for(var d=me(s),f=d.next();!f.done;f=d.next()){var p=f.value;this._callEventListener(e,p)}}catch(h){i={error:h}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}return!0},t.prototype.removeEventListener=function(e,i){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(a){return a!==i}))},t.prototype._debug=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._options.debug&&console.log.apply(console,be(["RWS>"],e))},t.prototype._getNextDelay=function(){var e=this._options,i=e.reconnectionDelayGrowFactor,a=i===void 0?k.reconnectionDelayGrowFactor:i,s=e.minReconnectionDelay,d=s===void 0?k.minReconnectionDelay:s,f=e.maxReconnectionDelay,p=f===void 0?k.maxReconnectionDelay:f,h=0;return this._retryCount>0&&(h=d*Math.pow(a,this._retryCount-1),h>p&&(h=p)),this._debug("next delay",h),h},t.prototype._wait=function(){var e=this;return new Promise(function(i){setTimeout(i,e._getNextDelay())})},t.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var i=e();if(typeof i=="string")return Promise.resolve(i);if(i.then)return i}throw Error("Invalid URL")},t.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var i=this._options,a=i.maxRetries,s=a===void 0?k.maxRetries:a,d=i.connectionTimeout,f=d===void 0?k.connectionTimeout:d,p=i.WebSocket,h=p===void 0?ve():p;if(this._retryCount>=s){this._debug("max retries reached",this._retryCount,">=",s);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!Ee(h))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(y){e._closeCalled||(e._debug("connect",{url:y,protocols:e._protocols}),e._ws=e._protocols?new h(y,e._protocols):new h(y),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},f))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ye(Error("TIMEOUT"),this))},t.prototype._disconnect=function(e,i){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,i),this._handleClose(new ge(e,i,this))}catch{}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(e,i){"handleEvent"in i?i.handleEvent(e):i(e)},t.prototype._removeListeners=function(){!this._ws||(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){!this._ws||(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}(),W=we;var X=pe(Y());console.log(X.default);function Z(t,e){newJoiners=new Set,Idiomorph.morph(t,e,{ignoreActive:!0,callbacks:{beforeNodeMorphed:function(i,a){i instanceof HTMLElement&&a instanceof HTMLElement&&i.hasAttribute("reactor-component")&&a.hasAttribute("reactor-component")&&i.id!==a.id&&(i.leave(),newJoiners.add(a.id))},afterNodeMorphed:function(i,a){newJoiners.has(i.id)&&i.join()}}})}var F=JSON.parse(document.querySelector("meta[name=reactor-boost]")?.dataset.enabled||"false");console.log("BOOST_PAGES",F);F&&document.addEventListener("click",t=>{let e=t.target;e=e.tagName.toLowerCase()!=="a"?e.closest("a"):e,e&&e.href&&(!e.target||e.target==="_self")&&e.origin==document.location.origin&&t.button===0&&!t.metaKey&&!t.ctrlKey&&!t.altKey&&!t.shiftKey&&(t.preventDefault(),V.load(e.href))});function G(t,e=void 0){let i=new DOMParser().parseFromString(t,"text/html");document.title=i.querySelector("title")?.text??"",Z(document.body,i.body),e===void 0?document.querySelector("[autofocus]")?.focus():window.scrollTo(0,e)}function Se(t){return t.startsWith("http://")||t.startsWith("https://")?new URL(t).origin===document.location.origin:!0}var V=class{static async load(e){F&&Se(e)?this.push(e):document.location.assign(e)}static back(){window.history.back()}static async push(e){history.replaceState({content:document.body.outerHTML,scrollY:window.scrollY},document.title,document.location.href);let a=await(await fetch(e)).text();history.pushState({},document.title,e),G(a)}static replace(e){history.replaceState({},document.title,e)}};window.addEventListener("popstate",t=>{t.state?.content!==void 0&&G(t.state.content,t.state.scrollY),fetch(document.location.href).then(e=>e.text()).then(e=>G(e))});var L={HistoryCache:V,morph:Z};var ke=new DOMParser,ee=class extends EventTarget{open(e="__reactor__"){let i=location.protocol.replace("http","ws");this.socket=new W(`${i}//${location.host}/${e}`,[],{maxEnqueuedMessages:0}),this.socket.addEventListener("open",()=>{console.log("WS: OPEN"),this.dispatchEvent(new Event("open"))}),this.socket.addEventListener("message",a=>this._processMessage(a)),this.socket.addEventListener("close",()=>{console.log("WS: CLOSE"),this.dispatchEvent(new Event("close"))})}get isOpen(){return this.socket?.readyState==W.OPEN}_processMessage(e){let{command:i,payload:a}=JSON.parse(e.data);switch(i){case"render":var{id:s,diff:d}=a;console.log("<<< RENDER",s),document.getElementById(s)?.applyDiff(d);break;case"append":case"prepend":case"insert_after":case"insert_before":case"replace_with":var{id:s,html:f}=a;console.log(`<<< ${i.toUpperCase()}`,s),f=ke.parseFromString(f,"text/html").body.firstChild;var p=document.getElementById(s);switch(i){case"append":p?.append(f);break;case"prepend":p?.prepend(f);break;case"insert_after":p?.after(f);break;case"insert_before":p?.before(f);break;case"replace_with":p?.replaceWith(f);break}break;case"remove":var{id:s}=a;console.log("<<< REMOVE",s),document.getElementById(s)?.remove();break;case"focus_on":var{selector:h}=a;console.log("<<< FOCUS-ON",`"${h}"`,document.querySelector(h)),window.requestAnimationFrame(()=>document.querySelector(h)?.focus());break;case"scroll_into_view":var{id:s,behavior:y,block:D,inline:R}=a;window.requestAnimationFrame(()=>document.getElementById(s)?.scrollIntoView({behavior:y,block:D,inline:R}));break;case"url_change":var{url:v}=a;switch(console.log("<< URL",a.command,v),a.command){case"redirect":L.HistoryCache.load(v);break;case"replace":L.HistoryCache.replace(v);break;case"push":L.HistoryCache.push(v);break}break;case"set_url_params":console.log("<< SET URL PARAMS",a);let O=document.location.search.slice(1),I={};O.length&&(I=O.split("&").map(E=>E.split("=")).reduce((E,C)=>{let[T,N]=C;return E[T]=N===void 0?void 0:decodeURIComponent(N),E},{}));let P=Object.entries(Object.assign(I,a)).map(E=>{let[C,T]=E;return C+(T===void 0?"":`=${encodeURIComponent(T)}`)}),H=document.location.pathname;P.length&&(H+="?"+P.join("&")),L.HistoryCache.replace(H);break;case"back":L.HistoryCache.back();break;default:console.error(`Unknown command "${i}"`,a)}}sendJoin(e,i,a){this._send("join",{name:e,parent_id:i,state:a})}sendLeave(e){console.log(">>> LEAVE",e),this._send("leave",{id:e})}sendUserEvent(e,i,a,s){console.log(">>> USER_EVENT",e,i,s),this._send("user_event",{id:e,command:i,implicit_args:a,explicit_args:s})}_send(e,i){this.isOpen&&this.socket.send(JSON.stringify({command:e,payload:i}))}},w=new ee;for({dataset}of document.querySelectorAll("meta[name=reactor-component]")){let t=document.createElement(dataset.extends);class e extends t.constructor{constructor(...a){super(...a);this._lastReceivedHtml=[],this.joinBind=()=>this.join(),this.wentOffline=()=>this.classList.add("reactor-disconnected")}connectedCallback(){w.addEventListener("open",this.joinBind),w.addEventListener("close",this.wentOffline),this.join()}disconnectedCallback(){w.removeEventListener("open",this.joinBind),w.removeEventListener("close",this.wentOffline),this.leave()}join(){this.classList.remove("reactor-disconnected"),w.sendJoin(this.dataset.name,this.parentId,this.dataset.state)}leave(){w.sendLeave(this.id)}applyDiff(a){window.requestAnimationFrame(()=>{let s=this.getHtml(a);L.morph(this,s)})}getHtml(a){let s=[],d=0;for(let f of a)typeof f=="string"?s.push(f):f<0?d-=f:(s.push(...this._lastReceivedHtml.slice(d,d+f)),d+=f);return this._lastReceivedHtml=s,s.join(" ")}get parentId(){return this.parentComponent?.id}get parentComponent(){return this.parentElement?.closest("[reactor-component]")}dispatch(a,s,d){w.sendUserEvent(this.id,a,this.serialize(d),s)}serialize(a){let s={};for(let d of a.querySelectorAll("[name]")){if(d.closest("[reactor-component]")!==this)continue;let f=null;switch(d.type.toLowerCase()){case"checkbox":case"radio":f=d.checked?d.value||!0:null;break;case"select-multiple":f=d.selectedOptions.map(p=>p.value);break;default:f=d.value;break}if(f!==null){let p=d.getAttribute("name"),h=s[p]??[];h.push(f),s[p]=h}}return s}}customElements.define(dataset.tagName,e,{extends:dataset.extends})}w.open();var te=void 0;window.reactor={send(t,e,i){let a=t.closest("[reactor-component]");if(a!==null){let s=t.closest("form"),d=a.contains(s)?s:a;a.dispatch(e,i,d)}},debounce(t){return e=>(...i)=>{clearTimeout(te),te=setTimeout(()=>e(...i),t)}}};})();
/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
//# sourceMappingURL=reactor.min.js.map
