"use strict";(self.webpackChunk_jupyrdf_jupyter_forcegraph=self.webpackChunk_jupyrdf_jupyter_forcegraph||[]).push([[137,132],{3295:(e,t,s)=>{s.d(t,{JW:()=>h,Y6:()=>i,af:()=>o,d:()=>d,fg:()=>r,vG:()=>a});var n=s(1526);const i={E:Math.E,LN10:Math.LN10,LN2:Math.LN2,LOG10E:Math.LOG10E,LOG2E:Math.LOG2E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2},r=[Math.acos,Math.acosh,Math.asin,Math.asinh,Math.atan,Math.atanh,Math.cbrt,Math.ceil,Math.cos,Math.cosh,Math.exp,Math.expm1,Math.floor,Math.fround,Math.log,Math.log10,Math.log1p,Math.log2,Math.sign,Math.sin,Math.sinh,Math.sqrt,Math.tan,Math.tanh,Math.trunc],o=[Math.imul,Math.atan2],a=[Math.min,Math.max,Math.hypot];var l;async function h(e){const t=await d();return new l.TemplateClass(e,t,null,!0)}async function d(){if(l.env)return l.env;if(l.loading)return await l.loading.promise,l.env;l.loading=new n.PromiseDelegate;const e=await s.e(410).then(s.t.bind(s,410,23)),t=new e.Environment;return function(e){for(const[t,s]of Object.entries(i))e.addGlobal(t,s);for(const t of r)e.addGlobal(t.name,t);for(const t of o)e.addGlobal(t.name,t);for(const t of a)e.addGlobal(t.name,c(t));e.addGlobal("now",(()=>performance.now())),e.addFilter("where",((e,t,s)=>{const n=[];for(const i of e)i[t]===s&&n.push(i);return n}))}(t),l.TemplateClass=e.Template,l.env=t,l.loading.resolve(t),t}function c(e){return function(t,...s){return Array.isArray(t)?e(...t):e(t,...s)}}!function(e){e.env=null,e.loading=null,e.TemplateClass=null}(l||(l={}))},3137:(e,t,s)=>{s.r(t),s.d(t,{BehaviorModel:()=>_,CenterForceModel:()=>M,ClusterForceModel:()=>b,CollisionForceModel:()=>L,ColumnModel:()=>w,ContinuousColorModel:()=>Q,DAGBehaviorModel:()=>P,DataFrameSourceModel:()=>_e,DynamicModel:()=>k,EllipseShapeModel:()=>le,FacetedForceModel:()=>y,FacetedModel:()=>f,ForceGraph3DModel:()=>ge,ForceGraph3DView:()=>pe,ForceGraphModel:()=>ce,ForceGraphView:()=>ue,GraphCameraModel:()=>j,GraphDataModel:()=>U,GraphDirectorModel:()=>G,GraphForcesModel:()=>F,GraphImageModel:()=>W,LinkArrowModel:()=>q,LinkForceModel:()=>N,LinkParticleModel:()=>$,LinkSelectionModel:()=>E,LinkShapeModel:()=>H,LinkTooltipModel:()=>J,ManyBodyForceModel:()=>B,NodeSelectionModel:()=>I,NodeShapeFacetsModel:()=>V,NodeShapeModel:()=>Z,NodeTooltipModel:()=>Y,NunjucksModel:()=>C,OrdinalColorModel:()=>X,RadialForceModel:()=>T,RectangleShapeModel:()=>he,TextShapeModel:()=>ae,XForceModel:()=>R,YForceModel:()=>S,ZForceModel:()=>O});var n=s(1526),i=s(1840),r=s(647),o=s(3295),a=s(8512);function l(...e){return null}function h(){return!0}function d(e){return e}function c(e){return()=>e}function u(e){return!a.Xx.includes(e.toLocaleLowerCase().trim())}function g(e){return Number(e)}function p(e){var t;try{t=JSON.parse(e)}catch(s){a.eM&&console.warn(`${a.Dd} could not parse ${e} as JSON`),t=null}return Array.isArray(t)?t:(a.eM&&console.log(`${a.Dd} could not parse ${e} as an array, setting value to []`),[])}function m(e){switch(e){case a.k9.boolish:return u;case a.k9.numeric:return g;case a.k9.array:return p;default:return d}}class _ extends r.WidgetModel{defaults(){return{...super.defaults(),...a.sB}}get rank(){const e=this.get("rank");return null==e?a.gy:e}initialize(e,t){super.initialize(e,t),this.on("change:rank",this.onRankChange),this._updateRequested=new i.Signal(this),this._graphDataUpdateRequested=new i.Signal(this),this._graphCameraUpdateRequested=new i.Signal(this)}onRankChange(){this._updateRequested.emit(a.k$.Behavior)}get updateRequested(){return this._updateRequested}get graphDataUpdateRequested(){return this._graphDataUpdateRequested}get graphCameraUpdateRequested(){return this._graphCameraUpdateRequested}}class f extends _{constructor(){super(...arguments),this._nodeFacets=n.JSONExt.emptyObject,this._linkFacets=n.JSONExt.emptyObject,this._facetNames=null}get _modelClass(){return f}get _facetClass(){return this._modelClass}defaults(){return{...super.defaults(),_model_name:this._modelClass.model_name}}get updateRequested(){return this._updateRequested}initialize(e,t){super.initialize(e,t);let s="";for(const e of this.facetNames)s+=`change:${e} `;this.on(s,this._onFacetsChanged,this),this._onFacetsChanged.call(this)}async _onFacetsChanged(){this._nodeFacets=n.JSONExt.emptyObject,this._linkFacets=n.JSONExt.emptyObject,this._updateRequested.emit(void 0)}async ensureFacets(){const e={},t={};for(const s of this.facetNames){let n=this.get(s);n instanceof k?(await n.ensureHandlers(),e[s]=n.nodeHandler,t[s]=n.linkHandler,n.updateRequested.connect(this._onFacetsChanged,this)):null!=n&&(e[s]=t[s]=c(n))}this._nodeFacets=e,this._linkFacets=t}get facetNames(){if(null==this._facetNames){const e=[...Object.keys(f.serializers)],t=[];for(const s of Object.keys(this._facetClass.serializers))e.includes(s)||t.push(s);this._facetNames=t}return this._facetNames}wrapForContext(e,t,s){return function(n,i,r){let o;try{let a=e({[t]:n,i,[s]:r});o=null==a?null:a,"boolean"!=typeof o&&(null==o||isNaN(o))&&(o=null)}catch(e){a.eM&&console.warn(a.Dd,e),o=null}return o}}wrapForNode(e){return this.wrapForContext(e,"node","nodes")}wrapForLink(e){return this.wrapForContext(e,"link","links")}}f.model_name="FacetedModel",f.serializers={...r.WidgetModel.serializers};class k extends _{constructor(){super(...arguments),this._nodeHandler=null,this._linkHandler=null}defaults(){return{...super.defaults(),value:"",coerce:null}}initialize(e,t){super.initialize(e,t),this.on("change:value",this.valueChanged,this)}valueChanged(){this._nodeHandler=null,this._linkHandler=null,this._updateRequested.emit(void 0)}get updateRequested(){return this._updateRequested}async ensureHandlers(){}get value(){return this.get("value")||""}get nodeHandler(){return this._nodeHandler||l}get linkHandler(){return this._linkHandler||l}get coerce(){return this.get("coerce")||null}}class C extends k{async ensureHandlers(){if(this._nodeHandler)return;const e=await(0,o.JW)(this.value),t=m(this.coerce);this._nodeHandler=function(s){return t(e.render(s))},this._linkHandler=this._nodeHandler}}class w extends k{async ensureHandlers(){if(this._nodeHandler)return;const{value:e}=this;if(null==e)return this._nodeHandler=l,void(this._linkHandler=l);const t=m(this.coerce),[s,n]=await this._buildHandlers(e,t);this._nodeHandler=s,this._linkHandler=n}async _buildHandlers(e,t){return[function(s){return t(s.node?s.node[e]:null)},function(s){return t(s.link?s.link[e]:null)}]}}var v=s(2874),x=s(22);class y extends f{forceFactory(){throw new Error("Not implemented")}initialize(e,t){super.initialize(e,t),this._force=this.forceFactory(),this.on("change:active",this._onFacetsChanged)}get active(){return this.get("active")}get force(){return this._force}}y.model_name="FacetedForceModel";class F extends _{defaults(){return{...super.defaults(),_model_name:F.model_name,forces:{},warmup_ticks:0,cooldown_ticks:-1,alpha_min:0,alpha_decay:.228,velocity_decay:.4}}initialize(e,t){super.initialize(e,t),this.on("change:forces change:cooldown_ticks change:warmup_ticks change:alpha_min change:alpha_decay change:velocity_decay",this.onForcesChange,this),this.onForcesChange()}get forces(){return this.get("forces")||{}}async onForcesChange(){const{forces:e,previousForces:t}=this;for(const e of Object.values(t))e&&e.updateRequested.disconnect(this.onForceUpdated,this);for(const t of Object.values(e))t&&t.updateRequested.connect(this.onForceUpdated,this);this.onForceUpdated()}get previousForces(){return this.previous&&this.previous("forces")||{}}async onForceUpdated(e){const t=[];for(const e of Object.values(this.forces))e instanceof f&&t.push(e.ensureFacets());t&&await Promise.all(t),this._updateRequested.emit(a.k$.Reheat)}get warmupTicks(){return this.get("warmup_ticks")}get cooldownTicks(){const e=this.get("cooldown_ticks");return e<0?1/0:e}get alphaMin(){return this.get("alpha_min")}get alphaDecay(){return this.get("alpha_decay")}get velocityDecay(){return this.get("velocity_decay")}checkPositions(e){let{nodes:t,links:s}=e.graphData(),n=!1;for(let e of t)if(isNaN(e.x)||isNaN(e.y)){n=!0;break}if(n){for(let e of t)e.x=NaN,e.y=NaN,e.vx=NaN,e.vy=NaN;!function(e,t=2){let s=Math.min(3,Math.max(1,Math.round(t)));for(var n,i=Math.PI*(3-Math.sqrt(5)),r=20*Math.PI/(9+Math.sqrt(221)),o=0,a=e.length;o<a;++o){if((n=e[o]).index=o,null!=n.fx&&(n.x=n.fx),null!=n.fy&&(n.y=n.fy),null!=n.fz&&(n.z=n.fz),isNaN(n.x)||s>1&&isNaN(n.y)||s>2&&isNaN(n.z)){var l=10*(s>2?Math.cbrt(.5+o):s>1?Math.sqrt(.5+o):o),h=o*i,d=o*r;1===s?n.x=l:2===s?(n.x=l*Math.cos(h),n.y=l*Math.sin(h)):(n.x=l*Math.sin(h)*Math.cos(d),n.y=l*Math.cos(h),n.z=l*Math.sin(h)*Math.sin(d))}(isNaN(n.vx)||s>1&&isNaN(n.vy)||s>2&&isNaN(n.vz))&&(n.vx=0,s>1&&(n.vy=0),s>2&&(n.vz=0))}}(t),s.forEach((e=>{let s=e.source;s!==t[s.index]&&console.warn("link source mismatch",s,t[s.index])}))}}}F.model_name="GraphForcesModel",F.serializers={...r.WidgetModel.serializers,forces:x.x};class M extends y{get _modelClass(){return M}forceFactory(){return(0,v.forceCenter)()}get force(){const{x:e,y:t,z:s}=this._nodeFacets;let n=this._force;return n=null==e?n:n.x(e()),n=null==t?n:n.y(t()),n=null==s?n:n.z(s()),n}}M.model_name="CenterForceModel",M.serializers={...y.serializers,x:x.x,y:x.x,z:x.x};var z=s(7967),D=s.n(z);class b extends y{constructor(){super(...arguments),this._clusters=new Map}get _modelClass(){return b}forceFactory(){return D()()}get force(){const{strength:e,inertia:t,key:s,radius:n,x:i,y:r,z:o}=this._nodeFacets;let a=this._force;return a=null==t?a:a.centerInertia(t()),a=null==e?a:a.strength(e()),a=null==s?a:a.centers(this.makeCenters(this.wrapForNode(s),{radius:n,x:i,y:r,z:o})),a}makeCenters(e,t){return(s,n,i)=>{s.radius||(s.radius=1);const r=e(s,n,i);let o=this._clusters.get(r);null==o&&(o={x:0,y:0,z:0,radius:0},this._clusters.set(r,o));const{x:a,y:l,z:h,radius:d}=t,c={cluster:o,node:s,key:r,nodes:i};return null!=d&&(o.radius=d(c)),null!=a&&(o.x=a(c)),null!=l&&(o.y=l(c)),null!=h&&(o.z=h(c)),this.fixCenter(o),o}}fixCenter(e){isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.z)&&(e.z=0),(isNaN(e.radius)||null==e.radius)&&(e.radius=0)}}b.model_name="ClusterForceModel",b.serializers={...y.serializers,strength:x.x,inertia:x.x,key:x.x,radius:x.x,y:x.x,x:x.x,z:x.x};class L extends y{get _modelClass(){return L}forceFactory(){return(0,v.forceCollide)()}get force(){const{radius:e,strength:t}=this._nodeFacets;let s=this._force;return s=null==e?s:s.radius(this.wrapForNode(e)),s=null==t?s:s.strength(t()),s}}L.model_name="CollisionForceModel",L.serializers={...y.serializers,radius:x.x,strength:x.x};class N extends y{get _modelClass(){return N}forceFactory(){return(0,v.forceLink)()}get force(){const{strength:e,distance:t}=this._linkFacets;let s=this._force;return s=null==e?s:s.strength(this.wrapForLink(e)),s=null==t?s:s.distance(this.wrapForLink(t)),s}}N.model_name="LinkForceModel",N.serializers={...y.serializers,strength:x.x,distance:x.x};class B extends y{forceFactory(){return(0,v.forceManyBody)()}get _modelClass(){return B}get force(){const{strength:e,theta:t,distance_max:s,distance_min:n}=this._nodeFacets;let i=this._force;return i=null==e?i:i.strength(this.wrapForNode(e)),i=null==t?i:i.theta(t()),i=null==s?i:i.distanceMax(s()),i=null==n?i:i.distanceMin(n()),i}}B.model_name="ManyBodyForceModel",B.serializers={...y.serializers,strength:x.x,theta:x.x,distance_max:x.x,distance_min:x.x};class T extends y{get _modelClass(){return T}forceFactory(){return(0,v.forceRadial)()}get force(){const{strength:e,radius:t,x:s,y:n,z:i}=this._nodeFacets;let r=this._force;return r=null==e?r:r.strength(this.wrapForNode(e)),r=null==t?r:r.radius(this.wrapForNode(t)),r=null==s?r:r.x(s()),r=null==n?r:r.y(n()),r=null==i?r:r.z(i()),r}}T.model_name="RadialForceModel",T.serializers={...y.serializers,x:x.x,y:x.x,z:x.x,radius:x.x,strength:x.x};class R extends y{get _modelClass(){return R}forceFactory(){return(0,v.forceX)()}get force(){const{x:e,strength:t}=this._nodeFacets;let s=this._force;return s=null==e?s:s.x(this.wrapForNode(e)),s=null==t?s:s.strength(this.wrapForNode(t)),s}}R.model_name="XForceModel",R.serializers={...y.serializers,x:x.x,strength:x.x};class S extends y{get _modelClass(){return S}forceFactory(){return(0,v.forceY)()}get force(){const{y:e,strength:t}=this._nodeFacets;let s=this._force;return s=null==e?s:s.y(this.wrapForNode(e)),s=null==t?s:s.strength(this.wrapForNode(t)),s}}S.model_name="YForceModel",S.serializers={...y.serializers,y:x.x,strength:x.x};class O extends y{get _modelClass(){return O}forceFactory(){return(0,v.forceZ)()}get force(){const{z:e,strength:t}=this._nodeFacets;let s=this._force;return s=null==e?s:s.z(this.wrapForNode(e)),s=null==t?s:s.strength(this.wrapForNode(t)),s}}O.model_name="ZForceModel",O.serializers={...y.serializers,z:x.x,strength:x.x};class P extends y{get _modelClass(){return P}forceFactory(){}refreshBehavior(e){const{mode:t,level_distance:s,node_filter:n}=this._nodeFacets,i=this.active&&t?t():null;if(i){e.dagMode(i),e.dagLevelDistance(s?s():null);const t=n?this.wrapForNode(n):h;e.dagNodeFilter(t)}else e.dagMode(null),e.dagLevelDistance(null),e.dagNodeFilter(h)}}P.model_name="DAGBehaviorModel",P.serializers={...y.serializers,mode:x.x,level_distance:x.x,node_filter:x.x};class A extends f{get zoom(){return this.get("zoom")}set zoom(e){this.set("zoom",e)}get lookAt(){return this.get("look_at")}set lookAt(e){this.set("look_at",e&&e.length?e:null)}get center(){return this.get("center")}set center(e){this.set("center",e)}is3d(e){return e.hasOwnProperty("nodeThreeObject")}}class j extends A{defaults(){return{...super.defaults(),...a.sB,_model_name:j.model_name,zoom:0,center:[0,0],visible:[],capturing:!1}}get visible(){return this.get("visible")||[]}set visible(e){this.set("visible",e)}get captureVisible(){return this.get("capturing")}set captureVisible(e){this.set("capturing",e)}onZoom(e){const{graph:t,k:s,lookAt:n}=e,i=this.is3d(t),r=null==e.z?[]:[e.z];this.center=[e.x,e.y,...r],this.zoom=s,this.lookAt=null!=e.lookAt?[n.x,n.y,n.z]:null,this.captureVisible&&(this.visible=i?this.getVisible3d(e):this.getVisible2d(e));try{this.save()}catch(e){}}getVisible3d(e){const t=e.graph,s=[];let n=0;const{THREE:i}=e.iframeClasses,r=t.camera(),o=(new i.Frustum).setFromProjectionMatrix((new i.Matrix4).multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse));for(let e of t.graphData().nodes){let t=e.__threeObj;(o.containsPoint(t.position)||o.intersectsObject(t))&&s.push(n),n++}return s}getVisible2d(e){const{graph:t,k:s}=e,n=t.width()/2/s,i=t.height()/2/s,r=[e.x-n,e.x+n],o=[e.y-i,e.y+i],a=[];let l=0;for(let{x:e,y:s}of t.graphData().nodes)e>=r[0]&&e<=r[1]&&s>=o[0]&&s<=o[1]&&a.push(l),l++;return a}}j.model_name="GraphCameraModel";class G extends A{constructor(){super(...arguments),this._resetting=!1,this._doneResetting=()=>{this._resetting=!1}}get _modelClass(){return G}defaults(){return{...super.defaults(),...a.sB,_model_name:j.model_name,zoom:null,visible:null,fit_padding:null,center:null,zoom_first:!1,zoom_duration:.2,pan_duration:.2,fit_duration:.2}}initialize(e,t){super.initialize(e,t),this.on("change:zoom change:center change:visible change:fit_padding",this.onZoomChanged,this),this.updateRequested.connect(this.onZoomChanged,this),this.onZoomChanged()}get zoomFirst(){return this.get("zoom_first")}set zoomFirst(e){this.set("zoom_first",e)}get zoomDuration(){return 1e3*(this.get("zoom_duration")||0)}set zoomDuration(e){this.set("zoom_duration",e)}get panDuration(){return 1e3*(this.get("pan_duration")||0)}set panDuration(e){this.set("pan_duration",e)}get fitDuration(){return 1e3*(this.get("fit_duration")||0)}set fitDuration(e){this.set("fit_duration",e)}get fitPadding(){return this.get("fit_padding")}set fitPadding(e){this.set("fit_padding",e)}onZoomChanged(){this._resetting||this._graphCameraUpdateRequested.emit()}async updateGraphCamera(e){const{graph:t}=e,s=this.is3d(t);let n=null;if(this.get("visible")&&(await this.ensureFacets(),n=this._nodeFacets.visible),n){const e=this.wrapForNode(n);t.zoomToFit(this.fitDuration,this.fitPadding,e)}else{if(s){const{lookAt:s,center:n}=this;if(!s||!n)return;let i=t;const{Vector3:r}=e.iframeClasses.THREE,o=new r(...s),[a,l,h]=n;i.cameraPosition({x:a,y:l,z:h},o,this.zoomDuration)}else{const e=this.zoom,[s,n]=this.center||[];this.zoomFirst?(null!=e&&t.zoom(e,this.zoomDuration),(null!=s||null!=n)&&t.centerAt(s,n,this.panDuration)):((null!=s||null!=n)&&t.centerAt(s,n,this.panDuration),null!=e&&t.zoom(e,this.zoomDuration))}this._resetting=!0,this.save({zoom:null,center:null,look_at:null}),setTimeout(this._doneResetting,this.panDuration+this.zoomDuration)}}}G.model_name="GraphDirectorModel",G.serializers={...f.serializers,visible:x.x};class U extends _{constructor(){super(...arguments),this._sourcesToCapture=0}defaults(){return{...super.defaults(),...a.sB,_model_name:U.model_name,capturing:!1,source_count:1,sources:[]}}get sourceCount(){return this.get("source_count")}get capturing(){return this.get("capturing")}get sources(){return this.get("sources")}initialize(e,t){super.initialize(e,t),this.on("change:capturing",this.onCapturingChanged,this),this.onCapturingChanged()}onCapturingChanged(e){this._sourcesToCapture=this.capturing?this.sourceCount:0,this._sourcesToCapture&&this._updateRequested.emit(a.k$.Render)}getExtraColumns(e){const t=[],s=[];for(const n of e){const{extraColumns:e}=n;e&&(t.push(...e.nodes),s.push(...e.links))}return{nodes:t,links:s}}onRender(e){const{_sourcesToCapture:t}=this;if(!t)return;const{sourceCount:s,sources:n}=this,i=s-t;this._sourcesToCapture-=1;let r=n[i];if(r.setFromGraphData(e.graphData,this.getExtraColumns(e.view.model.behaviors)),!this._sourcesToCapture){for(r of n)r.save();this.set({capturing:!1}),this.save()}}}U.model_name="GraphDataModel",U.serializers={...r.WidgetModel.serializers,sources:x.x};class W extends _{constructor(){super(...arguments),this._framesToCapture=0,this.onBlob=async(e,t,s)=>{let n=this.frames[e];const i=new DataView(await s.arrayBuffer());if(n.set({value:i}),t){for(n of this.frames)n.save();this.set({capturing:!1}),this.save()}}}defaults(){return{...super.defaults(),...a.sB,_model_name:W.model_name,enabled:!1,frame_count:1,frames:[]}}get frameCount(){return this.get("frame_count")}get capturing(){return this.get("capturing")}get frames(){return this.get("frames")}initialize(e,t){super.initialize(e,t),this.on("change:capturing",this.onCapturingChanged,this),this.onCapturingChanged()}onCapturingChanged(e){this._framesToCapture=this.capturing?this.frameCount:0,this._framesToCapture&&this._updateRequested.emit(a.k$.Render)}onRender(e){const{_framesToCapture:t}=this;if(!t)return;const{frameCount:s}=this,n=s-t;this._framesToCapture-=1;const{context2d:i,renderer3d:r}=e;let o=null;i?o=i.canvas:r&&(o=r.domElement),null!=o?o.toBlob(this.onBlob.bind(this,n,0===this._framesToCapture)):console.warn(`${a.Dd} couldn't handle post render of`,e)}}W.model_name="GraphImageModel",W.serializers={...r.WidgetModel.serializers,frames:x.x};class q extends f{get _modelClass(){return q}getLinkDirectionalArrowColor(e){return this._linkFacets.color?this._linkFacets.color(e):null}getLinkDirectionalArrowLength(e){return this._linkFacets.length?this._linkFacets.length(e):null}getLinkDirectionalArrowRelPos(e){return this._linkFacets.relative_position?this._linkFacets.relative_position(e):null}}q.model_name="LinkArrowModel",q.serializers={...f.serializers,length:x.x,color:x.x,relative_position:x.x};class $ extends f{get _modelClass(){return $}getLinkDirectionalParticleColor(e){return this._linkFacets.color?this._linkFacets.color(e):null}getLinkDirectionalParticleSpeed(e){return this._linkFacets.speed?this._linkFacets.speed(e):null}getLinkDirectionalParticles(e){return this._linkFacets.density?this._linkFacets.density(e):null}getLinkDirectionalParticleWidth(e){return this._linkFacets.width?this._linkFacets.width(e):null}}$.model_name="LinkParticleModel",$.serializers={...f.serializers,color:x.x,density:x.x,speed:x.x,width:x.x};class E extends _{constructor(){super(...arguments),this.onLinkClick=({link:e,index:t,event:s,graphData:n})=>{let{selected:i,columnName:r,multiple:o}=this;const a=i.has(t);if(o&&(s.ctrlKey||s.shiftKey||s.altKey))a?i.delete(t):i.add(t);else{if(r)for(const e of i){const t=n.links[e];t&&(t[r]=!1)}i.clear(),!a&&i.add(t)}return r&&(e[r]=!a),this.selected=i,!0}}defaults(){return{...super.defaults(),...a.sB,_model_name:E.model_name,selected:[],selected_color:a._F.selected,selected_curvature:a.BT.selected,selected_line_dash:a.xz.selected,selected_width:a.H8.selected,multiple:!0}}initialize(e,t){super.initialize(e,t),this.on("change:selected change:column_name",this.onValueChange,this),this.onValueChange()}get extraColumns(){return{links:this.columnName?[this.columnName]:[],nodes:[]}}onValueChange(e){this._updateRequested.emit(a.k$.Render),this.columnName&&this._graphDataUpdateRequested.emit(void 0)}async updateGraphData(e){const{selected:t,columnName:s}=this;if(!s)return;const{links:n}=e,i=n.length;for(let e=0;e<i;e++)n[e][s]=t.has(e)}get selected(){return new Set([...this.get("selected")||[]])}set selected(e){this.set({selected:[...e]}),this.save_changes()}get selectedColor(){return this.get("selected_color")||a._F.selected}get selectedCurvature(){return this.get("selected_curvature")||a.BT.selected}get selectedLineDash(){return this.get("selected_line_dash")||a.xz.selected}get selectedWidth(){return this.get("selected_width")||a.H8.selected}get columnName(){return this.get("column_name")||null}get multiple(){return this.get("multiple")}getLinkColor({index:e}){return this.selected.has(e)?this.selectedColor:null}getLinkCurvature({index:e}){const t=this.selected.has(e)?this.selectedCurvature:null;return null!=t?parseFloat(t):null}getLinkLineDash({index:e}){const t=this.selected.has(e)?this.selectedLineDash:null;return null!=t?"string"==typeof t?JSON.parse(t):t:null}getLinkWidth({index:e}){const t=this.selected.has(e)?this.selectedWidth:null;return null!=t?parseFloat(t):null}}E.model_name="LinkSelectionModel";class H extends f{get _modelClass(){return H}getLinkColor(e){return this._linkFacets.color?this._linkFacets.color(e):null}getLinkCurvature(e){return this._linkFacets.curvature?this._linkFacets.curvature(e):null}getLinkLineDash(e){return this._linkFacets.line_dash?this._linkFacets.line_dash(e):null}getLinkWidth(e){return this._linkFacets.width?this._linkFacets.width(e):null}}H.model_name="LinkShapeModel",H.serializers={...f.serializers,color:x.x,curvature:x.x,line_dash:x.x,width:x.x};class J extends f{get _modelClass(){return J}getLinkLabel(e){return this._linkFacets.label?this._linkFacets.label(e):null}}J.model_name="LinkTooltipModel",J.serializers={...f.serializers,label:x.x};class I extends _{constructor(){super(...arguments),this.onNodeClick=({node:e,index:t,event:s,graphData:n})=>{let{selected:i,multiple:r,columnName:o}=this;const a=i.has(t);if(r&&(s.ctrlKey||s.shiftKey||s.altKey))a?i.delete(t):i.add(t);else{if(o)for(const e of i){const t=n.nodes[e];t&&(t[o]=!1)}i.clear(),!a&&i.add(t)}return o&&(e[o]=!a),this.selected=i,!0}}defaults(){return{...super.defaults(),...a.sB,_model_name:I.model_name,selected:[],selected_color:a._F.selected,multiple:!0}}get extraColumns(){return{links:[],nodes:this.columnName?[this.columnName]:[]}}initialize(e,t){super.initialize(e,t),this.on("change:selected change:column_name",this.onValueChange,this),this.onValueChange()}onValueChange(e){this._updateRequested.emit(a.k$.Render),this.columnName&&this._graphDataUpdateRequested.emit(void 0)}async updateGraphData(e){const{selected:t,columnName:s}=this;if(!s)return;const{nodes:n}=e,i=n.length;for(let e=0;e<i;e++)n[e][s]=t.has(e)}get selected(){return new Set([...this.get("selected")||[]])}set selected(e){this.set({selected:[...e]}),this.save_changes()}get selectedColor(){return this.get("selected_color")||a._F.selected}get columnName(){return this.get("column_name")||null}get multiple(){return this.get("multiple")}getNodeColor({node:e}){const t=e.index;return null!=t&&this.selected.has(t)?this.selectedColor:null}}I.model_name="NodeSelectionModel";class V extends f{get _facetClass(){return V}getNodeSize(e){return this._nodeFacets.size?this._nodeFacets.size(e):null}getNodeColor(e){return this._nodeFacets.color?this._nodeFacets.color(e):null}}V.model_name="NodeShapeFacetsModel",V.serializers={..._.serializers,size:x.x,color:x.x};class Z extends V{defaults(){return{...super.defaults(),_model_name:Z.model_name,shapes:[]}}get _modelClass(){return Z}initialize(e,t){super.initialize(e,t),this.on("change:shapes",this.onShapesChanged,this),this.onShapesChanged.call(this)}async onShapesChanged(){for(const e of this.shapes)await e.ensureFacets(),e.updateRequested.connect(this.onShapesChanged,this);const e=this;this.shapes.length&&!e.getNodeCanvasObject?(e.getNodeCanvasObject=this._getNodeCanvasObject,e.getNodeThreeObject=this._getNodeThreeObject,this._updateRequested.emit(a.k$.Behavior)):this.shapes.length&&!e.getNodeCanvasObject?(delete e.getNodeCanvasObject,delete e.getNodeThreeObject,this._updateRequested.emit(a.k$.Behavior)):this._updateRequested.emit(void 0)}get shapes(){return this.get("shapes")||a.ow}_getNodeCanvasObject(e){for(const t of this.shapes)t.drawNode2D(e)}_getNodeThreeObject(e){for(const t of this.shapes){const s=t.drawNode3D(e);if(s)return s}}}Z.model_name="NodeShapeModel",Z.serializers={...V.serializers,shapes:x.x};class Y extends f{get _modelClass(){return Y}getNodeLabel(e){return this._nodeFacets.label?this._nodeFacets.label(e):null}}Y.model_name="NodeTooltipModel",Y.serializers={...f.serializers,label:x.x};const K=[l,l];class Q extends w{initialize(e,t){super.initialize(e,t),this.on("change:scheme change:domain",this.valueChanged,this)}async _buildHandlers(e,t){let{scheme:n,domain:i}=this;const r=i[0],o=i.slice(-1)[0],a=(await s.e(303).then(s.t.bind(s,2303,23)))[`interpolate${n}`];if(!a)return console.warn(`${n} cannot be interpolated`),K;const l=o-r;return[function(s){const n=t(s.node?s.node[e]:null);return null==n?n:a((n-r)/l)},function(s){const n=t(s.link?s.link[e]:null);return null==n?n:a((n-r)/l)}]}get scheme(){return this.get("scheme")}get domain(){return this.get("domain")||[0,1]}}class X extends w{initialize(e,t){super.initialize(e,t),this.on("change:scheme change:domain change:range change:sub_scheme",this.valueChanged,this)}async _buildHandlers(e,t){let{scheme:n,range:i,domain:r}=this;const[o,a]=await Promise.all([s.e(303).then(s.t.bind(s,2303,23)),s.e(253).then(s.t.bind(s,4253,23))]);if(n){const e=o[`scheme${n}`];e&&(i=e)}const l=a.scaleOrdinal(i).domain(r);return[function(s){const n=t(s.node?s.node[e]:null);return null==n?n:l(n)},function(s){const n=t(s.link?s.link[e]:null);return null==n?n:l(n)}]}get scheme(){return this.get("scheme")}get domain(){return this.get("domain")||[0,1]}get range(){return this.get("range")||[]}}const ee="rgba(0,0,0,0)",te=2*Math.PI,se=Object.freeze({width:12,height:12,depth:12,opacity:.75,fill:ee,scale_on_zoom:!1,stroke:ee,stroke_width:2}),ne=Object.freeze({width:12,height:12,depth:12,opacity:.75,fill:ee,scale_on_zoom:!1,stroke:ee,stroke_width:2}),ie=Object.freeze({size:12,fill:"rgba(0,0,0,1)",font:"sans-serif",padding:.2,text:"",scale_on_zoom:!0,stroke_width:2});class re extends f{drawNode2D(e){}drawNode3D(e){}_resolveFacets(e,t){const s={},n="link"==t?this._linkFacets:this._nodeFacets;for(const t of this._facetNames)if(n[t])try{s[t]=n[t](e)}catch(s){console.warn(`${a.Dd} encountered error for ${t}`,e,s)}return s}}re.model_name="ShapeBaseModel";class oe extends re{get _facetClass(){return oe}get shapeDefaults(){throw new Error(`${a.Dd} missing shape defaults for ${this._modelClass}`)}drawNode2D(e){const{context:t,node:s,globalScale:n}=e,{x:i,y:r}=s,o={...this.shapeDefaults,context:t,globalScale:n,x:i,y:r,...this._resolveFacets(e,a.TP.node)};o.width&&this._drawCanvas(o)}drawNode3D(e){const{node:t,iframeClasses:s}=e,{x:n,y:i}=t,r={...this.shapeDefaults,context:null,globalScale:null,x:n,y:i,iframeClasses:s,...this._resolveFacets(e,a.TP.node)};return r.width?this._drawThree(r):null}_drawCanvasPath(e){throw new Error(`${a.Dd} does not draw canvas ${this._modelClass}`)}_drawCanvas(e){const{context:t,globalScale:s,fill:n,scale_on_zoom:i,stroke_width:r,opacity:o,stroke:a}={...ne,...e};t.globalAlpha=o,t.fillStyle=n,t.strokeStyle=a,t.lineWidth=i?r/s:r,t.setLineDash(e.line_dash||[]),t.beginPath(),this._drawCanvasPath(e),t.fill(),t.stroke()}_drawThreeGeometry(e){throw new Error(`${a.Dd} doesn't implement 3d geometry ${this._modelClass}`)}_drawThree(e){const{fill:t,iframeClasses:s,opacity:n}={...ne,...e},i=s.THREE,r=this._drawThreeGeometry(e),o=new i.MeshLambertMaterial({color:t,transparent:!0,opacity:n});return new i.Mesh(r,o)}}oe.serializers={...re.serializers,width:x.x,height:x.x,depth:x.x,fill:x.x,opacity:x.x,stroke:x.x,stroke_width:x.x,scale_on_zoom:x.x,line_dash:x.x};class ae extends re{get _modelClass(){return ae}drawNode2D(e){const{context:t,node:s,globalScale:n}=e,{x:i,y:r}=s,o={...ie,context:t,globalScale:n,x:i,y:r,...this._resolveFacets(e,a.TP.node)};null!=o.text&&`${o.text}`.trim().length&&this._drawCanvas(o)}drawNode3D(e){const{node:t,iframeClasses:s}=e,{x:n,y:i}=t,r={...ie,context:null,globalScale:null,x:n,y:i,iframeClasses:s,...this._resolveFacets(e,a.TP.node)};return r.text?this._drawThree(r):null}_drawThree(e){const{text:t,fill:s,font:n,size:i,stroke:r,stroke_width:o,background:a,padding:l,iframeClasses:h}={...ie,...e},d=new(0,h.SpriteText)(t);return d.material.depthWrite=!1,d.textHeight=i,d.color=s,d.fontFace=n,d.fontSize=i,r&&(d.strokeColor=r,d.strokeWidth=o),a&&(d.backgroundColor=a,d.padding=l),d}_drawCanvas(e){const{context:t,text:s,size:n,globalScale:i,font:r,padding:o,fill:a,background:l,x:h,y:d,scale_on_zoom:c,stroke_width:u,stroke:g,line_dash:p}={...ie,...e},m=c?n/i:n;t.font=`${m}px ${r}`;const _=[t.measureText(s).width+m*o,m+m*o];l&&(t.fillStyle=l,t.fillRect(h-_[0]/2,d-_[1]/2,_[0],_[1])),t.textAlign="center",t.textBaseline="middle",g&&(t.setLineDash(p||[]),t.strokeStyle=g,t.lineWidth=c?u/i:u,t.strokeText(s,h,d)),t.fillStyle=a,t.fillText(s,h,d)}}ae.model_name="TextShapeModel",ae.serializers={...re.serializers,text:x.x,font:x.x,size:x.x,fill:x.x,stroke:x.x,stroke_width:x.x,background:x.x,padding:x.x,scale_on_zoom:x.x,line_dash:x.x};class le extends oe{get _modelClass(){return le}get shapeDefaults(){return se}_drawCanvasPath(e){const{width:t,height:s,context:n,x:i,y:r,scale_on_zoom:o,globalScale:a}=e,l=t/2,h=s/2;n.ellipse(i,r,o?l/a:l,o?h/a:h,0,0,te)}_drawThreeGeometry(e){const{height:t,width:s,depth:n,scale_on_zoom:i,globalScale:r}=e,o=e.iframeClasses.THREE,a=new o.SphereGeometry(i?s/r:s);return a.applyMatrix4((new o.Matrix4).makeScale(1,t/s,n/s)),a}}le.model_name="EllipseShapeModel";class he extends oe{get _modelClass(){return he}get shapeDefaults(){return ne}_drawCanvasPath(e){const{width:t,height:s,context:n,x:i,y:r,scale_on_zoom:o,globalScale:a}=e,l=o?t/a:t,h=o?s/a:s;n.rect(i-l/2,r-h/2,l,h)}_drawThreeGeometry(e){return new e.iframeClasses.THREE.BoxGeometry(e.width,e.height,e.depth)}}he.model_name="RectangleShapeModel";var de=s(125);class ce extends r.DOMWidgetModel{defaults(){return{...super.defaults(),...a.sB,_model_name:ce.model_name,_view_name:ue.view_name,source:null,behaviors:[],background_color:a._F.background,default_link_color:a._F.link,default_link_curvature:a.BT.link,default_link_line_dash:a.xz.link,default_link_width:a.H8.link,default_node_color:a._F.node,default_node_size:a.H8.node}}initialize(e,t){super.initialize(e,t),this.on("change:behaviors",this.onBehaviorsChange,this),this.onBehaviorsChange()}compareRank(e,t){return e.rank-t.rank||parseInt(e.cid.slice(1))-parseInt(t.cid.slice(1))}async onBehaviorsChange(){this._behaviorsChanged||(this._behaviorsChanged=new i.Signal(this),this._linkBehaviorsByMethod=[],this._nodeBehaviorsByMethod=[],this._graphBehaviorsByMethod=[]);const{behaviors:e}=this;for(let[t,s]of Object.entries(a.Tf)){let n=[];for(const s of e)s[t]&&n.push(s);this._linkBehaviorsByMethod[s]=n.sort(this.compareRank)}for(let[t,s]of Object.entries(a.js)){let n=[];for(const s of e)s[t]&&n.push(s);this._nodeBehaviorsByMethod[s]=n.sort(this.compareRank)}for(let[t,s]of Object.entries(a.Yb)){let n=[];for(const s of e)s[t]&&n.push(s);this._graphBehaviorsByMethod[s]=n.sort(this.compareRank)}let t=[];for(const s of e)s instanceof F&&t.push(s);this._forceBehaviors=t.sort(this.compareRank),this._behaviorsChanged.emit(void 0)}get linkBehaviorsByMethod(){return this._linkBehaviorsByMethod}get nodeBehaviorsByMethod(){return this._nodeBehaviorsByMethod}get graphBehaviorsByMethod(){return this._graphBehaviorsByMethod}get forceBehaviors(){return this._forceBehaviors}get graphData(){const e=this.get("source");return e?e.graphData:a.tM}get preservedColumns(){const e=this.get("source");return e?e.preservedColumns:a.EC}get behaviors(){return this.get("behaviors")||[]}get behaviorsChanged(){return this._behaviorsChanged}get previousBehaviors(){return this.previous&&this.previous("behaviors")||[]}get defaultNodeColor(){return this.get("default_node_color")||a._F.node}get defaultNodeSize(){return this.get("default_node_size")||a.H8.node}get defaultLinkColor(){return this.get("default_link_color")||a._F.link}get defaultLinkCurvature(){return this.get("default_link_curvature")||a.BT.link}get defaultLinkLineDash(){return this.get("default_link_line_dash")||a.xz.link}get defaultLinkWidth(){return this.get("default_link_width")||a.H8.link}get backgroundColor(){return this.get("background_color")||a._F.background}}ce.model_name="ForceGraphModel",ce.serializers={...r.DOMWidgetModel.serializers,source:x.x,behaviors:x.x};class ue extends r.DOMWidgetView{constructor(){super(...arguments),this.onFrameLoaded=async e=>{const t=e.currentTarget,{contentWindow:s}=t,n=s.init(),i=n.graph;this._iframeClasses=n.iframeClasses,this.graph=i,s.addEventListener("resize",this.onWindowResize),this._rendered.resolve(void 0),await this.onGraphInitialized(),await this.redraw()},this.onWindowResize=()=>{const{contentWindow:e}=this._iframe,t=this.graph;t.width(e.innerWidth),t.height(e.innerHeight)},this.wrapFunction=e=>this._iframe.contentWindow.wrapFunction(e),this.postForceUpdate=e=>{const{links:t}=this.graph.graphData();if(!t.length)return;const s=typeof t[0].source;if("string"===s||"number"===s)return setTimeout(this.postForceUpdate,250,e),void(a.eM&&console.log("Polling postForceUpdate..."));for(let s of e)s.links&&s.links(t)},this.getLinkColor=e=>this.getComposedLinkAttr(e,a.Tf.getLinkColor,"getLinkColor",this.model.defaultLinkColor),this.getLinkCurvature=e=>this.getComposedLinkAttr(e,a.Tf.getLinkCurvature,"getLinkCurvature",this.model.defaultLinkCurvature),this.getLinkLineDash=e=>this.getComposedLinkAttr(e,a.Tf.getLinkLineDash,"getLinkLineDash",this.model.defaultLinkLineDash),this.getLinkWidth=e=>this.getComposedLinkAttr(e,a.Tf.getLinkWidth,"getLinkWidth",this.model.defaultLinkWidth),this.getLinkLabel=e=>this.getComposedLinkAttr(e,a.Tf.getLinkLabel,"getLinkLabel",""),this.getLinkDirectionalArrowColor=e=>this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalArrowColor,"getLinkDirectionalArrowColor",""),this.getLinkDirectionalArrowLength=e=>this.castToNumber(this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalArrowLength,"getLinkDirectionalArrowLength","")),this.getLinkDirectionalArrowRelPos=e=>this.castToNumber(this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalArrowRelPos,"getLinkDirectionalArrowRelPos","")),this.getLinkDirectionalParticleColor=e=>this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalParticleColor,"getLinkDirectionalParticleColor",""),this.getLinkDirectionalParticleSpeed=e=>this.castToNumber(this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalParticleSpeed,"getLinkDirectionalParticleSpeed","")),this.getLinkDirectionalParticleWidth=e=>this.castToNumber(this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalParticleWidth,"getLinkDirectionalParticleWidth","")),this.getLinkDirectionalParticles=e=>this.castToNumber(this.getComposedLinkAttr(e,a.Tf.getLinkDirectionalParticles,"getLinkDirectionalParticles","")),this.getNodeColor=e=>this.getComposedNodeAttr(e,a.js.getNodeColor,"getNodeColor",this.model.defaultNodeColor),this.getNodeLabel=e=>this.getComposedNodeAttr(e,a.js.getNodeLabel,"getNodeLabel",""),this.getNodeSize=e=>this.getComposedNodeAttr(e,a.js.getNodeSize,"getNodeSize",this.model.defaultNodeSize),this.getNodeCanvasObject=(e,t,s)=>{let n;const i={view:this,context:t,graphData:this.graph.graphData(),node:e,globalScale:s};for(const e of this._nodeBehaviorsByMethod[a.js.getNodeCanvasObject])if(n=e.getNodeCanvasObject.call(e,i),null!=n)break},this.onNodeClick=(e,t)=>{const s=this.graph.graphData();let n=!0;const i={view:this,graphData:s,event:t,node:e,index:null!=e.index?e.index:s.nodes.indexOf(e)};for(const e of this._nodeBehaviorsByMethod[a.js.onNodeClick])if(n=e.onNodeClick(i),!n)return},this.onLinkClick=(e,t)=>{const s=this.graph.graphData();let n=!0;const i={view:this,graphData:s,event:t,link:e,index:null!=e.index?e.index:s.links.indexOf(e)};for(const e of this._linkBehaviorsByMethod[a.Tf.onLinkClick])if(n=e.onLinkClick(i),!n)return},this.onZoom=e=>{const t=e.graph||this.graph;for(const s of this._graphBehaviorsByMethod[a.Yb.onZoom])s.onZoom({...e,graph:t})},this.onRender=(e,t)=>{let s={view:this,graphData:this.graph.graphData(),context2d:e,globalScale:t};s=this.updateRenderOptions(s);for(const e of this._graphBehaviorsByMethod[a.Yb.onRender])e.onRender(s)}}get source(){return this.model.get("source")}get previousSource(){return this.model.previous&&this.model.previous("source")||null}get rendered(){return this._rendered.promise}initialize(e){super.initialize(e),this.luminoWidget.addClass(a.ux.widget),this.luminoWidget.addClass(`${a.ux.widget}-${this.graphJsClass}`),this._rendered=new n.PromiseDelegate,this.model.on("change:source",this.onSourceChange,this),this.model.on("change:default_node_color change:default_link_color change:background_color change:default_node_size change:default_link_width change:default_link_curvature change:default_link_line_dash",this.postUpdate,this),this.model.behaviorsChanged.connect(this.onBehaviorsChange,this),this.luminoWidget.disposed.connect(this.onDisposed,this),this.model.on("msg:custom",this.handleMessage,this),this.onSourceChange(),this.onBehaviorsChange()}handleMessage(e){const t=this.graph;if(t)if("reheat"===e.action)t.d3ReheatSimulation();else{const t=e.action;console.error(`${a.Dd} Unhandled custom action: ${t}`)}else console.warn(`${a.Dd} graph was not yet initialized, discarding`,e)}onDisposed(){this.graph&&(this.graph._destructor(),delete this.graph,this.graph=null),this._iframe&&(this._iframe.removeEventListener("resize",this.onWindowResize),this._iframe.onload=null,delete this._iframe,this._iframe=null),this.luminoWidget.disposed.disconnect(this.onDisposed)}async render(){const e=this.el,t=document.createElement("iframe"),s=await this.getIframeSource();t.setAttribute("srcdoc",s),t.onload=this.onFrameLoaded,e.appendChild(t),this._iframe=t}async onGraphInitialized(){}async getJsUrls(){return[(await s.e(460).then(s.bind(s,9460))).default]}get graphJsClass(){return"ForceGraph"}get extraJsClasses(){return"{}"}async getIframeSource(){let e=await this.getJsUrls(),t="";for(const s of e)t+=`<script src="${s}"><\/script>\n`;return`\n      <head>\n        ${t}\n        <style>\n          body, #main {\n            overflow: hidden;\n            position: absolute;\n            left: 0;\n            top: 0;\n            right: 0;\n            bottom: 0;\n            margin: 0;\n            padding: 0;\n          }\n        </style>\n      </head>\n      <body>\n        <script>\n          window.process = {\n            env: {\n              NODE_ENV: '${a.eM?"development":"production"}'\n            }\n          };\n          window.init = (args) => {\n            const div = document.createElement('div');\n            document.body.appendChild(div);\n            return {\n              graph: ${this.graphJsClass}(args || {})(div),\n              iframeClasses: ${this.extraJsClasses}\n            };\n          }\n          window.wrapFunction = (fn) => {\n            return (...args) => {\n              return fn(...args);\n            };\n          }\n        <\/script>\n      </body>\n    `}async redraw(){await this._rendered.promise,await this.postUpdate();const e=this.graph;if(!e)return void console.warn(`${a.Dd} no graph to redraw`);e.pauseAnimation();const{preservedColumns:t}=this.model;let s=this.model.graphData;const n=e.graphData();let i=!0;if(n.nodes.length&&(t.nodes.length||t.links.length)){const{source:e}=this;s=e.mergePreserved(s,n,t),i=null!=s}i&&(a.eM&&console.warn(`${a.Dd} updating...`,s),e.graphData(s)),e.resumeAnimation()}onSourceChange(e){const{source:t,previousSource:s}=this;s&&s.dataUpdated.disconnect(this.redraw,this),t&&(t.dataUpdated.connect(this.redraw,this),this.redraw())}async ensureAllFacets(){let e=[];for(const t of this.model.behaviors)t.ensureFacets&&e.push(t.ensureFacets());e.length&&await Promise.all(e)}async ensureBehaviorCache(){this._nodeBehaviorsByMethod=this.model.nodeBehaviorsByMethod,this._linkBehaviorsByMethod=this.model.linkBehaviorsByMethod,this._graphBehaviorsByMethod=this.model.graphBehaviorsByMethod}async onGraphDataUpdateRequested(e){const t=this.graph;t&&e.updateGraphData&&await e.updateGraphData(t.graphData())}async onGraphCameraUpdateRequested(e){const t=this.graph;t&&e.updateGraphCamera&&await e.updateGraphCamera({graph:t,iframeClasses:this._iframeClasses})}async postUpdate(e,t){await this.displayed,await this.rendered;const s=this.graph;if(!s)return void console.warn(`${a.Dd} no graph to postUpdate`);if(t&&a.k$.Behavior===(t&a.k$.Behavior))return void await this.model.onBehaviorsChange();await this.ensureAllFacets(),await this.ensureBehaviorCache();const{_linkBehaviorsByMethod:n,_nodeBehaviorsByMethod:i}=this,{backgroundColor:r,defaultLinkColor:o,defaultNodeColor:l,defaultLinkWidth:h,defaultLinkCurvature:d,defaultLinkLineDash:c,defaultNodeSize:u}=this.model;s.backgroundColor(r),s.linkColor(n[a.Tf.getLinkColor].length?this.wrapFunction(this.getLinkColor):this.wrapFunction((()=>o))),s.linkWidth(n[a.Tf.getLinkWidth].length?this.wrapFunction(this.getLinkWidth):this.wrapFunction((()=>h))),s.linkCurvature(n[a.Tf.getLinkCurvature].length?this.wrapFunction(this.getLinkCurvature):this.wrapFunction((()=>d))),"function"==typeof s.linkLineDash&&s.linkLineDash(n[a.Tf.getLinkLineDash].length?this.wrapFunction(this.getLinkLineDash):this.wrapFunction((()=>c))),s.linkLabel(n[a.Tf.getLinkLabel].length?this.wrapFunction(this.getLinkLabel):null),s.linkDirectionalArrowColor(n[a.Tf.getLinkDirectionalArrowColor].length?this.wrapFunction(this.getLinkDirectionalArrowColor):null),s.linkDirectionalArrowLength(n[a.Tf.getLinkDirectionalArrowLength].length?this.wrapFunction(this.getLinkDirectionalArrowLength):null),s.linkDirectionalArrowRelPos(n[a.Tf.getLinkDirectionalArrowRelPos].length?this.wrapFunction(this.getLinkDirectionalArrowRelPos):null),s.linkDirectionalParticleColor(n[a.Tf.getLinkDirectionalParticleColor].length?this.wrapFunction(this.getLinkDirectionalParticleColor):null),s.linkDirectionalParticleSpeed(n[a.Tf.getLinkDirectionalParticleSpeed].length?this.wrapFunction(this.getLinkDirectionalParticleSpeed):null),s.linkDirectionalParticleWidth(n[a.Tf.getLinkDirectionalParticleWidth].length?this.wrapFunction(this.getLinkDirectionalParticleWidth):null),s.linkDirectionalParticles(n[a.Tf.getLinkDirectionalParticles].length?this.wrapFunction(this.getLinkDirectionalParticles):null),s.nodeColor(i[a.js.getNodeColor].length?this.wrapFunction(this.getNodeColor):this.wrapFunction((()=>l))),s.nodeVal(i[a.js.getNodeSize].length?this.wrapFunction(this.getNodeSize):this.wrapFunction((()=>u))),s.nodeLabel(i[a.js.getNodeLabel].length?this.wrapFunction(this.getNodeLabel):null),s.onNodeClick(i[a.js.onNodeClick].length?this.wrapFunction(this.onNodeClick):null),s.onLinkClick(n[a.Tf.onLinkClick].length?this.wrapFunction(this.onLinkClick):null),this.getForceUpdate(),this.getOnRenderPostUpdate(),t&&a.k$.Reheat===(t&a.k$.Reheat)&&s.d3ReheatSimulation()}getForceUpdate(){const e=this.graph;let t=[];for(let s of this.model.forceBehaviors){const{warmupTicks:n,cooldownTicks:i,alphaDecay:r,alphaMin:o,velocityDecay:a}=s;s.checkPositions(e),e.cooldownTicks(i),e.warmupTicks(n),e.d3AlphaDecay(r),e.d3AlphaMin(o),e.d3VelocityDecay(a);for(let n in s.forces){let i=s.forces[n],r=(null==i?void 0:i.force)||null;r&&!(null==i?void 0:i.active)&&(r=null),i instanceof P?i.refreshBehavior(e):e.d3Force(n,r),(null==r?void 0:r.links)&&t.push(r)}}t.length&&setTimeout(this.postForceUpdate,250,t)}getOnRenderPostUpdate(){const e=this.graph;if(e.nodeCanvasObject(this._nodeBehaviorsByMethod[a.js.getNodeCanvasObject].length?this.wrapFunction(this.getNodeCanvasObject):null),e.onRenderFramePost(this._graphBehaviorsByMethod[a.Yb.onRender].length?this.wrapFunction(this.onRender):null),this._graphBehaviorsByMethod[a.Yb.onZoom].length){const t=new de.eD(this.wrapFunction((e=>this.onZoom(e))),a.BU);e.onZoom((e=>t.invoke(e)))}else e.onZoom(null)}async onBehaviorsChange(){const{behaviors:e,previousBehaviors:t}=this.model;for(const e of t)e.updateRequested.disconnect(this.postUpdate,this);for(const t of e)t.updateRequested.connect(this.postUpdate,this),t.graphDataUpdateRequested.connect(this.onGraphDataUpdateRequested,this),t.graphCameraUpdateRequested.connect(this.onGraphCameraUpdateRequested,this);await this.postUpdate()}castToNumber(e){return null==e?e:"string"==typeof e?parseFloat(e):e}getComposedLinkAttr(e,t,s,n){let i;const r=this.graph.graphData(),o={view:this,index:r.links.indexOf(e),graphData:r,link:e};for(const e of this._linkBehaviorsByMethod[t])if(i=e[s].call(e,o),null!=i)break;return null!=i?i:n}getComposedNodeAttr(e,t,s,n){let i;const r={view:this,graphData:this.graph.graphData(),node:e};for(const e of this._nodeBehaviorsByMethod[t])if(i=e[s].call(e,r),null!=i)break;return null!=i?i:n}updateRenderOptions(e){return e}}ue.view_name="ForceGraphView";class ge extends ce{defaults(){return{...super.defaults(),_model_name:ge.model_name,_view_name:pe.view_name}}}ge.model_name="ForceGraph3DModel",ge.serializers={...ce.serializers};class pe extends ue{constructor(){super(...arguments),this.onControlsChange=async()=>{const e=this.graph.cameraPosition();this.onZoom({...e,graph:this.graph,iframeClasses:this._iframeClasses})},this.getNodeThreeObject=e=>{let t;const s={view:this,graphData:this.graph.graphData(),node:e,iframeClasses:this._iframeClasses};for(const e of this._nodeBehaviorsByMethod[a.js.getNodeThreeObject])if(t=e.getNodeThreeObject.call(e,s),null!=t)return t}}async onGraphInitialized(){const e=this.graph;this._threeRenderer=e.renderer(),this._threeControls=e.controls(),this._threeCamera=e.camera();const t=new de.eD((()=>this.onControlsChange()),a.BU);this._threeControls.addEventListener("change",(()=>t.invoke()))}get graphJsClass(){return"ForceGraph3D"}get extraJsClasses(){return"{\n      SpriteText: window.SpriteText,\n      THREE: window.THREE,\n    }"}async getJsUrls(){return[(await s.e(228).then(s.bind(s,5228))).default,(await s.e(65).then(s.bind(s,7065))).default,(await s.e(271).then(s.bind(s,9271))).default]}get threeRenderer(){return this._threeRenderer}get threeControls(){return this._threeControls}get threeCamera(){return this._threeCamera}getOnRenderPostUpdate(){this.graph.nodeThreeObject(this._nodeBehaviorsByMethod[a.js.getNodeThreeObject].length?this.wrapFunction(this.getNodeThreeObject):null),this.threeRenderer.setAnimationLoop(this._graphBehaviorsByMethod[a.Yb.onRender].length?this.wrapFunction(this.onRender):null)}updateRenderOptions(e){return delete e.context2d,delete e.globalScale,e.renderer3d=this.threeRenderer,e}}pe.view_name="ForceGraph3DView";var me=s(132);class _e extends r.WidgetModel{constructor(){super(...arguments),this._dataUpdated=new i.Signal(this),this._graphData=null,this._graphDataRequested=!1,this.mergeOne=(e,t,s,n,i)=>{const r={...e},o=s[r[n]];if(t.push(r),null!=o)for(const e of i)o.hasOwnProperty(e)&&(r[e]=o[e])}}defaults(){return{...super.defaults(),...a.sB,_model_name:_e.model_name,nodes:null,links:null,node_id_column:a.vJ.id,link_id_column:a.vJ.id,link_source_column:a.vJ.source,link_target_column:a.vJ.target,node_preserve_columns:[]}}initialize(e,t){super.initialize(e,t),this.on("change:nodes change:links",this.graphUpdate,this)}get dataUpdated(){return this._dataUpdated}get nodeIdColumn(){return this.get("node_id_column")||a.vJ.id}get linkIdColumn(){return this.get("link_id_column")||a.vJ.id}get linkSourceColumn(){return this.get("link_source_column")||a.vJ.source}get linkTargetColumn(){return this.get("link_target_column")||a.vJ.target}get preservedColumns(){const e=this.get("node_preserve_columns")||a.ow,t=this.get("link_preserve_columns")||a.ow;return e.length||t.length?{nodes:e,links:t}:a.EC}get nodes(){return this.get("nodes")||a.ow}get links(){return this.get("links")||a.ow}get graphData(){return this._graphDataRequested||(this.graphUpdate(),this._graphDataRequested=!0),this._graphData||a.tM}set graphData(e){this._graphData=e,this._dataUpdated.emit(void 0)}allColumns(e,t){let s=[...Object.keys(e)];for(const e of t)s.includes(e)||s.push(e);return s}setFromGraphData(e,t){const{nodes:s,links:n}=e;let i,r,o,a,l=s.length,h=n.length,d={},c={};const{nodeIdColumn:u,linkSourceColumn:g,linkTargetColumn:p}=this;if(l)for(r of this.allColumns(s[0],t.nodes))for(o=d[r]=new Array(l),i=0;i<l;)o[i]=s[i][r],i++;if(h)for(r of this.allColumns(n[0],t.links))for(o=c[r]=new Array(l),i=0;i<h;){switch(a=n[i][r],r){case p:case g:a=a[u]}o[i]=a,i++}this.set({nodes:d,links:c})}graphUpdate(){const e={nodes:[],links:[]},{nodes:t,links:s,linkIdColumn:n,nodeIdColumn:i}=this,r=Object.keys(t),o=Object.keys(s),l={},h=(t[i]||a.ow).length,d=(s[n]||a.ow).length,c=null!=t[i],u=null!=t[n];for(let s=0;s<h;s++){const n=c?t[i][s]:s,o={id:n};l[n]=o;for(const e of r)e!==i&&(o[e]=t[e][s]);e.nodes.push(o)}for(let t=0;t<d;t++){let i={id:u?s[n][t]:t};for(const e of o)e!==n&&(i[e]=s[e][t]);e.links.push(i)}this.graphData=e}mergePreserved(e,t,s){const{nodeIdColumn:n,linkIdColumn:i,mergeOne:r}=this,o={},a={},l=[],h=[];for(const e of t.nodes)a[e[n]]=e;for(const e of t.links)o[e[i]]=e;for(const t of e.nodes)r(t,l,a,n,s.nodes);for(const t of e.links)r(t,h,o,i,s.links);return{nodes:l,links:h}}}_e.model_name="DataFrameSourceModel",_e.serializers={...r.WidgetModel.serializers,nodes:me.S3,links:me.S3}},132:(e,t,s)=>{s.d(t,{$w:()=>a,Q5:()=>o,S3:()=>l,initializeZstd:()=>h});var n=s(2739),i=s(6042),r=s(8512);function o(e,t){if(!e.buffer)return e;const s=i.Buffer.from(e.buffer.buffer),r=(0,n.decompress)(s),o=i.Buffer.prototype.toString.call(r,"utf8");return JSON.parse(o)}function a(e,t){const s=JSON.stringify(e),r=i.Buffer.from(s,"utf-8");return{buffer:(0,n.compress)(r).buffer}}const l={deserialize:o,serialize:a};async function h(){await(0,n.init)(),r.eM&&console.warn(`${r.Dd} zstd loaded`)}},22:(e,t,s)=>{s.d(t,{x:()=>n});const n={deserialize:s(647).unpack_models}}}]);
//# sourceMappingURL=137.6f0ddabb30857eeb84da.js.map?v=6f0ddabb30857eeb84da