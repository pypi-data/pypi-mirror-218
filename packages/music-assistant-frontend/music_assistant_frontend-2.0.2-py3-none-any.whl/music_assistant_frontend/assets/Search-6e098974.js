import{_ as q,s as A}from"./ListviewItem.vue_vue_type_script_setup_true_lang-c58b99fc.js";import{l as G,I as H,e as O,r as i,c as w,w as I,o as J,b as Q,q as v,y as V,j as s,x as n,L as k,F as S,z as L,v as g,M as b,A as W,N as _,k as X,B as P,O as T,K as Y,a1 as Z}from"./index-4e9c0066.js";import{_ as z,a as ee}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-e57f0014.js";import{V as te}from"./VSelect-9c82ccea.js";import{b as ae,a as le,V as se}from"./VSpacer-a4df716c.js";import{V as re,a as oe}from"./VRow-dfe55569.js";import{V as ue}from"./VToolbar-e0e7883b.js";import{V as ie}from"./ProviderIcon.vue_vue_type_script_setup_true_lang-a5d9de60.js";import{V as ne,l as ve}from"./VBtn-61a2102f.js";import{V as me}from"./VContainer-169e75da.js";import"./MediaItemThumb.vue_vue_type_style_index_0_lang-dd46e10e.js";import"./VCard-e45f718f.js";import"./VMenu-1368abb6.js";import"./VDivider-267318d1.js";import"./VCheckboxBtn-e7c81f63.js";import"./VLabel-93f5b94a.js";import"./VDialog-cb2c1193.js";/* empty css              */const fe={key:2},ce={style:{"margin-left":"15px"}},Le=G({__name:"Search",props:{initSearch:{}},setup(N){const $=N,R=H(),{mobile:U}=O(),r=i("list"),h=i(0),o=i(""),m=i(!1),l=i(),y=i(!1),f=i(!1),c=i([]),C=i(),M=["topresult","artists","albums","tracks","playlists","radios"],D=w(()=>U.value?140:150),E=function(){r.value==="panel"?r.value="list":r.value="panel",localStorage.setItem(`viewMode.search.${u.value}`,r.value)},B=function(e){c.value=[e],f.value=!0},F=function(e){var t;["artist","album","playlist"].includes(e.media_type)||!((t=P.selectedPlayer)!=null&&t.available)?R.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):P.selectedPlayer&&T.playMedia(e)};I(()=>o.value,()=>{clearTimeout(C.value),C.value=setTimeout(()=>{j()},200)});const K=function(e){return e<500?2:e<=500?3:e<=700?4:e<=1e3?5:e<=1200?6:e<=1500?7:e<=1700?8:e>1700?9:0},j=async function(){y.value=!0,localStorage.setItem("globalsearch",o.value),o.value?l.value=await T.search(o.value):l.value=void 0,y.value=!1},u=w(()=>M[h.value]),d=w(()=>{if(!l.value)return[];if(u.value=="artists")return l.value.artists;if(u.value=="albums")return l.value.albums;if(u.value=="tracks")return l.value.tracks;if(u.value=="playlists")return l.value.playlists;if(u.value=="radios")return l.value.radio;if(u.value=="topresult"){const e=[];for(const t of[l.value.tracks,l.value.artists,l.value.albums,l.value.playlists,l.value.radio]){const a=[];for(const p of t)a.includes(p.provider)||(e.push(p),a.push(p.provider))}return e}return[]});I(()=>u.value,e=>{if(e){const t=localStorage.getItem(`viewMode.search.${u.value}`);t?r.value=t:u.value=="artists"||u.value=="albums"?r.value="panel":r.value="list"}},{immediate:!0}),J(()=>{if($.initSearch)o.value=$.initSearch;else{const e=localStorage.getItem("globalsearch");e&&e!=="null"&&(o.value=e)}});const x=function(e){f.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),c.value=d.value):!m.value&&e.key=="Backspace"?o.value=o.value.slice(0,-1):!m.value&&e.key.length==1&&(o.value+=e.key))};return document.addEventListener("keydown",x),Q(()=>{document.removeEventListener("keydown",x)}),(e,t)=>(v(),V("div",null,[s(me,null,{default:n(()=>[s(te,{id:"searchInput",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("type_to_search"),"hide-details":"",variant:"filled",onFocus:t[1]||(t[1]=a=>m.value=!0),onBlur:t[2]||(t[2]=a=>m.value=!1)},null,8,["modelValue","label"]),k("div",null,[s(ae,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=a=>h.value=a),column:"",style:{"margin-top":"15px","margin-left":"10px"}},{default:n(()=>[(v(),V(S,null,L(M,a=>s(se,{key:a,filter:"",outlined:""},{default:n(()=>[Y(_(e.$t(a)),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),s(z,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),items:c.value,onClear:t[5]||(t[5]=()=>{c.value=[]})},null,8,["modelValue","items"]),y.value?(v(),g(ve,{key:0,indeterminate:""})):b("",!0),r.value=="panel"?(v(),g(re,{key:1},{default:n(()=>[(v(!0),V(S,null,L(d.value,a=>(v(),g(oe,{key:a.uri,class:Z(`col-${K(e.$vuetify.display.width)}`)},{default:n(()=>[s(ee,{item:a,size:D.value,"is-selected":!1,"show-checkboxes":!1,onMenu:B,onClick:F},null,8,["item","size"])]),_:2},1032,["class"]))),128))]),_:1})):b("",!0),r.value=="list"?(v(),V("div",fe,[s(W(A),{items:d.value,"item-size":60,"key-field":"item_id","page-mode":""},{default:n(({item:a})=>[s(q,{item:a,"show-track-number":!1,"show-duration":!0,"show-library":!1,"show-menu":!0,"show-providers":!0,"show-checkboxes":!1,"is-selected":!1,"show-details":!0,onMenu:B,onClick:F},null,8,["item"])]),_:1},8,["items"])])):b("",!0),s(ue,{density:"compact",variant:"flat",color:"transparent",height:"45"},{default:n(()=>[k("span",ce,_(e.$t("items_total",[d.value.length])),1),s(le),s(ie,{location:"bottom"},{activator:n(({props:a})=>[s(ne,X(a,{icon:r.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:t[6]||(t[6]=p=>E())}),null,16,["icon"])]),default:n(()=>[k("span",null,_(e.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1})])]),_:1})]))}});export{Le as default};
