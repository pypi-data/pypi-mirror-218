import{l as Q,r as A,c as X,a0 as le,Q as te,q as r,v as c,x as i,j as s,M as b,K as P,N as v,A as V,k as ie,L as I,ap as ne,aq as B,J as oe,w as se,y as g,z as E,F as N,B as D,O as u,S as k,a5 as G,ar as re,as as h,_ as T}from"./index-4e9c0066.js";import{_ as J,h as ue,p as de}from"./MediaItemThumb.vue_vue_type_style_index_0_lang-dd46e10e.js";import{c as pe,V as R}from"./VMenu-1368abb6.js";import{V as me,a as ce,b as F,P as fe}from"./ListviewItem.vue_vue_type_script_setup_true_lang-c58b99fc.js";import{V as $,d as ye,i as q,c as W,g as U,a as x}from"./VCard-e45f718f.js";import{j as L,V as j}from"./VBtn-61a2102f.js";import{V as be,_ as ve}from"./ProviderIcon.vue_vue_type_script_setup_true_lang-a5d9de60.js";import{V as _e,b as H}from"./VToolbar-e0e7883b.js";import{V as ge}from"./VDivider-267318d1.js";import{a as he,V as ke}from"./VSelect-9c82ccea.js";import{V as Ae}from"./VDialog-cb2c1193.js";const qe=Q({__name:"PanelviewItem",props:{item:{},size:{default:200},isSelected:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showTrackNumber:{type:Boolean,default:!0}},emits:["menu","click","select"],setup(e,{emit:n}){const a=e,m=A(!1),_=X(()=>{for(const l of a.item.provider_mappings)if(l.audio_format.content_type!=null&&l.audio_format.content_type in[B.DSF,B.FLAC,B.AIFF,B.WAV]&&(l.audio_format.sample_rate>48e3||l.audio_format.bit_depth>16))return`${l.audio_format.sample_rate}kHz ${l.audio_format.bit_depth} bits`;return""});return(l,f)=>{const C=le("hold");return te((r(),c(W,{class:"panel-item",onClick:f[1]||(f[1]=y=>l.showCheckboxes?null:n("click",l.item)),onContextmenu:f[2]||(f[2]=ne(y=>l.showCheckboxes?null:n("menu",l.item),["right","prevent"])),onMouseover:f[3]||(f[3]=y=>m.value=!0),onMouseleave:f[4]||(f[4]=y=>m.value=!0)},{default:i(()=>[l.showCheckboxes?(r(),c(pe,{key:0,"model-value":l.showCheckboxes,contained:"",scrim:l.isSelected?l.$vuetify.theme.current.dark?"rgba(0,0,0,.75)":"rgba(255,255,255,.75)":"#ffffff00",onClick:f[0]||(f[0]=y=>{n("select",l.item,!l.isSelected)})},{default:i(()=>[s(me,{class:"panel-item-checkbox",ripple:!1,"model-value":l.isSelected},null,8,["model-value"])]),_:1},8,["model-value","scrim"])):b("",!0),s(J,{item:l.item,width:"100%"},null,8,["item"]),s($,{class:"list-item-main",style:{"padding-left":"0px !important","padding-right":"0px !important","padding-top":"10px !important"}},{default:i(()=>[s(ye,{class:"line-clamp-1"},{default:i(()=>[P(v(l.item.name)+" "+v("version"in l.item&&l.item.version?`- ${l.item.version}`:""),1)]),_:1}),"artists"in l.item&&l.item.artists?(r(),c(q,{key:0,class:"line-clamp-1"},{default:i(()=>[P(v(V(ue)(l.item.artists,1)),1)]),_:1})):"owner"in l.item&&l.item.owner?(r(),c(q,{key:1,class:"line-clamp-1"},{default:i(()=>[P(v(l.item.owner),1)]),_:1})):b("",!0),l.item&&l.item.media_type==="track"?(r(),c(ce,{key:2,style:{"min-height":"22px","padding-top":"5px"}},{default:i(()=>[s(F,null,{default:i(()=>[V(de)(l.item.metadata.explicit||!1)?(r(),c(L,{key:0,icon:"mdi-alpha-e-box"})):b("",!0)]),_:1}),s(F,null,{default:i(()=>[_.value?(r(),c(be,{key:0,bottom:""},{activator:i(({props:y})=>[s(L,ie(y,{icon:"mdi-quality-high"}),null,16)]),default:i(()=>[I("span",null,v(_.value),1)]),_:1})):b("",!0)]),_:1}),"disc_number"in l.item&&l.item.disc_number&&l.showTrackNumber?(r(),c(F,{key:0},{default:i(()=>[s(L,{style:{"margin-left":"5px"},icon:"md:album"}),P(" "+v(l.item.disc_number),1)]),_:1})):b("",!0),"track_number"in l.item&&l.item.track_number&&l.showTrackNumber?(r(),c(F,{key:1},{default:i(()=>[s(L,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),P(" "+v(l.item.track_number),1)]),_:1})):b("",!0)]),_:1})):b("",!0)]),_:1})]),_:1})),[[C,()=>l.showCheckboxes?null:n("menu",l.item)]])}}});const Ve={key:0},Ce={class:"media-thumb"},we={key:0},S=function(e){var n;for(const a of e.provider_mappings)if(a.available&&((n=u.providers[a.provider_instance])!=null&&n.available))return!0;return!1},Pe=function(e){var n;for(const a of e.provider_mappings)if((n=u.providers[a.provider_instance])!=null&&n.supported_features.includes(G.SIMILAR_TRACKS))return!0;return!1},Ie=function(e,n){const a=[];if(e.length==0||!S(e[0]))return a;let m=h.PLAY,_=h.NEXT;return(e.length>10||[k.ALBUM,k.PLAYLIST].includes(e[0].media_type))&&(m=h.REPLACE,_=h.REPLACE_NEXT),e.length==1&&n&&n.media_type==k.PLAYLIST&&a.push({label:"play_playlist_from",action:()=>{u.playPlaylistFromIndex(n,e[0].position||0)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),e.length==1&&n&&n.media_type==k.ALBUM&&a.push({label:"play_album_from",action:()=>{u.playAlbumFromItem(n,e[0])},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),e.length<10?(a.push({label:"play_now",action:()=>{u.playMedia(e,h.PLAY)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),a.push({label:"play_now_replace",action:()=>{u.playMedia(e,h.REPLACE)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"})):a.push({label:"play_now",action:()=>{u.playMedia(e,h.REPLACE)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),Pe(e[0])&&a.push({label:"play_radio",action:()=>{u.playMedia(e,m,!0)},icon:"mdi-radio-tower",labelArgs:[],actionStr:"play"}),(e.length===1||e[0].media_type===k.TRACK)&&a.push({label:"play_next",action:()=>{u.playMedia(e,_)},icon:"mdi-skip-next-circle-outline",labelArgs:[],actionStr:"play"}),a.push({label:"add_queue",action:()=>{u.playMedia(e,h.ADD)},icon:"mdi-playlist-plus",labelArgs:[],actionStr:"play"}),a},Se=function(e,n){const a=[];if(e.length==0)return a;if(e.length===1&&e[0]!==n&&S(e[0])&&a.push({label:"show_info",labelArgs:[],action:()=>{var m;T.push({name:e[0].media_type,params:{itemId:e[0].item_id,provider:e[0].provider},query:{album:"album"in e[0]?(m=e[0].album)==null?void 0:m.uri:""}})},icon:"mdi-information-outline"}),e.length===1&&S(e[0])&&"artists"in e[0]&&e[0].artists.length===1)for(const m of e[0].artists)a.push({label:"goto_artist",labelArgs:[m.name],action:()=>{T.push({name:"artist",params:{itemId:m.item_id,provider:m.provider}})},icon:"mdi-account-music"});if(e.length===1&&S(e[0])&&"album"in e[0]&&e[0].album&&a.push({label:"goto_album",labelArgs:[e[0].album.name],action:()=>{T.push({name:"album",params:{itemId:e[0].album.item_id,provider:e[0].album.provider}})},icon:"mdi-album"}),e.length===1&&(e[0]==n||!S(e[0]))&&a.push({label:"refresh_item",labelArgs:[],action:async()=>{await u.refreshItem(e[0]),T.go(0)},icon:"mdi-refresh"}),!e[0].in_library&&S(e[0])&&a.push({label:"add_library",labelArgs:[],action:()=>{u.addItemsToLibrary(e)},icon:"mdi-heart-outline"}),e[0].in_library&&a.push({label:"remove_library",labelArgs:[],action:()=>{u.removeItemsFromLibrary(e)},icon:"mdi-heart"}),n&&n.media_type===k.PLAYLIST){const m=n;e[0].media_type===k.TRACK&&m.is_editable&&a.push({label:"remove_playlist",labelArgs:[],action:()=>{u.removePlaylistTracks(m.item_id,e.map(_=>_.position))},icon:"mdi-minus-circle-outline"})}return e[0].media_type==="track"&&a.push({label:"add_playlist",labelArgs:[],actionStr:"add_playlist",icon:"mdi-plus-circle-outline"}),e.length==1&&e[0].provider=="database"&&a.push({label:"delete_db",labelArgs:[],action:()=>{u.deleteDbItem(e[0].media_type,e[0].item_id,!0),n&&n.item_id==e[0].item_id&&T.push({name:`${n.media_type}s`})},icon:"mdi-cancel"}),e.length>1&&a.push({label:"clear_selection",labelArgs:[],actionStr:"clear",icon:"mdi-cancel"}),a},Ke=Q({__name:"MediaItemContextMenu",props:{items:{},parentItem:{default:void 0},modelValue:{type:Boolean},enablePlayItems:{type:Boolean,default:!0},enableActionMenuItems:{type:Boolean,default:!0},fullscreen:{type:Boolean,default:!0}},emits:["refresh","clear","update:modelValue","update:items"],setup(e,{emit:n}){const a=e,{t:m}=oe(),_=A([]),l=A([]),f=A(""),C=A([]),y=A(!1),K=A("");se(()=>a.modelValue,t=>{t&&Z()});const Z=async function(){if(y.value=!1,C.value=[],!a.items)return;a.items.length===1?f.value=a.items[0].name:f.value=m("items_selected",[a.items.length]).toString(),D.selectedPlayer&&D.selectedPlayer.available?l.value=Ie(a.items,a.parentItem):l.value=[];let t=a.items[0],d=0;if("position"in t&&(d=t.position),t.provider!=="database"){try{t=await u.getItemByUri(a.items[0].uri)}catch{t=a.items[0]}"position"in t&&(t.position=d);const o=a.items;o[0]=t,n("update:items",o)}_.value=Se(a.items,a.parentItem),ee()},ee=async function(){C.value=[];const t=await u.getPlaylists();for(const d of t.items)d.is_editable&&!(a.parentItem&&a.parentItem.media_type===k.PLAYLIST&&d.item_id===a.parentItem.item_id)&&C.value.push(d)},Y=function(t){u.addPlaylistTracks(t.item_id,a.items.map(d=>d.uri)),M()},z=async function(t){const d=await u.createPlaylist(K.value,t);Y(d)},O=async function(t){t.actionStr=="add_playlist"?y.value=!0:t.actionStr=="clear"?(n("clear"),M()):t.action&&t.actionStr=="play"?(t.action(),n("clear"),M()):t.action&&(M(),t.action())},M=function(){a.items.length==1&&n("clear"),n("update:modelValue",!1)},ae=X(()=>{var d,o;const t=[];for(const p in(d=u)==null?void 0:d.players){const w=(o=u)==null?void 0:o.players[p];w.synced_to||t.push({title:w.display_name,value:w.player_id})}return t.slice().sort((p,w)=>p.title.toUpperCase()>w.title.toUpperCase()?1:-1)});return(t,d)=>(r(),c(Ae,{"model-value":t.modelValue,fullscreen:t.$vuetify.display.mobile,"min-height":"80%",scrim:!0,"onUpdate:modelValue":d[3]||(d[3]=o=>t.$emit("update:modelValue",o))},{default:i(()=>[s(W,null,{default:i(()=>[s(_e,{color:"transparent",style:{padding:"10px 0px"},density:"compact",class:"titlebar"},{default:i(()=>[s(j,{icon:"mdi-play-circle-outline"}),y.value?(r(),c(H,{key:0,style:{"padding-left":"10px"}},{default:i(()=>[I("b",null,v(t.$t("add_playlist")),1),t.$vuetify.display.mobile?b("",!0):(r(),g("span",Ve," | "+v(f.value),1))]),_:1})):(r(),c(H,{key:1,style:{"padding-left":"10px"}},{default:i(()=>[I("b",null,v(f.value),1)]),_:1})),s(j,{icon:"mdi-close",dark:"",onClick:d[0]||(d[0]=o=>M())})]),_:1}),s(ge),t.enablePlayItems&&!y.value&&l.value.length>0?(r(),c(U,{key:0},{default:i(()=>{var o;return[s(he,{label:t.$t("play_on"),"model-value":(o=V(D).selectedPlayer)==null?void 0:o.player_id,items:ae.value,"hide-details":"","onUpdate:modelValue":d[1]||(d[1]=p=>{V(D).selectedPlayer=V(u).players[p]})},null,8,["label","model-value","items"]),s(R,null,{default:i(()=>[(r(!0),g(N,null,E(l.value,p=>(r(),g("div",{key:p.label},[s($,{class:"list-item-main",title:t.$t(p.label,p.labelArgs),density:"default",onClick:w=>O(p)},{prepend:i(()=>[s(x,{style:{"padding-right":"10px"}},{default:i(()=>[s(L,{icon:p.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"])]))),128))]),_:1})]}),_:1})):b("",!0),t.enableActionMenuItems&&!y.value&&_.value.length>0?(r(),c(U,{key:1,style:{"padding-top":"0","margin-top":"-10px","padding-bottom":"0"}},{default:i(()=>[s(q,{style:{"margin-left":"10px"}},{default:i(()=>[P(v(t.$t("actions")),1)]),_:1}),s(R,null,{default:i(()=>[(r(!0),g(N,null,E(_.value,o=>(r(),g("div",{key:o.label},[s($,{class:"list-item-main",title:t.$t(o.label,o.labelArgs),density:"default",onClick:p=>O(o)},{prepend:i(()=>[s(x,{style:{"padding-right":"10px"}},{default:i(()=>[s(L,{icon:o.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"])]))),128))]),_:1})]),_:1})):b("",!0),y.value?(r(),c(U,{key:2},{default:i(()=>[s(R,null,{default:i(()=>[(r(!0),g(N,null,E(C.value,o=>(r(),g("div",{key:o.item_id},[s($,{class:"list-item-main",ripple:"",density:"default",onClick:p=>Y(o)},{prepend:i(()=>[I("div",Ce,[s(J,{item:o,size:50,width:"50px",height:"50px"},null,8,["item"])])]),title:i(()=>[I("div",null,v(o.name),1)]),subtitle:i(()=>[I("div",null,v(o.owner),1)]),append:i(()=>[o.provider_mappings?(r(),c(fe,{key:0,"provider-mappings":o.provider_mappings,height:20},null,8,["provider-mappings"])):b("",!0)]),_:2},1032,["onClick"])]))),128)),(r(!0),g(N,null,E(V(u).providers,o=>(r(),g("div",{key:o.instance_id},[o.supported_features.includes(V(G).PLAYLIST_CREATE)?(r(),g("div",we,[s($,{class:"list-item-main",ripple:""},{prepend:i(()=>[s(ve,{domain:o.domain,size:"40px",class:"media-thumb"},null,8,["domain"])]),title:i(()=>[s(ke,{label:t.$t("create_playlist",[o.name]),"append-icon":"mdi-playlist-plus",variant:"plain","hide-details":"","onUpdate:modelValue":d[2]||(d[2]=p=>{K.value=p}),"onClick:append":p=>z(o.instance_id),onKeydown:re(p=>z(o.instance_id),["enter"])},null,8,["label","onClick:append","onKeydown"])]),_:2},1024)])):b("",!0)]))),128))]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["model-value","fullscreen"]))}});export{Ke as _,qe as a,Ie as b,Se as g,S as i};
