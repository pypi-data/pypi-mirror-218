(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3812)}])},3812:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return nO}});var r,i,l,s,o,a,c,u,d=t(5893),p=t(4523),m=t(9737),x=t(9008),h=t.n(x),f=t(3356),g=t(5117),j=t(9985),v=t(2445),y=t(7294),b=t(741),O=t(7789),w=t(1232),C=t(7564),T=t(8818),E=t(2185),S=t(1163);function I(e){let n=(0,S.useRouter)(),{ref:t}=(0,E.h)(),{avatar:r,buttons:i,tabs:l,activeTab:s,align:o,children:a}=e,c=e=>{let t=l.find(n=>n.value===e);t&&n.push(t.link)},u=null!=l?(0,d.jsx)(b.m,{value:s,defaultValue:s,onTabChange:c,color:"violet-manual.3",styles:e=>({tab:{"&:hover":{backgroundColor:e.colors.gray[0],borderColor:e.colors.gray[5]},"&[data-active]":{fontWeight:600},fontSize:e.fontSizes.md,height:"2rem",minWidth:"100px",borderWidth:"3px"},tabsList:{display:"flex",borderBottom:"none",gap:"1rem"},tabLabel:{marginBottom:"5px"},tabRightSection:{paddingLeft:"5px",marginBottom:"3px"}}),children:(0,d.jsx)(b.m.List,{children:l.map(e=>(0,d.jsx)(b.m.Tab,{value:e.value,rightSection:void 0!==e.badgeLabel&&null!==e.badgeLabel?(0,d.jsx)(O.C,{size:"sm",children:e.badgeLabel}):null,children:e.label},e.value))})}):void 0;return(0,d.jsx)(v.W,{pt:"1.5rem",bg:"#F7F8FA",sx:e=>({borderBottom:"1.5px solid ".concat(e.colors.gray[3])}),className:"layout-container",children:(0,d.jsxs)(v.W,{className:"layout-container-inner",children:[(0,d.jsxs)(w.Z,{spacing:"0rem",position:"apart",align:null!=o?o:"center",children:[(0,d.jsxs)(w.Z,{spacing:"1.5rem",align:null!=o?o:"center",children:[(0,d.jsx)(p.x,{ref:t,children:r}),(0,d.jsx)(C.K,{spacing:"sm",children:Array.isArray(a)?a.map((e,n)=>(0,d.jsx)("div",{children:e},"header-body-element-".concat(n.toString()))):a})]}),(0,d.jsx)(p.x,{mt:"5px",children:Array.isArray(i)?i.map((e,n)=>(0,d.jsx)("div",{children:e},"header-button-".concat(n.toString()))):i})]}),(0,d.jsx)(T.T,{h:"1.5rem",w:"100%",mt:"0.5rem"}),u]})})}var N=t(9876),k=function(){return(0,d.jsx)(p.x,{w:"100%",mih:"3rem"})},L=function(e){let{header:n,children:t}=e;return(0,d.jsxs)(N.k,{direction:"column",sx:{minHeight:"100vh"},children:[n,(0,d.jsx)(N.k,{direction:"column",sx:{flexGrow:1},children:t}),(0,d.jsx)(N.k,{direction:"column",sx:{flexGrow:0},children:(0,d.jsx)(k,{})})]})};function _(e){let{model:n,children:t}=e,r=(0,d.jsx)(g.x,{size:"xxl",fw:500,inline:!0,children:n.name}),i=(0,d.jsx)(I,{avatar:(0,d.jsx)(j.q,{src:n.avatar_url,size:"70px",radius:"0"}),align:"center",children:r});return(0,d.jsx)(L,{header:i,children:(0,d.jsx)(v.W,{my:"2rem",className:"layout-container",children:(0,d.jsx)(v.W,{className:"layout-container-inner",children:t})})})}var F=t(6154);let R=()=>{let e=F.Z.create({timeout:3e3});return e};var z=t(2819),Z=t(8767),P=function(e){return Object.freeze({axiosInstance:e,create:function(n){return e.post("/predictions",n,{headers:{accept:"application/json","Content-Type":"application/json"}})},get:function(n){return e.get("/predictions/".concat(n))},cancel:function(n){return e.post("/predictions/".concat(n,"/cancel"))}})};function B(e){let{failureReason:n,logsArea:t}=e;return(0,d.jsxs)(C.K,{children:[(0,d.jsx)(g.x,{color:"red.6",fw:500,children:function(e){switch(e){case"user_failure":return"Model run failed. See the logs below.";case"system_failure":return"An unexpected error occurred. If you encounter this repeatedly, please send us feedback.";case"timeout":return"Timeout Reached";default:return"ERROR".concat(e?": ".concat(e):"")}}(n)}),t]})}var A=t(966);function H(e){let{status:n,logsArea:t}=e;return(0,d.jsxs)(C.K,{children:[(0,d.jsxs)(w.Z,{children:[(0,d.jsx)(g.x,{fw:500,children:n.charAt(0).toUpperCase()+n.slice(1)}),(0,d.jsx)(A.a,{color:"gray",variant:"dots",size:"sm"})]}),t]})}var M=t(825);function W(e){let{title:n,rightIcon:t,children:r,...i}=e;return(0,d.jsxs)(M.Z,{withBorder:!0,padding:"lg",radius:"lg",h:"fit-content",...i,children:[(0,d.jsx)(M.Z.Section,{withBorder:!0,inheritPadding:!0,py:"sm",children:(0,d.jsxs)(w.Z,{position:"apart",children:["string"==typeof n?(0,d.jsx)(g.x,{fz:"xl",fw:600,children:n}):n,t]})}),(0,d.jsx)(p.x,{pt:"md",children:r})]})}var K=t(3523),U=t(2870);function q(){return(0,d.jsxs)(C.K,{align:"center",justify:"center",spacing:"lg",py:"xl",children:[(0,d.jsx)(K.M,{children:(0,d.jsx)(U.E,{mx:"auto",maw:"40%",opacity:.3,alt:"tungsten_logo",src:"/tungsten_greyed_out_logo.png"})}),(0,d.jsx)(g.x,{color:"gray.6",fz:"md",children:'Click "Run" to see amazing results.'})]})}var D=t(8104);function J(e){let{name:n,description:t,required:r}=e,i=(0,D.rZ)(),l=i.fn.variant({variant:"filled",color:"red"}).background;return(0,d.jsxs)(C.K,{spacing:"xxs",mb:"xs",children:[(0,d.jsxs)(p.x,{children:[(0,d.jsxs)(g.x,{fw:500,fz:"md",span:!0,children:[n," "]}),r&&(0,d.jsx)(g.x,{span:!0,color:l,children:"*"})]}),t?(0,d.jsx)(g.x,{color:"gray.7",fz:"sm",children:t}):void 0]})}var V=t(983),Y=t(2679),G=t(7297),X=t(7841),Q=t(2276),$=t(7311),ee=t(2015);function en(){let e=(0,G.Z)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  height: 100px;\n  width: 100%;\n  background: transparent;\n  gap: 2rem;\n"]);return en=function(){return e},e}function et(){let e=(0,G.Z)(["\n  width: 100%;\n  height: 90px;\n"]);return et=function(){return e},e}function er(){let e=(0,G.Z)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 60px;\n  height: 60px;\n  background: #e9e9e9;\n  border: 1px black;\n  outline: none;\n  cursor: pointer;\n  padding-bottom: 3px;\n  &:hover {\n    background: #ddd;\n  }\n"]);return er=function(){return e},e}let ei=ee.ZP.div(en()),el=ee.ZP.div(et());ee.ZP.button(er());var es=function(e){let{src:n}=e,r=(0,y.useId)(),[i,l]=(0,y.useState)(!1),[s,o]=(0,y.useState)(),a=!0;(0,y.useEffect)(()=>{if(a){let e=async()=>{let e=(await t.e(33).then(t.t.bind(t,1796,23))).default,i=document.getElementById("waveform".concat(r)),s=e.create({barWidth:3,barRadius:3,barGap:2,barMinHeight:1,cursorWidth:1,container:i,backend:"WebAudio",height:80,progressColor:"#black",responsive:!0,waveColor:"#C4C4C4",cursorColor:"transparent"});o(s),s.load(n),s.on("finish",()=>{l(!1)})};e(),a=!1}},[]);let c=e=>{l(!i),e&&e.playPause()};return(0,d.jsx)(p.x,{sx:{maxWidth:"90%"},children:(0,d.jsx)(p.x,{style:{padding:"0px",margin:"0px"},children:(0,d.jsxs)(ei,{style:{padding:"0px",margin:"0px",height:"90px"},children:[(0,d.jsx)(X.z,{sx:e=>({border:"none",borderRadius:e.radius.sm,width:"120px"}),variant:"contained",leftIcon:i?(0,d.jsx)(Q.Z,{}):(0,d.jsx)($.Z,{}),onClick:e=>c(s),children:i?"Pause":"Play"}),(0,d.jsx)(el,{id:"waveform".concat(r),style:{padding:"0px",margin:"0px",height:"80px"}})," ",(0,d.jsx)("audio",{id:"track".concat(r),src:n,style:{padding:"0px",margin:"0px"}})]})})})},eo=t(335);function ea(e){let{src:n}=e;return(0,d.jsx)(X.z,{component:"a",href:n,target:"_blank",variant:"default",leftIcon:(0,d.jsx)(eo.Z,{size:"1rem"}),children:"Download file"})}var ec=t(5215);t(1717);var eu=function(e){let{src:n,mimeType:t,autoplay:r=!1,controls:i=!0,responsive:l=!0,fluid:s=!0}=e,o=(0,y.useRef)(null),a=(0,y.useRef)(null),c=(e,n)=>{n.current=e};return(0,y.useEffect)(()=>{let e={autoplay:r,controls:i,responsive:l,fluid:s,sources:[{src:n,type:t}]};if(a.current){let n=a.current;n.autoplay(e.autoplay),n.src(e.sources)}else{var u;let n=document.createElement("video-js");n.classList.add("vjs-big-play-centered"),null===(u=o.current)||void 0===u||u.appendChild(n);let t=a.current=(0,ec.Z)(n,e,()=>{c&&c(t,a)})}},[n,t,r,i,l,s,o]),(0,y.useEffect)(()=>{let e=a.current;return()=>{e&&!e.isDisposed()&&(e.dispose(),a.current=null)}},[a]),(0,d.jsx)(N.k,{direction:"column",sx:{maxWidth:"100%",gap:"0.4rem"},children:(0,d.jsx)(p.x,{"data-vjs-player":!0,children:(0,d.jsx)("div",{ref:o,style:{}})})})};let ed=e=>{if("string"!=typeof e)return e.type;let n=(0,V.lookup)(e);return n||"application/octet-stream"},ep=(0,y.forwardRef)((e,n)=>{let t;let{file:r,filetype:i}=e,[l,s]=(0,y.useState)("string"==typeof r?r:URL.createObjectURL(r)),o=ed(r),a=(0,d.jsx)(p.x,{});switch((0,y.useEffect)(()=>{s("string"==typeof r?r:URL.createObjectURL(r))},[r]),i){case"image":t=l?(0,d.jsx)(Y.LazyLoadImage,{src:l,style:{maxWidth:"100%",maxHeight:"100%"},alt:i}):a;break;case"video":t=l?(0,d.jsx)(eu,{src:l,mimeType:o}):a;break;case"audio":t=l?(0,d.jsx)(es,{src:l}):a;break;default:t=l?(0,d.jsx)(ea,{src:l}):a}return(0,d.jsx)(p.x,{maw:"100%",mah:"100%",ref:n,children:t})});function em(e,n){if(n)return l.FILE;if(e.choices&&e.type&&["string","number","integer"].includes(e.type)){if("string"===e.type)return l.STR_CHOICE;if("integer"===e.type)return l.INT_CHOICE;if("number"===e.type)return l.FLOAT_CHOICE}return"integer"===e.type?void 0!==e.minimum||void 0!==e.maximum?l.CONINT:l.INT:"number"===e.type?void 0!==e.minimum||void 0!==e.maximum?l.CONFLOAT:l.FLOAT:"boolean"===e.type?l.BOOL:void 0!==e.min_length||void 0!==e.max_length?l.CONSTR:l.STR}ep.defaultProps={filetype:"binary"},ep.displayName="FileView",(r=l||(l={}))[r.FILE=0]="FILE",r[r.STR=1]="STR",r[r.CONSTR=2]="CONSTR",r[r.INT=3]="INT",r[r.CONINT=4]="CONINT",r[r.FLOAT=5]="FLOAT",r[r.CONFLOAT=6]="CONFLOAT",r[r.BOOL=7]="BOOL",r[r.STR_CHOICE=8]="STR_CHOICE",r[r.INT_CHOICE=9]="INT_CHOICE",r[r.FLOAT_CHOICE=10]="FLOAT_CHOICE",(i=s||(s={}))[i.FILE=0]="FILE",i[i.FILE_LIST=1]="FILE_LIST",i[i.FILE_DICT=2]="FILE_DICT",i[i.STR=3]="STR",i[i.NUMBER=4]="NUMBER",i[i.BOOL=5]="BOOL",i[i.JSON=6]="JSON";var ex=t(2328),eh=t(665),ef=t(7577),eg=t(5887),ej=t(8393),ev=t(9834),ey=t(8198),eb=t(3625);function eO(e){let{value:n,iconSize:t,...r}=e;return(0,d.jsx)(ef.a,{opacity:0,sx:{pointerEvents:"none"},...r,children:(0,d.jsx)(w.Z,{position:"right",align:"center",children:(0,d.jsx)(eg.q,{value:"string"==typeof n?n:n.toString(),timeout:2e3,children:e=>{let{copied:n,copy:r}=e;return(0,d.jsx)(ej.u,{label:n?"Copied":"Copy",withArrow:!0,position:"bottom",children:(0,d.jsx)(ev.A,{variant:"light",color:n?"button-blue":"gray",onClick:r,sx:{pointerEvents:"all"},children:n?(0,d.jsx)(ey.Z,{size:t}):(0,d.jsx)(eb.Z,{size:t})})})}})})})}eO.defaultProps={iconSize:"1rem"};var ew=t(6817),eC=t(6768),eT=(0,ew.k)((e,n)=>{let{color:t}=n,r=t||("dark"===e.colorScheme?"dark":"gray"),i=e.fn.variant({color:r,variant:"light"});return{root:{...e.fn.fontStyles(),lineHeight:e.lineHeight,padding:"".concat((0,eC.h)(2)," calc(").concat(e.spacing.xs," / 2)"),borderRadius:e.radius.sm,color:"dark"===e.colorScheme?"dark"===r?e.colors.dark[0]:e.white:e.colors.dark[7],backgroundColor:"dark"===e.colorScheme&&"dark"===r?e.colors.dark[5]:i.background,fontFamily:e.fontFamilyMonospace,fontSize:e.fontSizes.xs},block:{padding:e.spacing.xs,margin:0,whiteSpace:"pre-wrap",wordBreak:"break-all"}}});let eE={fz:"sm"},eS=(0,y.forwardRef)((e,n)=>{let{className:t,children:r,color:i,unstyled:l,variant:s,mono:o,ff:a,noCopy:c,...u}=(0,D.N4)("Code",eE,e),{classes:m,cx:x}=eT({color:i},{name:"Code",unstyled:l,variant:s}),h=(0,D.rZ)(),{ref:f,x:g,y:j}=(0,ex.i)({resetOnExit:!0}),v=(0,eh.Y)(f,n);return(0,d.jsx)(p.x,{ff:null!=a?a:o?h.fontFamilyMonospace:h.fontFamily,className:x(m.root,m.block,t),ref:v,...u,children:(0,d.jsxs)(p.x,{pos:"relative",children:[null!=r&&""!==r?r:(0,d.jsx)(p.x,{children:"\xa0"}),!0!==c&&(0!==g||0!==j)&&null!=r&&""!==r&&(0,d.jsx)(eO,{value:"string"==typeof r?r:r.toString(),iconSize:"1rem"})]})})});function eI(e){let{fieldName:n,propObj:t,filetype:r,itemFiletype:i,value:l}=e,o=function(e,n,t){let r=Object.keys(e),i="array"===e.type,l="object"===e.type&&r.includes("additionalProperties");return n?s.FILE:i&&t?s.FILE_LIST:l&&t?s.FILE_DICT:"integer"===e.type||"number"===e.type?s.NUMBER:"boolean"===e.type?s.BOOL:"string"===e.type?s.STR:s.JSON}(t,r,i);switch(o){case s.FILE:return(0,d.jsx)(ep,{file:l,filetype:r});case s.FILE_LIST:return(0,d.jsx)(C.K,{spacing:"xxs",children:l.map((e,r)=>(0,d.jsx)(eI,{fieldName:"".concat(n,"-").concat(r.toString()),propObj:t.items,filetype:i,value:e},"".concat(n,"-").concat(r.toString())))});case s.FILE_DICT:return(0,d.jsx)(C.K,{spacing:"xxs",children:Object.keys(l).map(e=>(0,d.jsxs)("div",{children:[(0,d.jsx)(J,{description:e},e),(0,d.jsx)(eI,{fieldName:"".concat(n,"-").concat(e),propObj:t.additionalProperties,filetype:i,value:l[e]})]},"".concat(n,"-").concat(e)))});case s.STR:return(0,d.jsx)(eS,{children:l});case s.BOOL:case s.NUMBER:return(0,d.jsx)(eS,{children:l.toString()});case s.JSON:return(0,d.jsx)(eS,{children:JSON.stringify(l,void 0,2)});default:throw TypeError("Unkown output field type ".concat(o," "))}}function eN(e){let{schema:n,filetypes:t,values:r,spacing:i}=e,l=[];return Object.keys(n.properties).forEach(e=>{l.push({name:e,component:function(e){let i=n.properties[e],l=t[e];return(0,d.jsx)(eI,{fieldName:e,propObj:i,filetype:l,itemFiletype:t["".concat(e,".$item")],value:r[e]})}(e)})}),(0,d.jsx)(C.K,{fz:"md",spacing:i,children:l.map(e=>(0,d.jsxs)("div",{children:[(0,d.jsx)(J,{name:e.name}),e.component]},"output-field-".concat(e.name)))})}eS.displayName="CodeBlockWithLinebreak",eN.defaultProps={spacing:"md"};var ek=t(3723);function eL(e){let{children:n,autoScroll:t,fz:r,h:i}=e,l=(0,y.useRef)(null),{ref:s,width:o,height:a}=(0,E.h)(),{ref:c,x:u,y:m}=(0,ex.i)({resetOnExit:!0}),x=(0,eh.Y)(s,c),h=!!t&&(0===u||0===m),f=e=>{var n;null==l||null===(n=l.current)||void 0===n||n.scrollTo({top:l.current.scrollHeight,behavior:e})};return(0,y.useEffect)(()=>{t&&h&&f(t)},[h,t,n]),(0,d.jsxs)(p.x,{pos:"relative",ref:x,children:[(0,d.jsx)(ek.x,{viewportRef:l,h:i,children:(0,d.jsx)(eS,{fz:r,miw:o,mih:a,mono:!0,noCopy:!0,children:n})}),(0!==u||0!==m)&&(0,d.jsx)(eO,{p:".3rem",value:null!=n?n:""})]})}function e_(e){let{mode:n,output:t,demoOutput:r,demoOutputSchema:i,demoOutputFiletypes:l,logs:s}=e,o=(0,d.jsx)(eN,{schema:i,filetypes:l,values:r}),a=(0,d.jsx)(eS,{fz:"xs",mono:!0,children:JSON.stringify(t,null,2)}),c=(0,d.jsx)(eL,{children:null!=s?s:""});return(0,d.jsxs)(d.Fragment,{children:["preview"===n&&o,"raw"===n&&a,"logs"===n&&c]})}eL.defaultProps={fz:"xs",h:"30vh",children:""};var eF=t(3819),eR=t(5158),ez=t(2972),eZ=t(7080);function eP(e){let{icon:n,label:t}=e;return(0,d.jsxs)(K.M,{children:[n,(0,d.jsx)(p.x,{ml:10,children:t})]})}function eB(e){let{mode:n,onChange:t,w:r,iconSize:i,...l}=e,s={size:void 0===i?"1rem":i};return(0,d.jsx)(eF.s,{value:n,onChange:t,w:null!=r?r:"100%",data:[{label:(0,d.jsx)(eP,{icon:(0,d.jsx)(eR.Z,{...s}),label:"Preview"}),value:"preview"},{label:(0,d.jsx)(eP,{icon:(0,d.jsx)(ez.Z,{...s}),label:"Raw"}),value:"raw"},{label:(0,d.jsx)(eP,{icon:(0,d.jsx)(eZ.Z,{...s}),label:"Logs"}),value:"logs"}],...l})}var eA=t(930),eH=t(2615),eM=t(4796),eW=t(2675),eK=t(8431),eU=t(1885),eq=t(1500),eD=t(6261),eJ=t(971),eV=t(4151),eY=t(3540),eG=t(5851),eX=t(7339),eQ=t(8044),e$=t(5204),e0=t(6862),e1=t(904),e5=t(7283);let e3={iconSize:"1.1rem",textProps:{fz:"md"}};function e7(e){let n;let{wrapperProps:t,value:r,defaultValue:i,filetype:l,onChange:s,textProps:o,maxsize:a,iconSize:c}=(0,eD.k)("DropzoneInput",e3,e),[u,m]=(0,eG.C)({value:r,onChange:s,finalValue:null}),x=(0,D.rZ)();return i&&m(i),(0,d.jsx)(eV.I.Wrapper,{...t,children:(0,d.jsxs)(C.K,{spacing:"xs",children:[u?function(e){let n=(0,d.jsx)(ep,{file:e,filetype:l}),t=typeof e!==i?(0,d.jsxs)(w.Z,{maw:"100%",spacing:"xs",children:[(0,d.jsx)(g.x,{fz:"xs",color:"gray.7",children:"string"==typeof e?decodeURI(e.split("/").pop()):"".concat(e.name," (").concat(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(n<0?0:n))," ").concat(["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][t])}(e.size),")")}),(0,d.jsx)(eJ.P,{title:"Delete file",color:"gray.7",onClick:()=>m(null)})]}):void 0;return(0,d.jsxs)(C.K,{spacing:"xs",maw:"100%",children:["image"===l?(0,d.jsx)(p.x,{maw:"50%",children:n}):n,t]})}(u):void 0,(0,d.jsx)(eY.fh,{onDrop:e=>{e.length>0&&void 0!==s&&(m(e[0]),s(e[0]))},maxSize:a,accept:function(){if(["audio","video","image"].includes(l)){let e={};for(let[n,t]of Object.entries(V.extensions))n.startsWith(l)&&(e[n]=t.map(e=>".".concat(e)));return e}}(),maxFiles:1,children:(0,d.jsxs)(w.Z,{position:"center",spacing:"md",style:{pointerEvents:"none"},children:[(0,d.jsx)(eY.fh.Accept,{children:(0,d.jsx)(e1.Z,{color:x.colors[x.primaryColor][5],size:c})}),(0,d.jsx)(eY.fh.Reject,{children:(0,d.jsx)(e5.Z,{color:x.colors.red[6],size:c})}),(0,d.jsx)(eY.fh.Idle,{children:(n="image"===l?eX.Z:"video"===l?eQ.Z:"audio"===l?e$.Z:e0.Z,(0,d.jsx)(n,{size:c}))}),(0,d.jsxs)(g.x,{inline:!0,...o,children:["Drag ",l," file here or click to select"]})]})})]})})}var e8=t(6801),e2=t(806),e4=t(4419);e4.ZP.registerCustom({isApplicable:e=>e instanceof File,serialize:e=>"null",deserialize:e=>null},"decimal.js");let{stringify:e6}=e4.ZP,{parse:e9}=e4.ZP,ne="This field is required.",[nn,nt,nr]=(0,e8.W)(),ni=e=>{let{schema:n,filetypes:t,initialValues:r}=e,i=Object.keys(n.properties),s=Object.fromEntries(i.map(e=>[e,r&&r[e]?r[e]:function(e){let r=n.properties[e],i=em(r,t[e]),s=r.default;if(null==s)switch(i){case l.STR:case l.CONSTR:case l.INT:case l.FLOAT:case l.CONINT:case l.CONFLOAT:s="";break;case l.BOOL:s=!1;break;default:s=null}return s}(e)])),{onSubmit:o,values:a,setFieldValue:c,isTouched:u,setTouched:d,...p}=nr({initialValues:s,validate:Object.fromEntries(i.map(e=>[e,function(e){let r=n.properties[e],i=null!=n.required&&n.required.includes(e),s=em(r,t[e]),o=e=>null==e?i?ne:void 0:"string"!=typeof e&&"string"==typeof e&&!function(e){let n;try{n=new URL(e)}catch(e){return!1}return"http:"===n.protocol||"https:"===n.protocol}(e)?"Not an HTTP(s) URL.":void 0,a=e=>{if(null==e)return i?ne:void 0;if("string"!=typeof e)throw TypeError("Invalid type for string form");return 0===e.length?i?ne:void 0:void 0!==r.max_length&&e.length>r.max_length?"Maximum length is ".concat(r.max_length," characters."):void 0!==r.min_length&&e.length<r.min_length?"Minimum length is ".concat(r.min_length," characters."):void 0},c=e=>{if(null==e||"string"==typeof e&&0===e.length)return i?ne:void 0;if("number"!=typeof e)throw TypeError("Invalid type for number form");return void 0!==r.maximum&&e>r.maximum?"Maximum value is ".concat(r.maximum):void 0!==r.minimum&&e<r.minimum?"Minimum value is ".concat(r.minimum,"."):void 0};switch(s){case l.FILE:return o;case l.STR:case l.CONSTR:case l.STR_CHOICE:return a;case l.CONFLOAT:case l.FLOAT:case l.CONINT:case l.INT:case l.INT_CHOICE:case l.FLOAT_CHOICE:return c;default:return}}(e)]))}),m=(e,t)=>{let r=(t,r)=>e(Object.fromEntries(i.map(e=>[e,function(e,t){let r=n.properties[e];return null==t?r.default:t}(e,t[e])])),r);return o(r,t)},x=(0,S.useRouter)(),[h,f]=(0,e2.X)({key:"prediction-input-form",defaultValue:null,serialize:e6,deserialize:e=>void 0===e?null:e9(e)});return(0,y.useEffect)(()=>{var e;let r=()=>{f({path:x.asPath,schema:n,filetypes:t,values:a})};return null===(e=x.events)||void 0===e||e.on("routeChangeStart",r),document.documentElement.addEventListener("mouseleave",r),null==window||window.addEventListener("beforeunload",r),()=>{document.documentElement.removeEventListener("mouseleave",r),null==window||window.removeEventListener("beforeunload",r)}},[n,t,x,f,a]),(0,y.useEffect)(()=>{null!=h&&(null==h?void 0:h.values)&&(null==h?void 0:h.path)===x.asPath&&(null==h?void 0:h.schema)!=null&&JSON.stringify(null==h?void 0:h.schema)===JSON.stringify(n)&&(null==h?void 0:h.filetypes)!=null&&JSON.stringify(null==h?void 0:h.filetypes)===JSON.stringify(t)&&Object.keys(h.values).forEach(e=>{(null==t[e]||null!=h.values[e])&&(c(e,h.values[e]),d({[e]:!0}))})},[h,c,n,t,x.asPath,d]),{onSubmit:m,values:a,setFieldValue:c,isTouched:u,setTouched:d,...p}},nl=()=>({placeholder:"Select one",rightSection:(0,d.jsx)(eq.Z,{size:"1rem"})}),ns=e=>({min:null!==(o=e.minimum)&&void 0!==o?o:void 0,max:null!==(a=e.maximum)&&void 0!==a?a:void 0,styles:{markLabel:{display:"none"},label:{display:"none"}}}),no=e=>({min:null!==(c=e.minimum)&&void 0!==c?c:void 0,max:null!==(u=e.maximum)&&void 0!==u?u:void 0,stepHoldDelay:500,stepHoldInterval:100,removeTrailingZeros:!0});function na(e){let{fieldName:n,fieldProp:t,filetype:r}=e,i=nt(),s=i.getInputProps(n),o=em(t,r);switch(o){case l.FILE:return(0,d.jsx)(e7,{filetype:r,maxsize:1073741824,iconSize:"1.1rem",textProps:{size:"sm"},...s});case l.STR:case l.CONSTR:return(0,d.jsx)(eH.g,{autosize:!0,minRows:1,...s});case l.INT:case l.FLOAT:return(0,d.jsx)(eM.Y,{w:"100%",precision:o===l.INT?1:10,step:o===l.INT?1:.01,...no(t),...s});case l.CONINT:case l.CONFLOAT:return(0,d.jsxs)(w.Z,{spacing:"1rem",children:[(0,d.jsx)(eM.Y,{w:"calc(30% - 1rem)",precision:o===l.CONINT?0:10,step:o===l.CONINT?1:.01,...no(t),...s}),(0,d.jsx)(eW.i,{w:"70%",value:s.value,onChange:s.onChange,step:o===l.CONINT?1:.01,...ns(t)})]});case l.STR_CHOICE:if(null==t.choices)throw TypeError("No choices");return(0,d.jsx)(eK.Ph,{data:t.choices,...s,...nl()});case l.BOOL:return(0,d.jsx)(eU.r,{...s});case l.INT_CHOICE:case l.FLOAT_CHOICE:if(null==t.choices)throw TypeError("No choices");return(0,d.jsx)(eK.Ph,{value:null!=s.value?s.value.toString():null,data:t.choices.map(e=>e.toString()),onChange:e=>{let n=null;"string"==typeof e&&(n=Number(e)),s.onChange(n)},...Object.fromEntries(Object.entries(s).filter(e=>!["onChange","value"].includes(e[0])))});default:throw TypeError("Unknown field type ".concat(o))}}function nc(e){let{filetype:n,value:t}=e;if(n)return(0,d.jsx)(ep,{file:t,filetype:n});if(void 0!==t)return(0,d.jsx)(eS,{children:"string"!=typeof t?t.toString():t});throw Error("`value` is undefined")}function nu(e){let{withForm:n,schema:t,filetypes:r,values:i,showOptions:l,spacing:s}=e,o=[],a=[];function c(e){return(null==t?void 0:t.required)!=null&&(null==t?void 0:t.required.includes(e))}function u(e){let l=t.properties[e],s=r[e];return n?(0,d.jsx)(na,{fieldName:e,fieldProp:l,filetype:s}):(0,d.jsx)(nc,{filetype:s,value:void 0===i?void 0:i[e]})}return Object.keys(t.properties).forEach(e=>{c(e)&&o.push({name:e,component:u(e)})}),Object.keys(t.properties).forEach(e=>{c(e)||a.push({name:e,component:u(e)})}),(0,d.jsxs)(p.x,{fz:"md",children:[(0,d.jsx)(C.K,{spacing:s,children:o.map(e=>(0,d.jsxs)("div",{children:[(0,d.jsx)(J,{name:e.name,required:!!n,description:n?t.properties[e.name].description:void 0}),e.component]},"input-field-".concat(e.name)))}),l&&a.length>0?(0,d.jsx)(T.T,{h:s}):void 0,(0,d.jsx)(eA.U,{in:null!=l&&l,children:(0,d.jsx)(C.K,{spacing:s,children:a.map(e=>(0,d.jsxs)("div",{children:[(0,d.jsx)(J,{name:e.name,required:!1,description:n?t.properties[e.name].description:void 0}),e.component]},"input-field-".concat(e.name)))})})]})}nu.defaultProps={spacing:"md",values:void 0,showOptions:!1};var nd=t(8078);function np(e){let{checked:n,onChange:t,...r}=e;return(0,d.jsx)(nd.X,{label:"Show options",checked:n,onChange:e=>t(e.currentTarget.checked),...r})}var nm=t(3575);let nx={height:"3rem"},nh=e=>nm.N9.show({message:"".concat(e),color:"red",sx:nx});var nf=t(4075);let ng=(0,y.forwardRef)((e,n)=>{var t,r;let i;let{prediction:l,model:s,setPrediction:o}=e,{demo_output_schema:a,demo_output_filetypes:c}=s,u=new f.Z,m=R(),x=P(m),[h,g]=(0,y.useState)("preview"),j=(0,Z.useMutation)({mutationFn:()=>(u.remove("current_prediction",{path:"/"}),o(null),x.cancel(l.id))}),v=(null==l?void 0:l.status)&&["pending","running"].includes(l.status)?"auto":"smooth",b=(0,d.jsx)(eL,{autoScroll:v,children:null!==(t=null==l?void 0:l.logs)&&void 0!==t?t:""}),O=(0,d.jsx)(T.T,{h:"md"}),C=(0,d.jsx)(T.T,{h:"xl"});switch(null==l?void 0:l.status){case"pending":case"running":i=(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(H,{status:l.status,logsArea:"running"===l.status?b:void 0}),O,(0,d.jsx)(X.z,{onClick:()=>j.mutate(),variant:"default",fullWidth:!0,children:"Cancel"})]});break;case"failed":i=(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(B,{failureReason:l.failure_reason,logsArea:b}),C]});break;case"success":i=(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eB,{mode:h,onChange:g}),O,(0,d.jsx)(e_,{mode:h,output:l.output,demoOutput:l.demo_output,demoOutputSchema:a,demoOutputFiletypes:c,logs:null!==(r=null==l?void 0:l.logs)&&void 0!==r?r:""}),C,(0,d.jsx)(w.Z,{position:"right",children:(0,d.jsx)(X.z,{variant:"default",onClick:()=>{window.scrollTo({top:0,behavior:"auto"}),u.remove("current_prediction",{path:"/"}),o(null)},leftIcon:(0,d.jsx)(nf.Z,{size:"1rem"}),children:"Clear"})})]});break;default:i=(0,d.jsx)(q,{})}return(0,d.jsx)(p.x,{ref:n,children:i})});ng.displayName="ModelRunProgress";var nj=t(8697);function nv(e){var n,t,r;let{model:i,currentPrediction:l,onFormSubmit:s,onError:o}=e,{input_schema:a,input_filetypes:c}=i,u=(0,S.useRouter)(),p=R(),m=Object.freeze({axiosInstance:p,upload:function(e){let n=new FormData;return n.append("file",e),p.post("/files",n,{timeout:3e5,headers:{"Content-Type":"multipart/form-data"}})}}),[x,h]=(0,y.useState)(!1),[f,g]=(0,y.useState)(!1),[j,v]=(0,y.useState)(!1),{start:b}=(0,nj.K)(()=>v(!1),2e3),O=()=>{v(!0),b()},E=ni({schema:a,filetypes:c});null===(n=u.events)||void 0===n||n.on("routeChangeComplete",()=>{g(!1),v(!1)}),null===(t=u.events)||void 0===t||t.on("routeChangeError",()=>{g(!1),v(!1)});let I=async e=>e instanceof File?await m.upload(e).then(e=>e.data.serving_url).catch(()=>""):e,N=async e=>{g(!0),O();let n=Object.keys(i.input_schema.properties),t=n.filter(e=>!!i.input_filetypes[e]),r=t.map(n=>I(e[n])),l=await Promise.all(r);if(l.some(e=>""===e)){console.log(l),o(),g(!1);return}let a=Object.fromEntries(n.map(n=>{let r=t.indexOf(n);return r>=0?[n,l[r]]:[n,e[n]]}));s(a),g(!1)},{setValues:k}=E;return(0,y.useLayoutEffect)(()=>{null!=l&&k(l.input)},[l,k]),(0,d.jsxs)(C.K,{w:"100%",spacing:"0",children:[null!=(r=i.input_schema).required&&Object.keys(r.properties).some(e=>{var n;return!(null===(n=r.required)||void 0===n?void 0:n.includes(e))})?(0,d.jsx)(w.Z,{position:"right",children:(0,d.jsx)(np,{checked:x,onChange:h})}):void 0,(0,d.jsx)(nn,{form:E,children:(0,d.jsxs)("form",{onSubmit:E.onSubmit(N),children:[(0,d.jsx)(nu,{withForm:!0,schema:a,filetypes:c,showOptions:x}),(0,d.jsx)(T.T,{h:"xxl"}),(0,d.jsxs)(w.Z,{position:"right",grow:!0,children:[(0,d.jsx)(X.z,{onClick:E.reset,leftIcon:(0,d.jsx)(nf.Z,{size:"1rem"}),variant:"default",children:"Reset"}),(0,d.jsx)(X.z,{leftIcon:(0,d.jsx)($.Z,{size:"1rem"}),color:"run-green.4",loading:f||j,type:f||j?void 0:"submit",children:"Run"})]})]})})]})}let ny="Failed to run by unexpected server error";function nb(e){let{model:n,currentPrediction:t}=e,r=R(),i=P(r),l=new f.Z,[s,o]=(0,y.useState)(t),{scrollIntoView:a,targetRef:c}=(0,z.g)({axis:"y"}),u=(0,Z.useMutation)({mutationFn:e=>{let n=i.create(e);return null!=s&&["pending","running"].includes(s.status)?i.cancel(s.id).then(()=>n):n},onSuccess:e=>{let{data:n}=e;l.set("current_prediction",n.id,{path:"/"}),console.log(n),o(n),a({alignment:"start"})},onError:()=>{nh(ny)}});return(0,Z.useQuery)({enabled:null!=s&&("running"===s.status||"pending"===s.status),retry:5,refetchInterval:500,queryKey:"",queryFn:()=>i.get(s.id),onSuccess:e=>o(e.data),onError:()=>nh("Failed to update the status from server")}),(0,d.jsxs)(w.Z,{w:"100%",spacing:"2rem",align:"top",grow:!0,children:[(0,d.jsx)(W,{title:"Input",children:(0,d.jsx)(nv,{model:n,currentPrediction:t,onFormSubmit:u.mutate,onError:()=>nh(ny)})}),(0,d.jsx)(W,{title:"Output",children:(0,d.jsx)(ng,{ref:c,prediction:s,model:n,setPrediction:o})})]})}function nO(){let e=R(),n=Object.freeze({axiosInstance:e,get:function(){return e.get("/metadata")}}),t=P(e),r=new f.Z,[i,l]=(0,y.useState)(null),[s,o]=(0,y.useState)(null);return(0,y.useLayoutEffect)(()=>{(async function(){await n.get().then(e=>l(e.data)).catch(()=>{nh("Failed to load model metadata by unexpected server error")})})()},[]),(0,y.useEffect)(()=>{var e;let n=null!==(e=r.get("current_prediction"))&&void 0!==e?e:null;(async function(){n&&await t.get(n).then(e=>{let{data:n}=e;o(n)}).catch(()=>null)})()},[i]),(0,d.jsxs)(p.x,{children:[i?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(h(),{children:[(0,d.jsx)("title",{children:"".concat(i.name," - Run | Tungsten")}),(0,d.jsx)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,d.jsx)(_,{model:i,children:(0,d.jsx)(nb,{model:i,currentPrediction:s})})]}):void 0,(0,d.jsx)(m.f,{visible:null==i})]})}},7579:function(){}},function(e){e.O(0,[544,8,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);