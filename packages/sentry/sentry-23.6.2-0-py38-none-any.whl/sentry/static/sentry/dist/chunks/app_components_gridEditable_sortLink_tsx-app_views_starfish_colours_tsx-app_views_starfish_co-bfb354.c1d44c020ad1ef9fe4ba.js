"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_gridEditable_sortLink_tsx-app_views_starfish_colours_tsx-app_views_starfish_co-bfb354"],{"./app/components/gridEditable/sortLink.tsx":(e,t,s)=>{s.d(t,{Z:()=>u});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react-router/es/index.js"),i=s("./app/components/links/link.tsx"),n=s("./app/icons/index.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{align:t,title:s,canSort:a,generateSortLink:i,onClick:n,direction:l,replace:u}=e;const h=i();if(!h||!a)return(0,o.tZ)(p,{align:t,children:s});const m=l?(0,o.tZ)(c,{size:"xs",direction:"desc"===l?"down":"up"}):null;return(0,o.BX)(d,{align:t,to:h,onClick:e=>{u&&(e.preventDefault(),r.browserHistory.replace(h)),n?.(e)},children:[s," ",m]})}l.displayName="SortLink";const d=(0,a.Z)((e=>{const{align:t,css:s,...a}=e;return(0,o.tZ)(i.Z,{...a})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),p=(0,a.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),c=(0,a.Z)(n.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),u=l},"./app/utils/discover/discoverQuery.tsx":(e,t,s)=>{s.d(t,{Z:()=>l,_:()=>o});var a=s("./app/utils/discover/genericDiscoverQuery.tsx"),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function n(e){return(0,r.tZ)(a.ZP,{route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:s,...a}=e.meta??{};return{...e,meta:{...s,...a}}},...e})}function o(e){const t=(0,a.JC)({route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:s,...a}=e.meta??{};return{...e,meta:{...s,...a}}},...e}),s=t.response?.getResponseHeader("Link")??void 0;return{...t,pageLinks:s}}n.displayName="DiscoverQuery";const l=n},"./app/views/starfish/colours.tsx":(e,t,s)=>{s.d(t,{SQ:()=>r,Tn:()=>i,eO:()=>n});var a=s("./app/constants/chartPalette.tsx");const r=a.$[3][3],i=(a.$[3][1],a.$[0][0]),n=a.$[5][3]},"./app/views/starfish/components/datePicker.tsx":(e,t,s)=>{s.d(t,{Z:()=>p});var a=s("./app/components/datePageFilter.tsx"),r=s("./app/locale.tsx"),i=s("./app/utils/analytics.tsx"),n=s("./app/utils/useOrganization.tsx"),o=s("./app/views/starfish/components/pageFilterContainer.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(){const e=(0,n.Z)();return(0,l.tZ)(a.Z,{maxDateRange:o._r,disallowArbitraryRelativeRanges:!0,relativeOptions:{"1h":(0,r.t)("Last hour"),"12h":(0,r.t)("Last 12 hours"),"24h":(0,r.t)("Last 24 hours"),"3d":(0,r.t)("Last 3 days"),"7d":(0,r.t)("Last 7 days")},defaultPeriod:"24h",alignDropdown:"left",onChange:t=>{let{start:s,end:a,relative:r}=t;(0,i.Gi)("starfish.page_filter.data_change",{organization:e,start:s,end:a,relative:r})}})}d.displayName="StarfishDatePicker";const p=d},"./app/views/starfish/components/pageFilterContainer.tsx":(e,t,s)=>{s.d(t,{ZP:()=>c,_r:()=>d});var a=s("./app/components/organizations/pageFilters/container.tsx"),r=s("./app/utils/useLocation.tsx"),i=s("./app/utils/usePageFilters.tsx"),n=s("./app/utils/useRouter.tsx"),o=s("./app/views/starfish/utils/getDateFilters.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const d=7;function p(e){const t=(0,n.Z)(),s=(0,r.T)(),{selection:p}=(0,i.Z)(),c=p.datetime,{endTime:u,startTime:h}=(0,o.tZ)(p);return u.diff(h,"days")>d&&(c.period="24h",c.start=null,c.end=null,t.replace({pathname:s.pathname,query:{...s.query,statsPeriod:"24h",start:null,end:null}})),(0,l.tZ)(a.Z,{children:e.children})}p.displayName="StarfishPageFilterContainer";const c=p},"./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts":(e,t,s)=>{s.d(t,{Z:()=>r});var a=s("./app/locale.tsx");const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return`${-1===e?"--":e.toFixed(2)} / ${(0,a.t)("s")}`}},"./app/views/starfish/utils/retryHandlers.tsx":(e,t,s)=>{function a(e,t){return e<3&&t.message.includes("429")}function r(e){return 1e3*Math.pow(3,e)}s.d(t,{P:()=>r,V:()=>a})},"./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx":(e,t,s)=>{s.d(t,{Jg:()=>F,sZ:()=>R,_2:()=>O});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),i=s("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),n=s("./app/components/charts/utils.tsx"),o=s("./app/components/panels/index.tsx"),l=s("./app/locale.tsx"),d=s("./app/styles/space.tsx"),p=s("./app/utils.tsx"),c=s("./app/utils/discover/discoverQuery.tsx"),u=s("./app/utils/discover/eventView.tsx"),h=s("./app/utils/discover/types.tsx"),m=s("./app/utils/useLocation.tsx"),g=s("./app/utils/useOrganization.tsx"),v=s("./app/utils/usePageFilters.tsx"),f=s("./app/views/starfish/types.tsx"),x=s("./app/utils/discover/genericDiscoverQuery.tsx"),y=s("./app/views/starfish/utils/retryHandlers.tsx"),w=s("../node_modules/react-router/es/index.js"),b=s("../node_modules/lodash/cloneDeep.js"),_=s.n(b),E=s("./app/components/compactSelect/index.tsx"),T=s("./app/utils/analytics.tsx"),Z=s("./app/utils/discover/charts.tsx"),P=s("./app/utils/performanceForSentry/index.tsx"),D=s("./app/views/starfish/components/chart.tsx"),k=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function C(e){let{topSeriesData:t,transaction:s,isTimeseriesLoading:a,errored:r,options:i,dataDisplayType:n,setDataDisplayType:o}=e;const d=(0,g.Z)(),p=d.features.includes("starfish-wsv-chart-dropdown"),c=[];for(let e=0;e<t.length;e++){const s=t[e];s.emphasis={disabled:!1,focus:"series"},s.blur={areaStyle:{opacity:.3}},s.triggerLineEvent=!0,c.push(s)}const u=_()(c),h=t[0]?.data?.length??0;for(let e=0;e<h;e++){const s=t.reduce(((t,s)=>t+s.data[e].value),0);u.forEach((t=>{const a={...t.data[e]};a.value=a.value/s,t.data[e]=a}))}const m=Boolean(s);return(0,k.tZ)(j,{children:(0,k.BX)(S,{children:[(0,k.BX)($,{children:[(0,k.tZ)(L,{children:m?(0,l.t)("Endpoint Breakdown"):(0,l.t)("Service Breakdown")}),p&&(0,k.tZ)(E.Z,{options:i,value:n,onChange:e=>{o(e.value),(0,T.Gi)("starfish.web_service_view.breakdown.display_change",{organization:d,display:e.value})}})]}),(0,k.tZ)(P.oF,{id:"WSV.SpanGroupBreakdown",hasData:t.length>0,children:(0,k.tZ)(D.ZP,{statsPeriod:"24h",height:340,showLegend:!0,data:n===F.PERCENTAGE?u:t,dataMax:n===F.PERCENTAGE?1:void 0,durationUnit:n===F.PERCENTAGE?.25:void 0,start:"",end:"",errored:r,loading:a,utc:!1,onClick:e=>{switch(e.seriesName){case"http":w.browserHistory.push("/starfish/api");break;case"db":w.browserHistory.push("/starfish/database");break;default:w.browserHistory.push("/starfish/spans")}},grid:{left:"0",right:"0",top:"20px",bottom:"0"},definedAxisTicks:6,stacked:!0,aggregateOutputFormat:n===F.PERCENTAGE?"percentage":"duration",tooltipFormatterOptions:{valueFormatter:e=>n===F.PERCENTAGE?(0,Z.Ew)(e,"percentage"):(0,Z.Ew)(e,"duration")},onLegendSelectChanged:e=>{(0,T.Gi)("starfish.web_service_view.breakdown.legend_change",{organization:d,selected:Object.keys(e.selected).filter((t=>e.selected[t])),toggled:e.name})}})})]})})}C.displayName="SpanGroupBreakdown";const S=(0,a.Z)("div",{target:"e1sx7q3i3"})("padding:0 ",(0,d.D)(2),";flex:2;"),L=(0,a.Z)("p",{target:"e1sx7q3i2"})((e=>e.theme.text.cardTitle),";"),$=(0,a.Z)("div",{target:"e1sx7q3i1"})("padding:0 ",(0,d.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,d.D)(1),";"),j=(0,a.Z)("div",{target:"e1sx7q3i0"})("display:flex;min-height:200px;padding-bottom:",(0,d.D)(2),";"),{SPAN_SELF_TIME:N}=f.SpanMetricsFields,A="Other",R=(0,l.t)("custom");let F;function O(e){let{transaction:t,transactionMethod:s}=e;const a=(0,v.Z)(),n=(0,g.Z)(),o=(0,m.T)(),{selection:l}=a,d=(0,i.u)(),h=[{label:"Percentages",value:F.PERCENTAGE},{label:"Duration (p95)",value:F.DURATION_P95},{label:"Total Duration",value:F.CUMULATIVE_DURATION}],[f,w]=(0,r.useState)(F.PERCENTAGE),{data:b,isLoading:_}=(0,c._)({eventView:V(o,`transaction.op:http.server ${t?`transaction:${t}`:""} ${s?`http.method:${s}`:""}`,["span.category"]),orgSlug:n.slug,referrer:"starfish-web-service.span-category-breakdown",location:o,limit:4}),{data:E,isLoading:T}=(0,c._)({eventView:V(o,`transaction.op:http.server ${t?`transaction:${t}`:""} ${s?`http.method:${s}`:""}`,[]),orgSlug:n.slug,referrer:"starfish-web-service.total-time",location:o}),{isLoading:Z,data:P,isError:D}=function(e){let{eventView:t,enabled:s,initialData:a,referrer:r}=e;const i=(0,m.T)(),n=(0,g.Z)(),{isLoading:o,data:l,isError:d}=(0,x.JC)({route:"events-stats",eventView:t,location:i,orgSlug:n.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(i),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:0,partial:1,orderby:t.sorts?.[0]?(0,u.uZ)(t.sorts?.[0]):void 0,interval:t.interval}),options:{enabled:s,refetchOnWindowFocus:!1,retry:y.V,retryDelay:y.P,staleTime:1/0},referrer:r});return{isLoading:o,data:o&&a?a:l,isError:d}}({eventView:I(o,l,`transaction.op:http.server ${t?`transaction:${t}`:""} ${s?`http.method:${s}`:""}`,["span.category"],f,!0),enabled:!0,referrer:"starfish-web-service.span-category-breakdown-timeseries",initialData:[]}),S=E?.data[0]?.[`sum(${N})`]?parseInt(E?.data[0][`sum(${N})`],10):0,L=b?.data.reduce(((e,t)=>e+parseInt(t[`sum(${N})`],10)),0)??0,$=S?S-L:0,j=[];if((0,p.ri)(b)){for(let e=0;e<b.data.length;e++){const t=b.data[e],s=t["span.category"];j.push({cumulativeTime:parseInt(t[`sum(${N})`],10),group:{"span.category":""===s?R:s}})}$>0&&j.push({cumulativeTime:$,group:{"span.category":A}})}const O={},M=d.charts.getColorPalette(j.length-2);(0,p.ri)(P)&&!Z&&j.length>0&&(j.forEach(((e,t)=>{const s=e.group["span.category"],a=""===s?R:s;O[a]={seriesName:a,data:[],color:M[t]}})),Object.keys(P).forEach((e=>{const t=P?.[e];O[""===e?R:e].data=t?.data.map((e=>({name:1e3*e[0],value:e[1][0].count})))??[]})));const B=Object.values(O);return(0,k.tZ)(G,{children:(0,k.tZ)(C,{tableData:j,totalCumulativeTime:S,isTableLoading:_,topSeriesData:B,colorPalette:M,isTimeseriesLoading:Z,isCumulativeTimeLoading:T,transaction:t,errored:D,options:h,dataDisplayType:f,setDataDisplayType:w})})}!function(e){e.DURATION_P95="duration_p95",e.CUMULATIVE_DURATION="cumulative_duration",e.PERCENTAGE="percentage"}(F||(F={})),O.displayName="SpanGroupBreakdownContainer";const G=(0,a.Z)(o.s_,{target:"eoo99dh0"})("padding-top:",(0,d.D)(2),";margin-bottom:0;"),I=(e,t,s,a,r,i)=>{const o=r===F.DURATION_P95?`p95(${N})`:`sum(${N})`;return u.ZP.fromNewQueryWithLocation({name:"",fields:[`sum(${N})`,`p95(${N})`,...a],yAxis:i?[o]:[],query:s,dataset:h.as.SPANS_METRICS,orderby:"-sum_span_self_time",version:2,topEvents:a.length>0?"4":void 0,interval:i?(0,n.ZS)(t.datetime,"low"):void 0},e)},V=(e,t,s)=>u.ZP.fromNewQueryWithLocation({name:"",fields:[`sum(${N})`,...s],query:t,dataset:h.as.SPANS_METRICS,orderby:"-sum_span_self_time",version:2,topEvents:s.length>0?"4":void 0},e)}}]);
//# sourceMappingURL=../sourcemaps/app_components_gridEditable_sortLink_tsx-app_views_starfish_colours_tsx-app_views_starfish_co-bfb354.bd160ec42b87f713e39aecd523414cf9.js.map