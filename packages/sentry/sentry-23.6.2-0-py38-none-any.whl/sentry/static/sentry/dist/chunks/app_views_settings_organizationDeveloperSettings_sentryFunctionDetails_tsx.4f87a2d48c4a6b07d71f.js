"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx"],{"./app/components/forms/formPanel.tsx":(e,t,n)=>{n.d(t,{Z:()=>u});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react/index.js"),i=n("./app/components/forms/fieldFromConfig.tsx"),r=n("./app/components/panels/index.tsx"),a=n("./app/icons/index.tsx"),l=n("./app/utils/sanitizeQuerySelector.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(e){let{additionalFieldProps:t={},title:n,fields:s,access:c,disabled:u,renderFooter:m,renderHeader:h,collapsible:g,initiallyCollapsed:f=!1,...v}=e;const[y,b]=(0,o.useState)(f),x=(0,o.useCallback)((()=>b((e=>!e))),[]);return(0,d.BX)(r.s_,{id:"string"==typeof n?(0,l.m)(n):void 0,children:[n&&(0,d.BX)(r.V9,{children:[n,g&&(0,d.tZ)(p,{onClick:x,children:(0,d.tZ)(a.g6,{"data-test-id":"form-panel-collapse-chevron",direction:y?"down":"up",size:"xs"})})]}),(0,d.BX)(r.N,{hidden:y,children:["function"==typeof h&&h({title:n,fields:s}),s.map((e=>{if("function"==typeof e)return e();const{defaultValue:n,...s}=e;return!0===u&&(s.disabled=!0,s.disabledReason=void 0),(0,d.tZ)(i.Z,{access:c,disabled:u,...v,...t,field:s,highlighted:v.highlighted===`#${e.name}`},e.name)})),"function"==typeof m&&m({title:n,fields:s})]})]})}c.displayName="FormPanel";const u=c,p=(0,s.Z)("span",{target:"eovlw60"})({name:"e0dnmk",styles:"cursor:pointer"})},"./app/components/forms/jsonForm.tsx":(e,t,n)=>{n.d(t,{Z:()=>h});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/react/index.js"),i=n("../node_modules/@sentry/core/esm/exports.js"),r=n("../node_modules/scroll-to-element/index.js"),a=n.n(r),l=n("./app/utils.tsx"),d=n("./app/utils/sanitizeQuerySelector.tsx"),c=n("./app/utils/withSentryRouter.tsx"),u=n("./app/components/forms/formPanel.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m extends o.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{highlighted:this.props.location?.hash})}componentDidMount(){this.scrollToHash()}componentDidUpdate(e){if(this.props.location&&this.props.location.hash!==e.location.hash){const e=this.props.location.hash;this.scrollToHash(e),this.setState({highlighted:e})}}scrollToHash(e){const t=e||this.props.location?.hash;if(t)try{a()((0,d.m)(decodeURIComponent(t)),{align:"middle",offset:-100})}catch(e){i.Tb(e)}}shouldDisplayForm(e){const t=e.filter((e=>"function"!=typeof e&&(0,l.ri)(e?.visible)));if(e.length===t.length){const{additionalFieldProps:e,...n}=this.props;return!t.every((t=>"function"==typeof t.visible?!t.visible({...n,...e}):!t.visible))}return!0}renderForm(e){let{fields:t,formPanelProps:n,title:s}=e;return this.shouldDisplayForm(t)||n?.renderFooter||n?.renderHeader?(0,p.tZ)(u.Z,{title:s,fields:t,...n}):null}render(){const{access:e,collapsible:t,initiallyCollapsed:n,fields:s,title:i,forms:r,disabled:a,features:l,additionalFieldProps:d,renderFooter:c,renderHeader:u,location:m,params:h,router:g,routes:f,...v}=this.props,y={access:e,disabled:a,features:l,additionalFieldProps:d,renderFooter:c,renderHeader:u,highlighted:this.state.highlighted,collapsible:t,initiallyCollapsed:n};return(0,p.BX)("div",{...v,children:[void 0!==r&&r.map(((e,t)=>(0,p.tZ)(o.Fragment,{children:this.renderForm({formPanelProps:y,...e})},t))),void 0===r&&void 0!==s&&this.renderForm({fields:s,formPanelProps:y,title:i})]})}}m.displayName="JsonForm";const h=(0,c.Z)(m)},"./app/views/settings/organizationDeveloperSettings/sentryFunctionDetails.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>H}),n("../node_modules/core-js/modules/es.array.push.js");var s=n("../node_modules/react/index.js"),o=n("../node_modules/react-router/es/index.js"),i=n("../node_modules/@monaco-editor/react/lib/es/index.js"),r=n("./app/actionCreators/indicator.tsx"),a=n("./app/components/acl/feature.tsx"),l=n("./app/components/asyncComponent.tsx"),d=n("./app/components/forms/form.tsx"),c=n("./app/components/forms/jsonForm.tsx"),u=n("./app/components/forms/model.tsx"),p=n("./app/components/panels/index.tsx"),m=n("./app/locale.tsx"),h=n("./app/utils/withDomainRequired.tsx"),g=n("./app/utils/withOrganization.tsx"),f=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),v=n("./app/components/button.tsx"),y=n("./app/components/forms/fields/textField.tsx"),b=n("./app/icons/index.tsx"),x=n("./app/styles/space.tsx"),Z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function F(e){const{envVariables:t,setEnvVariables:n}=e;return(0,Z.BX)("div",{children:[(0,Z.BX)(p.V9,{children:[(0,m.t)("Environment Variables"),(0,Z.tZ)(j,{size:"sm",icon:(0,Z.tZ)(b.N_,{isCircled:!0}),"aria-label":(0,m.t)("Add Environment Variable"),onClick:()=>{n([...t,{name:"",value:""}])}})]}),(0,Z.BX)(D,{children:[(0,Z.BX)(w,{children:[(0,Z.tZ)(_,{children:(0,m.t)("Name")}),(0,Z.tZ)(C,{children:(0,m.t)("Value")})]}),t.map(((e,s)=>(0,Z.BX)(w,{children:[(0,Z.tZ)(y.Z,{name:`env-variable-name-${s}`,required:!1,inline:!1,defaultValue:e.name,value:e.name,stacked:!0,onChange:e=>((e,s)=>{const o=[...t];for(;o.length<=s;)o.push({name:"",value:""});o[s]={...o[s],name:e},n(o)})(e,s)}),(0,Z.tZ)(y.Z,{name:`env-variable-value-${s}`,required:!1,inline:!1,defaultValue:e.value,value:e.value,stacked:!0,onChange:e=>((e,s)=>{const o=[...t];for(;o.length<=s;)o.push({name:"",value:""});o[s]={...o[s],value:e},n(o)})(e,s)}),(0,Z.tZ)(V,{children:(0,Z.tZ)(j,{size:"sm",icon:(0,Z.tZ)(b.Fz,{}),"aria-label":(0,m.t)("Remove Environment Variable %s",s),onClick:()=>(e=>{const s=[...t];s.splice(e,1),n(s)})(s)})})]},s)))]})]})}F.displayName="SentryFunctionEnvironmentVariables";const S=F,w=(0,f.Z)("div",{target:"eeaybgs5"})({name:"1dre63g",styles:"display:grid;grid-template-columns:1fr 1.5fr min-content"}),j=(0,f.Z)(v.zx,{target:"eeaybgs4"})({name:"tjo4qw",styles:"float:right"}),_=(0,f.Z)("div",{target:"eeaybgs3"})("text-align:left;margin-top:",(0,x.D)(2),";margin-bottom:",(0,x.D)(1),";color:",(e=>e.theme.gray400),";"),C=(0,f.Z)(_,{target:"eeaybgs2"})("margin-left:-",(0,x.D)(2),";"),V=(0,f.Z)("div",{target:"eeaybgs1"})("align-items:center;display:flex;margin-bottom:",(0,x.D)(2),";"),D=(0,f.Z)(p.N,{target:"eeaybgs0"})("padding:",(0,x.D)(2),";");var P=n("./app/views/settings/organizationDeveloperSettings/constants.tsx"),z=n("./app/views/settings/organizationDeveloperSettings/subscriptionBox.tsx");function B(e){const{events:t,setEvents:n}=e;function s(e,s){s&&!t.includes(e)?n(t.concat(e)):!s&&t.includes(e)&&n(t.filter((t=>t!==e)))}return(0,Z.tZ)(k,{children:P.j.map((t=>(0,Z.tZ)(z.Z,{disabledFromPermissions:!1,webhookDisabled:!1,checked:e.events.includes(t),resource:t,onChange:s,isNew:"comment"===t},t)))})}B.displayName="SentryFunctionSubscriptions";const E=B,k=(0,f.Z)("div",{target:"e13f5gqz0"})("display:grid;grid-template:auto/1fr 1fr 1fr;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-template:1fr 1fr 1fr/auto;}");function $(e){const t=[];e.onIssue&&t.push("issue"),e.onError&&t.push("error"),e.onComment&&t.push("comment"),delete e.onIssue,delete e.onError,delete e.onComment,e.events=t;const n=[];let s=0;for(;e[`env-variable-name-${s}`];)e[`env-variable-value-${s}`]&&n.push({name:e[`env-variable-name-${s}`],value:e[`env-variable-value-${s}`]}),delete e[`env-variable-name-${s}`],delete e[`env-variable-value-${s}`],s++;e.envVariables=n;const{...o}=e;return o}const N=[{name:"name",type:"string",required:!0,placeholder:"e.g. My Sentry Function",label:"Name",help:"Human readable name of your Sentry Function"},{name:"author",type:"string",placeholder:"e.g. Acme Software",label:"Author",help:"The company or person who built and maintains this Sentry Function."},{name:"overview",type:"string",placeholder:"e.g. This Sentry Function does something useful",label:"Overview",help:"A short description of your Sentry Function."}];function q(e){const[t]=(0,s.useState)((()=>new u.Z({transformData:$}))),{functionSlug:n}=e.params,{organization:l,sentryFunction:g}=e,f=n?"PUT":"POST";let v=`/organizations/${l.slug}/functions/`;n&&(v+=`${n}/`);const y=g?g.code:"exports.yourFunction = (req, res) => {\n    let message = req.query.message || req.body.message || 'Hello World!';\n    console.log('Query: ' + req.query);\n    console.log('Body: ' + req.body);\n    res.status(200).send(message);\n  };",[b,x]=(0,s.useState)(g?.events||[]);(0,s.useEffect)((()=>{t.setValue("onIssue",b.includes("issue")),t.setValue("onError",b.includes("error")),t.setValue("onComment",b.includes("comment"))}),[t,b]);const[F,w]=(0,s.useState)(g?.env_variables?.length?g?.env_variables:[{name:"",value:""}]);return(0,Z.tZ)("div",{children:(0,Z.BX)(a.Z,{features:["organizations:sentry-functions"],children:[(0,Z.tZ)("h2",{children:g?(0,m.t)("Editing Sentry Function"):(0,m.t)("Create Sentry Function")}),(0,Z.BX)(d.Z,{apiMethod:f,apiEndpoint:v,model:t,onPreSubmit:()=>{(0,r.E3)((0,m.t)("Saving changes.."))},initialData:{code:y,events:b,envVariables:F,...e.sentryFunction},onSubmitError:e=>{let t=(0,m.t)("Unknown Error");e.status>=400&&e.status<500&&(t=e?.responseJSON.detail??t),(0,r.Iw)(t)},onSubmitSuccess:e=>{(0,r.S9)((0,m.t)("Sentry Function successfully saved.",e.name));const t=`/settings/${l.slug}/developer-settings/sentry-functions/${e.slug}/`;g?(0,r.S9)((0,m.t)("%s successfully saved.",e.name)):(0,r.S9)((0,m.t)("%s successfully created.",e.name)),o.browserHistory.push((0,h.D)(t))},children:[(0,Z.tZ)(c.Z,{forms:[{title:(0,m.t)("Sentry Function Details"),fields:N}]}),(0,Z.BX)(p.s_,{children:[(0,Z.tZ)(p.V9,{children:(0,m.t)("Webhooks")}),(0,Z.tZ)(p.N,{children:(0,Z.tZ)(E,{events:b,setEvents:x})})]}),(0,Z.tZ)(p.s_,{children:(0,Z.tZ)(S,{envVariables:F,setEnvVariables:w})}),(0,Z.BX)(p.s_,{children:[(0,Z.tZ)(p.V9,{children:(0,m.t)("Write your Code Below")}),(0,Z.tZ)(p.N,{children:(0,Z.tZ)(i.ZP,{height:"40vh",theme:"light",defaultLanguage:"javascript",defaultValue:y,onChange:function(e,n){t.setValue("code",e)},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1}})})]})]})]})})}q.displayName="SentryFunctionDetails";class X extends l.Z{getEndpoints(){const{functionSlug:e}=this.props.params,{organization:t}=this.props;return e?[["sentryFunction",`/organizations/${t.slug}/functions/${e}/`]]:[]}renderBody(){return(0,Z.tZ)(q,{sentryFunction:this.state.sentryFunction,...this.props})}}const H=(0,g.Z)(X)}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx.72336b913d299fe9e26c1f2b844223dc.js.map