"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spanSummaryPage_index_tsx"],{"./app/components/gridEditable/sortLink.tsx":(e,t,s)=>{s.d(t,{Z:()=>u});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("../node_modules/react-router/es/index.js"),r=s("./app/components/links/link.tsx"),i=s("./app/icons/index.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{align:t,title:s,canSort:n,generateSortLink:r,onClick:i,direction:l,replace:u}=e;const m=r();if(!m||!n)return(0,o.tZ)(c,{align:t,children:s});const h=l?(0,o.tZ)(p,{size:"xs",direction:"desc"===l?"down":"up"}):null;return(0,o.BX)(d,{align:t,to:m,onClick:e=>{u&&(e.preventDefault(),a.browserHistory.replace(m)),i?.(e)},children:[s," ",h]})}l.displayName="SortLink";const d=(0,n.Z)((e=>{const{align:t,css:s,...n}=e;return(0,o.tZ)(r.Z,{...n})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),c=(0,n.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),p=(0,n.Z)(i.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),u=l},"./app/utils/discover/discoverQuery.tsx":(e,t,s)=>{s.d(t,{Z:()=>l,_:()=>o});var n=s("./app/utils/discover/genericDiscoverQuery.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function i(e){return(0,a.tZ)(n.ZP,{route:"events",shouldRefetchData:r,afterFetch:(e,t)=>{const{fields:s,...n}=e.meta??{};return{...e,meta:{...s,...n}}},...e})}function o(e){const t=(0,n.JC)({route:"events",shouldRefetchData:r,afterFetch:(e,t)=>{const{fields:s,...n}=e.meta??{};return{...e,meta:{...s,...n}}},...e}),s=t.response?.getResponseHeader("Link")??void 0;return{...t,pageLinks:s}}i.displayName="DiscoverQuery";const l=i},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,s)=>{s.d(t,{AA:()=>x,JC:()=>w,ZP:()=>b,o:()=>m});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/react/index.js")),r=s("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),i=s("./app/api.tsx"),o=s("./app/locale.tsx"),l=s("./app/utils/discover/eventView.tsx"),d=s("./app/utils/performance/contexts/performanceEventViewContext.tsx"),c=s("./app/utils/useApi.tsx"),p=s("./app/utils/useOrganization.tsx"),u=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class h extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new i.KU}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=Z(this.props),s=Z(e);return!(0,l.ze)(t,s)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new m(t,e);const s=t?.message;return new m("string"==typeof s?s:(0,o.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:s,didFetch:n,eventView:a,orgSlug:r,route:i,setError:o}=this.props,{api:l}=this.state;if(!a.isValid())return;const d=`/organizations/${r}/${i}/`,c=Symbol("tableFetchID"),p=Z(this.props);this.setState({isLoading:!0,tableFetchID:c}),o?.(void 0),t?.(l),l.clear();try{const[t,,a]=await x(l,d,p,{queryBatching:e});if(this.state.tableFetchID!==c)return;const r=s?s(t,this.props):t;n?.(r),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:a?.getResponseHeader("Link")??e.pageLinks,tableData:r})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),o&&o(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),s=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||s||n)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:s,pageLinks:n}=this.state,a={isLoading:e,error:t,tableData:s,pageLinks:n},r=this.props.children;return r?.(a)}}function g(e){const t=(0,p.Z)({allowNull:!0})?.slug,s=(0,a.useContext)(d.uL)?.eventView,n=e.orgSlug??t,r=e.eventView??s;if(void 0===n||void 0===r)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const i={...e,orgSlug:n,eventView:r};return(0,u.tZ)(h,{...i})}h.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const f=200,v=2,y=e=>new Promise((t=>setTimeout(t,e)));async function x(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:a,retry:r}=n;if(a?.batchRequest)return a.batchRequest(e,t,{query:s,includeAllArgs:!0});const i=r?.baseTimeout??f,o=r?.timeoutMultiplier??v,l=r?.statusCodes??[],d=r?.tries??1;let c,p=0,u=0;for(;p<d&&(!c||l.includes(c.status));){u>0&&await y(u);try{return p++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...s}})}catch(e){c=e,u=i*o**(p-1)}}throw c}function Z(e){const{cursor:t,limit:s,noPagination:n,referrer:a,getRequestPayload:r,eventView:i,location:o,forceAppendRawQueryString:l}=e,d=r?r(e):i.getEventsAPIPayload(o,l);return t&&(d.cursor=t),s&&(d.per_page=s),n&&(d.noPagination=n),a&&(d.referrer=a),Object.assign(d,e.queryExtras??{}),d}function w(e){const t=(0,c.Z)(),{orgSlug:s,route:n,options:a}=e,i=`/organizations/${s}/${n}/`,o=Z(e),l=(0,r.a)([n,o],(()=>x(t,i,o,{queryBatching:e.queryBatching})),a);return{...l,data:l.data?.[0]??void 0,statusCode:l.data?.[1]??void 0,response:l.data?.[2]??void 0}}const b=g},"./app/utils/performance/contexts/pageError.tsx":(e,t,s)=>{s.d(t,{De:()=>d,V_:()=>o,YY:()=>l});var n=s("../node_modules/react/index.js"),a=s("./app/components/alert.tsx"),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,n.createContext)({pageError:void 0,setPageError:e=>{}});function o(e){let{children:t}=e;const[s,a]=(0,n.useState)();return(0,r.tZ)(i.Provider,{value:{pageError:s,setPageError:a},children:t})}function l(){const{pageError:e}=(0,n.useContext)(i);return e?(0,r.tZ)(a.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}o.displayName="PageErrorProvider",l.displayName="PageErrorAlert";const d=()=>(0,n.useContext)(i)},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,s)=>{s.d(t,{bq:()=>a,uL:()=>i});var n=s("./app/utils/performance/contexts/utils.tsx");const[a,r,i]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,s)=>{s.d(t,{n:()=>a}),s("../node_modules/core-js/modules/es.error.cause.js");var n=s("../node_modules/react/index.js");function a(e){const{strict:t=!0,errorMessage:s=`useContext for "${e.name}" must be inside a Provider with a value`,name:a}=e,r=(0,n.createContext)(void 0);return r.displayName=a,[r.Provider,function(){const e=(0,n.useContext)(r);if(!e&&t)throw new Error(s);return e},r]}},"./app/utils/useKeyPress.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var n=s("../node_modules/react/index.js");const a=(e,t)=>{const[s,a]=(0,n.useState)(!1),r=t??document.body;return(0,n.useEffect)((()=>{const t=t=>{let{key:s}=t;s===e&&a(!0)},s=t=>{let{key:s}=t;s===e&&a(!1)};return r.addEventListener("keydown",t),r.addEventListener("keyup",s),()=>{r.removeEventListener("keydown",t),r.removeEventListener("keyup",s)}}),[e,r]),s}},"./app/utils/useOnClickOutside.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var n=s("../node_modules/react/index.js");const a=function(e,t){(0,n.useEffect)((()=>{const s=s=>{const n=e?.current;n&&!n.contains(s.target)&&t(s)};return document.addEventListener("mousedown",s),document.addEventListener("touchstart",s),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}}),[e,t])}},"./app/views/starfish/colours.tsx":(e,t,s)=>{s.d(t,{SQ:()=>a,Tn:()=>r,eO:()=>i});var n=s("./app/constants/chartPalette.tsx");const a=n.$[3][3],r=(n.$[3][1],n.$[0][0]),i=n.$[5][3]},"./app/views/starfish/components/chartPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/react/index.js"),s("./app/components/panels/index.tsx")),r=s("./app/styles/space.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(e){let{title:t,children:s,button:n}=e;return(0,i.tZ)(a.s_,{children:(0,i.BX)(a.N,{withPadding:!0,children:[t&&(0,i.BX)(d,{children:[t&&(0,i.tZ)(l,{children:t}),n]}),s]})})}o.displayName="ChartPanel";const l=(0,n.Z)("p",{target:"e1tvnfsq1"})((e=>e.theme.text.cardTitle),";"),d=(0,n.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,r.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/components/datePicker.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var n=s("./app/components/datePageFilter.tsx"),a=s("./app/locale.tsx"),r=s("./app/utils/analytics.tsx"),i=s("./app/utils/useOrganization.tsx"),o=s("./app/views/starfish/components/pageFilterContainer.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(){const e=(0,i.Z)();return(0,l.tZ)(n.Z,{maxDateRange:o._r,disallowArbitraryRelativeRanges:!0,relativeOptions:{"1h":(0,a.t)("Last hour"),"12h":(0,a.t)("Last 12 hours"),"24h":(0,a.t)("Last 24 hours"),"3d":(0,a.t)("Last 3 days"),"7d":(0,a.t)("Last 7 days")},defaultPeriod:"24h",alignDropdown:"left",onChange:t=>{let{start:s,end:n,relative:a}=t;(0,r.Gi)("starfish.page_filter.data_change",{organization:e,start:s,end:n,relative:a})}})}d.displayName="StarfishDatePicker";const c=d},"./app/views/starfish/components/pageFilterContainer.tsx":(e,t,s)=>{s.d(t,{ZP:()=>p,_r:()=>d});var n=s("./app/components/organizations/pageFilters/container.tsx"),a=s("./app/utils/useLocation.tsx"),r=s("./app/utils/usePageFilters.tsx"),i=s("./app/utils/useRouter.tsx"),o=s("./app/views/starfish/utils/getDateFilters.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const d=7;function c(e){const t=(0,i.Z)(),s=(0,a.T)(),{selection:c}=(0,r.Z)(),p=c.datetime,{endTime:u,startTime:m}=(0,o.tZ)(c);return u.diff(m,"days")>d&&(p.period="24h",p.start=null,p.end=null,t.replace({pathname:s.pathname,query:{...s.query,statsPeriod:"24h",start:null,end:null}})),(0,l.tZ)(n.Z,{children:e.children})}c.displayName="StarfishPageFilterContainer";const p=c},"./app/views/starfish/components/samplesTable/common.tsx":(e,t,s)=>{s.d(t,{fd:()=>l,kQ:()=>d});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("./app/locale.tsx"),r=s("./app/utils/formatters.tsx"),i=s("./app/views/starfish/components/textAlign.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{duration:t,p95:s,containerProps:n}=e;const l=t-s;if(d(t,s))return(0,o.tZ)(i.Dq,{...n,children:(0,a.t)("Near baseline")});const p=(0,r.g9)(l/1e3,2,!0,!0),u=l>0?`+${p} above`:`${p} below`;return(0,o.tZ)(c,{...n,value:l,children:u})}l.displayName="DurationComparisonCell";const d=(e,t)=>{const s=.03*t;return Math.abs(e-t)<s},c=(0,n.Z)("span",{target:"e1tr2orr0"})("color:",(e=>0===e.value?e.theme.subText:e.value<0?e.theme.green400:e.theme.red400),";text-align:right;")},"./app/views/starfish/components/tableCells/renderHeadCell.tsx":(e,t,s)=>{s.d(t,{WJ:()=>c,qF:()=>d});var n=s("./app/components/gridEditable/sortLink.tsx"),a=s("./app/utils/discover/fields.tsx"),r=s("./app/views/starfish/types.tsx"),i=s("./app/views/starfish/views/queryParameters.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_SELF_TIME:l}=r.SpanMetricsFields,d=new Set([`p95(${l})`,`percentile_percent_change(${l}, 0.95)`,"sps()","sps_percent_change()","time_spent_percentage()","time_spent_percentage(local)","http_error_count()","http_error_count_percent_change()"]),c=e=>{let{column:t,location:s,sort:a}=e;const{key:r,name:l}=t,c=p(r);let u="desc";a?.field===t.key&&"desc"===a.kind&&(u="asc");const m=`${"desc"===u?"-":""}${r}`;return(0,o.tZ)(n.Z,{align:c,canSort:Boolean(s&&a&&d.has(r)),direction:a?.field===t.key?a.kind:void 0,title:l,generateSortLink:()=>({...s,query:{...s?.query,[i.o.SORT]:m}})})};c.displayName="renderHeadCell";const p=e=>{const t=(0,a.dL)(e);if(t){const s=(0,a._4)(t.name,t.arguments[0]);if(s)return(0,a.qG)(e,s)}return"left"}},"./app/views/starfish/components/tableCells/throughputCell.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});var n=s("./app/locale.tsx"),a=s("./app/utils/discover/styles.tsx"),r=s("./app/utils/formatters.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(e){let{throughputPerSecond:t,containerProps:s}=e;const o=t?t.toFixed(2):"--";return(0,i.BX)(a.Hw,{...s,children:[(0,r.Du)(o),"/",(0,n.t)("s")]})}o.displayName="ThroughputCell"},"./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts":(e,t,s)=>{s.d(t,{Z:()=>a});var n=s("./app/locale.tsx");const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return`${-1===e?"--":e.toFixed(2)} / ${(0,n.t)("s")}`}},"./app/views/starfish/utils/extractRoute.tsx":(e,t,s)=>{function n(e){return e.pathname.match(/^\/starfish\/api\//)?"api":e.pathname.match(/^\/starfish\/database\//)?"database":e.pathname.match(/^\/starfish\/endpoint-overview\//)?"endpoint-overview":null}s.d(t,{G:()=>n})},"./app/views/starfish/utils/getDateConditions.tsx":(e,t,s)=>{s.d(t,{x:()=>r});var n=s("./app/components/organizations/pageFilters/parse.tsx"),a=s("./app/views/starfish/utils/getDateFilters.tsx");const r=e=>{const{startTime:t,endTime:s,statsPeriod:r}=(0,a.tZ)(e),{start:i,end:o}=(0,n.fK)({start:t.toDate(),end:s.toDate()});return r?{statsPeriod:r}:{start:i,end:o}}},"./app/views/starfish/utils/retryHandlers.tsx":(e,t,s)=>{function n(e,t){return e<3&&t.message.includes("429")}function a(e){return 1e3*Math.pow(3,e)}s.d(t,{P:()=>a,V:()=>n})},"./app/views/starfish/utils/useSpansQuery.tsx":(e,t,s)=>{s.d(t,{zT:()=>h,bB:()=>g,RX:()=>v}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/es.array.push.js");var n=s("../node_modules/moment/moment.js"),a=s.n(n),r=s("./app/utils/discover/discoverQuery.tsx"),i=s("./app/utils/discover/eventView.tsx"),o=s("./app/utils/discover/genericDiscoverQuery.tsx"),l=s("./app/utils/useLocation.tsx"),d=s("./app/utils/useOrganization.tsx"),c=s("./app/utils/usePageFilters.tsx"),p=s("./app/views/starfish/utils/retryHandlers.tsx"),u=s("../node_modules/react/index.js"),m=s("./app/utils/analytics.tsx");const h="YYYY-MM-DDTHH:mm:ssZ";function g(e){let{eventView:t,initialData:s,limit:n,enabled:a,referrer:r="use-spans-query",cursor:i}=e;const o=(t?.yAxis?.length??0)>0?f:v,{isReady:l}=(0,c.Z)();if(t){const e=o({eventView:t,initialData:s,limit:n,enabled:(a||void 0===a)&&l,referrer:r,cursor:i});return function(e,t){let{isLoading:s,statusCode:n}=t;const[a,r]=(0,u.useState)(null),[i,o]=(0,u.useState)(!1),l=(0,d.Z)();(0,u.useEffect)((()=>{if(s)null===a&&(r(Date.now()),o(!1));else if(!i&&(o(!0),a)){const e=Date.now();(0,m.Gi)("starfish.request",{organization:l,duration:e-a,statusCode:n}),r(null)}}),[i,e,a,l,s,n])}(t,e),e}throw new Error("eventView argument must be defined when Starfish useDiscover is true")}function f(e){let{eventView:t,enabled:s,initialData:n,referrer:r,cursor:c}=e;const u=(0,l.T)(),m=(0,d.Z)(),g=(0,o.JC)({route:"events-stats",eventView:t,location:u,orgSlug:m.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(u),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:0,partial:1,orderby:t.sorts?.[0]?(0,i.uZ)(t.sorts?.[0]):void 0,interval:t.interval,cursor:c}),options:{enabled:s,refetchOnWindowFocus:!1,retry:p.V,retryDelay:p.P,staleTime:1/0},referrer:r}),f=g.isLoading&&n?n:function(e,t){if(!t.yAxis)return[];let s=[];const n=t.yAxis&&("string"==typeof t.yAxis||1===t.yAxis.length),r="string"==typeof t.yAxis?t.yAxis:t.yAxis[0];if(e.data){const t=y(e,n?r:"count").map((e=>({interval:a()(1e3*parseInt(e.interval,10)).format(h),[r]:e[r],group:e.group})));return t}return Object.keys(e).forEach((t=>{e[t].data?s=x(s,y(e[t],n?r:t)):Object.keys(e[t]).forEach((n=>{"order"!==n&&(s=x(s,y(e[t][n],n,t)))}))})),s.map((e=>({...e,interval:a()(1e3*parseInt(e.interval,10)).format(h)})))}(g.data,t);return{...g,data:f,meta:g.data?.meta}}function v(e){let{eventView:t,initialData:s,enabled:n,referrer:a,limit:i,cursor:o}=e;const c=(0,l.T)(),u=(0,d.Z)(),m=(0,r._)({eventView:t,orgSlug:u.slug,location:c,referrer:a,cursor:o,limit:i,options:{enabled:n,refetchOnWindowFocus:!1,retry:p.V,retryDelay:p.P,staleTime:1/0}}),h=m.data?.meta;h&&(h.fields["sps()"]="rate",h.units["sps()"]="1/second");const g=m.isLoading&&s?s:m.data?.data;return{...m,data:g,meta:h}}function y(e,t,s){const n=[];return e.data.forEach((e=>{let[a,[{count:r}]]=e;const i=n.find((e=>e.interval===a&&(!s||e.group===s)));i?i[t]=r:n.push({interval:a,[t]:r,group:s})})),n}function x(e,t){const s=JSON.parse(JSON.stringify(e));return t.forEach((e=>{let{interval:t,group:n,...a}=e;const r=s.find((e=>e.interval===t&&(!n||e.group===n)));r?Object.keys(a).forEach((e=>{r[e]=a[e]})):s.push({interval:t,group:n,...a})})),s}},"./app/views/starfish/views/queryParameters.tsx":(e,t,s)=>{let n;s.d(t,{o:()=>n}),function(e){e.CURSOR="spansCursor",e.SORT="spansSort"}(n||(n={}))},"./app/views/starfish/views/spanSummaryPage/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{Block:()=>ut,BlockContainer:()=>ft,default:()=>wt});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/query-string/index.js")),r=s("./app/components/breadcrumbs.tsx"),i=s("./app/components/layouts/thirds.tsx"),o=s("./app/components/panels/index.tsx"),l=s("./app/components/questionTooltip.tsx"),d=s("./app/locale.tsx"),c=s("./app/styles/space.tsx"),p=s("./app/utils/discover/eventView.tsx"),u=s("./app/utils/performance/contexts/pageError.tsx"),m=s("./app/utils/useOrganization.tsx"),h=s("./app/utils/withDomainRequired.tsx"),g=s("./app/views/starfish/colours.tsx"),f=s("./app/views/starfish/components/chart.tsx"),v=s("./app/views/starfish/components/chartPanel.tsx"),y=s("./app/views/starfish/components/datePicker.tsx"),x=s("./app/views/starfish/components/pageFilterContainer.tsx");const Z=(0,n.Z)("div",{target:"e1enucjs0"})("padding:",(0,c.D)(1),";border-radius:",(e=>e.theme.borderRadius),";overflow-x:auto;white-space:pre-wrap;");var w=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const b=(e,t)=>{let s="";return e.split("").map(((n,a)=>{s+=n;let r=null;if(s===t.action?r=(0,w.BX)(_,{children:[t.action," "]},a):s===t.domain?r=(0,w.BX)(L,{children:[t.domain," "]},a):S.has(s)?r=(0,w.tZ)(P,{children:s},a):["(",")"].includes(s)?r=(0,w.tZ)(D,{children:s},a):" "===n||"\n"===n||")"===e[a+1]?r=s:"%s"===s?r=(0,w.tZ)(E,{children:s}):a===e.length-1&&(r=s),r){s="";const e=r;return r=null,e}return null}))},S=new Set(["ADD","ALL","ALTER","COLUMN","TABLE","AND","ANY","AS","ASC","BACKUP","DATABASE","BETWEEN","CASE","CHECK","CONSTRAINT","CREATE","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","EXEC","EXISTS","FOREIGN","KEY","FROM","FULL","OUTER","INNER","LEFT","RIGHT","ORDER","ON","LIMIT","WHERE","COUNT","JOIN","GROUP","BY","HAVING","UPDATE"]),_=(0,n.Z)("b",{target:"e1sm9bxn4"})("color:",(e=>e.theme.blue400),";"),L=(0,n.Z)("b",{target:"e1sm9bxn3"})("color:",(e=>e.theme.green400),";margin-right:-",(0,c.D)(.5),";"),E=(0,n.Z)("b",{target:"e1sm9bxn2"})("color:",(e=>e.theme.red400),";margin-right:-",(0,c.D)(.5),";"),P=(0,n.Z)("b",{target:"e1sm9bxn1"})("color:",(e=>e.theme.yellow400),";"),D=(0,n.Z)("b",{target:"e1sm9bxn0"})("color:",(e=>e.theme.pink400),";");function T(e){let{spanMeta:t}=e;return t["span.op"].startsWith("db")?(0,w.tZ)(C,{spanMeta:t}):(0,w.tZ)(N,{children:t["span.description"]})}function C(e){let{spanMeta:t}=e;return(0,w.tZ)(k,{children:(0,w.tZ)(Z,{children:b(t["span.description"]||"",{action:t["span.action"]||"",domain:t["span.domain"]||""})})})}T.displayName="SpanDescription",C.displayName="DatabaseSpanDescription";const k=(0,n.Z)("div",{target:"elfaq7i1"})("font-size:",(e=>e.theme.fontSizeMedium),";"),N=(0,n.Z)("div",{target:"elfaq7i0"})({name:"1sdjnkx",styles:"word-break:break-word"});var j=s("./app/utils/discover/styles.tsx"),F=s("./app/utils/formatters.tsx");function M(e){let{count:t,containerProps:s}=e;return(0,w.tZ)(j.Hw,{...s,children:(0,F.Du)(t)})}M.displayName="CountCell";var $=s("./app/views/starfish/components/tableCells/durationCell.tsx"),A=s("./app/views/starfish/components/tableCells/throughputCell.tsx"),q=s("./app/views/starfish/components/tableCells/timeSpentCell.tsx"),R=s("./app/utils/discover/types.tsx"),I=s("./app/utils/useLocation.tsx"),B=s("./app/views/starfish/utils/useSpansQuery.tsx");const O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"span-metrics";const a=(0,I.T)(),r=e?function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=e.group.replaceAll("-","").slice(-16);return p.ZP.fromNewQueryWithLocation({name:"",query:`span.group:${a}${s?.transactionName?` transaction:${s?.transactionName}`:""}${s?.["transaction.method"]?` transaction.method:${s?.["transaction.method"]}`:""}`,fields:n,dataset:R.as.SPANS_METRICS,version:2},t)}(e,a,t,s):void 0,i=(0,B.bB)({eventView:r,initialData:[],enabled:Boolean(e),referrer:n});return{...i,data:i?.data?.[0]??{}}};var z=s("../node_modules/lodash/keyBy.js"),V=s.n(z),X=s("./app/components/charts/utils.tsx"),Q=s("./app/utils/usePageFilters.tsx");const W=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"span-metrics-series";const a=(0,I.T)(),r=(0,Q.Z)(),i=e?function(e,t,s,n,a){const r=e.group.replaceAll("-","").slice(-16);return p.ZP.fromNewQueryWithLocation({name:"",query:`span.group:${r}${a?.transactionName?` transaction:${a?.transactionName}`:""}${a?.["transaction.method"]?` transaction.method:${a?.["transaction.method"]}`:""}`,fields:[],yAxis:n,dataset:R.as.SPANS_METRICS,interval:(0,X.ZS)(s.datetime,"low"),version:2},t)}(e,a,r.selection,s,t):void 0,{isLoading:o,data:l}=(0,B.bB)({eventView:i,initialData:[],referrer:n});return{isLoading:o,data:V()(s.map((e=>({seriesName:e,data:l.map((t=>({value:t[e],name:t.interval})))}))),"seriesName")}};var H=s("./app/views/starfish/types.tsx"),G=s("./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts"),U=s("./app/views/starfish/utils/extractRoute.tsx");const Y={api:(0,d.t)("API Module"),database:(0,d.t)("DB Module"),"endpoint-overview":(0,d.t)("Endpoint Overview"),"span-summary":(0,d.t)("Span Summary"),"web-service":(0,d.t)("Web Service")};var K=s("./app/views/starfish/views/queryParameters.tsx"),J=s("./app/views/starfish/views/spans/types.tsx"),ee=s("../node_modules/react/index.js"),te=s("../node_modules/lodash/omit.js"),se=s.n(te),ne=s("./app/utils/useRouter.tsx"),ae=s("./app/components/button.tsx"),re=s("./app/icons/iconClose.tsx"),ie=s("./app/utils/useKeyPress.tsx"),oe=s("./app/utils/useOnClickOutside.tsx"),le=s("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),de=s("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),ce=s("./app/utils/analytics.tsx");const pe="50vw",ue=(0,ee.forwardRef)(me);function me(e,t){let{collapsed:s,children:n}=e;const{query:a}=(0,I.T)(),r=(0,m.Z)();return(0,ee.useEffect)((()=>{s||(0,ce.Gi)("starfish.panel.open",{organization:r})}),[a,s,r]),(0,w.tZ)(he,{ref:t,collapsed:s,initial:{opacity:0,x:pe},animate:s?{opacity:0,x:pe}:{opacity:1,x:0},transition:{type:"spring",stiffness:500,damping:50},children:n})}me.displayName="SlideOverPanel";const he=(0,n.Z)(de.E.div,{shouldForwardProp:e=>["animate","transition","initial"].includes(e)||"collapsed"!==e&&(0,le.Z)(e),target:"e1iwvxg00"})("width:",pe,";position:fixed;top:0;bottom:0;right:0;background:",(e=>e.theme.background),";color:",(e=>e.theme.textColor),";border-left:1px solid ",(e=>e.theme.border),";text-align:left;z-index:",(e=>e.theme.zIndex.sidebar-1),";",(e=>e.collapsed?"overflow: hidden;":"overflow-x: hidden;\n  overflow-y: scroll;"),";");function ge(e){let{children:t,detailKey:s,onClose:n}=e;const[a,r]=(0,ee.useState)({collapsed:!0}),i=(0,ie.Z)("Escape");(0,ee.useEffect)((()=>{s&&r({collapsed:!1})}),[s]);const o=(0,ee.useRef)(null);return(0,oe.Z)(o,(()=>{a.collapsed||(n?.(),r({collapsed:!0}))})),(0,ee.useEffect)((()=>{i&&(a.collapsed||(n?.(),r({collapsed:!0})))}),[i]),(0,w.BX)(ue,{collapsed:a.collapsed,ref:o,children:[(0,w.tZ)(ve,{children:(0,w.tZ)(fe,{priority:"link",size:"zero",borderless:!0,"aria-label":(0,d.t)("Close Details"),icon:(0,w.tZ)(re.b,{size:"sm"}),onClick:()=>{r({collapsed:!0}),n?.()}})}),(0,w.tZ)(ye,{children:t})]})}ge.displayName="Detail";const fe=(0,n.Z)(ae.zx,{target:"e1clb2dw2"})("color:",(e=>e.theme.gray300),";&:hover{color:",(e=>e.theme.gray400),";}"),ve=(0,n.Z)("div",{target:"e1clb2dw1"})("justify-content:flex-end;display:flex;padding:",(0,c.D)(2),";"),ye=(0,n.Z)("div",{target:"e1clb2dw0"})("padding:0 ",(0,c.D)(4),";");var xe=s("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),Ze=s("./app/views/starfish/components/samplesTable/common.tsx"),we=s("../node_modules/moment/moment.js"),be=s.n(we),Se=s("./app/utils/queryClient.tsx"),_e=s("./app/utils/tokenizeSearch.tsx"),Le=s("./app/utils/useApi.tsx"),Ee=s("./app/views/starfish/utils/getDateConditions.tsx");const{SPAN_SELF_TIME:Pe}=H.SpanMetricsFields,De=e=>{const t=(0,Le.Z)(),s=(0,Q.Z)(),{groupId:n,transactionName:r,transactionMethod:i}=e,o=(0,I.T)(),l=new _e.MY([`span.group:${n}`,`transaction:${r}`,`transaction.method:${i}`]),d=(0,Ee.x)(s.selection),{isLoading:c,data:p}=W(n?{group:n}:void 0,{transactionName:r},[`p95(${Pe})`],"sidebar-span-metrics"),u=(0,f.yX)([p?.[`p95(${Pe})`]]);return(0,Se.aM)({queryKey:["span-samples",n,r,d.statsPeriod,d.start,d.end],queryFn:async()=>{const{data:e}=await t.requestPromise(`/api/0/organizations/sentry/spans-samples/?${a.stringify({...d,utc:o.query.utc,lowerBound:0,firstBound:u*(1/3),secondBound:u*(2/3),upperBound:u,query:l.formatString()})}`);return e?.map((e=>({...e,timestamp:be()(e.timestamp).format(B.zT)}))).sort(((e,t)=>t["span.self_time"]-e["span.self_time"]))},refetchOnWindowFocus:!1,enabled:Boolean(n&&r&&!c),initialData:[]})},{SPAN_SELF_TIME:Te,SPAN_OP:Ce}=H.SpanMetricsFields;function ke(e){let{groupId:t,transactionName:s,onClickSample:n,onMouseLeaveSample:a,onMouseOverSample:r,highlightedSpanId:i,transactionMethod:o}=e;const l=(0,xe.u)(),d=(e,t)=>(0,Ze.kQ)(e,t)?{symbol:"path://M 0 0 V -8 L 5 0 L 0 8 L -5 0 L 0 -8",color:l.gray300}:e>t?{symbol:"path://M 5 4 L 0 -4 L -5 4 L 5 4",color:l.red300}:{symbol:"path://M -5 -4 L 0 4 L 5 -4 L -5 -4",color:l.green300},{isLoading:c,data:p}=W({group:t},{transactionName:s,"transaction.method":o},[`p95(${Te})`],"sidebar-span-metrics"),{data:u}=O({group:t},{transactionName:s,"transaction.method":o},[`p95(${Te})`,Ce],"span-summary-panel-samples-table-p95"),m=u?.[`p95(${Te})`]||0,{data:h,isLoading:v,isRefetching:y}=De({groupId:t,transactionName:s,transactionMethod:o}),x={seriesName:"Baseline P95",data:[],markLine:{data:[{valueDim:"x",yAxis:m}],symbol:["none","none"],lineStyle:{color:l.gray400},emphasis:{disabled:!0},label:{fontSize:11,position:"insideEndBottom",formatter:()=>"Baseline P95"}}},Z=h.map((e=>{let{timestamp:t,"span.self_time":s,"transaction.id":n,span_id:a}=e;return{data:[{name:t,value:s}],symbol:d(s,m).symbol,color:d(s,m).color,symbolSize:a===i?15:10,seriesName:n.substring(0,8)}})),b=(e,t)=>h.find((s=>s.timestamp===e&&s["span.self_time"]===t));return(0,w.BX)("div",{onMouseLeave:()=>{a&&a()},children:[(0,w.tZ)("h5",{children:J.F.p95}),(0,w.tZ)(f.ZP,{statsPeriod:"24h",height:140,onClick:e=>{if("scatter"===e?.componentSubType&&n){const[t,s]=e.value,a=b(t,s);a&&n(a)}},onHighlight:e=>{const{seriesIndex:t}=e.batch[0],s=t>1;if(s&&r){const e=Z?.[t-2]?.data[0],{name:s,value:n}=e,a=b(s,n);a&&r(a)}!s&&a&&a()},aggregateOutputFormat:"duration",data:[p?.[`p95(${Te})`],x],start:"",end:"",loading:c,scatterPlot:v||y?void 0:Z,utc:!1,chartColors:[g.Tn,"black"],isLineChart:!0,definedAxisTicks:4})]})}ke.displayName="DurationChart";const Ne=ke,{SPAN_SELF_TIME:je}=H.SpanMetricsFields;function Fe(e){const{groupId:t,transactionName:s,transactionMethod:n}=e,{data:a}=O({group:t},{transactionName:s,"transaction.method":n},["sps()",`sum(${je})`,`p95(${je})`,"time_spent_percentage(local)"],"span-summary-panel-metrics"),r={textAlign:"left"};return(0,w.BX)(ft,{children:[(0,w.tZ)(ut,{title:J.F.throughput,children:(0,w.tZ)(A.Z,{containerProps:{style:r},throughputPerSecond:a?.["sps()"]})}),(0,w.tZ)(ut,{title:J.F.p95,children:(0,w.tZ)($.Z,{containerProps:{style:r},milliseconds:a?.[`p95(${je})`]})})]})}Fe.displayName="SampleInfo";const Me=Fe;var $e=s("./app/utils/performanceForSentry/index.tsx"),Ae=s("../node_modules/react-router/es/index.js"),qe=s("./app/components/gridEditable/index.tsx"),Re=s("./app/views/starfish/components/textAlign.tsx");const Ie=[{key:"transaction_id",name:"Event ID",width:200},{key:"duration",name:"Span Duration",width:200},{key:"p95_comparison",name:"Compared to baseline",width:200}];function Be(e){let{isLoading:t,data:s,p95:n,highlightedSpanId:a,onMouseLeaveSample:r,onMouseOverSample:i}=e;const o=(0,I.T)();return(0,w.tZ)("div",{onMouseLeave:function(){r&&r()},children:(0,w.tZ)(qe.ZP,{isLoading:t,data:s,columnOrder:Ie,columnSortBy:[],grid:{renderHeadCell:function(e){return"p95_comparison"===e.key||"duration"===e.key?(0,w.tZ)(Re.Dq,{children:(0,w.tZ)(Re._F,{children:e.name})}):(0,w.tZ)(Re._F,{children:e.name})},renderBodyCell:function(e,t){const s={style:t.span_id===a?{fontWeight:"bold"}:{},onMouseEnter:()=>function(e){i&&i(e)}(t)};return"transaction_id"===e.key?(0,w.tZ)(Ae.Link,{to:`/performance/${t.project}:${t["transaction.id"]}#span-${t.span_id}`,...s,children:t["transaction.id"].slice(0,8)}):"duration"===e.key?(0,w.tZ)($.Z,{containerProps:s,milliseconds:t["span.self_time"]}):"p95_comparison"===e.key?(0,w.tZ)(Ze.fd,{containerProps:s,duration:t["span.self_time"],p95:n}):(0,w.tZ)("span",{...s,children:t[e.key]})}},location:o})})}Be.displayName="SpanSamplesTable";var Oe=s("./app/utils/discover/discoverQuery.tsx"),ze=s("./app/views/starfish/utils/retryHandlers.tsx");const{SPAN_SELF_TIME:Ve,SPAN_OP:Xe}=H.SpanMetricsFields;function Qe(e){let{groupId:t,transactionName:s,highlightedSpanId:n,onMouseLeaveSample:a,onMouseOverSample:r,transactionMethod:i}=e;const{data:o,isFetching:l}=O({group:t},{transactionName:s,"transaction.method":i},[`p95(${Ve})`,Xe],"span-summary-panel-samples-table-p95"),c=(0,m.Z)(),{data:u,isFetching:h,refetch:g}=De({groupId:t,transactionName:s,transactionMethod:i}),{data:f,isFetching:v}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"use-transactions";const s=(0,I.T)(),{slug:n}=(0,m.Z)(),a=p.ZP.fromNewQueryWithLocation({fields:["id","timestamp","project.name","transaction.duration"],name:"Transactions",version:2,query:`id:[${e.join(",")}]`},s),r=Boolean(e.length),i=(0,Oe._)({eventView:a,location:s,orgSlug:n,referrer:t,options:{enabled:r,refetchOnWindowFocus:!1,retry:ze.V,retryDelay:ze.P,staleTime:1/0}}),o=i.data?.data??[];return r?{...i,data:o}:{isFetching:!1,isLoading:!1,data:[]}}(u.map((e=>e["transaction.id"])),"span-summary-panel-samples-table-transactions"),[y,x]=(0,ee.useState)(!1);(0,ee.useEffect)((()=>{v||h?x(!1):y||((0,ce.Gi)("starfish.samples.loaded",{organization:c,count:f?.length??0}),x(!0))}),[y,h,f,v,c]);const Z=V()(f,"id"),b=!h&&0===u.length,S=l||h||!b&&v;return(0,w.BX)(ee.Fragment,{children:[(0,w.tZ)($e.oF,{id:"SpanSummary.Samples.SampleTable",hasData:u.length>0,children:(0,w.tZ)(Be,{onMouseLeaveSample:a,onMouseOverSample:r,highlightedSpanId:n,data:u.map((e=>({...e,op:o["span.op"],transaction:Z[e["transaction.id"]]}))),isLoading:S,p95:o?.[`p95(${Ve})`]})}),(0,w.tZ)(ae.zx,{onClick:()=>g(),children:(0,d.t)("Load More Samples")})]})}Qe.displayName="SampleTable";const We=Qe;function He(e){let{groupId:t,transactionName:s,transactionMethod:n}=e;const a=(0,ne.Z)(),[r,i]=(0,ee.useState)(void 0);return(0,w.BX)(ge,{detailKey:t,onClose:()=>{a.push({pathname:a.location.pathname,query:se()(a.location.query,"transaction")})},children:[(0,w.tZ)("h3",{children:`${n} ${s}`}),(0,w.tZ)(Me,{groupId:t,transactionName:s,transactionMethod:n}),(0,w.tZ)(Ne,{groupId:t,transactionName:s,transactionMethod:n,onClickSample:e=>{a.push(`/performance/${e.project}:${e["transaction.id"]}/#span-${e.span_id}`)},onMouseOverSample:e=>i(e.span_id),onMouseLeaveSample:()=>i(void 0),highlightedSpanId:r}),(0,w.tZ)(We,{highlightedSpanId:r,transactionMethod:n,onMouseLeaveSample:()=>i(void 0),onMouseOverSample:e=>i(e.span_id),groupId:t,transactionName:s})]})}He.displayName="SampleList";var Ge=s("./app/components/links/link.tsx"),Ue=s("./app/components/pagination.tsx"),Ye=s("./app/components/truncate.tsx"),Ke=s("./app/utils/discover/fieldRenderers.tsx"),Je=s("./app/views/starfish/components/tableCells/renderHeadCell.tsx");const{SPAN_SELF_TIME:et}=H.SpanMetricsFields,tt=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span-transaction-metrics";const n=(0,I.T)(),{transactions:a,sorts:r}=t,i=function(e,t,s,n){const a=e.group.replaceAll("-","").slice(-16),r=new _e.MY("");r.addFilterValues("span.group",[a]),r.addFilterValues("transaction.op",["http.server"]),s.length>0&&r.addFilterValues("transaction",s);const i=p.ZP.fromNewQueryWithLocation({name:"",query:r.formatString(),fields:["transaction","transaction.method","sps()","sps_percent_change()",`sum(${et})`,`p95(${et})`,`percentile_percent_change(${et}, 0.95)`,"time_spent_percentage(local)","transaction.op"],orderby:"-time_spent_percentage_local",dataset:R.as.SPANS_METRICS,version:2},t);return n&&(i.sorts=n),i}(e,n,a??[],r);return(0,B.RX)({eventView:i,initialData:[],enabled:Boolean(e),referrer:s})};function st(e){let{span:t,openSidebar:s,onClickTransaction:n,endpoint:a,endpointMethod:r,sort:i}=e;const o=(0,I.T)(),l=(0,m.Z)(),{data:c=[],meta:p,isLoading:u,pageLinks:h}=tt(t,{transactions:a?[a]:void 0,sorts:[i]}),g=c.map((e=>({transaction:e.transaction,transactionMethod:e["transaction.method"],metrics:e})));return(0,w.BX)(ee.Fragment,{children:[(0,w.tZ)($e.oF,{id:"SpanSummary.SpanTransactionsTable",hasData:c.length>0,children:(0,w.tZ)(qe.ZP,{isLoading:u,data:g,columnOrder:at,columnSortBy:[],grid:{renderHeadCell:e=>(0,Je.WJ)({column:e,sort:i,location:o}),renderBodyCell:(e,i)=>"transaction"===e.key?(0,w.tZ)(nt,{endpoint:a,endpointMethod:r,span:t,row:i,column:e,openSidebar:s,onClickTransactionName:n,location:o}):p&&p?.fields?(0,Ke.Js)(e.key,p.fields,!1)(i.metrics,{location:o,organization:l,unit:p.units?.[e.key]}):i[e.key]},location:o})}),(0,w.BX)(rt,{children:[a&&(0,w.tZ)(ae.zx,{to:{pathname:o.pathname,query:se()(o.query,"endpoint")},children:(0,d.t)("View More Endpoints")}),(0,w.tZ)(it,{pageLinks:h})]})]})}function nt(e){let{span:t,row:s,endpoint:n,endpointMethod:r,location:i}=e;const o=s.transactionMethod?`${s.transactionMethod} ${s.transaction}`:s.transaction;return(0,w.tZ)(ee.Fragment,{children:(0,w.tZ)(Ge.Z,{to:`/starfish/${(0,U.G)(i)??"spans"}/span/${encodeURIComponent(t.group)}?${a.stringify({...i.query,endpoint:n,endpointMethod:r,transaction:s.transaction,transactionMethod:s.transactionMethod})}`,children:(0,w.tZ)(Ye.Z,{value:o,maxLength:75})})})}st.displayName="SpanTransactionsTable",nt.displayName="TransactionCell";const at=[{key:"transaction",name:"Found In Endpoints",width:qe.z7},{key:"sps()",name:J.F.throughput,width:qe.z7},{key:"sps_percent_change()",name:J.F.change,width:qe.z7},{key:`p95(${H.SpanMetricsFields.SPAN_SELF_TIME})`,name:J.F.p95,width:qe.z7},{key:`percentile_percent_change(${H.SpanMetricsFields.SPAN_SELF_TIME}, 0.95)`,name:J.F.change,width:qe.z7},{key:"time_spent_percentage(local)",name:J.F.timeSpent,width:qe.z7}],rt=(0,n.Z)("div",{target:"eo6is321"})({name:"1eoy87d",styles:"display:flex;justify-content:space-between"}),it=(0,n.Z)(Ue.Z,{target:"eo6is320"})({name:"1wh5xum",styles:"margin-top:0;margin-left:auto"});function ot(e){return Je.qF.has(e.field)}const{SPAN_SELF_TIME:lt}=H.SpanMetricsFields,dt={kind:"desc",field:"time_spent_percentage(local)"};function ct(e){let{params:t,location:s}=e;const n=(0,m.Z)(),{groupId:l}=t,{transaction:c,transactionMethod:Z,endpoint:b,endpointMethod:S}=s.query,_=b?{transactionName:b}:void 0,L=(0,p.vp)(s.query[K.o.SORT]).filter(ot)[0]??dt;S&&_&&(_["transaction.method"]=S);const{data:E,isLoading:P}=O({group:l},_,["span.op","span.description","span.action","span.domain","count()","sps()",`sum(${lt})`,`p95(${lt})`,"time_spent_percentage()","http_error_count()"],"span-summary-page-metrics"),D=Object.assign({group:l},E),{isLoading:C,data:k}=W({group:l},_,[`p95(${lt})`,"sps()","http_error_count()"],"span-summary-page-metrics");(0,f.K4)([!C]);const N={seriesName:D?.["span.op"]?.startsWith("db")?"Queries":"Requests",data:k?.["sps()"].data},j=bt(s,D,!0),F=bt(s,D),R=[];R.push({label:(0,d.t)("Web Service"),to:(0,h.D)(`/organizations/${n.slug}/starfish/`)});const I=(0,U.G)(s);return I&&Y[I]&&R.push({label:Y[I],to:(0,h.D)(`/organizations/${n.slug}/starfish/${I??"spans"}/?${a.stringify({endpoint:b,"http.method":S})}`)}),R.push({label:j}),(0,w.tZ)(i.T3,{children:(0,w.tZ)(x.ZP,{children:(0,w.BX)(u.V_,{children:[(0,w.tZ)(i.h4,{children:(0,w.BX)(i.oB,{children:[!P&&(0,w.tZ)(r.Z,{crumbs:R}),(0,w.tZ)(i.Dx,{children:S&&b?`${S} ${b}`:!P&&j})]})}),(0,w.tZ)(i.uT,{children:(0,w.BX)(i.or,{fullWidth:!0,children:[(0,w.tZ)(u.YY,{}),(0,w.BX)(ft,{children:[(0,w.tZ)(pt,{children:(0,w.tZ)(y.Z,{})}),(0,w.BX)(ft,{children:[(0,w.tZ)(ut,{title:(0,d.t)("Operation"),children:D?.["span.op"]}),(0,w.tZ)(ut,{title:(0,d.t)("Throughput"),description:(0,d.t)("Throughput of this span per second"),children:(0,w.tZ)(A.Z,{throughputPerSecond:E?.["sps()"]})}),(0,w.tZ)(ut,{title:(0,d.t)("Duration (P95)"),description:(0,d.t)("Time spent in this span"),children:(0,w.tZ)($.Z,{milliseconds:E?.[`p95(${lt})`]})}),D?.["span.op"]?.startsWith("http")&&(0,w.tZ)(ut,{title:(0,d.t)("5XX Responses"),description:(0,d.t)("5XX responses in this span"),children:(0,w.tZ)(M,{count:E?.["http_error_count()"]})}),(0,w.tZ)(ut,{title:(0,d.t)("Time Spent"),description:(0,d.t)("Time spent in this span as a proportion of total application time"),children:(0,w.tZ)(q.z,{timeSpentPercentage:E?.["time_spent_percentage()"],totalSpanTime:E?.[`p95(${lt})`]})})]})]}),D?.["span.description"]&&(0,w.BX)(ft,{children:[(0,w.tZ)(ut,{children:(0,w.tZ)(o.s_,{children:(0,w.tZ)(yt,{children:(0,w.BX)(vt,{children:[(0,w.tZ)(Zt,{children:F}),(0,w.tZ)(T,{spanMeta:D})]})})})}),(0,w.tZ)(ut,{children:(0,w.tZ)(v.Z,{title:J.F.throughput,children:(0,w.tZ)(f.ZP,{statsPeriod:"24h",height:140,data:[N],start:"",end:"",loading:C,utc:!1,chartColors:[g.SQ],isLineChart:!0,definedAxisTicks:4,aggregateOutputFormat:"rate",tooltipFormatterOptions:{valueFormatter:e=>(0,G.Z)(e)}})})}),(0,w.tZ)(ut,{children:(0,w.tZ)(v.Z,{title:J.F.p95,children:(0,w.tZ)(f.ZP,{statsPeriod:"24h",height:140,data:[k?.[`p95(${lt})`]],start:"",end:"",loading:C,utc:!1,chartColors:[g.Tn],isLineChart:!0,definedAxisTicks:4})})}),D?.["span.op"]?.startsWith("http")&&(0,w.tZ)(ut,{children:(0,w.tZ)(v.Z,{title:J.F.errorCount,children:(0,w.tZ)(f.ZP,{statsPeriod:"24h",height:140,data:[k?.["http_error_count()"]],start:"",end:"",loading:C,utc:!1,chartColors:[g.eO],isLineChart:!0,definedAxisTicks:4})})})]}),D&&(0,w.tZ)(st,{span:D,sort:L,endpoint:b,endpointMethod:S}),c&&D?.group&&(0,w.tZ)(He,{groupId:D.group,transactionName:c,transactionMethod:Z})]})})]})})})}ct.displayName="SpanSummaryPage";const pt=(0,n.Z)("div",{target:"eby1jon8"})("display:flex;flex-direction:row;gap:",(0,c.D)(1),";align-items:center;flex:1;");function ut(e){let{title:t,description:s,children:n}=e;return(0,w.BX)(xt,{children:[(0,w.BX)(mt,{children:[t,s&&(0,w.tZ)(gt,{children:(0,w.tZ)(l.Z,{size:"sm",position:"right",title:s})})]}),(0,w.tZ)(ht,{children:n})]})}ut.displayName="Block";const mt=(0,n.Z)("h3",{target:"eby1jon7"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,c.D)(1),";white-space:nowrap;"),ht=(0,n.Z)("h4",{target:"eby1jon6"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),gt=(0,n.Z)("span",{target:"eby1jon5"})("margin-left:",(0,c.D)(1),";"),ft=(0,n.Z)("div",{target:"eby1jon4"})("display:flex;&>div:last-child{padding-right:",(0,c.D)(1),";}padding-bottom:",(0,c.D)(2),";"),vt=(0,n.Z)("div",{target:"eby1jon3"})("width:100%;padding:",(0,c.D)(1),";font-size:1rem;line-height:1.2;"),yt=(0,n.Z)(o.N,{target:"eby1jon2"})("padding:",(0,c.D)(2),";height:208px;"),xt=(0,n.Z)("div",{target:"eby1jon1"})("padding-right:",(0,c.D)(4),";flex:1;"),Zt=(0,n.Z)("h4",{target:"eby1jon0"})({name:"1qszq24",styles:"font-size:1rem;font-weight:600;line-height:1.2"}),wt=ct,bt=(e,t,s)=>{const n=(0,U.G)(e);if("api"===n)return s?(0,d.t)("URL Request Summary"):(0,d.t)("URL Request");if("database"===n)return s?(0,d.t)("Query Summary"):(0,d.t)("Query");const a=t["span.op"];let r;return a?.startsWith("http")&&(r=s?(0,d.t)("URL Request Summary"):(0,d.t)("URL Request")),a?.startsWith("db")&&(r=s?(0,d.t)("Query Summary"):(0,d.t)("Query")),a?.startsWith("serialize")&&(r=s?(0,d.t)("Serializer Summary"):(0,d.t)("Serializer")),a?.startsWith("task")&&(r=s?(0,d.t)("Task Summary"):(0,d.t)("Task")),r||(r=s?(0,d.t)("Span Summary"):(0,d.t)("Span Description")),r}}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spanSummaryPage_index_tsx.60858121ee77f38efa14e937303e56dd.js.map