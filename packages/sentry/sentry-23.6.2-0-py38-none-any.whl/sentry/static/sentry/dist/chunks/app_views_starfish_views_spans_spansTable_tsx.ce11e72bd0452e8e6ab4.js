"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spans_spansTable_tsx"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,s)=>{s.d(t,{AA:()=>w,JC:()=>x,ZP:()=>b,o:()=>h});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=(s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/react/index.js")),i=s("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),a=s("./app/api.tsx"),o=s("./app/locale.tsx"),p=s("./app/utils/discover/eventView.tsx"),u=s("./app/utils/performance/contexts/performanceEventViewContext.tsx"),c=s("./app/utils/useApi.tsx"),l=s("./app/utils/useOrganization.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h{constructor(e,t){(0,r.Z)(this,"message",void 0),(0,r.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class m extends n.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new a.KU}),(0,r.Z)(this,"_shouldRefetchData",(e=>{const t=_(this.props),s=_(e);return!(0,p.ze)(t,s)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,r.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new h(t,e);const s=t?.message;return new h("string"==typeof s?s:(0,o.t)("An unknown error occurred."),e)})),(0,r.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:s,didFetch:r,eventView:n,orgSlug:i,route:a,setError:o}=this.props,{api:p}=this.state;if(!n.isValid())return;const u=`/organizations/${i}/${a}/`,c=Symbol("tableFetchID"),l=_(this.props);this.setState({isLoading:!0,tableFetchID:c}),o?.(void 0),t?.(p),p.clear();try{const[t,,n]=await w(p,u,l,{queryBatching:e});if(this.state.tableFetchID!==c)return;const i=s?s(t,this.props):t;r?.(i),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:n?.getResponseHeader("Link")??e.pageLinks,tableData:i})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),o&&o(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),s=!1===e.eventView.isValid()&&this.props.eventView.isValid(),r=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||s||r)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:s,pageLinks:r}=this.state,n={isLoading:e,error:t,tableData:s,pageLinks:r},i=this.props.children;return i?.(n)}}function g(e){const t=(0,l.Z)({allowNull:!0})?.slug,s=(0,n.useContext)(u.uL)?.eventView,r=e.orgSlug??t,i=e.eventView??s;if(void 0===r||void 0===i)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const a={...e,orgSlug:r,eventView:i};return(0,d.tZ)(m,{...a})}m.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const f=200,y=2,v=e=>new Promise((t=>setTimeout(t,e)));async function w(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:n,retry:i}=r;if(n?.batchRequest)return n.batchRequest(e,t,{query:s,includeAllArgs:!0});const a=i?.baseTimeout??f,o=i?.timeoutMultiplier??y,p=i?.statusCodes??[],u=i?.tries??1;let c,l=0,d=0;for(;l<u&&(!c||p.includes(c.status));){d>0&&await v(d);try{return l++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...s}})}catch(e){c=e,d=a*o**(l-1)}}throw c}function _(e){const{cursor:t,limit:s,noPagination:r,referrer:n,getRequestPayload:i,eventView:a,location:o,forceAppendRawQueryString:p}=e,u=i?i(e):a.getEventsAPIPayload(o,p);return t&&(u.cursor=t),s&&(u.per_page=s),r&&(u.noPagination=r),n&&(u.referrer=n),Object.assign(u,e.queryExtras??{}),u}function x(e){const t=(0,c.Z)(),{orgSlug:s,route:r,options:n}=e,a=`/organizations/${s}/${r}/`,o=_(e),p=(0,i.a)([r,o],(()=>w(t,a,o,{queryBatching:e.queryBatching})),n);return{...p,data:p.data?.[0]??void 0,statusCode:p.data?.[1]??void 0,response:p.data?.[2]??void 0}}const b=g},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,s)=>{s.d(t,{bq:()=>n,uL:()=>a});var r=s("./app/utils/performance/contexts/utils.tsx");const[n,i,a]=(0,r.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,s)=>{s.d(t,{n:()=>n}),s("../node_modules/core-js/modules/es.error.cause.js");var r=s("../node_modules/react/index.js");function n(e){const{strict:t=!0,errorMessage:s=`useContext for "${e.name}" must be inside a Provider with a value`,name:n}=e,i=(0,r.createContext)(void 0);return i.displayName=n,[i.Provider,function(){const e=(0,r.useContext)(i);if(!e&&t)throw new Error(s);return e},i]}},"./app/views/starfish/components/tableCells/renderHeadCell.tsx":(e,t,s)=>{s.d(t,{WJ:()=>c,qF:()=>u});var r=s("./app/components/gridEditable/sortLink.tsx"),n=s("./app/utils/discover/fields.tsx"),i=s("./app/views/starfish/types.tsx"),a=s("./app/views/starfish/views/queryParameters.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_SELF_TIME:p}=i.SpanMetricsFields,u=new Set([`p95(${p})`,`percentile_percent_change(${p}, 0.95)`,"sps()","sps_percent_change()","time_spent_percentage()","time_spent_percentage(local)","http_error_count()","http_error_count_percent_change()"]),c=e=>{let{column:t,location:s,sort:n}=e;const{key:i,name:p}=t,c=l(i);let d="desc";n?.field===t.key&&"desc"===n.kind&&(d="asc");const h=`${"desc"===d?"-":""}${i}`;return(0,o.tZ)(r.Z,{align:c,canSort:Boolean(s&&n&&u.has(i)),direction:n?.field===t.key?n.kind:void 0,title:p,generateSortLink:()=>({...s,query:{...s?.query,[a.o.SORT]:h}})})};c.displayName="renderHeadCell";const l=e=>{const t=(0,n.dL)(e);if(t){const s=(0,n._4)(t.name,t.arguments[0]);if(s)return(0,n.qG)(e,s)}return"left"}},"./app/views/starfish/utils/extractRoute.tsx":(e,t,s)=>{function r(e){return e.pathname.match(/^\/starfish\/api\//)?"api":e.pathname.match(/^\/starfish\/database\//)?"database":e.pathname.match(/^\/starfish\/endpoint-overview\//)?"endpoint-overview":null}s.d(t,{G:()=>r})},"./app/views/starfish/utils/useSpansQuery.tsx":(e,t,s)=>{s.d(t,{zT:()=>m,bB:()=>g,RX:()=>y}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/es.array.push.js");var r=s("../node_modules/moment/moment.js"),n=s.n(r),i=s("./app/utils/discover/discoverQuery.tsx"),a=s("./app/utils/discover/eventView.tsx"),o=s("./app/utils/discover/genericDiscoverQuery.tsx"),p=s("./app/utils/useLocation.tsx"),u=s("./app/utils/useOrganization.tsx"),c=s("./app/utils/usePageFilters.tsx"),l=s("./app/views/starfish/utils/retryHandlers.tsx"),d=s("../node_modules/react/index.js"),h=s("./app/utils/analytics.tsx");const m="YYYY-MM-DDTHH:mm:ssZ";function g(e){let{eventView:t,initialData:s,limit:r,enabled:n,referrer:i="use-spans-query",cursor:a}=e;const o=(t?.yAxis?.length??0)>0?f:y,{isReady:p}=(0,c.Z)();if(t){const e=o({eventView:t,initialData:s,limit:r,enabled:(n||void 0===n)&&p,referrer:i,cursor:a});return function(e,t){let{isLoading:s,statusCode:r}=t;const[n,i]=(0,d.useState)(null),[a,o]=(0,d.useState)(!1),p=(0,u.Z)();(0,d.useEffect)((()=>{if(s)null===n&&(i(Date.now()),o(!1));else if(!a&&(o(!0),n)){const e=Date.now();(0,h.Gi)("starfish.request",{organization:p,duration:e-n,statusCode:r}),i(null)}}),[a,e,n,p,s,r])}(t,e),e}throw new Error("eventView argument must be defined when Starfish useDiscover is true")}function f(e){let{eventView:t,enabled:s,initialData:r,referrer:i,cursor:c}=e;const d=(0,p.T)(),h=(0,u.Z)(),g=(0,o.JC)({route:"events-stats",eventView:t,location:d,orgSlug:h.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(d),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:0,partial:1,orderby:t.sorts?.[0]?(0,a.uZ)(t.sorts?.[0]):void 0,interval:t.interval,cursor:c}),options:{enabled:s,refetchOnWindowFocus:!1,retry:l.V,retryDelay:l.P,staleTime:1/0},referrer:i}),f=g.isLoading&&r?r:function(e,t){if(!t.yAxis)return[];let s=[];const r=t.yAxis&&("string"==typeof t.yAxis||1===t.yAxis.length),i="string"==typeof t.yAxis?t.yAxis:t.yAxis[0];if(e.data){const t=v(e,r?i:"count").map((e=>({interval:n()(1e3*parseInt(e.interval,10)).format(m),[i]:e[i],group:e.group})));return t}return Object.keys(e).forEach((t=>{e[t].data?s=w(s,v(e[t],r?i:t)):Object.keys(e[t]).forEach((r=>{"order"!==r&&(s=w(s,v(e[t][r],r,t)))}))})),s.map((e=>({...e,interval:n()(1e3*parseInt(e.interval,10)).format(m)})))}(g.data,t);return{...g,data:f,meta:g.data?.meta}}function y(e){let{eventView:t,initialData:s,enabled:r,referrer:n,limit:a,cursor:o}=e;const c=(0,p.T)(),d=(0,u.Z)(),h=(0,i._)({eventView:t,orgSlug:d.slug,location:c,referrer:n,cursor:o,limit:a,options:{enabled:r,refetchOnWindowFocus:!1,retry:l.V,retryDelay:l.P,staleTime:1/0}}),m=h.data?.meta;m&&(m.fields["sps()"]="rate",m.units["sps()"]="1/second");const g=h.isLoading&&s?s:h.data?.data;return{...h,data:g,meta:m}}function v(e,t,s){const r=[];return e.data.forEach((e=>{let[n,[{count:i}]]=e;const a=r.find((e=>e.interval===n&&(!s||e.group===s)));a?a[t]=i:r.push({interval:n,[t]:i,group:s})})),r}function w(e,t){const s=JSON.parse(JSON.stringify(e));return t.forEach((e=>{let{interval:t,group:r,...n}=e;const i=s.find((e=>e.interval===t&&(!r||e.group===r)));i?Object.keys(n).forEach((e=>{i[e]=n[e]})):s.push({interval:t,group:r,...n})})),s}},"./app/views/starfish/views/queryParameters.tsx":(e,t,s)=>{let r;s.d(t,{o:()=>r}),function(e){e.CURSOR="spansCursor",e.SORT="spansSort"}(r||(r={}))},"./app/views/starfish/views/spans/spansTable.tsx":(e,t,s)=>{s.d(t,{ZP:()=>T,ki:()=>F}),s("../node_modules/core-js/modules/es.array.push.js");var r=s("../node_modules/react/index.js"),n=s("../node_modules/react-router/es/index.js"),i=s("../node_modules/query-string/index.js"),a=s("./app/components/gridEditable/index.tsx"),o=s("./app/components/links/link.tsx"),p=s("./app/components/pagination.tsx"),u=s("./app/utils/discover/fieldRenderers.tsx"),c=s("./app/utils/performanceForSentry/index.tsx"),l=s("./app/utils/queryString.tsx"),d=s("./app/utils/useLocation.tsx"),h=s("./app/utils/useOrganization.tsx"),m=s("./app/views/starfish/components/tableCells/renderHeadCell.tsx"),g=s("./app/views/starfish/components/textAlign.tsx"),f=s("../node_modules/lodash/omit.js"),y=s.n(f),v=s("./app/utils.tsx"),w=s("./app/utils/discover/eventView.tsx"),_=s("./app/utils/discover/types.tsx"),x=s("./app/views/starfish/types.tsx"),b=s("./app/views/starfish/utils/useSpansQuery.tsx"),S=s("./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx");const{SPAN_SELF_TIME:k}=x.SpanMetricsFields,D=["span.op","span.domain","span.action","!span.module","!span.category"],L=function(e,t,s,r,n,i){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"use-span-list",o=arguments.length>7?arguments[7]:void 0;const p=function(e,t,s,r,n,i){const a=function(e,t,s,r,n){const{query:i}=t,a=Object.keys(i).filter((e=>D.includes(e))).filter((e=>Boolean(i[e]))).map((e=>{const t=i[e],s=Array.isArray(t);return"!span.category"===e&&s&&t.includes("db")?`(!span.category:db OR span.op:db.redis) !span.category:[${t.filter((e=>"db"!==e)).join(",")}]`:`${e}:${s?`[${t}]`:t}`}));return e!==x.rA.ALL&&a.push(`span.module:${e}`),e===x.rA.DB&&a.push("!span.op:db.redis"),(0,v.ri)(n)&&(n===S.sZ?a.push("!has:span.category"):"Other"!==n&&a.push(`span.category:${n}`)),s&&a.push(`transaction:${s}`),r&&a.push(`transaction.method:${r}`),a}(e,t,s,r,n).filter(Boolean).join(" "),o=w.ZP.fromNewQueryWithLocation({name:"",query:a,fields:["span.op","span.group","span.description","span.domain","sps()","sps_percent_change()",`sum(${k})`,`p95(${k})`,"time_spent_percentage()",`percentile_percent_change(${k}, 0.95)`,"http_error_count()","http_error_count_percent_change()"],dataset:_.as.SPANS_METRICS,version:2},y()(t,"span.category","http.method"));return i&&(o.sorts=i),o}(e,(0,d.T)(),t,s,r,n),{isLoading:u,data:c,meta:l,pageLinks:h}=(0,b.RX)({eventView:p,initialData:[],limit:i,referrer:a,cursor:o});return{isLoading:u,data:c,meta:l,pageLinks:h}};var A=s("./app/views/starfish/utils/extractRoute.tsx"),j=s("./app/views/starfish/views/queryParameters.tsx"),E=s("./app/views/starfish/views/spans/types.tsx"),q=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_SELF_TIME:C}=x.SpanMetricsFields,P=new Set([`p95(${C})`,`percentile_percent_change(${C}, 0.95)`,"sps()","sps_percent_change()","time_spent_percentage()","http_error_count()","http_error_count_percent_change()"]);function T(e){let{moduleName:t,sort:s,columnOrder:f,spanCategory:y,endpoint:v,method:w,limit:_=25}=e;const b=(0,d.T)(),S=(0,h.Z)(),k=(0,l.ro)(b.query?.[j.o.CURSOR]),{isLoading:D,data:E,meta:C,pageLinks:P}=L(t??x.rA.ALL,v,w,y,[s],_,"use-span-list",k),T=Boolean(v);return(0,q.tZ)(r.Fragment,{children:(0,q.BX)(c.oF,{id:"SpansTable",hasData:E.length>0,isLoading:D,disabled:T,children:[(0,q.tZ)(a.ZP,{isLoading:D,data:E,columnOrder:f??Z(t),columnSortBy:[{key:s.field,order:s.kind}],grid:{renderHeadCell:e=>(0,m.WJ)({column:e,sort:s,location:b}),renderBodyCell:(e,t)=>function(e,t,s,r,n,a,p){if("span.description"===e.key){const e={...r.query,endpoint:a,endpointMethod:p};return(0,q.tZ)(g._F,{children:t["span.group"]?(0,q.tZ)(o.Z,{to:`/starfish/${(0,A.G)(r)??"spans"}/span/${t["span.group"]}${e?`?${i.stringify(e)}`:""}`,children:t["span.description"]||"<null>"}):t["span.description"]||"<null>"})}if(!s||!s?.fields)return t[e.key];return(0,u.Js)(e.key,s.fields,!1)(t,{location:r,organization:n,unit:s.units?.[e.key]})}(e,t,C,b,S,v,w)},location:b}),(0,q.tZ)(p.Z,{pageLinks:P,onCursor:(e,t,s)=>{n.browserHistory.push({pathname:t,query:{...s,[j.o.CURSOR]:e}})}})]})})}function Z(e){const t=function(e){return e===x.rA.HTTP?"URL":e===x.rA.DB?"Query":"Description"}(e),s=function(e){return e===x.rA.HTTP?"Host":e===x.rA.DB?"Table":"Domain"}(e);return[{key:"span.op",name:"Operation",width:120},{key:"span.description",name:t,width:a.z7},...e!==x.rA.ALL?[{key:"span.domain",name:s,width:a.z7}]:[],{key:"sps()",name:"Throughput",width:a.z7},{key:"sps_percent_change()",name:E.F.change,width:a.z7},{key:`p95(${C})`,name:E.F.p95,width:a.z7},{key:`percentile_percent_change(${C}, 0.95)`,name:E.F.change,width:a.z7},...e===x.rA.HTTP?[{key:"http_error_count()",name:E.F.errorCount,width:a.z7},{key:"http_error_count_percent_change()",name:E.F.change,width:a.z7}]:[],{key:"time_spent_percentage()",name:E.F.timeSpent,width:a.z7}]}function F(e){return P.has(e.field)}T.displayName="SpansTable"}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spans_spansTable_tsx.470d99aba20894b309528316a05bb459.js.map