"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationIntegrations_configureIntegration_tsx"],{"./app/components/forms/formPanel.tsx":(t,e,i)=>{i.d(e,{Z:()=>c});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=i("../node_modules/react/index.js"),r=i("./app/components/forms/fieldFromConfig.tsx"),o=i("./app/components/panels/index.tsx"),a=i("./app/icons/index.tsx"),p=i("./app/utils/sanitizeQuerySelector.tsx"),l=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(t){let{additionalFieldProps:e={},title:i,fields:s,access:d,disabled:c,renderFooter:u,renderHeader:h,collapsible:m,initiallyCollapsed:y=!1,...f}=t;const[Z,x]=(0,n.useState)(y),b=(0,n.useCallback)((()=>x((t=>!t))),[]);return(0,l.BX)(o.s_,{id:"string"==typeof i?(0,p.m)(i):void 0,children:[i&&(0,l.BX)(o.V9,{children:[i,m&&(0,l.tZ)(g,{onClick:b,children:(0,l.tZ)(a.g6,{"data-test-id":"form-panel-collapse-chevron",direction:Z?"down":"up",size:"xs"})})]}),(0,l.BX)(o.N,{hidden:Z,children:["function"==typeof h&&h({title:i,fields:s}),s.map((t=>{if("function"==typeof t)return t();const{defaultValue:i,...s}=t;return!0===c&&(s.disabled=!0,s.disabledReason=void 0),(0,l.tZ)(r.Z,{access:d,disabled:c,...f,...e,field:s,highlighted:f.highlighted===`#${t.name}`},t.name)})),"function"==typeof u&&u({title:i,fields:s})]})]})}d.displayName="FormPanel";const c=d,g=(0,s.Z)("span",{target:"eovlw60"})({name:"e0dnmk",styles:"cursor:pointer"})},"./app/components/forms/jsonForm.tsx":(t,e,i)=>{i.d(e,{Z:()=>h});var s=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=i("../node_modules/react/index.js"),r=i("../node_modules/@sentry/core/esm/exports.js"),o=i("../node_modules/scroll-to-element/index.js"),a=i.n(o),p=i("./app/utils.tsx"),l=i("./app/utils/sanitizeQuerySelector.tsx"),d=i("./app/utils/withSentryRouter.tsx"),c=i("./app/components/forms/formPanel.tsx"),g=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u extends n.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{highlighted:this.props.location?.hash})}componentDidMount(){this.scrollToHash()}componentDidUpdate(t){if(this.props.location&&this.props.location.hash!==t.location.hash){const t=this.props.location.hash;this.scrollToHash(t),this.setState({highlighted:t})}}scrollToHash(t){const e=t||this.props.location?.hash;if(e)try{a()((0,l.m)(decodeURIComponent(e)),{align:"middle",offset:-100})}catch(t){r.Tb(t)}}shouldDisplayForm(t){const e=t.filter((t=>"function"!=typeof t&&(0,p.ri)(t?.visible)));if(t.length===e.length){const{additionalFieldProps:t,...i}=this.props;return!e.every((e=>"function"==typeof e.visible?!e.visible({...i,...t}):!e.visible))}return!0}renderForm(t){let{fields:e,formPanelProps:i,title:s}=t;return this.shouldDisplayForm(e)||i?.renderFooter||i?.renderHeader?(0,g.tZ)(c.Z,{title:s,fields:e,...i}):null}render(){const{access:t,collapsible:e,initiallyCollapsed:i,fields:s,title:r,forms:o,disabled:a,features:p,additionalFieldProps:l,renderFooter:d,renderHeader:c,location:u,params:h,router:m,routes:y,...f}=this.props,Z={access:t,disabled:a,features:p,additionalFieldProps:l,renderFooter:d,renderHeader:c,highlighted:this.state.highlighted,collapsible:e,initiallyCollapsed:i};return(0,g.BX)("div",{...f,children:[void 0!==o&&o.map(((t,e)=>(0,g.tZ)(n.Fragment,{children:this.renderForm({formPanelProps:Z,...t})},e))),void 0===o&&void 0!==s&&this.renderForm({fields:s,formPanelProps:Z,title:r})]})}}u.displayName="JsonForm";const h=(0,d.Z)(u)},"./app/stores/repositoryStore.tsx":(t,e,i)=>{i.d(e,{Z:()=>n});const s={state:{orgSlug:void 0,repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},init(){this.resetRepositories()},resetRepositories(){this.state={orgSlug:void 0,repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},this.trigger(this.state)},loadRepositories(t){this.state={orgSlug:t,repositories:t===this.state.orgSlug?this.state.repositories:void 0,repositoriesLoading:!0,repositoriesError:void 0},this.trigger(this.state)},loadRepositoriesError(t){this.state={...this.state,repositories:void 0,repositoriesLoading:!1,repositoriesError:t},this.trigger(this.state)},loadRepositoriesSuccess(t){this.state={...this.state,repositories:t,repositoriesLoading:!1,repositoriesError:void 0},this.trigger(this.state)},get(){return{...this.state}}},n=(0,i("../node_modules/reflux/src/index.js").createStore)(s)},"./app/views/settings/components/settingsBreadcrumb/breadcrumbTitle.tsx":(t,e,i)=>{i.d(e,{Z:()=>n});var s=i("./app/views/settings/components/settingsBreadcrumb/context.tsx");const n=function(t){return(0,s.Qi)(t),null}},"./app/views/settings/organizationIntegrations/addIntegration.tsx":(t,e,i)=>{i.d(e,{Z:()=>d});var s=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=i("../node_modules/react/index.js"),r=i("../node_modules/query-string/index.js"),o=i("./app/actionCreators/indicator.tsx"),a=i("./app/locale.tsx"),p=i("./app/stores/configStore.tsx"),l=i("./app/utils/integrationUtil.tsx");class d extends n.Component{constructor(){super(...arguments),(0,s.Z)(this,"dialog",null),(0,s.Z)(this,"openDialog",(t=>{const{account:e,analyticsParams:i,modalParams:s,organization:n,provider:o}=this.props;(0,l.Db)("integrations.installation_start",{integration:o.key,integration_type:"first_party",organization:n,...i});const{url:a,width:p,height:d}=o.setupDialog,{left:c,top:g}=this.computeCenteredWindow(p,d);let u={...t};e&&(u.account=e),s&&(u={...u,...s});const h=`${a}?${r.stringify(u)}`,m=`scrollbars=yes,width=${p},height=${d},top=${g},left=${c}`;this.dialog=window.open(h,"sentryAddIntegration",m),this.dialog&&this.dialog.focus()})),(0,s.Z)(this,"didReceiveMessage",(t=>{const{analyticsParams:e,onInstall:i,organization:s,provider:n}=this.props;if(![p.Z.get("links").sentryUrl,p.Z.get("links").organizationUrl,document.location.origin].includes(t.origin))return;if(t.source!==this.dialog)return;const{success:r,data:d}=t.data;this.dialog=null,r?d&&((0,l.Db)("integrations.installation_complete",{integration:n.key,integration_type:"first_party",organization:s,...e}),(0,o.S9)((0,a.t)("%s added",n.name)),i(d)):(0,o.Iw)(d?.error??(0,a.t)("An unknown error occurred"))}))}componentDidMount(){window.addEventListener("message",this.didReceiveMessage)}componentWillUnmount(){window.removeEventListener("message",this.didReceiveMessage),this.dialog?.close()}computeCenteredWindow(t,e){const i=void 0!==window.screenLeft?window.screenLeft:window.screenX,s=void 0!==window.screenTop?window.screenTop:window.screenY;return{left:(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-t/2+i,top:(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-e/2+s}}render(){const{children:t}=this.props;return t(this.openDialog)}}d.displayName="AddIntegration"},"./app/views/settings/organizationIntegrations/configureIntegration.tsx":(t,e,i)=>{i.r(e),i.d(e,{default:()=>Ze});var s=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(i("../node_modules/core-js/modules/es.array.push.js"),i("../node_modules/core-js/modules/es.array.unshift.js"),i("../node_modules/react/index.js")),o=i("./app/actionCreators/indicator.tsx"),a=i("./app/components/acl/access.tsx"),p=i("./app/components/alert.tsx"),l=i("./app/components/button.tsx"),d=i("./app/components/confirm.tsx"),c=i("./app/components/forms/form.tsx"),g=i("./app/components/forms/jsonForm.tsx"),u=i("./app/components/list/index.tsx"),h=i("./app/components/list/listItem.tsx"),m=i("./app/components/navTabs.tsx"),y=i("./app/icons/index.tsx"),f=i("./app/locale.tsx"),Z=i("./app/utils/integrationUtil.tsx"),x=i("./app/utils/marked.tsx"),b=i("./app/utils/withApi.tsx"),v=i("./app/utils/withDomainRequired.tsx"),w=i("./app/utils/withOrganization.tsx"),S=i("./app/views/asyncView.tsx"),z=i("./app/views/settings/components/settingsBreadcrumb/breadcrumbTitle.tsx"),C=i("./app/views/settings/components/settingsPageHeader.tsx"),k=i("./app/views/settings/organizationIntegrations/addIntegration.tsx"),M=i("./app/components/emptyMessage.tsx"),_=i("./app/components/idBadge/projectBadge.tsx"),D=i("./app/components/panels/index.tsx"),R=i("./app/utils/withProjects.tsx"),B=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function E(t){let{projects:e,organization:i}=t;return(0,B.BX)(D.s_,{children:[(0,B.tZ)(D.V9,{children:(0,f.t)("Project Configuration")}),(0,B.BX)(D.N,{children:[0===e.length&&(0,B.tZ)(M.Z,{size:"large",children:(0,f.t)("You have no projects to add Alert Rules to")}),e.map((t=>(0,B.BX)(I,{children:[(0,B.tZ)(_.Z,{project:t,avatarSize:16}),(0,B.tZ)(l.zx,{to:`/organizations/${i.slug}/alerts/${t.slug}/wizard/`,size:"xs",children:(0,f.t)("Add Alert Rule")})]},t.slug)))]})]})}E.displayName="IntegrationAlertRules";const I=(0,n.Z)(D.Lv,{target:"e1a7opp60"})({name:"1tz8p38",styles:"align-items:center;justify-content:space-between"}),F=(0,w.Z)((0,R.Z)(E));var j=i("../node_modules/lodash/sortBy.js"),N=i.n(j),$=i("./app/actionCreators/modal.tsx"),P=i("./app/components/asyncComponent.tsx"),T=i("./app/components/links/externalLink.tsx"),q=i("./app/components/pagination.tsx"),L=i("./app/styles/space.tsx"),A=i("./app/utils/analytics.tsx"),O=i("./app/utils/routeAnalytics/withRouteAnalytics.tsx"),X=i("./app/views/settings/components/text/textBlock.tsx"),U=i("../node_modules/lodash/pick.js"),H=i.n(U),V=i("./app/components/forms/fieldFromConfig.tsx"),W=i("./app/components/forms/model.tsx"),J=i("./app/utils/useApi.tsx");function K(t){let{existingConfig:e,integration:i,onCancel:s,onSubmitSuccess:n,organization:o,projects:a,repos:p}=t;const l=(0,J.Z)(),d=(0,r.useRef)(new W.Z),g=p.map((t=>{let{name:e,id:i}=t;return{value:i,label:e}})),u=[{name:"projectId",type:"sentry_project_selector",required:!0,label:(0,f.t)("Project"),projects:a},{name:"repositoryId",type:"select_async",required:!0,label:(0,f.t)("Repo"),placeholder:(0,f.t)("Choose repo"),url:`/organizations/${o.slug}/repos/`,defaultOptions:g,onResults:t=>t.map(Z.je),onChange:function(t){const e=p.find((e=>e.id===t));e&&l.requestPromise(`/organizations/${o.slug}/integrations/${i.id}/repos/`,{query:{search:e.name}}).then((t=>{const{defaultBranch:i}=t.repos.find((t=>t.identifier===e.name))??{},s=d.current.getValue("repositoryId")===e.id;i&&s&&d.current.setValue("defaultBranch",i)}))}},{name:"defaultBranch",type:"string",required:!0,label:(0,f.t)("Branch"),placeholder:(0,f.t)("Type your branch"),showHelpInTooltip:!0,help:(0,f.t)("If an event does not have a release tied to a commit, we will use this branch when linking to your source code.")},{name:"stackRoot",type:"string",required:!1,label:(0,f.t)("Stack Trace Root"),placeholder:(0,f.t)("Type root path of your stack traces"),showHelpInTooltip:!0,help:(0,f.t)("Any stack trace starting with this path will be mapped with this rule. An empty string will match all paths.")},{name:"sourceRoot",type:"string",required:!1,label:(0,f.t)("Source Code Root"),placeholder:(0,f.t)("Type root path of your source code, e.g. `src/`."),showHelpInTooltip:!0,help:(0,f.t)("When a rule matches, the stack trace root is replaced with this path to get the path in your repository. Leaving this empty means replacing the stack trace root with an empty string.")}],h={defaultBranch:"master",stackRoot:"",sourceRoot:"",repositoryId:e?.repoId,integrationId:i.id,...H()(e,["projectId","defaultBranch","stackRoot","sourceRoot"])},m=`/organizations/${o.slug}/code-mappings/`,y=e?`${m}${e.id}/`:m,x=e?"PUT":"POST";return(0,B.tZ)(c.Z,{onSubmitSuccess:n,onPreSubmit:function(){(0,A.Gi)("integrations.stacktrace_submit_config",{setup_type:"manual",view:"integration_configuration_detail",provider:i.provider.key,organization:o})},initialData:h,apiEndpoint:y,apiMethod:x,model:d.current,onCancel:s,children:u.map((t=>(0,B.tZ)(V.Z,{field:t,inline:!1,stacked:!0,flexibleControlStateSize:!0},t.name)))})}K.displayName="RepositoryProjectPathConfigForm";const Y=K;var G=i("./app/components/idBadge/index.tsx"),Q=i("./app/components/tooltip.tsx");function tt(t){let{pathConfig:e,project:i,onEdit:s,onDelete:n}=t;return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(ot,{children:(0,B.BX)(et,{children:[(0,B.tZ)(it,{children:e.repoName}),(0,B.BX)(st,{children:[(0,B.tZ)(G.Z,{project:i,avatarSize:14,displayName:i.slug,avatarProps:{consistentWidth:!0}}),(0,B.BX)(nt,{children:[" | ",e.defaultBranch]})]})]})}),(0,B.tZ)(at,{children:e.sourceRoot}),(0,B.tZ)(pt,{children:e.stackRoot}),(0,B.BX)(lt,{children:[(0,B.tZ)(l.zx,{size:"sm",icon:(0,B.tZ)(y.yl,{size:"sm"}),"aria-label":(0,f.t)("edit"),onClick:()=>s(e)}),(0,B.tZ)(a.Z,{access:["org:integrations"],children:t=>{let{hasAccess:i}=t;return(0,B.tZ)(Q.u,{title:(0,f.t)("You must be an organization owner, manager or admin to remove a code mapping."),disabled:i,children:(0,B.tZ)(d.Z,{onConfirm:()=>n(e),message:(0,f.t)("Are you sure you want to remove this code mapping?"),disabled:!i,children:(0,B.tZ)(l.zx,{size:"sm",icon:(0,B.tZ)(y.Fz,{size:"sm"}),"aria-label":(0,f.t)("delete"),disabled:!i})})})}})]})]})}tt.displayName="RepositoryProjectPathConfigRow";const et=(0,n.Z)("div",{target:"e2hxax88"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),it=(0,n.Z)("span",{target:"e2hxax87"})("padding-bottom:",(0,L.D)(1),";"),st=(0,n.Z)("div",{target:"e2hxax86"})("display:flex;flex-direction:row;color:",(t=>t.theme.gray300),";"),nt=(0,n.Z)("div",{target:"e2hxax85"})({name:"oid971",styles:"line-height:1.2"}),rt=(0,n.Z)("span",{target:"e2hxax84"})({name:"8w0o20",styles:"overflow:hidden;overflow-wrap:break-word"}),ot=(0,n.Z)(rt,{target:"e2hxax83"})({name:"75sbk5",styles:"grid-area:name-repo"}),at=(0,n.Z)(rt,{target:"e2hxax82"})({name:"13u5yj5",styles:"grid-area:output-path"}),pt=(0,n.Z)(rt,{target:"e2hxax81"})({name:"ewbb63",styles:"grid-area:input-path"}),lt=(0,n.Z)(rt,{target:"e2hxax80"})("display:flex;gap:",(0,L.D)(1),";");class dt extends P.Z{constructor(){super(...arguments),(0,s.Z)(this,"trackDocsClick",(()=>{(0,A.Gi)("integrations.stacktrace_docs_clicked",{view:"integration_configuration_detail",provider:this.props.integration.provider.key,organization:this.props.organization})})),(0,s.Z)(this,"handleDelete",(async t=>{const{organization:e}=this.props,i=`/organizations/${e.slug}/code-mappings/${t.id}/`;try{await this.api.requestPromise(i,{method:"DELETE"});let{pathConfigs:e}=this.state;e=e.filter((e=>e.id!==t.id)),this.setState({pathConfigs:e}),(0,o.S9)((0,f.t)("Deletion successful"))}catch(t){(0,o.Iw)(`${t.statusText}: ${t.responseText}`)}})),(0,s.Z)(this,"handleSubmitSuccess",(t=>{(0,A.Gi)("integrations.stacktrace_complete_setup",{setup_type:"manual",view:"integration_configuration_detail",provider:this.props.integration.provider.key,organization:this.props.organization});let{pathConfigs:e}=this.state;e=e.filter((e=>e.id!==t.id)),e=e.concat([t]),this.setState({pathConfigs:e}),this.setState({pathConfig:void 0})})),(0,s.Z)(this,"openModal",(t=>{const{organization:e,projects:i,integration:s}=this.props;(0,A.Gi)("integrations.stacktrace_start_setup",{setup_type:"manual",view:"integration_configuration_detail",provider:this.props.integration.provider.key,organization:this.props.organization}),(0,$.openModal)((n=>{let{Body:o,Header:a,closeModal:p}=n;return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(a,{closeButton:!0,children:(0,B.tZ)("h4",{children:(0,f.t)("Configure code path mapping")})}),(0,B.tZ)(o,{children:(0,B.tZ)(Y,{organization:e,integration:s,projects:i,repos:this.repos,onSubmitSuccess:t=>{this.handleSubmitSuccess(t),p()},existingConfig:t,onCancel:p})})]})}))})),(0,s.Z)(this,"handleCursor",(async(t,e,i,s)=>{const n=this.props.organization.slug,[r,o,a]=await this.api.requestPromise(`/organizations/${n}/code-mappings/`,{includeAllArgs:!0,query:{...i,cursor:t}});this.setState({pathConfigs:r,pathConfigsPageLinks:a?.getResponseHeader("link")})}))}getDefaultState(){return{...super.getDefaultState(),pathConfigs:[],repos:[]}}get integrationId(){return this.props.integration.id}get pathConfigs(){return N()(this.state.pathConfigs,[t=>{let{projectSlug:e}=t;return e},t=>{let{id:e}=t;return parseInt(e,10)}])}get repos(){return this.state.repos.filter((t=>t.integrationId===this.integrationId))}getEndpoints(){const t=this.props.organization.slug;return[["pathConfigs",`/organizations/${t}/code-mappings/`,{query:{integrationId:this.integrationId}}],["repos",`/organizations/${t}/repos/`,{query:{status:"active"}}]]}getMatchingProject(t){return this.props.projects.find((e=>e.id===t.projectId))}componentDidMount(){super.componentDidMount(),this.props.setEventNames("integrations.code_mappings_viewed","Integrations: Code Mappings Viewed"),this.props.setRouteAnalyticsParams({integration:this.props.integration.provider.key,integration_type:"first_party"})}renderBody(){const t=this.pathConfigs,{integration:e}=this.props,{pathConfigsPageLinks:i}=this.state,s=`https://docs.sentry.io/product/integrations/source-code-mgmt/${e.provider.key}/#stack-trace-linking`;return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(X.Z,{children:(0,f._N)("Code Mappings are used to map stack trace file paths to source code file paths. These mappings are the basis for features like Stack Trace Linking. To learn more, [link: read the docs].",{link:(0,B.tZ)(T.Z,{href:s,onClick:this.trackDocsClick})})}),(0,B.BX)(D.s_,{children:[(0,B.tZ)(D.V9,{disablePadding:!0,hasButtons:!0,children:(0,B.BX)(ut,{children:[(0,B.tZ)(ot,{children:(0,f.t)("Code Mappings")}),(0,B.tZ)(pt,{children:(0,f.t)("Stack Trace Root")}),(0,B.tZ)(at,{children:(0,f.t)("Source Code Root")}),(0,B.tZ)(lt,{children:(0,B.tZ)(l.zx,{"data-test-id":"add-mapping-button",onClick:()=>this.openModal(),size:"xs",icon:(0,B.tZ)(y.N_,{size:"xs",isCircled:!0}),children:(0,f.t)("Add Code Mapping")})})]})}),(0,B.BX)(D.N,{children:[0===t.length&&(0,B.tZ)(M.Z,{icon:(0,Z.Y6)(e.provider.key,"lg"),action:(0,B.tZ)(l.zx,{href:s,size:"sm",external:!0,onClick:this.trackDocsClick,children:(0,f.t)("View Documentation")}),children:(0,f.t)("Set up stack trace linking by adding a code mapping.")}),t.map((t=>{const e=this.getMatchingProject(t);return e?(0,B.tZ)(ht,{children:(0,B.tZ)(gt,{children:(0,B.tZ)(tt,{pathConfig:t,project:e,onEdit:this.openModal,onDelete:this.handleDelete})})},t.id):null})).filter((t=>!!t))]})]}),i&&(0,B.tZ)(q.Z,{pageLinks:i,onCursor:this.handleCursor})]})}}const ct=(0,O.Z)((0,R.Z)((0,w.Z)(dt))),gt=(0,n.Z)("div",{target:"e13lhd3a2"})("display:grid;grid-column-gap:",(0,L.D)(1),";width:100%;align-items:center;grid-template-columns:4.5fr 2.5fr 2.5fr max-content;grid-template-areas:'name-repo input-path output-path button';"),ut=(0,n.Z)(gt,{target:"e13lhd3a1"})("align-items:center;margin:0 ",(0,L.D)(1)," 0 ",(0,L.D)(2),";"),ht=(0,n.Z)(D.Lv,{target:"e13lhd3a0"})("");i("../node_modules/core-js/modules/es.error.cause.js");var mt=i("../node_modules/lodash/uniqBy.js"),yt=i.n(mt),ft=i("./app/utils/withSentryRouter.tsx"),Zt=i("../node_modules/lodash/capitalize.js"),xt=i.n(Zt);class bt extends r.Component{constructor(){super(...arguments),(0,s.Z)(this,"model",new W.Z)}get initialData(){const{integration:t,mapping:e}=this.props;return{provider:t.provider.key,integrationId:t.id,...e}}getDefaultOptions(t){const{defaultOptions:e,type:i}=this.props;if("object"!=typeof e)return e;const s=[...e??[]];if(!t||!(0,Z.HM)(t)||!t.sentryName)return s;const n=t[`${i}Id`];return s.some((t=>{let{value:e}=t;return n&&e===n}))?s:[{value:n,label:t.sentryName},...s]}get formFields(){const{dataEndpoint:t,isInline:e,mapping:i,mappingKey:s,onResults:n,sentryNamesMapper:r,type:o}=this.props,a=[{flexibleControlStateSize:!0,name:`${o}Id`,type:"select_async",required:!0,label:e?void 0:(0,f._N)("Sentry [type]",{type:xt()(o)}),placeholder:(0,f.t)("Select Sentry %s",xt()(o)),url:t,defaultOptions:this.getDefaultOptions(i),onResults:t=>(n?.(t,e?i?.externalName:s),r(t).map(Z.je))}];return e||a.unshift({name:"externalName",type:"string",flexibleControlStateSize:!0,required:!0,label:e?void 0:(0,f._N)("External [type]",{type:xt()(o)}),placeholder:"user"===o?(0,f.t)("@username"):(0,f.t)("@org/teamname")}),a}get extraFormFieldProps(){const{isInline:t}=this.props;return t?{getData:()=>this.model.getData(),onBlur:()=>this.updateModel()}:{flexibleControlStateSize:!0}}updateModel(){const{getBaseFormEndpoint:t,mapping:e}=this.props,i={...e,...this.model.getData()};if(i){const e=(0,Z.wt)(t(i),i);this.model.setFormOptions(e)}}render(){const{isInline:t,onCancel:e,onSubmitError:i,onSubmitSuccess:s}=this.props;return(0,B.tZ)(vt,{children:(0,B.tZ)(c.Z,{requireChanges:!0,model:this.model,initialData:this.initialData,onCancel:e,onSubmitSuccess:s,onSubmitError:i,saveOnBlur:t,allowUndo:t,onPreSubmit:()=>this.updateModel(),children:this.formFields.map((t=>(0,B.tZ)(V.Z,{field:t,inline:!1,stacked:!0,...this.extraFormFieldProps},t.name)))})})}}bt.displayName="IntegrationExternalMappingForm";const vt=(0,n.Z)("div",{target:"e8brhvv0"})({name:"1v094lo",styles:"position:relative;width:inherit"});var wt=i("./app/plugins/components/pluginIcon.tsx");class St extends P.Z{getDefaultState(){return{...super.getDefaultState(),associationMappings:{},newlyAssociatedMappings:[]}}getEndpoints(){const{organization:t,integration:e}=this.props;return[["associationMappings",`/organizations/${t.slug}/codeowners-associations/`,{query:{provider:e.provider.key}}]]}get isFirstPage(){const{cursor:t}=this.props.location.query;return!t||"0"===t?.split(":")[1]}get unassociatedMappings(){const{type:t}=this.props,{associationMappings:e}=this.state,i=`missing_external_${t}s`,s=Object.values(e).reduce(((t,e)=>{let{errors:s}=e;return new Set([...t,...s[i]])}),new Set);return Array.from(s).map((t=>({externalName:t})))}get allMappings(){const{mappings:t}=this.props;if(!this.isFirstPage)return t;const{newlyAssociatedMappings:e}=this.state;return[...this.unassociatedMappings.map((t=>e.find((e=>{let{externalName:i}=e;return i===t.externalName}))??t)),...t]}renderMappingName(t){const{type:e,getBaseFormEndpoint:i,integration:s,dataEndpoint:n,sentryNamesMapper:r,onResults:o,defaultOptions:a}=this.props;return(0,B.tZ)(bt,{type:e,integration:s,dataEndpoint:n,getBaseFormEndpoint:i,mapping:t,sentryNamesMapper:r,onResults:o,onSubmitSuccess:t=>{this.setState({newlyAssociatedMappings:[...this.state.newlyAssociatedMappings.filter((e=>e.externalName!==t.externalName)),t]})},isInline:!0,defaultOptions:a})}renderMappingActions(t){const{type:e,onDelete:i,organization:s}=this.props,n=s.access.includes("org:integrations");return(0,Z.HM)(t)?(0,B.tZ)(d.Z,{disabled:!n,onConfirm:()=>i(t),message:(0,f.t)("Are you sure you want to remove this external %s mapping?",e),children:(0,B.tZ)(l.zx,{borderless:!0,size:"sm",icon:(0,B.tZ)(y.Fz,{size:"sm"}),"aria-label":(0,f.t)("Remove user mapping"),title:n?(0,f.t)("Remove user mapping"):(0,f.t)("You must be an organization owner, manager or admin to delete an external user mapping.")})}):(0,B.tZ)(Q.u,{title:(0,f.t)("This %s mapping suggestion was generated from a CODEOWNERS file",e),children:(0,B.tZ)(l.zx,{disabled:!0,borderless:!0,size:"sm",icon:(0,B.tZ)(y.BS,{size:"sm"}),"aria-label":(0,f.t)("This %s mapping suggestion was generated from a CODEOWNERS file",e),"data-test-id":"suggestion-option"})})}renderBody(){const{integration:t,type:e,onCreate:i,pageLinks:s}=this.props;return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(Ct,{"data-test-id":"mapping-table",isEmpty:!this.allMappings.length,emptyMessage:(0,f._N)("Set up External [type] Mappings.",{type:xt()(e)}),headers:[(0,f._N)("External [type]",{type:e}),(0,B.tZ)(y.CC,{direction:"right",size:"sm"},"arrow"),(0,f._N)("Sentry [type]",{type:e}),(0,B.tZ)(_t,{"data-test-id":"add-mapping-button",onClick:()=>i(),size:"xs",icon:(0,B.tZ)(y.N_,{size:"xs",isCircled:!0}),children:(0,f._N)("Add [type] Mapping",{type:e})},"delete-button")],children:this.allMappings.map(((e,i)=>(0,B.BX)(r.Fragment,{children:[(0,B.BX)(Mt,{children:[(0,B.tZ)(kt,{pluginId:t.provider.key,size:19}),(0,B.tZ)("span",{children:e.externalName})]}),(0,B.tZ)("div",{children:(0,B.tZ)(y.CC,{direction:"right",size:"sm",color:"gray300"})}),(0,B.tZ)(Dt,{children:this.renderMappingName(e)}),(0,B.tZ)("div",{children:this.renderMappingActions(e)})]},i)))}),(0,B.tZ)(q.Z,{pageLinks:s})]})}}const zt=(0,ft.Z)(St),Ct=(0,n.Z)(D.KB,{target:"e66ln7q4"})("overflow:visible;grid-template-columns:1fr max-content 1fr 66px;",(t=>t.isEmpty?`\n  > :not(:nth-child(n + 5)) {\n    padding: ${(0,L.D)(1)} ${(0,L.D)(2)};\n  }`:`\n  > :nth-child(n + 5) {\n    display: flex;\n    align-items: center;\n    padding: ${(0,L.D)(1.5)} ${(0,L.D)(2)};\n  }\n\n  > * {\n    padding: ${(0,L.D)(1)} ${(0,L.D)(2)};\n  }\n`),">:nth-child(4n){padding-right:",(0,L.D)(1),";justify-content:end;}"),kt=(0,n.Z)(wt.ZP,{target:"e66ln7q3"})("min-width:",(t=>t.size),"px;margin-right:",(0,L.D)(2),";"),Mt=(0,n.Z)("div",{target:"e66ln7q2"})("font-family:",(t=>t.theme.text.familyMono),";"),_t=(0,n.Z)(l.zx,{target:"e66ln7q1"})({name:"vxzmxr",styles:"align-self:end"}),Dt=(0,n.Z)("div",{target:"e66ln7q0"})({name:"1d3w5wq",styles:"width:100%"});class Rt extends P.Z{constructor(){super(...arguments),(0,s.Z)(this,"handleDelete",(async t=>{try{const{organization:e}=this.props,{teams:i}=this.state,s=i.find((e=>e.id===t.teamId));if(!s)throw new Error("Cannot find correct team slug.");const n=`/teams/${e.slug}/${s.slug}/external-teams/${t.id}/`;await this.api.requestPromise(n,{method:"DELETE"}),(0,o.S9)((0,f.t)("Deletion successful")),this.fetchData()}catch{(0,o.Iw)((0,f.t)("An error occurred"))}})),(0,s.Z)(this,"handleSubmitSuccess",(()=>{this.fetchData()})),(0,s.Z)(this,"modalMappingKey","__MODAL_RESULTS__"),(0,s.Z)(this,"combineResultsById",((t,e)=>yt()([...t,...e],"id"))),(0,s.Z)(this,"handleResults",((t,e)=>{if(e){const{queryResults:i}=this.state;this.setState({queryResults:{...i,[e]:this.combineResultsById(t,i[e]??[])}})}})),(0,s.Z)(this,"openModal",(t=>{const{integration:e}=this.props;(0,$.openModal)((i=>{let{Body:s,Header:n,closeModal:o}=i;return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(n,{closeButton:!0,children:(0,f.t)("Configure External Team Mapping")}),(0,B.tZ)(s,{children:(0,B.tZ)(bt,{type:"team",integration:e,dataEndpoint:this.dataEndpoint,getBaseFormEndpoint:t=>this.getBaseFormEndpoint(t),defaultOptions:this.defaultTeamOptions,mapping:t,mappingKey:this.modalMappingKey,sentryNamesMapper:this.sentryNamesMapper,onCancel:o,onResults:this.handleResults,onSubmitSuccess:()=>{this.handleSubmitSuccess(),o()}})})]})}))}))}getDefaultState(){return{...super.getDefaultState(),teams:[],initialResults:[],queryResults:{}}}getEndpoints(){const{organization:t,location:e}=this.props;return[["teams",`/organizations/${t.slug}/teams/`,{query:{...e?.query,query:"hasExternalTeams:true"}}],["initialResults",`/organizations/${t.slug}/teams/`]]}get mappings(){const{integration:t}=this.props,{teams:e}=this.state;return e.reduce(((e,i)=>{const{externalTeams:s}=i;return e.push(...s.filter((e=>e.provider===t.provider.key)).map((t=>({...t,sentryName:i.slug})))),e}),[]).sort(((t,e)=>parseInt(t.id,10)-parseInt(e.id,10)))}get dataEndpoint(){const{organization:t}=this.props;return`/organizations/${t.slug}/teams/`}get defaultTeamOptions(){const{initialResults:t}=this.state;return this.sentryNamesMapper(t).map(Z.je)}getBaseFormEndpoint(t){if(!t)return"";const{organization:e}=this.props,{queryResults:i,initialResults:s}=this.state,n=i[t.externalName]??i[this.modalMappingKey],r=n?.find((e=>e.id===t.teamId))??s?.find((e=>e.id===t.teamId));return`/teams/${e.slug}/${r?.slug??""}/external-teams/`}sentryNamesMapper(t){return t.map((t=>{let{id:e,slug:i}=t;return{id:e,name:i}}))}renderBody(){const{integration:t,organization:e}=this.props,{teamsPageLinks:i}=this.state;return(0,B.tZ)(zt,{type:"team",integration:t,organization:e,mappings:this.mappings,dataEndpoint:this.dataEndpoint,getBaseFormEndpoint:t=>this.getBaseFormEndpoint(t),defaultOptions:this.defaultTeamOptions,sentryNamesMapper:this.sentryNamesMapper,onCreate:this.openModal,onDelete:this.handleDelete,pageLinks:i,onResults:this.handleResults})}}const Bt=(0,ft.Z)((0,w.Z)(Rt));class Et extends P.Z{constructor(){super(...arguments),(0,s.Z)(this,"handleDelete",(async t=>{const{organization:e}=this.props;try{await this.api.requestPromise(`/organizations/${e.slug}/external-users/${t.id}/`,{method:"DELETE"}),(0,o.S9)((0,f.t)("Deletion successful")),this.fetchData()}catch{(0,o.Iw)((0,f.t)("An error occurred"))}})),(0,s.Z)(this,"handleSubmitSuccess",(()=>{this.fetchData()})),(0,s.Z)(this,"openModal",(t=>{const{integration:e}=this.props;(0,$.openModal)((i=>{let{Body:s,Header:n,closeModal:o}=i;return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(n,{closeButton:!0,children:(0,f.t)("Configure External User Mapping")}),(0,B.tZ)(s,{children:(0,B.tZ)(bt,{type:"user",integration:e,dataEndpoint:this.dataEndpoint,getBaseFormEndpoint:()=>this.baseFormEndpoint,defaultOptions:this.defaultUserOptions,mapping:t,sentryNamesMapper:this.sentryNamesMapper,onCancel:o,onSubmitSuccess:()=>{this.handleSubmitSuccess(),o()}})})]})}))}))}getEndpoints(){const{organization:t}=this.props;return[["members",`/organizations/${t.slug}/members/`,{query:{query:"hasExternalUsers:true",expand:"externalUsers"}}],["initialResults",`/organizations/${t.slug}/members/`]]}get mappings(){const{integration:t}=this.props,{members:e}=this.state;return e.reduce(((e,i)=>{const{externalUsers:s,user:n}=i;return e.push(...s.filter((e=>e.provider===t.provider.key)).map((t=>({...t,sentryName:n?.name??i.name})))),e}),[]).sort(((t,e)=>parseInt(t.id,10)-parseInt(e.id,10)))}get dataEndpoint(){const{organization:t}=this.props;return`/organizations/${t.slug}/members/`}get baseFormEndpoint(){const{organization:t}=this.props;return`/organizations/${t.slug}/external-users/`}get defaultUserOptions(){const{initialResults:t}=this.state;return this.sentryNamesMapper(t).map(Z.je)}sentryNamesMapper(t){return t.filter((t=>t.user)).map((t=>{let{user:e,email:i,name:s}=t;const n=i!==s?`${s} - ${i}`:`${i}`;return{id:e?.id,name:n}}))}renderBody(){const{integration:t,organization:e}=this.props,{membersPageLinks:i}=this.state;return(0,B.tZ)(r.Fragment,{children:(0,B.tZ)(zt,{type:"user",integration:t,organization:e,mappings:this.mappings,dataEndpoint:this.dataEndpoint,getBaseFormEndpoint:()=>this.baseFormEndpoint,defaultOptions:this.defaultUserOptions,sentryNamesMapper:this.sentryNamesMapper,onCreate:this.openModal,onDelete:this.handleDelete,pageLinks:i})})}}const It=(0,ft.Z)((0,w.Z)(Et));var Ft=i("./app/views/settings/organizationIntegrations/integrationItem.tsx");class jt extends r.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{integration:this.props.integration}),(0,s.Z)(this,"handleSubmitSuccess",(t=>{(0,o.S9)((0,f.t)("Integration updated.")),this.props.onUpdate(),this.setState({integration:t})}))}get initialData(){const{integration:t}=this.props;return{name:t.name,domain:t.domainName||""}}get formFields(){return[{name:"name",type:"string",required:!1,label:(0,f.t)("Integration Name")},{name:"domain",type:"string",required:!1,label:(0,f.t)("Full URL")}]}render(){const{integration:t}=this.state,{organization:e}=this.props;return(0,B.tZ)(c.Z,{initialData:this.initialData,apiMethod:"PUT",apiEndpoint:`/organizations/${e.slug}/integrations/${t.id}/`,onSubmitSuccess:this.handleSubmitSuccess,submitLabel:(0,f.t)("Save Settings"),children:(0,B.tZ)(g.Z,{fields:this.formFields})})}}jt.displayName="IntegrationMainSettings";const Nt=jt;var $t=i("../node_modules/lodash/debounce.js"),Pt=i.n($t),Tt=i("./app/actionCreators/integrations.tsx"),qt=i("./app/components/dropdownAutoComplete/index.tsx"),Lt=i("./app/components/dropdownButton.tsx"),At=i("./app/components/repositoryRow.tsx"),Ot=i("./app/stores/repositoryStore.tsx");class Xt extends P.Z{constructor(){super(...arguments),(0,s.Z)(this,"onRepositoryChange",(t=>{const e=this.state.itemList;e.forEach((e=>{e.id===t.id&&(e.status=t.status,e.url=void 0===t.url?e.url:t.url,e.name=t.name||e.name)})),this.setState({itemList:e}),Ot.Z.resetRepositories()})),(0,s.Z)(this,"debouncedSearchRepositoriesRequest",Pt()((t=>this.searchRepositoriesRequest(t)),200)),(0,s.Z)(this,"searchRepositoriesRequest",(t=>{const e={search:t},i=`/organizations/${this.props.organization.slug}/integrations/${this.props.integration.id}/repos/`;return this.api.request(i,{method:"GET",query:e,success:t=>{this.setState({integrationRepos:t,dropdownBusy:!1})},error:t=>{this.setState({dropdownBusy:!1,integrationReposErrorStatus:t?.status})}})})),(0,s.Z)(this,"handleSearchRepositories",(t=>{this.setState({dropdownBusy:!0,integrationReposErrorStatus:null}),this.debouncedSearchRepositoriesRequest(t?.target.value)}))}getDefaultState(){return{...super.getDefaultState(),adding:!1,itemList:[],integrationRepos:{repos:[],searchable:!1},integrationReposErrorStatus:null,dropdownBusy:!0}}componentDidMount(){super.componentDidMount(),this.searchRepositoriesRequest()}getEndpoints(){return[["itemList",`/organizations/${this.props.organization.slug}/repos/`,{query:{status:"active",integration_id:this.props.integration.id}}]]}addRepo(t){const{integration:e}=this.props,{itemList:i}=this.state,s=this.props.organization.slug;this.setState({adding:!0});const n=i.filter((e=>!(!t.value||!e.externalSlug)&&t.value===e.externalSlug))[0];let r;r=n?(0,Tt.Ag)(this.api,s,n.id,e):(0,Tt.eg)(this.api,s,t.value,e),r.then((t=>{this.setState({adding:!1,itemList:i.concat(t)}),Ot.Z.resetRepositories()}),(()=>this.setState({adding:!1})))}renderDropdown(){if(!["github","gitlab"].includes(this.props.integration.provider.key)&&!this.props.organization.access.includes("org:integrations"))return(0,B.tZ)(Lt.Z,{disabled:!0,title:(0,f.t)("You must be an organization owner, manager or admin to add repositories"),isOpen:!1,size:"xs",children:(0,f.t)("Add Repository")});const t=new Set(this.state.itemList.filter((t=>t.integrationId)).map((t=>t.externalSlug))),e=(this.state.integrationRepos.repos||[]).filter((e=>!t.has(e.identifier))).map((t=>({searchKey:t.name,value:t.identifier,label:(0,B.tZ)(Wt,{children:(0,B.tZ)(Jt,{children:t.name})})}))),i=(0,B.tZ)(Ht,{children:(0,f.t)("Repositories")}),s=this.state.integrationRepos.searchable?this.handleSearchRepositories:void 0;return(0,B.tZ)(qt.Z,{items:e,onSelect:this.addRepo.bind(this),onChange:s,menuHeader:i,emptyMessage:(0,f.t)("No repositories available"),noResultsMessage:(0,f.t)("No repositories found"),busy:this.state.dropdownBusy,alignMenu:"right",children:t=>{let{isOpen:e}=t;return(0,B.tZ)(Lt.Z,{isOpen:e,size:"xs",busy:this.state.adding,children:(0,f.t)("Add Repository")})}})}renderBody(){const{itemListPageLinks:t,integrationReposErrorStatus:e,itemList:i}=this.state,s=this.props.organization.slug;return(0,B.BX)(r.Fragment,{children:[400===e&&(0,B.tZ)(p.bZ,{type:"error",showIcon:!0,children:(0,f.t)("We were unable to fetch repositories for this integration. Try again later. If this error continues, please reconnect this integration by uninstalling and then reinstalling.")}),(0,B.BX)(D.s_,{children:[(0,B.BX)(D.V9,{hasButtons:!0,children:[(0,B.tZ)("div",{children:(0,f.t)("Repositories")}),(0,B.tZ)(Vt,{children:this.renderDropdown()})]}),(0,B.BX)(D.N,{children:[0===i.length&&(0,B.tZ)(M.Z,{icon:(0,B.tZ)(y.J3,{}),title:(0,f.t)("Sentry is better with commit data"),description:(0,f.t)("Add a repository to begin tracking its commit data. Then, set up release tracking to unlock features like suspect commits, suggested issue owners, and deploy emails."),action:(0,B.tZ)(l.zx,{href:"https://docs.sentry.io/product/releases/",children:(0,f.t)("Learn More")})}),i.map((t=>(0,B.tZ)(At.Z,{api:this.api,repository:t,orgId:s,onRepositoryChange:this.onRepositoryChange},t.id)))]})]}),t&&(0,B.tZ)(q.Z,{pageLinks:t,...this.props})]})}}const Ut=(0,w.Z)(Xt),Ht=(0,n.Z)("div",{target:"e18p0mvp3"})("width:250px;font-size:0.875em;padding:",(0,L.D)(1)," 0;text-transform:uppercase;"),Vt=(0,n.Z)("div",{target:"e18p0mvp2"})({name:"kxbue8",styles:"text-transform:none"}),Wt=(0,n.Z)("div",{target:"e18p0mvp1"})("display:flex;align-items:center;padding:",(0,L.D)(.5),";"),Jt=(0,n.Z)("div",{target:"e18p0mvp0"})("flex-shrink:1;min-width:0;",(t=>t.theme.overflowEllipsis),";");var Kt=i("./app/components/switchButton.tsx");class Yt extends r.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{submitting:!1}),(0,s.Z)(this,"recordAction",(t=>{(0,Z.Db)("integrations.serverless_function_action",{integration:this.props.integration.provider.key,integration_type:"first_party",action:t,organization:this.props.organization})})),(0,s.Z)(this,"toggleEnable",(async()=>{const{serverlessFunction:t}=this.props,e=this.enabled?"disable":"enable",i={action:e,target:t.name};try{(0,o.E3)(),this.setState({submitting:!0}),this.props.onUpdateFunction({enabled:!this.enabled}),this.recordAction(e);const t=await this.props.api.requestPromise(this.endpoint,{method:"POST",data:i});this.props.onUpdateFunction(t),(0,o.S9)((0,f.t)("Success"))}catch(e){this.props.onUpdateFunction(t),(0,o.Iw)(e.responseJSON?.detail??(0,f.t)("Error occurred"))}this.setState({submitting:!1})})),(0,s.Z)(this,"updateVersion",(async()=>{const{serverlessFunction:t}=this.props,e={action:"updateVersion",target:t.name};try{this.setState({submitting:!0}),this.props.onUpdateFunction({outOfDate:!1}),(0,o.E3)(),this.recordAction("updateVersion");const t=await this.props.api.requestPromise(this.endpoint,{method:"POST",data:e});this.props.onUpdateFunction(t),(0,o.S9)((0,f.t)("Success"))}catch(e){this.props.onUpdateFunction(t),(0,o.Iw)(e.responseJSON?.detail??(0,f.t)("Error occurred"))}this.setState({submitting:!1})}))}get enabled(){return this.props.serverlessFunction.enabled}get endpoint(){return`/organizations/${this.props.organization.slug}/integrations/${this.props.integration.id}/serverless-functions/`}renderLayerStatus(){const{serverlessFunction:t}=this.props;return t.outOfDate?(0,B.tZ)(ne,{size:"sm",priority:"primary",onClick:this.updateVersion,children:(0,f.t)("Update")}):this.enabled?(0,f.t)("Latest"):(0,f.t)("Disabled")}render(){const{serverlessFunction:t}=this.props,{version:e}=t,i=this.enabled&&e>0?(0,B.BX)(r.Fragment,{children:[" | v",e]}):null;return(0,B.BX)(Qt,{children:[(0,B.tZ)(ee,{children:(0,B.BX)(re,{children:[(0,B.tZ)(oe,{children:t.name}),(0,B.BX)(ae,{children:[(0,B.tZ)(pe,{children:t.runtime}),(0,B.tZ)(pe,{children:i})]})]})}),(0,B.tZ)(ie,{children:this.renderLayerStatus()}),(0,B.tZ)(se,{isActive:this.enabled,isDisabled:this.state.submitting,size:"sm",toggle:this.toggleEnable})]})}}Yt.displayName="IntegrationServerlessRow";const Gt=(0,b.Z)(Yt),Qt=(0,n.Z)("div",{target:"e1aux73s9"})("padding:",(0,L.D)(2),";&:not(:last-child){border-bottom:1px solid ",(t=>t.theme.innerBorder),";}display:grid;grid-column-gap:",(0,L.D)(1),";align-items:center;grid-template-columns:2fr 1fr 0.5fr;grid-template-areas:'function-name layer-status enable-switch';"),te=(0,n.Z)("span",{target:"e1aux73s8"})({name:"5l2w6y",styles:"height:32px;vertical-align:middle;display:flex;align-items:center"}),ee=(0,n.Z)(te,{target:"e1aux73s7"})({name:"gs1e4l",styles:"grid-area:function-name"}),ie=(0,n.Z)(te,{target:"e1aux73s6"})({name:"12cfrml",styles:"grid-area:layer-status"}),se=(0,n.Z)(Kt.Z,{target:"e1aux73s5"})({name:"uxilq9",styles:"grid-area:enable-switch"}),ne=(0,n.Z)(l.zx,{target:"e1aux73s4"})(""),re=(0,n.Z)("div",{target:"e1aux73s3"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),oe=(0,n.Z)("span",{target:"e1aux73s2"})("padding-bottom:",(0,L.D)(1),";"),ae=(0,n.Z)("div",{target:"e1aux73s1"})("display:flex;flex-direction:row;color:",(t=>t.theme.gray300),";"),pe=(0,n.Z)("div",{target:"e1aux73s0"})({name:"oid971",styles:"line-height:1.2"});class le extends P.Z{constructor(){super(...arguments),(0,s.Z)(this,"handleFunctionUpdate",((t,e)=>{const i=[...this.serverlessFunctions],s={...i[e],...t};i[e]=s,this.setState({serverlessFunctions:i})}))}getDefaultState(){return{...super.getDefaultState(),serverlessFunctions:[]}}getEndpoints(){return[["serverlessFunctions",`/organizations/${this.props.organization.slug}/integrations/${this.props.integration.id}/serverless-functions/`]]}get serverlessFunctions(){return this.state.serverlessFunctions}onLoadAllEndpointsSuccess(){(0,Z.Db)("integrations.serverless_functions_viewed",{integration:this.props.integration.provider.key,integration_type:"first_party",num_functions:this.serverlessFunctions.length,organization:this.props.organization})}renderBody(){return(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(p.bZ,{type:"info",children:(0,f.t)("Manage your AWS Lambda functions below. Only Node and Python runtimes are currently supported.")}),(0,B.BX)(D.s_,{children:[(0,B.BX)(ce,{disablePadding:!0,hasButtons:!0,children:[(0,B.tZ)(he,{children:(0,f.t)("Name")}),(0,B.tZ)(me,{children:(0,f.t)("Layer Status")}),(0,B.tZ)(ye,{children:(0,f.t)("Enabled")})]}),(0,B.tZ)(ue,{children:this.serverlessFunctions.map(((t,e)=>(0,B.tZ)(Gt,{serverlessFunction:t,onUpdateFunction:t=>this.handleFunctionUpdate(t,e),...this.props},t.name)))})]})]})}}const de=(0,w.Z)(le),ce=(0,n.Z)(D.V9,{target:"e5os9235"})("padding:",(0,L.D)(2),";display:grid;grid-column-gap:",(0,L.D)(1),";align-items:center;grid-template-columns:2fr 1fr 0.5fr;grid-template-areas:'function-name layer-status enable-switch';"),ge=(0,n.Z)("div",{target:"e5os9234"})({name:"82a6rk",styles:"flex:1"}),ue=(0,n.Z)(D.N,{target:"e5os9233"})(""),he=(0,n.Z)(ge,{target:"e5os9232"})({name:"gs1e4l",styles:"grid-area:function-name"}),me=(0,n.Z)(ge,{target:"e5os9231"})({name:"12cfrml",styles:"grid-area:layer-status"}),ye=(0,n.Z)(ge,{target:"e5os9230"})({name:"uxilq9",styles:"grid-area:enable-switch"});class fe extends S.Z{constructor(){super(...arguments),(0,s.Z)(this,"onTabChange",(t=>{this.setState({tab:t})})),(0,s.Z)(this,"onUpdateIntegration",(()=>{this.setState(this.getDefaultState(),this.fetchData)})),(0,s.Z)(this,"handleJiraMigration",(async()=>{try{const{organization:t,params:{integrationId:e}}=this.props;await this.api.requestPromise(`/organizations/${t.slug}/integrations/${e}/issues/`,{method:"PUT",data:{}}),this.setState({plugins:(this.state.plugins||[]).filter((t=>{let{id:e}=t;return"jira"===e}))},(()=>(0,o.S9)((0,f.t)("Migration in progress."))))}catch(t){(0,o.Iw)((0,f.t)("Something went wrong! Please try again."))}})),(0,s.Z)(this,"getAction",(t=>{const{integration:e,plugins:i}=this.state,s=t&&["jira","jira_server"].includes(t.key)&&(i||[]).find((t=>{let{id:e}=t;return"jira"===e}));return t&&"pagerduty"===t.key?(0,B.tZ)(k.Z,{provider:t,onInstall:this.onUpdateIntegration,account:e.domainName,organization:this.props.organization,children:t=>(0,B.tZ)(l.zx,{priority:"primary",size:"sm",icon:(0,B.tZ)(y.N_,{size:"xs",isCircled:!0}),onClick:()=>t(),children:(0,f.t)("Add Services")})}):s?(0,B.tZ)(a.Z,{access:["org:integrations"],children:t=>{let{hasAccess:e}=t;return(0,B.tZ)(d.Z,{disabled:!e,header:"Migrate Linked Issues from Jira Plugins",renderMessage:()=>(0,B.BX)(r.Fragment,{children:[(0,B.tZ)("p",{children:(0,f.t)("This will automatically associate all the Linked Issues of your Jira Plugins to this integration.")}),(0,B.tZ)("p",{children:(0,f.t)("If the Jira Plugins had the option checked to automatically create a Jira ticket for every new Sentry issue checked, you will need to create alert rules to recreate this behavior. Jira Server does not have this feature.")}),(0,B.tZ)("p",{children:(0,f.t)("Once the migration is complete, your Jira Plugins will be disabled.")})]}),onConfirm:()=>{this.handleJiraMigration()},children:(0,B.tZ)(l.zx,{priority:"primary",size:"md",disabled:!e,children:(0,f.t)("Migrate Plugin")})})}}):null}))}getEndpoints(){const{organization:t}=this.props,{integrationId:e}=this.props.params;return[["config",`/organizations/${t.slug}/config/integrations/`],["integration",`/organizations/${t.slug}/integrations/${e}/`],["plugins",`/organizations/${t.slug}/plugins/configs/`]]}componentDidMount(){super.componentDidMount();const{location:t,router:e,organization:i,params:{providerKey:s}}=this.props;["github","gitlab"].includes(s)||i.access.includes("org:integrations")||e.push((0,v.D)({pathname:`/settings/${i.slug}/integrations/${s}/`}));const n=["codeMappings","userMappings","teamMappings"].find((e=>e===t.query.tab))||"repos";this.setState({tab:n})}onRequestSuccess(t){let{stateKey:e,data:i}=t;"integration"===e&&(0,Z.Db)("integrations.details_viewed",{integration:i.provider.key,integration_type:"first_party",organization:this.props.organization})}getTitle(){return this.state.integration?this.state.integration.provider.name:"Configure Integration"}hasStacktraceLinking(t){return t.features.includes("stacktrace-link")&&this.props.organization.features.includes("integrations-stacktrace-link")}hasCodeOwners(){return this.props.organization.features.includes("integrations-codeowners")}isCustomIntegration(){const{integration:t}=this.state,{organization:e}=this.props;return e.features.includes("integrations-custom-scm")&&"custom_scm"===t.provider.key}get tab(){return this.state.tab||"repos"}renderMainTab(t){const{organization:e}=this.props,{integration:i}=this.state,s=i.dynamicDisplayInformation?.configure_integration?.instructions;return(0,B.BX)(r.Fragment,{children:[i.configOrganization.length>0&&(0,B.tZ)(c.Z,{hideFooter:!0,saveOnBlur:!0,allowUndo:!0,apiMethod:"POST",initialData:i.configData||{},apiEndpoint:`/organizations/${e.slug}/integrations/${i.id}/`,children:(0,B.tZ)(g.Z,{fields:i.configOrganization,title:i.provider.aspects.configure_integration?.title||(0,f.t)("Organization Integration Settings")})}),s&&s.length>0&&(0,B.tZ)(p.bZ,{type:"info",children:1===s?.length?(0,B.tZ)("span",{dangerouslySetInnerHTML:{__html:(0,x.A)(s[0])}}):(0,B.tZ)(u.Z,{symbol:(0,B.tZ)(y.CC,{size:"xs",direction:"right"}),children:s?.map(((t,e)=>(0,B.tZ)(h.Z,{children:(0,B.tZ)("span",{dangerouslySetInnerHTML:{__html:(0,x.A)(t)}})},e)))??[]})}),t.features.includes("alert-rule")&&(0,B.tZ)(F,{}),t.features.includes("commits")&&(0,B.tZ)(Ut,{...this.props,integration:i}),t.features.includes("serverless")&&(0,B.tZ)(de,{integration:i})]})}renderBody(){const{integration:t}=this.state,e=this.state.config.providers.find((e=>e.key===t.provider.key));if(!e)return null;const i=(0,B.tZ)(Ft.Z,{integration:t}),s=(0,B.tZ)(C.Z,{noTitleStyles:!0,title:i,action:this.getAction(e)});return(0,B.BX)(r.Fragment,{children:[s,this.renderMainContent(e),(0,B.tZ)(z.Z,{routes:this.props.routes,title:(0,f.t)("Configure %s",t.provider.name)})]})}renderMainContent(t){if(!this.hasStacktraceLinking(t))return this.renderMainTab(t);const e=[["repos",(0,f.t)("Repositories")],["codeMappings",(0,f.t)("Code Mappings")],...this.hasCodeOwners()?[["userMappings",(0,f.t)("User Mappings")]]:[],...this.hasCodeOwners()?[["teamMappings",(0,f.t)("Team Mappings")]]:[]];return this.isCustomIntegration()&&e.unshift(["settings",(0,f.t)("Settings")]),(0,B.BX)(r.Fragment,{children:[(0,B.tZ)(m.Z,{underlined:!0,children:e.map((t=>(0,B.tZ)("li",{className:this.tab===t[0]?"active":"",onClick:()=>this.onTabChange(t[0]),children:(0,B.tZ)(xe,{children:t[1]})},t[0])))}),this.renderTabContent(this.tab,t)]})}renderTabContent(t,e){const{integration:i}=this.state,{organization:s}=this.props;switch(t){case"codeMappings":return(0,B.tZ)(ct,{integration:i});case"repos":default:return this.renderMainTab(e);case"userMappings":return(0,B.tZ)(It,{integration:i});case"teamMappings":return(0,B.tZ)(Bt,{integration:i});case"settings":return(0,B.tZ)(Nt,{onUpdate:this.onUpdateIntegration,organization:s,integration:i})}}}const Ze=(0,w.Z)((0,b.Z)(fe)),xe=(0,n.Z)("a",{target:"efezj530"})({name:"kff9ir",styles:"text-transform:capitalize"})},"./app/views/settings/organizationIntegrations/integrationItem.tsx":(t,e,i)=>{i.d(e,{Z:()=>p});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=i("./app/styles/space.tsx"),r=i("./app/views/settings/organizationIntegrations/integrationIcon.tsx"),o=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function a(t){let{integration:e,compact:i=!1}=t;return(0,o.BX)(l,{children:[(0,o.tZ)("div",{children:(0,o.tZ)(r.Z,{size:i?22:32,integration:e})}),(0,o.BX)(d,{compact:i,children:[(0,o.tZ)(c,{"data-test-id":"integration-name",children:e.name}),(0,o.tZ)(g,{compact:i,children:e.domainName})]})]})}a.displayName="IntegrationItem";const p=a,l=(0,s.Z)("div",{target:"e1cj6uyl3"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),d=(0,s.Z)("div",{target:"e1cj6uyl2"})("box-sizing:border-box;display:flex;",(t=>t.compact?"align-items: center;":""),";flex-direction:",(t=>t.compact?"row":"column"),";padding-left:",(0,n.D)(1),";min-width:0;justify-content:center;"),c=(0,s.Z)("div",{target:"e1cj6uyl1"})("font-size:",(t=>t.theme.fontSizeMedium),";font-weight:bold;"),g=(0,s.Z)("div",{target:"e1cj6uyl0"})("color:",(t=>t.theme.subText),";margin-left:",(t=>t.compact?(0,n.D)(1):"inherit"),";margin-top:",(t=>t.compact?"inherit":0),";font-size:",(t=>t.theme.fontSizeSmall),";overflow:hidden;text-overflow:ellipsis;")}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationIntegrations_configureIntegration_tsx.f61943d0df4dc7d2538173ffca8459d0.js.map