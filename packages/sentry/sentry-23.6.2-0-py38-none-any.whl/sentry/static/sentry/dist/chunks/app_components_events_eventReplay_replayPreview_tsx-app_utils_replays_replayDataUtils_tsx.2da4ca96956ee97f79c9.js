"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_eventReplay_replayPreview_tsx-app_utils_replays_replayDataUtils_tsx"],{"./app/components/events/eventReplay/replayPreview.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>Z});var a=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=r("../node_modules/react/index.js"),s=r("./app/components/alert.tsx"),i=r("./app/components/button.tsx"),o=r("./app/components/links/externalLink.tsx"),l=r("./app/components/list/index.tsx"),p=r("./app/components/list/listItem.tsx"),c=r("./app/components/placeholder.tsx"),u=r("./app/components/replays/replayContext.tsx"),m=r("./app/components/replays/replayPlayer.tsx"),d=r("./app/components/replays/utils.tsx"),g=r("./app/icons/index.tsx"),f=r("./app/locale.tsx"),h=r("./app/styles/space.tsx"),y=r("./app/utils/getRouteStringFromRoutes.tsx"),v=r("./app/utils/replays/hooks/useReplayReader.tsx"),b=r("./app/utils/useRoutes.tsx"),T=r("./app/views/replays/detail/layout/fluidHeight.tsx"),x=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function w(e){let{orgSlug:t,replaySlug:r,event:a}=e;const c=(0,b.V)(),{fetching:h,replay:T,replayRecord:w,fetchError:Z,replayId:D}=(0,v.Z)({orgSlug:t,replaySlug:r}),N=a.dateCreated?1e3*Math.floor(new Date(a.dateCreated).getTime()/1e3):0,M=w?.started_at.getTime()??0,j=(0,n.useMemo)((()=>N&&M?(0,d.NH)(N,M):0),[N,M]);if(Z){const e=[(0,f.t)("The replay was rate-limited and could not be accepted."),(0,f.t)("The replay has been deleted by a member in your organization."),(0,f.t)("There were network errors and the replay was not saved."),(0,f._N)("[link:Read the docs] to understand why.",{link:(0,x.tZ)(o.Z,{href:"https://docs.sentry.io/platforms/javascript/session-replay/#error-linking"})})];return(0,x.BX)(s.bZ,{type:"info",showIcon:!0,"data-test-id":"replay-error",trailingItems:(0,x.tZ)(i.zx,{external:!0,href:"https://docs.sentry.io/platforms/javascript/session-replay/#error-linking",size:"xs",children:(0,f.t)("Read Docs")}),children:[(0,x.tZ)("p",{children:(0,f.t)("The replay for this event cannot be found. This could be due to these reasons:")}),(0,x.tZ)(l.Z,{symbol:"bullet",children:e.map(((e,t)=>(0,x.tZ)(p.Z,{children:e},t)))})]})}if(h||!w)return(0,x.tZ)(I,{testId:"replay-loading-placeholder",height:"400px",width:"100%"});const O={pathname:`/organizations/${t}/replays/${D}/`,query:{referrer:(0,y.Z)(c),t_main:"console",t:j/1e3}};return(0,x.tZ)(u.z,{isFetching:h,replay:T,initialTimeOffsetMs:{offsetMs:j},children:(0,x.BX)(k,{"data-test-id":"player-container",children:[(0,x.tZ)(S,{children:(0,x.tZ)(m.Z,{isPreview:!0})}),(0,x.tZ)(C,{children:(0,x.tZ)(i.zx,{icon:(0,x.tZ)(g.JF,{}),priority:"primary",to:O,children:(0,f.t)("Open Replay")})}),(0,x.tZ)(R,{children:(0,x.tZ)(_,{children:(0,f.t)("Replays")})})]})})}w.displayName="ReplayPreview";const k=(0,a.Z)(T.Z,{target:"e7frq835"})("position:relative;margin-bottom:",(0,h.D)(2),";background:",(e=>e.theme.background),";gap:",(0,h.D)(1),";max-height:448px;"),S=(0,a.Z)(T.Z,{target:"e7frq834"})("border:1px solid ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";"),C=(0,a.Z)("div",{target:"e7frq833"})({name:"pw760u",styles:"position:absolute;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:rgba(255, 255, 255, 0.5)"}),R=(0,a.Z)("div",{target:"e7frq832"})("display:flex;align-items:center;position:absolute;top:",(0,h.D)(1),";right:",(0,h.D)(1),";background:",(e=>e.theme.background),";border-radius:2.25rem;padding:",(0,h.D)(.75)," ",(0,h.D)(.75)," ",(0,h.D)(.75)," ",(0,h.D)(1),";box-shadow:",(e=>e.theme.dropShadowLight),";gap:0 ",(0,h.D)(.25),";"),_=(0,a.Z)("div",{target:"e7frq831"})("font-size:",(e=>e.theme.fontSizeSmall),";line-height:0;color:",(e=>e.theme.text),";"),I=(0,a.Z)(c.Z,{target:"e7frq830"})("margin-bottom:",(0,h.D)(2),";"),Z=w},"./app/components/replays/replayContext.tsx":(e,t,r)=>{r.d(t,{z:()=>T,M:()=>x});var a=r("../node_modules/react/index.js"),n=r("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),s=r("../node_modules/@sentry-internal/rrweb/es/rrweb/packages/rrweb/src/replay/index.js"),i=r("../node_modules/@sentry-internal/rrweb/es/rrweb/packages/rrweb/src/types.js"),o=r("./app/stores/configStore.tsx"),l=r("./app/stores/useLegacyStore.tsx"),p=r("./app/utils/analytics.tsx"),c=r("./app/utils/localStorage.tsx");const u="rgba(168, 196, 236, 0.75)",m=new Map;function d(e){let{replayer:t,nodeId:r}=e;if(!m.has(r))return!1;const a=m.get(r);return!(!a||!t.wrapper.contains(a.canvas)||(t.wrapper.removeChild(a.canvas),m.delete(r),0))}var g,f=r("./app/utils/useOrganization.tsx"),h=r("./app/utils/usePrevious.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(e){e.REPLAY_CONFIG="replay-config"}(g||(g={}));const v=(0,a.createContext)({clearAllHighlights:()=>{},currentHoverTime:void 0,currentTime:0,dimensions:{height:0,width:0},fastForwardSpeed:0,highlight:()=>{},initRoot:()=>{},isBuffering:!1,isFetching:!1,isFinished:!1,isPlaying:!1,isSkippingInactive:!0,removeHighlight:()=>{},replay:null,restart:()=>{},setCurrentHoverTime:()=>{},setCurrentTime:()=>{},setSpeed:()=>{},speed:1,togglePlayPause:()=>{},toggleSkipInactive:()=>{}});function b(e){c.Z.setItem(g.REPLAY_CONFIG,JSON.stringify(e))}function T(e){let{children:t,initialTimeOffsetMs:r,isFetching:T,replay:x,value:w={}}=e;const k=(0,l.X)(o.Z),S=(0,f.Z)(),C=x?.getRRWebFrames(),R=(0,a.useRef)(JSON.parse(c.Z.getItem(g.REPLAY_CONFIG)||"{}")),_=(0,n.u)(),I=(0,h.Z)(C),Z=C!==I,D=(0,a.useRef)(null),[N,M]=(0,a.useState)({height:0,width:0}),[j,O]=(0,a.useState)(),[F,P]=(0,a.useState)(!1),[A,E]=(0,a.useState)(-1),[z,B]=(0,a.useState)(R.current.skip??!0),[L,H]=(0,a.useState)(R.current.speed||1),[U,q]=(0,a.useState)(0),[G,W]=(0,a.useState)({target:-1,previous:-1}),$=(0,a.useRef)(void 0),J=(0,a.useRef)(!1),V=D.current?.getCurrentTime()===A,X=e=>{M(e)},Y=e=>{q(e.speed)},K=()=>{q(0)},Q=(0,a.useCallback)((e=>{let{nodeId:t,annotation:r,spotlight:a}=e;const n=D.current;n&&function(e){let{replayer:t,nodeId:r,annotation:a="",color:n,spotlight:s}=e;const{mouseTail:i,wrapper:o}=t,l=t.getMirror().getNode(r);if(!l||!("getBoundingClientRect"in l)||!t.iframe.contentDocument?.body?.contains(l))return null;const{top:p,left:c,width:d,height:g}=l.getBoundingClientRect(),f=n??u,h=i.cloneNode(),y=h.getContext("2d");if(!y)return null;y.fillStyle=f,s?(y.fillRect(0,0,h.width,h.height),y.clearRect(c,p,d,g)):y.fillRect(c,p,d,g),y.beginPath(),y.setLineDash([5,5]),y.moveTo(c,p),y.lineTo(c+d,p),y.lineTo(c+d,p+g),y.lineTo(c,p+g),y.closePath(),y.stroke(),y.font="24px Rubik",y.textAlign="right",y.textBaseline="bottom";const{width:v}=y.measureText(a);g<=40?(y.fillStyle="rgba(30, 30, 30, 0.75)",y.fillRect(c,p+g,v,30),y.fillStyle="white",y.fillText(a,c+v,p+g+30)):(y.fillStyle="rgba(30, 30, 30, 0.75)",y.fillRect(c+d-v,p+g-30,v,30),y.fillStyle="white",y.fillText(a,c+d,p+g)),m.set(r,{canvas:h}),o.insertBefore(h,i)}({replayer:n,nodeId:t,annotation:r,spotlight:a})}),[]),ee=(0,a.useCallback)((()=>{const e=D.current;e&&function(e){let{replayer:t}=e;for(const e of m.keys())d({replayer:t,nodeId:e})}({replayer:e})}),[]),te=(0,a.useCallback)((e=>{let{nodeId:t}=e;const r=D.current;r&&d({replayer:r,nodeId:t})}),[]),re=(0,a.useCallback)((()=>{E(D.current?.getCurrentTime()??-1),P(!1)}),[]),ae=(0,a.useCallback)((()=>D.current?Math.max(D.current.getCurrentTime(),0):0),[]),ne=(0,a.useCallback)((e=>{const t=D.current;if(!t)return;const r=t.config;r&&t.setConfig({skipInactive:!1});const a=D.current?.getMetaData().totalTime,n=e>a?0:e;W({target:n,previous:ae()}),$.current&&window.clearTimeout($.current),r&&t.setConfig({skipInactive:!0}),F?($.current=window.setTimeout((()=>t.play(n)),0),P(!0)):($.current=window.setTimeout((()=>t.pause(n)),0),P(!1))}),[ae,F]),se=(0,a.useCallback)((e=>{ne(e),ee()}),[ne,ee]),ie=(0,a.useCallback)((()=>{if(!J.current&&r&&C&&D.current){const{highlight:e,offsetMs:t}=r;t>0&&ne(t),e&&(Q(e),setTimeout((()=>{ee(),Q(e)}))),J.current=!0}}),[ee,C,Q,r,ne]);(0,a.useEffect)(ee,[ee,F]);const oe=(0,a.useCallback)((e=>{if(void 0===C||null===e||T)return;if(D.current){if(!Z)return;if(0===D.current.iframe.contentDocument?.body.childElementCount)return;for(;e.firstChild;)e.removeChild(e.firstChild)}const t=new s.x(C,{root:e,blockClass:"sentry-block",mouseTail:{duration:750,lineCap:"round",lineWidth:2,strokeStyle:_.purple200},skipInactive:R.current.skip??!0,speed:R.current.speed||1});t.on(i.SA.Resize,X),t.on(i.SA.Finish,re),t.on(i.SA.SkipStart,Y),t.on(i.SA.SkipEnd,K),D.current=t,ie()}),[C,T,_.purple200,re,Z,ie]),le=(0,a.useCallback)((e=>{const t=D.current;R.current={...R.current,speed:e},b(R.current),t&&(F?(t.pause(),t.setConfig({speed:e}),t.play(ae())):t.setConfig({speed:e}),H(e))}),[ae,F]),pe=(0,a.useCallback)((e=>{const t=D.current;t&&(e?t.play(ae()):t.pause(ae()),P(e),(0,p.Gi)("replay.play-pause",{organization:S,user_email:k.user.email,play:e}))}),[ae,k.user.email,S]);(0,a.useEffect)((()=>{const e=()=>{"visible"!==document.visibilityState&&pe(!1)};return D.current&&C&&(oe(D.current.wrapper.parentElement),document.addEventListener("visibilitychange",e)),()=>{document.removeEventListener("visibilitychange",e)}}),[oe,C,pe]);const ce=(0,a.useCallback)((()=>{D.current&&(D.current.play(0),P(!0))}),[]),ue=(0,a.useCallback)((e=>{const t=D.current;R.current={...R.current,skip:e},b(R.current),t&&(e!==t.config.skipInactive&&t.setConfig({skipInactive:e}),B(e))}),[]),me=function(e){const[t,r]=(0,a.useState)(0);return function(e){(0,a.useEffect)((()=>{const t=window.requestAnimationFrame(e);return()=>window.cancelAnimationFrame(t)}),[e])}((()=>r(e))),t}(ae),[de,ge]=-1!==G.target&&G.previous===me&&G.target!==G.previous?[!0,G.target]:[!1,me];return(0,a.useEffect)((()=>{!de&&C&&C.length>=2&&D.current&&ie()}),[de,C,ie]),(0,a.useEffect)((()=>{de||-1===G.target||W({target:-1,previous:-1})}),[de,G.target]),(0,y.tZ)(v.Provider,{value:{clearAllHighlights:ee,currentHoverTime:j,currentTime:ge,dimensions:N,fastForwardSpeed:U,highlight:Q,initRoot:oe,isBuffering:de,isFetching:T,isFinished:V,isPlaying:F,isSkippingInactive:z,removeHighlight:te,replay:x,restart:ce,setCurrentHoverTime:O,setCurrentTime:se,setSpeed:le,speed:L,togglePlayPause:pe,toggleSkipInactive:ue,...w},children:t})}T.displayName="Provider";const x=()=>(0,a.useContext)(v)},"./app/components/replays/utils.tsx":(e,t,r)=>{r.d(t,{DF:()=>c,DR:()=>u,NH:()=>o,UJ:()=>d,Ul:()=>l,cs:()=>g,mr:()=>p}),r("../node_modules/core-js/modules/es.array.push.js");var a=r("./app/utils/formatters.tsx");const n=1e3,s=60*n,i=60*s;function o(e,t){return Math.abs(new Date(e).getTime()-t)}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return p(o(e,t),r)}function p(e,t){if(e<=0||isNaN(e))return t?"00:00.000":"00:00";const r=e/1e3;return(0,a.HE)(t?r:Math.floor(r))}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=Math.floor(t/r);a-=e-a*t>0?1:0;const o=[1*i,30*s,20*s,15*s,10*s,5*s,2*s,1*s,30*n,10*n,5*n,1*n].reduce(((t,r)=>(t.set(r,Math.floor(e/r)),t)),new Map),[l,p]=Array.from(o.entries()).filter((e=>{let[t,r]=e;return r<=a})).reduce(((e,t)=>t[1]>e[1]?t:e),[0,0]);return{timespan:l,cols:p,remaining:(e-l*p)/l}}function u(e,t,r,a){const n=isNaN(t)?1:t;return r.map((t=>{const{timestamp:r}=t,s=+new Date(String(r)),i=isNaN(s)?0:s-e,o=Math.floor(i/n*(a-1))+1;return[Math.max(1,o),t]})).reduce(((e,t)=>{let[r,a]=t;return e.has(r)?e.get(r)?.push(a):e.set(r,[a]),e}),new Map)}function m(e,t){const r=e.startTimestamp<=t.startTimestamp&&t.startTimestamp<=e.endTimestamp,a=e.startTimestamp<=t.endTimestamp&&t.endTimestamp<=e.endTimestamp;return r||a}function d(e){if(!e.length)return[];const[t,...r]=e.map((e=>({frameCount:1,startTimestamp:e.timestampMs,endTimestamp:e.endTimestampMs,duration:e.endTimestampMs-e.timestampMs}))),a=[t];for(const e of r){let t=!1;for(const r of a)if(m(r,e)){t=!0,r.frameCount+=1,r.startTimestamp=Math.min(r.startTimestamp,e.startTimestamp),r.endTimestamp=Math.max(r.endTimestamp,e.endTimestamp),r.duration=r.endTimestamp-r.startTimestamp;break}t||a.push(e)}return a}function g(e,t){return void 0===t||isNaN(t)||0===t?0:e/t}},"./app/utils/date/isValidDate.tsx":(e,t,r)=>{function a(e){return e instanceof Date&&!isNaN(e.getTime())}r.d(t,{Z:()=>a})},"./app/utils/replays/replayDataUtils.tsx":(e,t,r)=>{r.d(t,{so:()=>m,qC:()=>u,iz:()=>g,_O:()=>d});var a=r("../node_modules/invariant/browser.js"),n=r.n(a),s=r("../node_modules/moment/moment.js"),i=r("./app/components/events/interfaces/breadcrumbs/utils.tsx"),o=r("./app/locale.tsx"),l=r("./app/types/breadcrumbs.tsx"),p=r("./app/utils/date/isValidDate.tsx");function c(e){let t=e.length,r=1/0,a=-1/0;for(;t--;)r=e[t]<r?e[t]:r,a=e[t]>a?e[t]:a;return{min:r,max:a}}function u(e){const t=Object.fromEntries(Object.entries(e.user).filter((e=>{let[t,r]=e;return"display_name"!==t&&r})).map((e=>{let[t,r]=e;return[`user.${t}`,[r]]}))),r={...e.tags,...e.browser?.name?{"browser.name":[e.browser.name]}:{},...e.browser?.version?{"browser.version":[e.browser.version]}:{},...e.device?.brand?{"device.brand":[e.device.brand]}:{},...e.device?.family?{"device.family":[e.device.family]}:{},...e.device?.model_id?{"device.model_id":[e.device.model_id]}:{},...e.device?.name?{"device.name":[e.device.name]}:{},...e.platform?{platform:[e.platform]}:{},...e.releases?{releases:[...e.releases]}:{},...e.replay_type?{replayType:[e.replay_type]}:{},...e.os?.name?{"os.name":[e.os.name]}:{},...e.os?.version?{"os.version":[e.os.version]}:{},...e.sdk?.name?{"sdk.name":[e.sdk.name]}:{},...e.sdk?.version?{"sdk.version":[e.sdk.version]}:{},...t},a=Object.keys(r).sort().reduce(((e,t)=>(e[t]=r[t],e)),{}),i=new Date(e.started_at);n()((0,p.Z)(i),"replay.started_at is invalid");const o=new Date(e.finished_at);return n()((0,p.Z)(o),"replay.finished_at is invalid"),{...e,...e.started_at?{started_at:i}:{},...e.finished_at?{finished_at:o}:{},...void 0!==e.duration?{duration:(0,s.duration)(1e3*e.duration)}:{},tags:a}}function m(e,t,r,a){const n=["ui.focus","ui.blur"],s=e.urls?.[0]??e.tags.url?.join(", "),p={type:l.kS.INIT,timestamp:e.started_at.toISOString(),level:l.nU.INFO,message:s,data:{action:"replay-init",label:(0,o.t)("Start recording"),url:s}},c=t.map((e=>({type:l.kS.ERROR,level:l.nU.ERROR,category:"issue",message:e.title,data:{label:e["error.type"].join(""),eventId:e.id,groupId:e["issue.id"]||1,groupShortId:e.issue,project:e["project.name"]},timestamp:e.timestamp}))),u=a.filter((e=>["navigation.navigate","navigation.reload","largest-contentful-paint"].includes(e.op))).sort(((e,t)=>e.startTimestamp-t.startTimestamp)).map((e=>{if(e.op.startsWith("navigation")){const[,t]=e.op.split(".");try{return{category:"default",type:l.kS.NAVIGATION,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:l.nU.INFO,message:e.description,action:t,data:{to:e.description,label:"reload"===t?(0,o.t)("Reload"):"navigate"===t?(0,o.t)("Page load"):(0,o.t)("Navigation"),...e.data}}}catch{return null}}try{return{type:l.kS.DEBUG,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:l.nU.INFO,category:"default",data:{action:e.op,...e.data,label:"largest-contentful-paint"===e.op?(0,o.t)("LCP"):e.op}}}catch{return null}})).filter(Boolean),m=a.find((e=>"navigation.navigate"===e.op)),d=r.filter((e=>!n.includes(e.category||"")&&(!e.category?.startsWith("replay")||"replay.mutations"===e.category)&&("ui.slowClickDetected"!==e.category||e.data?.timeAfterClickMs>=3e3))).map((e=>{if("replay.mutations"===e.category){const t=e.data;try{return{...e,type:t.limit?l.kS.ERROR:l.kS.WARNING,level:t.limit?l.nU.FATAL:l.nU.WARNING,timestamp:new Date(1e3*e.timestamp).toISOString()}}catch{return null}}try{return{...e,type:l.kS.DEFAULT,timestamp:new Date(1e3*e.timestamp).toISOString()}}catch{return null}})).filter(Boolean);return(0,i.LP)([...a.length&&!m?[p]:[],...d,...c,...u]).sort(((e,t)=>+new Date(e.timestamp||0)-+new Date(t.timestamp||0)))}function d(e){return e.sort(((e,t)=>e.startTimestamp-t.startTimestamp)).map((e=>({...e,id:`${e.description??e.op}-${e.startTimestamp}-${e.endTimestamp}`,timestamp:1e3*e.startTimestamp})))}function g(e,t,r,a){const n=t.map((e=>e.timestamp)).filter(Boolean),s=r.map((e=>e.timestamp)).filter(Boolean),i=a.filter((e=>{let{op:t}=e;return"largest-contentful-paint"!==t})),o=i.map((e=>e.startTimestamp)),l=i.map((e=>e.endTimestamp)),{min:p,max:u}=c(n),{min:m,max:d}=c(s),{min:g}=c(o),{max:f}=c(l);return{startTimestampMs:Math.min(e.started_at.getTime(),p,1e3*m,1e3*g),endTimestampMs:Math.max(e.finished_at.getTime(),u,1e3*d,1e3*f)}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_eventReplay_replayPreview_tsx-app_utils_replays_replayDataUtils_tsx.295bf2607b25a3b1f5164edbe2618e41.js.map