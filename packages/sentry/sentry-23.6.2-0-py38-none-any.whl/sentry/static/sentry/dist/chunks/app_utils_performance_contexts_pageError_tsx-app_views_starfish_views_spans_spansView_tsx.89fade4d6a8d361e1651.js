"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_contexts_pageError_tsx-app_views_starfish_views_spans_spansView_tsx"],{"./app/utils/performance/contexts/pageError.tsx":(e,t,a)=>{a.d(t,{De:()=>l,V_:()=>i,YY:()=>p});var s=a("../node_modules/react/index.js"),r=a("./app/components/alert.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const n=(0,s.createContext)({pageError:void 0,setPageError:e=>{}});function i(e){let{children:t}=e;const[a,r]=(0,s.useState)();return(0,o.tZ)(n.Provider,{value:{pageError:a,setPageError:r},children:t})}function p(){const{pageError:e}=(0,s.useContext)(n);return e?(0,o.tZ)(r.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}i.displayName="PageErrorProvider",p.displayName="PageErrorAlert";const l=()=>(0,s.useContext)(n)},"./app/views/starfish/components/chartPanel.tsx":(e,t,a)=>{a.d(t,{Z:()=>i});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(a("../node_modules/react/index.js"),a("./app/components/panels/index.tsx")),o=a("./app/styles/space.tsx"),n=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){let{title:t,children:a,button:s}=e;return(0,n.tZ)(r.s_,{children:(0,n.BX)(r.N,{withPadding:!0,children:[t&&(0,n.BX)(l,{children:[t&&(0,n.tZ)(p,{children:t}),s]}),a]})})}i.displayName="ChartPanel";const p=(0,s.Z)("p",{target:"e1tvnfsq1"})((e=>e.theme.text.cardTitle),";"),l=(0,s.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,o.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/views/spans/spansView.tsx":(e,t,a)=>{a.d(t,{Z:()=>K});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=a("../node_modules/react/index.js"),o=a("../node_modules/lodash/pick.js"),n=a.n(o),i=a("./app/styles/space.tsx"),p=a("./app/utils/discover/eventView.tsx"),l=a("./app/utils/useLocation.tsx"),u=a("./app/views/starfish/components/datePicker.tsx"),d=a("./app/views/starfish/types.tsx"),c=a("./app/views/starfish/views/queryParameters.tsx"),m=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/react-router/es/index.js")),h=a("./app/components/compactSelect/index.tsx"),v=a("./app/locale.tsx"),g=a("./app/utils/discover/types.tsx"),y=a("./app/views/starfish/utils/useSpansQuery.tsx"),f=a("./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx"),x=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function Z(e){let{value:t="",moduleName:a=d.rA.ALL,spanCategory:s}=e;const r=(0,l.T)(),o=function(e,t,a){const s=[];return t&&s.push('!span.action:""'),t===d.rA.DB&&s.push("!span.op:db.redis"),a&&(a===f.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),p.ZP.fromNewQueryWithLocation({name:"",fields:["span.action","count()"],orderby:"-count",query:s.join(" "),dataset:g.as.SPANS_METRICS,version:2},e)}(r,a,s),n=a===d.rA.HTTP,{data:i}=(0,y.bB)({eventView:o,initialData:[],enabled:!n}),u=n?w:[{value:"",label:"All"},...i.map((e=>({value:e["span.action"],label:e["span.action"]})))];return(0,x.tZ)(h.Z,{triggerProps:{prefix:b[a]},value:t,options:u??[],onChange:e=>{m.browserHistory.push({...r,query:{...r.query,"span.action":e.value}})}})}Z.displayName="ActionSelector";const w=[{value:"",label:"All"},...["GET","POST","PUT","DELETE"].map((e=>({value:e,label:e})))],b={http:(0,v.t)("HTTP Method"),db:(0,v.t)("SQL Command"),none:(0,v.t)("Action"),"":(0,v.t)("Action")};function _(e){let{value:t="",moduleName:a=d.rA.ALL,spanCategory:s}=e;const r=(0,l.T)(),o=function(e,t,a){const s=['!span.domain:""'];return t&&s.push(`span.module:${t}`),t===d.rA.DB&&s.push("!span.op:db.redis"),a&&(a===f.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),p.ZP.fromNewQueryWithLocation({name:"",fields:["span.domain","count()"],orderby:"-count",query:s.join(" "),dataset:g.as.SPANS_METRICS,version:2},e)}(r,a,s),{data:n}=(0,y.bB)({eventView:o,initialData:[]}),i=[{value:"",label:"All"},...n.map((e=>({value:e["span.domain"],label:e["span.domain"]})))];return(0,x.tZ)(h.Z,{triggerProps:{prefix:A[a]},value:t,options:i??[],onChange:e=>{m.browserHistory.push({...r,query:{...r.query,"span.domain":e.value}})}})}_.displayName="DomainSelector";const A={http:(0,v.t)("Host"),db:(0,v.t)("Table"),none:(0,v.t)("Domain"),"":(0,v.t)("Domain")};function C(e){let{value:t="",moduleName:a=d.rA.ALL,spanCategory:s}=e;const r=(0,l.T)(),o=function(e,t,a){const s=[];return t&&s.push(`span.module:${t}`),t===d.rA.DB&&s.push("!span.op:db.redis"),a&&(a===f.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),p.ZP.fromNewQueryWithLocation({name:"",fields:["span.op","count()"],orderby:"-count",query:s.join(" "),dataset:g.as.SPANS_METRICS,version:2},e)}(r,a,s),{data:n}=(0,y.bB)({eventView:o,initialData:[]}),i=[{value:"",label:"All"},...n.map((e=>({value:e["span.op"],label:e["span.op"]})))];return(0,x.tZ)(h.Z,{triggerProps:{prefix:(0,v.t)("Operation")},value:t,options:i??[],onChange:e=>{m.browserHistory.push({...r,query:{...r.query,"span.op":e.value}})}})}C.displayName="SpanOperationSelector";var N=a("./app/components/charts/utils.tsx"),T=a("./app/utils/usePageFilters.tsx"),P=a("./app/utils/useRouter.tsx"),S=a("./app/views/starfish/colours.tsx"),L=a("./app/views/starfish/components/chart.tsx"),D=a("./app/views/starfish/components/chartPanel.tsx"),j=a("./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts"),q=a("../node_modules/moment/moment.js");const E=e=>{const t=(0,l.T)(),a=(0,T.Z)(),s={id:void 0,name:"HTTP Module - HTTP error rate",fields:["http_error_count()"],query:e,version:1,topEvents:"5",dataset:g.as.SPANS_METRICS,interval:(0,N.ZS)(a.selection.datetime,"low"),yAxis:["http_error_count()"]},r=p.ZP.fromNewQueryWithLocation(s,t),o=(0,y.bB)({eventView:r,initialData:[]}),n=o?.data?.map((e=>({interval:(0,q.unix)(e.interval).format("YYYY-MM-DDTHH:mm:ss"),"http_error_count()":e["http_error_count()"]})));return{...o,formattedData:n}};var k=a("./app/views/starfish/views/spans/types.tsx");const{SPAN_SELF_TIME:B}=d.SpanMetricsFields;function O(e){let{moduleName:t,appliedFilters:a,spanCategory:s}=e;const{selection:r}=(0,T.Z)(),o=(0,l.T)(),n=M(t,o,r,a,s),{isLoading:i}=(0,y.bB)({eventView:n,initialData:[]});(0,L.K4)([!i]);const p={[d.rA.ALL]:[{title:k.F.throughput,Comp:F},{title:k.F.p95,Comp:V}],[d.rA.DB]:[],[d.rA.HTTP]:[{title:k.F.errorCount,Comp:$}],[d.rA.NONE]:[]},u=[...p[d.rA.ALL]];return t!==d.rA.ALL&&u.push(...p[t]),(0,x.tZ)(I,{children:u.map((e=>{let{title:s,Comp:r}=e;return(0,x.tZ)(Y,{children:(0,x.tZ)(D.Z,{title:s,children:(0,x.tZ)(r,{moduleName:t,filters:a})})},s)}))})}function F(e){let{moduleName:t,filters:a}=e;const s=(0,T.Z)(),r=(0,l.T)(),o=M(t,r,s.selection,a),n=function(e){return e===d.rA.DB?"Queries":"Requests"}(t),{isLoading:i,data:p}=(0,y.bB)({eventView:o,initialData:[]}),u={[n]:p},c=Object.keys(u).map((e=>({seriesName:n??"Throughput",data:u[e].map((e=>({value:e["sps()"],name:e.interval})))})));return(0,x.tZ)(L.ZP,{statsPeriod:"24h",height:100,data:c,start:"",end:"",loading:i,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,aggregateOutputFormat:"rate",stacked:!0,isLineChart:!0,chartColors:[S.SQ],tooltipFormatterOptions:{valueFormatter:e=>(0,j.Z)(e)},onDataZoom:R("-sps()")})}function V(e){let{moduleName:t,filters:a}=e;const s=(0,T.Z)(),r=(0,l.T)(),o=M(t,r,s.selection,a),n=`p95(${B})`,{isLoading:i,data:p}=(0,y.bB)({eventView:o,initialData:[]}),u={[n]:p},d=Object.keys(u).map((e=>({seriesName:n,data:u[e].map((e=>({value:e[`p95(${B})`],name:e.interval})))})));return(0,x.tZ)(L.ZP,{statsPeriod:"24h",height:100,data:[...d],start:"",end:"",loading:i,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[S.Tn],onDataZoom:R("-p95(span.self_time)")})}function $(e){let{moduleName:t,filters:a}=e;const s=Q(t,a),{isLoading:r,data:o}=E(s),n={seriesName:k.F.errorCount,data:o?.length?o?.map((e=>({name:e.interval,value:e["http_error_count()"]}))):[]};return(0,x.tZ)(L.ZP,{statsPeriod:"24h",height:100,data:[n],start:"",end:"",loading:r,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[S.eO],onDataZoom:R("-http_error_count()")})}O.displayName="SpanTimeCharts",F.displayName="ThroughputChart",V.displayName="DurationChart",$.displayName="ErrorChart";const H=["span_operation","domain","action"],M=(e,t,a,s,r)=>{const o=Q(e,s,r);return p.ZP.fromNewQueryWithLocation({name:"",fields:[""],yAxis:["sps()",`p50(${B})`,`p95(${B})`],query:o,dataset:g.as.SPANS_METRICS,interval:(0,N.ZS)(a.datetime,"low"),version:2},t)},Q=(e,t,a)=>{const s=Object.keys(t).filter((e=>H.includes(e))).filter((e=>Boolean(t[e]))).map((e=>`${e}:${t[e]}`));return e!==d.rA.ALL&&s.push(`span.module:${e}`),e===d.rA.DB&&s.push("!span.op:db.redis"),a&&(a===f.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),s.join(" ")};function R(e){const t=(0,P.Z)(),a=(0,l.T)();return(s,r)=>{Array.from(document.querySelectorAll(":hover")).find((e=>e.classList.contains("echarts-for-react")))===document.querySelector(`[_echarts_instance_="${r.id}"]`)&&t.replace({pathname:a.pathname,query:{...a.query,spansSort:e}})}}const I=(0,s.Z)("div",{target:"e1evs38o1"})("display:flex;flex-direction:row;flex-wrap:wrap;gap:",(0,i.D)(2),";"),Y=(0,s.Z)("div",{target:"e1evs38o0"})({name:"82a6rk",styles:"flex:1"});var W=a("./app/views/starfish/views/spans/spansTable.tsx");const X={kind:"desc",field:"time_spent_percentage()"},G=25;function K(e){const t=(0,l.T)(),a=n()(t.query,["span.action","span.domain","span.op","span.group"]),s=(0,p.vp)(t.query[c.o.SORT]).filter(W.ki)[0]??X;return(0,x.BX)(r.Fragment,{children:[(0,x.tZ)(z,{children:(0,x.tZ)(u.Z,{})}),(0,x.tZ)(U,{children:(0,x.tZ)(O,{moduleName:e.moduleName||d.rA.ALL,appliedFilters:a,spanCategory:e.spanCategory})}),(0,x.BX)(z,{children:[(0,x.tZ)(C,{moduleName:e.moduleName,value:a["span.op"]||"",spanCategory:e.spanCategory}),(0,x.tZ)(Z,{moduleName:e.moduleName,value:a["span.action"]||"",spanCategory:e.spanCategory}),(0,x.tZ)(_,{moduleName:e.moduleName,value:a["span.domain"]||"",spanCategory:e.spanCategory})]}),(0,x.tZ)(U,{children:(0,x.tZ)(W.ZP,{moduleName:e.moduleName||d.rA.ALL,spanCategory:e.spanCategory,sort:s,limit:G})})]})}K.displayName="SpansView";const U=(0,s.Z)("div",{target:"e1ojq8vq1"})("margin:0 ",(0,i.D)(2),";"),z=(0,s.Z)(U,{target:"e1ojq8vq0"})("display:flex;flex-direction:row;gap:",(0,i.D)(1),";margin-bottom:",(0,i.D)(2),";")}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_contexts_pageError_tsx-app_views_starfish_views_spans_spansView_tsx.f683b2ab7ff1a3408083b4c54719f7ee.js.map