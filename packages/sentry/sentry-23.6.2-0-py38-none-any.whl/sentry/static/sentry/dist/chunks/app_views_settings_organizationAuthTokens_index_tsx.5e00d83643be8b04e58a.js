"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationAuthTokens_index_tsx"],{"./app/views/settings/organizationAuthTokens/index.tsx":(t,e,n)=>{n.r(e),n.d(e,{OrganizationAuthTokensIndex:()=>q,default:()=>P,makeFetchOrgAuthTokensForOrgQueryKey:()=>N,tokenPreview:()=>D});var o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),a=n("./app/actionCreators/indicator.tsx"),i=n("./app/components/acl/access.tsx"),r=n("./app/components/button.tsx"),d=n("./app/components/links/externalLink.tsx"),l=n("./app/components/loadingError.tsx"),c=n("./app/components/panels/index.tsx"),p=n("./app/components/sentryDocumentTitle.tsx"),g=n("./app/locale.tsx"),u=n("./app/utils/handleXhrErrorResponse.tsx"),h=n("./app/utils/queryClient.tsx"),m=n("./app/utils/useApi.tsx"),k=n("./app/utils/withOrganization.tsx"),Z=n("./app/views/settings/components/settingsPageHeader.tsx"),x=n("./app/views/settings/components/text/textBlock.tsx"),y=n("./app/components/confirm.tsx"),v=n("./app/components/links/link.tsx"),f=n("./app/components/loadingIndicator.tsx"),j=n("./app/components/placeholder.tsx"),w=n("./app/components/timeSince.tsx"),z=n("./app/components/tooltip.tsx"),L=n("./app/icons/index.tsx"),b=n("./app/styles/space.tsx"),T=n("./app/utils/getDynamicText.tsx"),A=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function $(t){let{organization:e,dateLastUsed:n,projectLastUsed:o}=t;return n&&o?(0,A.tZ)(s.Fragment,{children:(0,g._N)("[date] in project [project]",{date:(0,A.tZ)(w.Z,{date:(0,T.Z)({value:n,fixed:new Date(150820808e4)})}),project:(0,A.tZ)(v.Z,{to:`/settings/${e.slug}/${o.slug}/`,children:o.name})})}):n?(0,A.tZ)(s.Fragment,{children:(0,A.tZ)(w.Z,{date:(0,T.Z)({value:n,fixed:new Date(150820808e4)})})}):o?(0,A.tZ)(s.Fragment,{children:(0,g._N)("in project [project]",{project:(0,A.tZ)(v.Z,{to:`/settings/${e.slug}/${o.slug}/`,children:o.name})})}):(0,A.tZ)(E,{children:(0,g.t)("never used")})}function F(t){let{organization:e,isRevoking:n,token:o,revokeToken:a,projectLastUsed:i,isProjectLoading:d}=t;return(0,A.BX)(s.Fragment,{children:[(0,A.BX)("div",{children:[(0,A.tZ)(_,{children:(0,A.tZ)(v.Z,{to:`/settings/${e.slug}/auth-tokens/${o.id}/`,children:o.name})}),o.tokenLastCharacters&&(0,A.tZ)(I,{"aria-label":(0,g.t)("Token preview"),children:D((0,T.Z)({value:o.tokenLastCharacters,fixed:"ABCD"}))})]}),(0,A.tZ)(C,{children:d?(0,A.tZ)(j.Z,{height:"1.25em"}):(0,A.tZ)($,{dateLastUsed:o.dateLastUsed,projectLastUsed:i,organization:e})}),(0,A.tZ)(U,{children:(0,A.tZ)(z.u,{title:(0,g.t)("You must be an organization owner, manager or admin to revoke a token."),disabled:!!a,children:(0,A.tZ)(y.Z,{disabled:!a||n,onConfirm:a?()=>a(o):void 0,message:(0,g.t)("Are you sure you want to revoke this token? The token will not be usable anymore, and this cannot be undone."),children:(0,A.tZ)(r.zx,{size:"sm",disabled:n||!a,"aria-label":(0,g.t)("Revoke %s",o.name),icon:n?(0,A.tZ)(f.Z,{mini:!0}):(0,A.tZ)(L.JZ,{isCircled:!0,size:"xs"}),children:(0,g.t)("Revoke")})})})})]})}$.displayName="LastUsed",F.displayName="OrganizationAuthTokensAuthTokenRow";const _=(0,o.Z)("div",{target:"ejq8tdr4"})(""),U=(0,o.Z)("div",{target:"ejq8tdr3"})({name:"skgbeu",styles:"display:flex;justify-content:flex-end"}),C=(0,o.Z)("div",{target:"ejq8tdr2"})("display:flex;align-items:center;gap:",(0,b.D)(.5),";"),E=(0,o.Z)("div",{target:"ejq8tdr1"})("color:",(t=>t.theme.gray300),";"),I=(0,o.Z)("div",{target:"ejq8tdr0"})("color:",(t=>t.theme.gray300),";"),N=t=>{let{orgSlug:e}=t;return[`/organizations/${e}/org-auth-tokens/`]};function R(t){let{organization:e,tokenList:n,isRevoking:o,revokeToken:a}=t;const i=`/organizations/${e.slug}/projects/`,r=n.map((t=>t.projectLastUsedId)).filter((t=>!!t)),d=r.map((t=>`id:${t}`)).join(" "),l=r.length>0,{data:c,isLoading:p}=(0,h.WE)([i,{query:{query:d}}],{staleTime:0,enabled:l});return(0,A.tZ)(s.Fragment,{children:n.map((t=>{const n=t.projectLastUsedId?c?.find((e=>e.id===t.projectLastUsedId)):void 0;return(0,A.tZ)(F,{organization:e,token:t,isRevoking:o,revokeToken:a?()=>a({token:t}):void 0,projectLastUsed:n,isProjectLoading:l&&p},t.id)}))})}function q(t){let{organization:e}=t;const n=(0,m.Z)(),o=(0,h.NL)(),{isLoading:c,isError:k,data:y,refetch:v}=(0,h.WE)(N({orgSlug:e.slug}),{staleTime:1/0}),{mutate:f,isLoading:j}=(0,h.Db)({mutationFn:t=>{let{token:o}=t;return n.requestPromise(`/organizations/${e.slug}/org-auth-tokens/${o.id}/`,{method:"DELETE"})},onSuccess:(t,n)=>{let{token:s}=n;(0,a.S9)((0,g.t)("Revoked auth token for the organization.")),(0,h.XN)(o,N({orgSlug:e.slug}),(t=>Array.isArray(t)?t.filter((t=>t.id!==s.id)):t))},onError:t=>{const e=(0,g.t)("Failed to revoke the auth token for the organization.");(0,u.X)(e,t),(0,a.Iw)(e)}}),w=(0,A.tZ)(r.zx,{priority:"primary",size:"sm",to:`/settings/${e.slug}/auth-tokens/new-token/`,"data-test-id":"create-token",children:(0,g.t)("Create New Token")});return(0,A.tZ)(i.Z,{access:["org:write"],children:t=>{let{hasAccess:n}=t;return(0,A.BX)(s.Fragment,{children:[(0,A.tZ)(p.Z,{title:(0,g.t)("Auth Tokens")}),(0,A.tZ)(Z.Z,{title:(0,g.t)("Auth Tokens"),action:w}),(0,A.tZ)(x.Z,{children:(0,g.t)("Authentication tokens allow you to perform actions against the Sentry API on behalf of your organization. They're the easiest way to get started using the API.")}),(0,A.tZ)(x.Z,{children:(0,g._N)("For more information on how to use the web API, see our [link:documentation].",{link:(0,A.tZ)(d.Z,{href:"https://docs.sentry.io/api/"})})}),(0,A.tZ)(S,{isLoading:c||k,isEmpty:!c&&!y?.length,loader:k?(0,A.tZ)(l.Z,{message:(0,g.t)("Failed to load auth tokens for the organization."),onRetry:v}):void 0,emptyMessage:(0,g.t)("You haven't created any authentication tokens yet."),headers:[(0,g.t)("Auth token"),(0,g.t)("Last access"),""],children:!k&&!c&&!!y?.length&&(0,A.tZ)(R,{organization:e,tokenList:y,isRevoking:j,revokeToken:n?f:void 0})})]})}})}function D(t){return`sntrys_************${t}`}R.displayName="TokenList",q.displayName="OrganizationAuthTokensIndex";const P=(0,k.Z)(q),S=(0,o.Z)(c.KB,{target:"e1vbcwy0"})("@media (max-width: ",(t=>t.theme.breakpoints.small),"){grid-template-columns:1fr 1fr;>*:nth-child(3n + 2){display:none;}}")}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationAuthTokens_index_tsx.491cd611927e135fb4333ac3aa4b2491.js.map