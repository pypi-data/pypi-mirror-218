"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_avatarChooser_tsx-app_components_forms_jsonForm_tsx"],{"./app/components/avatarChooser.tsx":(e,t,s)=>{s.d(t,{Z:()=>W});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),r=s("./app/actionCreators/indicator.tsx"),n=s("./app/components/avatar/index.tsx");const l=(0,a.Z)("div",{target:"e1wagsbt0"})("border:1px solid ",(e=>e.theme.border),";box-shadow:none;background:",(e=>e.theme.backgroundSecondary),";padding:",(e=>e.hasImage?"80px 30px":"15px 20px"),";margin-bottom:20px;border-radius:3px;",(e=>e.centered&&"text-align: center"),";");var p=s("./app/constants/index.tsx"),d=s("./app/locale.tsx"),c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h=256,u=1024;function m(e,t){return(e-2*e+(t-2*t))/2}function g(e,t){return(e-2*e+t)/2}function f(e,t){return(e+(t-2*t))/2}function v(e,t){return(e+t)/2}const x={nw:["top","left"],ne:["top","right"],se:["bottom","right"],sw:["bottom","left"]};class b extends o.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{file:null,objectURL:null,mousePosition:{pageX:0,pageY:0},resizeDimensions:{top:0,left:0,size:0},resizeDirection:null}),(0,i.Z)(this,"file",(0,o.createRef)()),(0,i.Z)(this,"canvas",(0,o.createRef)()),(0,i.Z)(this,"image",(0,o.createRef)()),(0,i.Z)(this,"cropContainer",(0,o.createRef)()),(0,i.Z)(this,"onSelectFile",(e=>{const t=e.target.files?.[0];if(!t)return;if(!/^image\//.test(t.type))return void(0,r.Iw)((0,d.t)("That is not a supported file type."));this.revokeObjectUrl();const{updateDataUrlState:s}=this.props,i=window.URL.createObjectURL(t);this.setState({file:t,objectURL:i},(()=>s({savedDataUrl:null})))})),(0,i.Z)(this,"revokeObjectUrl",(()=>this.state.objectURL&&window.URL.revokeObjectURL(this.state.objectURL))),(0,i.Z)(this,"onImageLoad",(()=>{const e=this.validateImage();if(e)return this.revokeObjectUrl(),this.setState({objectURL:null}),void(0,r.Iw)(e);const t=this.image.current;if(!t)return;const s={resizeDimensions:{size:Math.min(t.clientHeight,t.clientWidth),top:0,left:0}};this.setState(s,this.drawToCanvas)})),(0,i.Z)(this,"updateDimensions",(e=>{const t=this.cropContainer.current;if(!t)return;const{mousePosition:s,resizeDimensions:i}=this.state;let a=e.pageY,o=e.pageX,r=i.top+(a-s.pageY),n=i.left+(o-s.pageX);r<0?(r=0,a=s.pageY):r+i.size>t.clientHeight&&(r=t.clientHeight-i.size,a=s.pageY),n<0?(n=0,o=s.pageX):n+i.size>t.clientWidth&&(n=t.clientWidth-i.size,o=s.pageX),this.setState((e=>({resizeDimensions:{...e.resizeDimensions,top:r,left:n},mousePosition:{pageX:o,pageY:a}})))})),(0,i.Z)(this,"onMouseDown",(e=>{e.preventDefault(),this.setState({mousePosition:{pageY:e.pageY,pageX:e.pageX}}),document.addEventListener("mousemove",this.updateDimensions),document.addEventListener("mouseup",this.onMouseUp)})),(0,i.Z)(this,"onMouseUp",(e=>{e.preventDefault(),document.removeEventListener("mousemove",this.updateDimensions),document.removeEventListener("mouseup",this.onMouseUp),this.drawToCanvas()})),(0,i.Z)(this,"startResize",((e,t)=>{t.stopPropagation(),t.preventDefault(),document.addEventListener("mousemove",this.updateSize),document.addEventListener("mouseup",this.stopResize),this.setState({resizeDirection:e,mousePosition:{pageY:t.pageY,pageX:t.pageX}})})),(0,i.Z)(this,"stopResize",(e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("mousemove",this.updateSize),document.removeEventListener("mouseup",this.stopResize),this.setState({resizeDirection:null}),this.drawToCanvas()})),(0,i.Z)(this,"updateSize",(e=>{const t=this.cropContainer.current;if(!t)return;const{mousePosition:s}=this.state,i=e.pageY-s.pageY,a=e.pageX-s.pageX;this.setState({resizeDimensions:this.getNewDimensions(t,i,a),mousePosition:{pageX:e.pageX,pageY:e.pageY}})})),(0,i.Z)(this,"getNewDimensions",((e,t,s)=>{const{resizeDimensions:i,resizeDirection:a}=this.state,o={getDiffNE:g,getDiffNW:m,getDiffSE:v,getDiffSW:f}["getDiff"+a.toUpperCase()](t,s);let r=e.clientHeight-i.top,n=e.clientWidth-i.left;const l="nw"===a||"ne"===a,p="nw"===a||"sw"===a,d={top:i.top,left:i.left,size:i.size+o};l&&(d.top=i.top-o,r=e.clientHeight-d.top),p&&(d.left=i.left-o,n=e.clientWidth-d.left),d.top<0&&(d.size=d.size+d.top,p&&(d.left=d.left-d.top),d.top=0),d.left<0&&(d.size=d.size+d.left,l&&(d.top=d.top-d.left),d.left=0);const c=Math.min(n,r);return d.size>c?(l&&(d.top=d.top+d.size-c),p&&(d.left=d.left+d.size-c),d.size=c):d.size<h&&(l&&(d.top=d.top+d.size-h),p&&(d.left=d.left+d.size-h),d.size=h),{...i,...d}})),(0,i.Z)(this,"uploadClick",(e=>{e.preventDefault(),this.file.current&&this.file.current.click()}))}componentWillUnmount(){this.revokeObjectUrl()}validateImage(){const e=this.image.current;return e?e.naturalWidth<h||e.naturalHeight<h?(0,d._N)("Please upload an image larger than [size]px by [size]px.",{size:255}):e.naturalWidth>u||e.naturalHeight>u?(0,d._N)("Please upload an image smaller than [size]px by [size]px.",{size:u}):null:null}drawToCanvas(){const e=this.canvas.current;if(!e)return;const t=this.image.current;if(!t)return;const{left:s,top:i,size:a}=this.state.resizeDimensions,o=(t.naturalHeight/t.clientHeight+t.naturalWidth/t.clientWidth)/2;e.width=a*o,e.height=a*o,e.getContext("2d").drawImage(t,s*o,i*o,a*o,a*o,0,0,a*o,a*o),this.props.updateDataUrlState({dataUrl:e.toDataURL()})}get imageSrc(){const{savedDataUrl:e,model:t,type:s}=this.props,i=t.avatar?.avatarUuid,a=i&&`/${p.f6[s]||"avatar"}/${i}/`;return e||this.state.objectURL||a}renderImageCrop(){const e=this.imageSrc;if(!e)return null;const{resizeDimensions:t,resizeDirection:s}=this.state,i={top:t.top,left:t.left,width:t.size,height:t.size};return(0,c.tZ)(Z,{resizeDirection:s,children:(0,c.BX)(z,{ref:this.cropContainer,children:[(0,c.tZ)("img",{ref:this.image,src:e,onLoad:this.onImageLoad,onDragStart:e=>e.preventDefault()}),(0,c.tZ)(D,{style:i,onMouseDown:this.onMouseDown,children:Object.keys(x).map((e=>(0,c.tZ)(w,{position:e,onMouseDown:this.startResize.bind(this,e)},e)))})]})})}render(){const e=this.imageSrc,t=(0,c.tZ)("a",{onClick:this.uploadClick}),s=(0,c.tZ)(l,{hasImage:!0,centered:!0,children:(0,c.tZ)("p",{children:(0,d._N)("[upload:Upload an image] to get started.",{upload:t})})});return(0,c.BX)(o.Fragment,{children:[!e&&s,e&&(0,c.tZ)(U,{ref:this.canvas}),this.renderImageCrop(),(0,c.BX)("div",{className:"form-group",children:[e&&(0,c.tZ)("a",{onClick:this.uploadClick,children:(0,d.t)("Change Photo")}),(0,c.tZ)(y,{ref:this.file,type:"file",accept:"image/gif,image/jpeg,image/png",onChange:this.onSelectFile})]})]})}}b.displayName="AvatarUploader";const y=(0,a.Z)("input",{target:"e11xh6zl5"})({name:"1trwphv",styles:"position:absolute;opacity:0"}),Z=(0,a.Z)("div",{target:"e11xh6zl4"})("cursor:",(e=>e.resizeDirection?`${e.resizeDirection}-resize`:"default"),";text-align:center;margin-bottom:20px;background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0px;background-color:",(e=>e.theme.background),";background-image:linear-gradient(\n      45deg,\n      ",(e=>e.theme.backgroundSecondary)," 25%,\n      rgba(0, 0, 0, 0) 25%\n    ),linear-gradient(-45deg, ",(e=>e.theme.backgroundSecondary)," 25%, rgba(0, 0, 0, 0) 25%),linear-gradient(45deg, rgba(0, 0, 0, 0) 75%, ",(e=>e.theme.backgroundSecondary)," 75%),linear-gradient(-45deg, rgba(0, 0, 0, 0) 75%, ",(e=>e.theme.backgroundSecondary)," 75%);"),z=(0,a.Z)("div",{target:"e11xh6zl3"})({name:"nycxdm",styles:"display:inline-block;position:relative;max-width:100%"}),D=(0,a.Z)("div",{target:"e11xh6zl2"})("position:absolute;border:2px dashed ",(e=>e.theme.gray300),";"),w=(0,a.Z)("div",{target:"e11xh6zl1"})("border-radius:5px;width:10px;height:10px;position:absolute;background-color:",(e=>e.theme.gray300),";cursor:",(e=>`${e.position}-resize`),";",(e=>x[e.position].map((e=>`${e}: -5px;`))),";"),U=(0,a.Z)("canvas",{target:"e11xh6zl0"})({name:"eivff4",styles:"display:none"});var S=s("./app/components/button.tsx"),C=s("./app/components/forms/controls/radioGroup.tsx"),j=s("./app/components/links/externalLink.tsx"),k=s("./app/components/loadingError.tsx"),_=s("./app/components/loadingIndicator.tsx"),P=s("./app/components/panels/index.tsx"),X=s("./app/styles/space.tsx"),L=s("./app/utils/withApi.tsx");class R extends o.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{model:this.props.model,savedDataUrl:null,dataUrl:null,hasError:!1}),(0,i.Z)(this,"handleSaveSettings",(e=>{const{endpoint:t,api:s,type:i}=this.props,{model:a,dataUrl:o}=this.state;e.preventDefault();const r=a?.avatar?.avatarType,n=o?.split(",")[1],l={avatar_type:r};"upload"===r&&(l.avatar_photo=n),i?.startsWith("sentryApp")&&(l.color="sentryAppColor"===i),s.request(t,{method:"PUT",data:l,success:e=>{this.setState({savedDataUrl:this.state.dataUrl}),this.handleSuccess(this.getModelFromResponse(e))},error:e=>{const t=e?.responseJSON?.avatar_photo||[];t.length?t.map(this.handleError):this.handleError.bind(this,(0,d.t)("There was an error saving your preferences."))}})})),(0,i.Z)(this,"handleChange",(e=>this.setState((t=>({model:{...t.model,avatar:{avatarUuid:t.model.avatar?.avatarUuid??"",avatarType:e}}})))))}componentDidUpdate(e){const{model:t}=this.props;void 0!==t&&t!==e.model&&this.setState({model:t})}getModelFromResponse(e){const{type:t}=this.props,s=t?.startsWith("sentryApp");if(!s)return e;const i="sentryAppColor"===t;return{avatar:e?.avatars?.find((e=>{let{color:t}=e;return t===i}))??void 0}}handleError(e){(0,r.Iw)(e)}handleSuccess(e){const{onSave:t}=this.props;this.setState({model:e}),t(e),(0,r.S9)((0,d.t)("Successfully saved avatar preferences"))}render(){const{allowGravatar:e,allowUpload:t,allowLetter:s,savedDataUrl:i,type:a,isUser:o,disabled:r,title:p,help:h,defaultChoice:u}=this.props,{hasError:m,model:g,dataUrl:f}=this.state;if(m)return(0,c.tZ)(k.Z,{});if(!g)return(0,c.tZ)(_.Z,{});const{allowDefault:v,preview:x,choiceText:y}=u||{},Z=g.avatar?.avatarType??"letter_avatar",z="letter_avatar"===Z,D=Boolean(x&&"default"===Z),w="team"===a,U="organization"===a,X=a?.startsWith("sentryApp"),L=[];return v&&x&&L.push(["default",y??(0,d.t)("Use default avatar")]),s&&L.push(["letter_avatar",(0,d.t)("Use initials")]),t&&L.push(["upload",(0,d.t)("Upload an image")]),e&&L.push(["gravatar",(0,d.t)("Use Gravatar")]),(0,c.BX)(P.s_,{children:[(0,c.tZ)(P.V9,{children:p||(0,d.t)("Avatar")}),(0,c.tZ)(P.N,{children:(0,c.BX)(E,{children:[(0,c.BX)(T,{inline:z||D,children:[(0,c.tZ)(C.Z,{style:{flex:1},choices:L,value:Z,label:(0,d.t)("Avatar Type"),onChange:this.handleChange,disabled:r}),z&&(0,c.tZ)(n.Z,{gravatar:!1,style:{width:90,height:90},user:o?g:void 0,organization:U?g:void 0,team:w?g:void 0,sentryApp:X?g:void 0}),D&&x]}),(0,c.BX)(N,{children:[e&&"gravatar"===Z&&(0,c.BX)(l,{children:[(0,d.t)("Gravatars are managed through "),(0,c.tZ)(j.Z,{href:"http://gravatar.com",children:"Gravatar.com"})]}),g.avatar&&"upload"===Z&&(0,c.tZ)(b,{...this.props,type:a,model:g,savedDataUrl:i,updateDataUrlState:e=>this.setState(e)}),(0,c.BX)(H,{className:"form-actions",children:[h&&(0,c.tZ)(F,{children:h}),(0,c.tZ)(S.zx,{priority:"primary",onClick:this.handleSaveSettings,disabled:r||"upload"===Z&&!f,children:(0,d.t)("Save Avatar")})]})]})]})})]})}}R.displayName="AvatarChooser",(0,i.Z)(R,"defaultProps",{allowGravatar:!0,allowLetter:!0,allowUpload:!0,type:"user",onSave:()=>{},defaultChoice:{allowDefault:!1}});const F=(0,a.Z)("p",{target:"e7s5np24"})("margin-right:auto;color:",(e=>e.theme.gray300),";font-size:14px;width:50%;"),T=(0,a.Z)("div",{target:"e7s5np23"})("display:flex;flex-direction:",(e=>e.inline?"row":"column"),";"),E=(0,a.Z)("div",{target:"e7s5np22"})("line-height:",(0,X.D)(3),";padding:",(0,X.D)(1.5)," ",(0,X.D)(2),";margin:",(0,X.D)(1.5)," ",(0,X.D)(1)," ",(0,X.D)(.5),";"),H=(0,a.Z)("fieldset",{target:"e7s5np21"})("display:flex;align-items:center;margin-top:",(0,X.D)(4),";padding-top:",(0,X.D)(1.5),";"),N=(0,a.Z)("div",{target:"e7s5np20"})("margin-top:",(0,X.D)(1.5),";"),W=(0,L.Z)(R)},"./app/components/forms/formPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("../node_modules/react/index.js"),o=s("./app/components/forms/fieldFromConfig.tsx"),r=s("./app/components/panels/index.tsx"),n=s("./app/icons/index.tsx"),l=s("./app/utils/sanitizeQuerySelector.tsx"),p=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{additionalFieldProps:t={},title:s,fields:i,access:d,disabled:c,renderFooter:u,renderHeader:m,collapsible:g,initiallyCollapsed:f=!1,...v}=e;const[x,b]=(0,a.useState)(f),y=(0,a.useCallback)((()=>b((e=>!e))),[]);return(0,p.BX)(r.s_,{id:"string"==typeof s?(0,l.m)(s):void 0,children:[s&&(0,p.BX)(r.V9,{children:[s,g&&(0,p.tZ)(h,{onClick:y,children:(0,p.tZ)(n.g6,{"data-test-id":"form-panel-collapse-chevron",direction:x?"down":"up",size:"xs"})})]}),(0,p.BX)(r.N,{hidden:x,children:["function"==typeof m&&m({title:s,fields:i}),i.map((e=>{if("function"==typeof e)return e();const{defaultValue:s,...i}=e;return!0===c&&(i.disabled=!0,i.disabledReason=void 0),(0,p.tZ)(o.Z,{access:d,disabled:c,...v,...t,field:i,highlighted:v.highlighted===`#${e.name}`},e.name)})),"function"==typeof u&&u({title:s,fields:i})]})]})}d.displayName="FormPanel";const c=d,h=(0,i.Z)("span",{target:"eovlw60"})({name:"e0dnmk",styles:"cursor:pointer"})},"./app/components/forms/jsonForm.tsx":(e,t,s)=>{s.d(t,{Z:()=>m});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/react/index.js"),o=s("../node_modules/@sentry/core/esm/exports.js"),r=s("../node_modules/scroll-to-element/index.js"),n=s.n(r),l=s("./app/utils.tsx"),p=s("./app/utils/sanitizeQuerySelector.tsx"),d=s("./app/utils/withSentryRouter.tsx"),c=s("./app/components/forms/formPanel.tsx"),h=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{highlighted:this.props.location?.hash})}componentDidMount(){this.scrollToHash()}componentDidUpdate(e){if(this.props.location&&this.props.location.hash!==e.location.hash){const e=this.props.location.hash;this.scrollToHash(e),this.setState({highlighted:e})}}scrollToHash(e){const t=e||this.props.location?.hash;if(t)try{n()((0,p.m)(decodeURIComponent(t)),{align:"middle",offset:-100})}catch(e){o.Tb(e)}}shouldDisplayForm(e){const t=e.filter((e=>"function"!=typeof e&&(0,l.ri)(e?.visible)));if(e.length===t.length){const{additionalFieldProps:e,...s}=this.props;return!t.every((t=>"function"==typeof t.visible?!t.visible({...s,...e}):!t.visible))}return!0}renderForm(e){let{fields:t,formPanelProps:s,title:i}=e;return this.shouldDisplayForm(t)||s?.renderFooter||s?.renderHeader?(0,h.tZ)(c.Z,{title:i,fields:t,...s}):null}render(){const{access:e,collapsible:t,initiallyCollapsed:s,fields:i,title:o,forms:r,disabled:n,features:l,additionalFieldProps:p,renderFooter:d,renderHeader:c,location:u,params:m,router:g,routes:f,...v}=this.props,x={access:e,disabled:n,features:l,additionalFieldProps:p,renderFooter:d,renderHeader:c,highlighted:this.state.highlighted,collapsible:t,initiallyCollapsed:s};return(0,h.BX)("div",{...v,children:[void 0!==r&&r.map(((e,t)=>(0,h.tZ)(a.Fragment,{children:this.renderForm({formPanelProps:x,...e})},t))),void 0===r&&void 0!==i&&this.renderForm({fields:i,formPanelProps:x,title:o})]})}}u.displayName="JsonForm";const m=(0,d.Z)(u)}}]);
//# sourceMappingURL=../sourcemaps/app_components_avatarChooser_tsx-app_components_forms_jsonForm_tsx.32220f83935f748b2dab080b3357ced0.js.map