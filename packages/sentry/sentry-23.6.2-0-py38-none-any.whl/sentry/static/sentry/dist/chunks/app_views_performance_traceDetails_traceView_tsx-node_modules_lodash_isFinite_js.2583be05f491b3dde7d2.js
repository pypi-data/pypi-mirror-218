(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_traceDetails_traceView_tsx-node_modules_lodash_isFinite_js"],{"./app/utils/discover/discoverQuery.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>l,_:()=>o});var n=r("./app/utils/discover/genericDiscoverQuery.tsx"),s=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function a(e){return(0,s.tZ)(n.ZP,{route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:r,...n}=e.meta??{};return{...e,meta:{...r,...n}}},...e})}function o(e){const t=(0,n.JC)({route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:r,...n}=e.meta??{};return{...e,meta:{...r,...n}}},...e}),r=t.response?.getResponseHeader("Link")??void 0;return{...t,pageLinks:r}}a.displayName="DiscoverQuery";const l=a},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{"use strict";r.d(t,{AA:()=>w,JC:()=>Z,ZP:()=>y,o:()=>h});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),i=r("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),a=r("./app/api.tsx"),o=r("./app/locale.tsx"),l=r("./app/utils/discover/eventView.tsx"),c=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),d=r("./app/utils/useApi.tsx"),p=r("./app/utils/useOrganization.tsx"),u=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class m extends s.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new a.KU}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=b(this.props),r=b(e);return!(0,l.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new h(t,e);const r=t?.message;return new h("string"==typeof r?r:(0,o.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:r,didFetch:n,eventView:s,orgSlug:i,route:a,setError:o}=this.props,{api:l}=this.state;if(!s.isValid())return;const c=`/organizations/${i}/${a}/`,d=Symbol("tableFetchID"),p=b(this.props);this.setState({isLoading:!0,tableFetchID:d}),o?.(void 0),t?.(l),l.clear();try{const[t,,s]=await w(l,c,p,{queryBatching:e});if(this.state.tableFetchID!==d)return;const i=r?r(t,this.props):t;n?.(i),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:s?.getResponseHeader("Link")??e.pageLinks,tableData:i})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),o&&o(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||n)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:r,pageLinks:n}=this.state,s={isLoading:e,error:t,tableData:r,pageLinks:n},i=this.props.children;return i?.(s)}}function g(e){const t=(0,p.Z)({allowNull:!0})?.slug,r=(0,s.useContext)(c.uL)?.eventView,n=e.orgSlug??t,i=e.eventView??r;if(void 0===n||void 0===i)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const a={...e,orgSlug:n,eventView:i};return(0,u.tZ)(m,{...a})}m.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const f=200,v=2,x=e=>new Promise((t=>setTimeout(t,e)));async function w(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:s,retry:i}=n;if(s?.batchRequest)return s.batchRequest(e,t,{query:r,includeAllArgs:!0});const a=i?.baseTimeout??f,o=i?.timeoutMultiplier??v,l=i?.statusCodes??[],c=i?.tries??1;let d,p=0,u=0;for(;p<c&&(!d||l.includes(d.status));){u>0&&await x(u);try{return p++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}catch(e){d=e,u=a*o**(p-1)}}throw d}function b(e){const{cursor:t,limit:r,noPagination:n,referrer:s,getRequestPayload:i,eventView:a,location:o,forceAppendRawQueryString:l}=e,c=i?i(e):a.getEventsAPIPayload(o,l);return t&&(c.cursor=t),r&&(c.per_page=r),n&&(c.noPagination=n),s&&(c.referrer=s),Object.assign(c,e.queryExtras??{}),c}function Z(e){const t=(0,d.Z)(),{orgSlug:r,route:n,options:s}=e,a=`/organizations/${r}/${n}/`,o=b(e),l=(0,i.a)([n,o],(()=>w(t,a,o,{queryBatching:e.queryBatching})),s);return{...l,data:l.data?.[0]??void 0,statusCode:l.data?.[1]??void 0,response:l.data?.[2]??void 0}}const y=g},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{"use strict";r.d(t,{bq:()=>s,uL:()=>a});var n=r("./app/utils/performance/contexts/utils.tsx");const[s,i,a]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{"use strict";r.d(t,{n:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,i=(0,n.createContext)(void 0);return i.displayName=s,[i.Provider,function(){const e=(0,n.useContext)(i);if(!e&&t)throw new Error(r);return e},i]}},"./app/views/performance/traceDetails/styles.tsx":(e,t,r)=>{"use strict";r.d(t,{$G:()=>_,CB:()=>m.wh,Iq:()=>f,LA:()=>Z,RB:()=>y,W3:()=>w,X2:()=>m.X2,Z9:()=>x,cC:()=>v,pH:()=>g,qD:()=>m.iF,uI:()=>b});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/components/events/eventTags/eventTagsPill.tsx"),i=r("./app/components/events/interfaces/spans/header.tsx"),a=r("./app/components/panels/index.tsx"),o=r("./app/components/pills.tsx"),l=r("./app/components/searchBar.tsx"),c=r("./app/styles/space.tsx"),d=r("./app/utils.tsx"),p=r("./app/utils/queryString.tsx"),u=r("./app/views/performance/transactionSummary/utils.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),m=r("./app/components/events/interfaces/spans/spanDetail.tsx");const g=(0,n.Z)("div",{target:"evb4dv48"})({name:"7whenc",styles:"display:flex;width:100%"}),f=(0,n.Z)(l.Z,{target:"evb4dv47"})({name:"1ff36h2",styles:"flex-grow:1"}),v=(0,n.Z)(i.il,{target:"evb4dv46"})("border-top:none;border-bottom:1px solid ",(e=>e.theme.border),";position:sticky;top:0;z-index:1;"),x=(0,n.Z)("div",{target:"evb4dv45"})("display:grid;grid-template-columns:1fr;gap:",(0,c.D)(3),";margin-bottom:",(0,c.D)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:max-content max-content;grid-row-gap:0;}"),w=(0,n.Z)("div",{target:"evb4dv44"})({name:"13udsys",styles:"height:100%"}),b=(0,n.Z)("div",{target:"evb4dv43"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),Z=(0,n.Z)(a.s_,{target:"evb4dv42"})({name:"1vsyufa",styles:"height:100%;overflow:auto"}),y=(0,n.Z)("span",{target:"evb4dv41"})("margin-right:",(0,c.D)(.75),";display:flex;flex-direction:column;justify-content:center;"),D=(0,n.Z)(o.Z,{target:"evb4dv40"})("padding-top:",(0,c.D)(1.5),";");function _(e){let{location:t,organization:r,transaction:n}=e;const{tags:i}=n;if(!i||i.length<=0)return null;const a=r.slug;return(0,h.BX)("tr",{children:[(0,h.tZ)("td",{className:"key",children:"Tags"}),(0,h.tZ)("td",{className:"value",children:(0,h.tZ)(D,{children:i.map(((e,i)=>{const{pathname:o,query:l}=(0,u.e1)({orgSlug:a,transaction:n.transaction,projectID:String(n.project_id),query:{...t.query,query:(0,p.os)(t.query.query,e.key,e.value)}});return(0,h.tZ)(s.Z,{tag:e,projectSlug:n.project_slug,projectId:n.project_id.toString(),organization:r,query:l,streamPath:o},(0,d.ri)(e.key)?e.key:`tag-pill-${i}`)}))})})]})}_.displayName="Tags"},"./app/views/performance/traceDetails/traceNotFound.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("../node_modules/react/index.js"),i=r("./app/components/alert.tsx"),a=r("./app/components/links/link.tsx"),o=r("./app/components/loadingError.tsx"),l=r("./app/components/loadingIndicator.tsx"),c=r("./app/components/performance/waterfall/rowDetails.tsx"),d=r("./app/locale.tsx"),p=r("./app/styles/space.tsx"),u=r("./app/utils/discover/discoverQuery.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){let{meta:t,traceEventView:r,traceSlug:n,organization:p,location:m}=e;if(0===(t?.transactions??0)&&(t?.errors??0)>0){const e=r.withColumns([{kind:"field",field:"project"},{kind:"field",field:"title"},{kind:"field",field:"issue.id"},{kind:"field",field:"level"}]);return e.query=`trace:${n} !event.type:transaction `,(0,h.tZ)(u.Z,{eventView:e,orgSlug:p.slug,location:m,referrer:"api.trace-view.errors-view",children:e=>{let{isLoading:t,tableData:r,error:n}=e;return t?(0,h.tZ)(l.Z,{}):n?(0,h.tZ)(i.bZ,{type:"error",showIcon:!0,children:(0,h.tZ)(g,{children:(0,d._N)("The trace cannot be shown when all events are errors. An error occurred when attempting to fetch these error events: [error]",{error:n.message})})}):(0,h.BX)(i.bZ,{type:"error",showIcon:!0,children:[(0,h.tZ)(g,{children:(0,d.t)("The trace cannot be shown when all events are errors.")}),(0,h.tZ)(c.TV,{"data-test-id":"trace-view-errors",children:r?.data.map((e=>(0,h.BX)(s.Fragment,{children:[(0,h.tZ)(c._U,{level:e.level}),(0,h.tZ)(c.wE,{children:e.level}),(0,h.tZ)(c.St,{children:(0,h.tZ)(a.Z,{to:`/organizations/${p.slug}/issues/${e["issue.id"]}/events/${e.id}?referrer=performance-trace-not-found`,children:e.title})})]},e.id)))})]})}})}return(0,h.tZ)(o.Z,{message:(0,d.t)("The trace you are looking for was not found.")})}m.displayName="TraceNotFound";const g=(0,n.Z)("div",{target:"effixob0"})("margin-bottom:",(0,p.D)(1),";"),f=m},"./app/views/performance/traceDetails/traceView.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>he}),r("../node_modules/core-js/modules/es.array.push.js");var n=r("../node_modules/react/index.js"),s=r("../node_modules/@sentry/core/esm/hub.js"),i=r("./app/components/events/interfaces/spans/dividerHandlerManager.tsx"),a=r("./app/components/events/interfaces/spans/measurementsPanel.tsx"),o=r("./app/components/events/interfaces/spans/scrollbarManager.tsx"),l=r("./app/components/events/interfaces/spans/utils.tsx"),c=r("./app/components/performance/waterfall/messageRow.tsx"),d=r("./app/components/performance/waterfall/miniHeader.tsx"),p=r("./app/components/performance/waterfall/utils.tsx"),u=r("./app/locale.tsx"),h=r("./app/utils/analytics.tsx"),m=r("./app/views/performance/traceDetails/styles.tsx"),g=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),f=r("./app/components/assistant/guideAnchor.tsx"),v=r("./app/components/count.tsx"),x=r("./app/components/events/interfaces/spans/styles.tsx"),w=r("./app/components/idBadge/projectBadge.tsx"),b=r("./app/components/performance/waterfall/constants.tsx"),Z=r("./app/components/performance/waterfall/row.tsx"),y=r("./app/components/performance/waterfall/rowBar.tsx"),D=r("./app/components/performance/waterfall/rowDivider.tsx"),_=r("./app/components/performance/waterfall/rowTitle.tsx"),T=r("./app/components/performance/waterfall/treeConnector.tsx"),C=r("./app/components/tooltip.tsx"),B=r("./app/utils.tsx"),S=r("./app/utils/performance/quickTrace/utils.tsx"),j=r("./app/utils/projects.tsx"),I=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),E=r("../node_modules/react-router/es/index.js"),V=r("../node_modules/lodash/omit.js"),R=r.n(V),k=r("./app/components/alert.tsx"),O=r("./app/components/button.tsx"),X=r("./app/components/copyToClipboardButton.tsx"),M=r("./app/components/dateTime.tsx"),z=r("./app/components/links/link.tsx"),A=r("./app/components/performance/waterfall/rowDetails.tsx"),L=r("./app/components/quickTrace/utils.tsx"),$=r("./app/constants/pageFilters.tsx"),P=r("./app/styles/space.tsx"),F=r("./app/utils/discover/urls.tsx"),G=r("./app/utils/getDynamicText.tsx"),N=r("./app/utils/performance/urls.ts"),q=r("./app/utils/performance/vitals/constants.tsx"),H=r("./app/utils/performanceForSentry/index.tsx"),Q=r("./app/utils/profiling/routes.tsx"),U=r("./app/views/performance/transactionSummary/utils.tsx"),W=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class J extends n.Component{constructor(){super(...arguments),(0,g.Z)(this,"scrollBarIntoView",(e=>t=>{t.preventDefault();const r=`#txn-${e}`;this.props.scrollIntoView(),E.browserHistory.push({...this.props.location,hash:r})}))}componentDidMount(){const{organization:e,transaction:t}=this.props;(0,h.Gi)("performance_views.trace_view.open_transaction_details",{organization:e,operation:t["transaction.op"],transaction:t.transaction})}renderTransactionErrors(){const{organization:e,transaction:t}=this.props,{errors:r,performance_issues:n}=t;return r.length+n.length===0?null:(0,W.tZ)(k.bZ,{system:!0,type:"error",expand:[...r,...n].map((t=>(0,W.BX)(A.TV,{children:[(0,W.tZ)(A._U,{level:t.level}),(0,W.tZ)(A.wE,{children:t.level}),(0,W.tZ)(A.St,{children:(0,W.tZ)(z.Z,{to:(0,L.F7)(t,e),children:t.title})})]},t.event_id))),children:(0,W.tZ)(A.CM,{children:(0,u.tn)("%s issue occurred in this transaction.","%s issues occurred in this transaction.",r.length+n.length)})})}renderGoToTransactionButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,F.JE)({id:r.event_id,project:r.project_slug}),s=(0,N.D)(t.slug,n,r.transaction,R()(e.query,Object.values($.V)));return(0,W.tZ)(K,{size:"xs",to:s,children:(0,u.t)("View Event")})}renderGoToSummaryButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,U.e1)({orgSlug:t.slug,transaction:r.transaction,query:R()(e.query,Object.values($.V)),projectID:String(r.project_id)});return(0,W.tZ)(K,{size:"xs",to:n,children:(0,u.t)("View Summary")})}renderGoToProfileButton(){const{organization:e,transaction:t}=this.props;if(!t.profile_id)return null;const r=(0,Q.O$)({orgSlug:e.slug,projectSlug:t.project_slug,profileId:t.profile_id});return(0,W.tZ)(K,{size:"xs",to:r,onClick:function(){(0,h.Gi)("profiling_views.go_to_flamegraph",{organization:e,source:"performance.trace_view"})},children:(0,u.t)("View Profile")})}renderMeasurements(){const{transaction:e}=this.props,{measurements:t={}}=e,r=Object.keys(t).filter((e=>Boolean(q.r9[`measurements.${e}`]))).sort();return r.length<=0?null:(0,W.tZ)(n.Fragment,{children:r.map((e=>(0,W.tZ)(m.X2,{title:q.r9[`measurements.${e}`]?.name,children:`${Number(t[e].value.toFixed(3)).toLocaleString()}ms`},e)))})}renderTransactionDetail(){const{location:e,organization:t,transaction:r}=this.props,s=Math.min(r.start_timestamp,r.timestamp),i=Math.max(r.start_timestamp,r.timestamp),{start:a,end:o}=(0,l.Zv)(s,i),c=`${Number((1e3*(i-s)).toFixed(3)).toLocaleString()}ms`;return(0,W.tZ)(m.qD,{children:(0,W.tZ)("table",{className:"table key-value",children:(0,W.BX)("tbody",{children:[(0,W.BX)(m.X2,{title:(0,W.tZ)(Y,{onClick:this.scrollBarIntoView(r.event_id),children:(0,u.t)("Event ID")}),extra:this.renderGoToTransactionButton(),children:[r.event_id,(0,W.tZ)(X.m,{borderless:!0,size:"zero",iconSize:"xs",text:`${window.location.href.replace(window.location.hash,"")}#txn-${r.event_id}`})]}),(0,W.tZ)(m.X2,{title:"Transaction",extra:this.renderGoToSummaryButton(),children:r.transaction}),(0,W.tZ)(m.X2,{title:"Transaction Status",children:r["transaction.status"]}),(0,W.tZ)(m.X2,{title:"Span ID",children:r.span_id}),r.profile_id&&(0,W.tZ)(m.X2,{title:"Profile ID",extra:this.renderGoToProfileButton(),children:r.profile_id}),(0,W.tZ)(m.X2,{title:"Project",children:r.project_slug}),(0,W.tZ)(m.X2,{title:"Start Date",children:(0,G.Z)({fixed:"Mar 19, 2021 11:06:27 AM UTC",value:(0,W.BX)(n.Fragment,{children:[(0,W.tZ)(M.Z,{date:1e3*s}),` (${a})`]})})}),(0,W.tZ)(m.X2,{title:"End Date",children:(0,G.Z)({fixed:"Mar 19, 2021 11:06:28 AM UTC",value:(0,W.BX)(n.Fragment,{children:[(0,W.tZ)(M.Z,{date:1e3*i}),` (${o})`]})})}),(0,W.tZ)(m.X2,{title:"Duration",children:c}),(0,W.tZ)(m.X2,{title:"Operation",children:r["transaction.op"]||""}),this.renderMeasurements(),(0,W.tZ)(m.$G,{location:e,organization:t,transaction:r})]})})})}render(){return(0,W.tZ)(H.C6,{id:"TransactionDetail",children:(0,W.BX)(m.CB,{onClick:e=>{e.stopPropagation()},children:[this.renderTransactionErrors(),this.renderTransactionDetail()]})})}}J.displayName="TransactionDetail";const Y=(0,I.Z)("a",{target:"ehk3o3f1"})("display:flex;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}"),K=(0,I.Z)(O.zx,{target:"ehk3o3f0"})("position:absolute;top:",(0,P.D)(.75),";right:",(0,P.D)(.5),";"),ee=J;class te extends n.Component{constructor(){super(...arguments),(0,g.Z)(this,"state",{showDetail:!1}),(0,g.Z)(this,"transactionRowDOMRef",(0,n.createRef)()),(0,g.Z)(this,"transactionTitleRef",(0,n.createRef)()),(0,g.Z)(this,"spanContentRef",null),(0,g.Z)(this,"toggleDisplayDetail",(()=>{const{transaction:e}=this.props;(0,S.Ci)(e)&&this.setState((e=>({showDetail:!e.showDetail})))})),(0,g.Z)(this,"handleWheel",(e=>{if(Math.abs(e.deltaY)>Math.abs(e.deltaX))return;if(e.preventDefault(),e.stopPropagation(),Math.abs(e.deltaY)===Math.abs(e.deltaX))return;const{onWheel:t}=this.props;t(e.deltaX)})),(0,g.Z)(this,"scrollIntoView",(()=>{const e=this.transactionRowDOMRef.current;if(!e)return;const t=e.getBoundingClientRect().top+window.scrollY;this.setState({showDetail:!0},(()=>window.scrollTo(0,t)))}))}componentDidMount(){const{location:e,transaction:t}=this.props;"event_id"in t&&(0,l.KQ)(t.event_id)===e.hash&&this.scrollIntoView(),this.transactionTitleRef.current&&this.transactionTitleRef.current.addEventListener("wheel",this.handleWheel,{passive:!1})}componentWillUnmount(){this.transactionTitleRef.current&&this.transactionTitleRef.current.removeEventListener("wheel",this.handleWheel)}getCurrentOffset(){const{transaction:e}=this.props,{generation:t}=e;return re(t)}renderMeasurements(){const{measurements:e,generateBounds:t}=this.props;return e?(0,W.tZ)(n.Fragment,{children:Array.from(e.values()).map((e=>{const r=Object.values(e.marks)[0],{timestamp:n}=r,s=(0,l.vu)(n,t);return(0,B.ri)(s.left)&&(0,B.ri)(s.width)&&s.isSpanVisibleInView?(0,W.tZ)(x.a,{style:{left:`clamp(0%, ${(0,p.yI)(s.left||0)}, calc(100% - 1px))`},failedThreshold:e.failedThreshold},String(n)):null}))}):null}renderConnector(e){const{continuingDepths:t,isExpanded:r,isOrphan:n,isLast:s,transaction:i}=this.props,{generation:a}=i,o=(0,S.Ci)(i)?i.event_id:i.traceSlug;if(0===a)return e?(0,W.tZ)(T.UV,{style:{right:"15px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1}):null;const l=t.map((e=>{let{depth:t,isOrphanDepth:r}=e;if(a-t<=1)return null;const n=-1*re(a-t-1)-2;return(0,W.tZ)(T.UV,{style:{left:n},orphanBranch:r},`${o}-${t}`)}));return e&&r&&l.push((0,W.tZ)(T.UV,{style:{right:"15px",height:"10px",bottom:s?`-${b.dN/2+1}px`:"0",top:"auto"},orphanBranch:!1},`${o}-last`)),(0,W.tZ)(T.DN,{isLast:s,hasToggler:e,orphanBranch:n,children:l})}renderToggle(e){const{isExpanded:t,transaction:r,toggleExpandedState:n}=this.props,{children:s,generation:i}=r,a=this.getCurrentOffset();if(s.length<=0)return(0,W.tZ)(T.rw,{style:{left:`${a}px`},children:this.renderConnector(!1)});const o=0===i;return(0,W.BX)(T.rw,{style:{left:`${a}px`},hasToggler:!0,children:[this.renderConnector(!0),(0,W.BX)(T.U1,{disabled:o,isExpanded:t,errored:e,onClick:e=>{e.stopPropagation(),o||n()},children:[(0,W.tZ)(v.Z,{value:s.length}),!o&&(0,W.tZ)("div",{children:(0,W.tZ)(T.jd,{direction:t?"up":"down"})})]})]})}renderTitle(e){const{organization:t,transaction:r,addContentSpanBarRef:s,removeContentSpanBarRef:i}=this.props,a=this.getCurrentOffset(),o=!!(0,S.Ci)(r)&&r.errors.length+r.performance_issues.length>0,l=(0,S.Ci)(r)?(0,W.BX)(n.Fragment,{children:[(0,W.tZ)(j.Z,{orgId:t.slug,slugs:[r.project_slug],children:e=>{let{projects:t}=e;const n=t.find((e=>e.slug===r.project_slug));return(0,W.tZ)(m.RB,{children:(0,W.tZ)(C.u,{title:r.project_slug,children:(0,W.tZ)(w.Z,{project:n||{slug:r.project_slug},avatarSize:16,hideName:!0})})})}}),(0,W.BX)(_.rv,{errored:o,children:[(0,W.BX)("strong",{children:[r["transaction.op"]," — "]}),r.transaction]})]}):(0,W.BX)(_.rv,{errored:!1,children:[(0,W.tZ)("strong",{children:"Trace — "}),r.traceSlug]});return(0,W.BX)(_.mw,{ref:e=>{e?(s(e),this.spanContentRef=e):i(this.spanContentRef)},children:[this.renderToggle(o),(0,W.tZ)(_.Wh,{style:{left:`${a}px`,width:"100%"},children:l})]})}renderDivider(e){if(this.state.showDetail)return(0,W.tZ)(D.xN,{showDetail:!0,style:{position:"absolute"}});const{addDividerLineRef:t}=e;return(0,W.tZ)(D.xN,{ref:t(),style:{position:"absolute"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}renderGhostDivider(e){const{dividerPosition:t,addGhostDividerLineRef:r}=e;return(0,W.tZ)(D.Hr,{style:{width:`calc(${(0,p.yI)(t)} + 0.5px)`,display:"none"},children:(0,W.tZ)(D.xN,{ref:r(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})}renderErrorBadge(){const{transaction:e}=this.props;return(0,S.Ci)(e)&&e.errors.length+e.performance_issues.length?(0,W.tZ)(D.cS,{}):null}renderRectangle(){const{transaction:e,traceInfo:t,barColor:r}=this.props,{showDetail:n}=this.state,s=Math.abs(t.endTimestamp-t.startTimestamp)||1,i=Math.abs(e.start_timestamp-t.startTimestamp)/s,a=Math.abs(e.timestamp-e.start_timestamp),o=a/s;return(0,W.BX)(y.e,{style:{backgroundColor:r,left:`min(${(0,p.yI)(i||0)}, calc(100% - 1px))`,width:(0,p.yI)(o||0)},children:[this.renderPerformanceIssues(),(0,W.tZ)(y.R,{durationDisplay:(0,p.ud)({left:i,width:o}),showDetail:n,children:(0,p.bQ)(a)})]})}renderPerformanceIssues(){const{transaction:e,barColor:t}=this.props;if(!(0,S.Ci)(e))return null;const r=[],n=Math.abs(e.timestamp-e.start_timestamp)||1;for(let s=0;s<e.performance_issues.length;s++){const i=e.performance_issues[s],a=Math.abs(i.start-e.start_timestamp)/n,o=Math.abs(i.end-i.start)/n;r.push((0,W.tZ)(y.e,{style:{backgroundColor:t,left:`min(${(0,p.yI)(a||0)}, calc(100% - 1px))`,width:(0,p.yI)(o||0)},spanBarType:b.il.AFFECTED}))}return r}renderHeader(e){let{dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:r}=e;const{hasGuideAnchor:n,index:s}=this.props,{showDetail:i}=this.state,{dividerPosition:a}=t;return(0,W.BX)(Z.Qc,{showDetail:i,children:[(0,W.tZ)(Z.E5,{"data-test-id":"transaction-row-title","data-type":"span-row-cell",style:{width:`calc(${(0,p.yI)(a)} - 0.5px)`,paddingTop:0},showDetail:i,onClick:this.toggleDisplayDetail,ref:this.transactionTitleRef,children:(0,W.tZ)(f.Z,{target:"trace_view_guide_row",disabled:!n,children:this.renderTitle(r)})}),(0,W.BX)(D.kP,{children:[this.renderDivider(t),this.renderErrorBadge()]}),(0,W.tZ)(Z.E5,{"data-test-id":"transaction-row-duration","data-type":"span-row-cell",showStriping:s%2!=0,style:{width:`calc(${(0,p.yI)(1-a)} - 0.5px)`,paddingTop:0},showDetail:i,onClick:this.toggleDisplayDetail,children:(0,W.BX)(f.Z,{target:"trace_view_guide_row_details",disabled:!n,children:[this.renderRectangle(),this.renderMeasurements()]})}),!i&&this.renderGhostDivider(t)]})}renderDetail(){const{location:e,organization:t,isVisible:r,transaction:n}=this.props,{showDetail:s}=this.state;return(0,S.Ci)(n)&&r&&s?(0,W.tZ)(ee,{location:e,organization:t,transaction:n,scrollIntoView:this.scrollIntoView}):null}render(){const{isVisible:e,transaction:t}=this.props,{showDetail:r}=this.state;return(0,W.BX)(Z.X2,{ref:this.transactionRowDOMRef,visible:e,showBorder:r,cursor:(0,S.Ci)(t)?"pointer":"default",children:[(0,W.tZ)(o.$6,{children:e=>(0,W.tZ)(i.$,{children:t=>this.renderHeader({dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:e})})}),this.renderDetail()]})}}function re(e){return e*(T.Ll/2)+0}te.displayName="TransactionBar";const ne=te;class se extends n.Component{constructor(){super(...arguments),(0,g.Z)(this,"state",{isExpanded:!0}),(0,g.Z)(this,"toggleExpandedState",(()=>{this.setState((e=>{let{isExpanded:t}=e;return{isExpanded:!t}}))}))}componentDidUpdate(e,t){t.isExpanded!==this.state.isExpanded&&this.props.updateScrollState()}render(){const{location:e,organization:t,transaction:r,traceInfo:s,continuingDepths:i,isOrphan:a,isLast:o,index:l,isVisible:c,hasGuideAnchor:d,renderedChildren:p,barColor:u,addContentSpanBarRef:h,removeContentSpanBarRef:m,onWheel:g,measurements:f,generateBounds:v}=this.props,{isExpanded:x}=this.state;return(0,W.BX)(n.Fragment,{children:[(0,W.tZ)(ne,{location:e,organization:t,measurements:f,generateBounds:v,index:l,transaction:r,traceInfo:s,continuingDepths:i,isOrphan:a,isLast:o,isExpanded:x,toggleExpandedState:this.toggleExpandedState,isVisible:c,hasGuideAnchor:d,barColor:u,addContentSpanBarRef:h,removeContentSpanBarRef:m,onWheel:g}),x&&p]})}}se.displayName="TransactionGroup";const ie=(0,o.Iw)(se);var ae=r("./app/views/performance/traceDetails/utils.tsx"),oe=r("./app/components/discover/discoverFeature.tsx");function le(e){let{traceInfo:t,traceEventView:r,organization:n,meta:s}=e;const i=t.transactions.size,a=s?.transactions??i;if(null===a||i>=a)return null;const o=r.getResultsViewUrlTarget(n.slug);return(0,W.tZ)(c.V,{children:(0,u._N)("Limited to a view of [count] transactions. To view the full list, [discover].",{count:i,discover:(0,W.tZ)(oe.Z,{children:e=>{let{hasFeature:t}=e;return(0,W.tZ)(z.Z,{disabled:!t,to:o,children:(0,u.t)("Open in Discover")})}})})})}le.displayName="LimitExceededMessage";const ce=le;var de=r("./app/views/performance/traceDetails/traceNotFound.tsx");function pe(e){let{isVisible:t,numberOfHiddenTransactionsAbove:r}=e;return!t||r<1?null:(0,W.tZ)(c.V,{children:(0,W.tZ)("span",{children:1===r?(0,u._N)("[numOfTransaction] hidden transaction",{numOfTransaction:(0,W.tZ)("strong",{children:r})}):(0,u._N)("[numOfTransaction] hidden transactions",{numOfTransaction:(0,W.tZ)("strong",{children:r})})},"trace-info-message")})}function ue(e){return(0,l.IG)({traceStartTimestamp:e.startTimestamp,traceEndTimestamp:e.endTimestamp,viewStart:0,viewEnd:1})}function he(e){let{location:t,meta:r,organization:c,traces:u,traceSlug:g,traceEventView:f,filteredTransactionIds:v,...x}=e;const w=s.Gd().getScope()?.getTransaction(),b=w?.startChild({op:"trace.render",description:"trace-view-content"});function Z(e,r){let{continuingDepths:s,isOrphan:i,isLast:a,index:o,numberOfHiddenTransactionsAbove:d,traceInfo:h,hasGuideAnchor:m}=r;const{children:g,event_id:f}=e,x=e.generation+1,w=function(e,t){return!t||t.has(e.event_id)}(e,v),b=g.reduce(((e,t,r)=>{const n=r===g.length-1,a=t.children.length>0,o=Z(t,{continuingDepths:!n&&a?[...s,{depth:x,isOrphanDepth:i}]:s,isOrphan:i,isLast:n,index:e.lastIndex+1,numberOfHiddenTransactionsAbove:e.numberOfHiddenTransactionsAbove,traceInfo:h,hasGuideAnchor:!1});return e.lastIndex=o.lastIndex,e.numberOfHiddenTransactionsAbove=o.numberOfHiddenTransactionsAbove,e.renderedChildren.push(o.transactionGroup),e}),{renderedChildren:[],lastIndex:o,numberOfHiddenTransactionsAbove:w?0:d+1});return{transactionGroup:(0,W.BX)(n.Fragment,{children:[(0,W.tZ)(pe,{isVisible:w,numberOfHiddenTransactionsAbove:d}),(0,W.tZ)(ie,{location:t,organization:c,traceInfo:h,transaction:{...e,generation:x},measurements:u&&u.length>0?(0,l.is)(u[0],ue(h)):void 0,generateBounds:ue(h),continuingDepths:s,isOrphan:i,isLast:a,index:o,isVisible:w,hasGuideAnchor:m,renderedChildren:b.renderedChildren,barColor:(0,p.hd)(e["transaction.op"])})]},f),lastIndex:b.lastIndex,numberOfHiddenTransactionsAbove:b.numberOfHiddenTransactionsAbove}}(0,n.useEffect)((()=>{(0,h.Gi)("performance_views.trace_view.view",{organization:c})}),[c]);const y=(0,n.createRef)(),D=(0,n.createRef)();if(null===u||u.length<=0)return(0,W.tZ)(de.Z,{meta:r,traceEventView:f,traceSlug:g,location:t,organization:c});const _=x.traceInfo||(0,ae.Rg)(u),T={index:1,numberOfHiddenTransactionsAbove:0,traceInfo:_,transactionGroups:[]},{transactionGroups:C,numberOfHiddenTransactionsAbove:B}=u.reduce(((e,t,r)=>{const n=r===u.length-1,s=t.children.length>0,i=!n&&null!==u[r+1].parent_span_id,a=Z(t,{...e,isOrphan:!(0,ae.uM)(t),isLast:n,continuingDepths:!n&&s?[{depth:0,isOrphanDepth:i}]:[],hasGuideAnchor:0===r});return e.index=a.lastIndex+1,e.numberOfHiddenTransactionsAbove=a.numberOfHiddenTransactionsAbove,e.transactionGroups.push(a.transactionGroup),e}),T),S=ue(_),j=Object.keys(u[0].measurements??{}).length>0?(0,l.is)(u[0],S):void 0,I=(0,W.tZ)(m.W3,{children:(0,W.tZ)(i.z,{interactiveLayerRef:y,children:(0,W.tZ)(i.$,{children:e=>{let{dividerPosition:n}=e;return(0,W.tZ)(o.zt,{dividerPosition:n,interactiveLayerRef:D,children:(0,W.BX)(m.LA,{children:[(0,W.BX)(m.cC,{children:[(0,W.tZ)(o.$6,{children:e=>{let{virtualScrollbarRef:t,scrollBarAreaRef:r,onDragStart:s,onScroll:i}=e;return(0,W.BX)(d.cs,{ref:D,style:{width:`calc(${(0,p.yI)(n)} - 0.5px)`},onScroll:i,children:[(0,W.tZ)("div",{style:{width:0,height:"1px"},ref:r}),(0,W.tZ)(d.Qk,{"data-type":"virtual-scrollbar",ref:t,onMouseDown:s,children:(0,W.tZ)(d.v6,{})})]})}}),(0,W.tZ)(d._i,{}),j?(0,W.tZ)(a.Z,{measurements:j,generateBounds:S,dividerPosition:n}):null]}),(0,W.BX)(m.uI,{ref:y,children:[(0,W.tZ)(ie,{location:t,organization:c,traceInfo:_,transaction:{traceSlug:g,generation:0,"transaction.duration":_.endTimestamp-_.startTimestamp,children:u,start_timestamp:_.startTimestamp,timestamp:_.endTimestamp},measurements:j,generateBounds:S,continuingDepths:[],isOrphan:!1,isLast:!1,index:0,isVisible:!0,hasGuideAnchor:!1,renderedChildren:C,barColor:(0,p.hd)("")}),(0,W.tZ)(pe,{isVisible:!0,numberOfHiddenTransactionsAbove:B}),(0,W.tZ)(ce,{traceInfo:_,organization:c,traceEventView:f,meta:r})]})]})})}})})});return b?.finish(),I}pe.displayName="TraceHiddenMessage"},"../node_modules/lodash/isFinite.js":(e,t,r)=>{var n=r("../node_modules/lodash/_root.js").isFinite;e.exports=function(e){return"number"==typeof e&&n(e)}}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_traceDetails_traceView_tsx-node_modules_lodash_isFinite_js.726208bab4fe65220dc6039cc80eee8e.js.map