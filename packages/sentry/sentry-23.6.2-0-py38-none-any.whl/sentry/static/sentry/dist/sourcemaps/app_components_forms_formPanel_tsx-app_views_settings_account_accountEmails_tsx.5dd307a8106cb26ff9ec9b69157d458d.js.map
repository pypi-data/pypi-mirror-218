{"version":3,"file":"chunks/app_components_forms_formPanel_tsx-app_views_settings_account_accountEmails_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"mmBA8CA,SAASA,EAASC,GAWR,IAXS,qBACjBC,EAAuB,CAAC,EAAC,MACzBC,EAAK,OACLC,EAAM,OACNC,EAAM,SACNC,EAAQ,aACRC,EAAY,aACZC,EAAY,YACZC,EAAW,mBACXC,GAAqB,KAClBC,GACGV,EACN,MAAOW,EAAWC,IAAeC,EAAAA,EAAAA,UAASJ,GACpCK,GAAuBC,EAAAA,EAAAA,cAAY,IAAMH,GAAYI,IAAYA,KAAU,IAEjF,OACEC,EAAAA,EAAAA,IAACC,EAAAA,GAAK,CAACC,GAAqB,iBAAVjB,GAAqBkB,EAAAA,EAAAA,GAAsBlB,QAASmB,EAAUC,SAAA,CAC7EpB,IACCe,EAAAA,EAAAA,IAACM,EAAAA,GAAW,CAAAD,SAAA,CACTpB,EACAM,IACCgB,EAAAA,EAAAA,IAACC,EAAQ,CAACC,QAASZ,EAAqBQ,UACtCE,EAAAA,EAAAA,IAACG,EAAAA,GAAW,CACV,eAAa,8BACbC,UAAWjB,EAAY,OAAS,KAChCkB,KAAK,aAMfZ,EAAAA,EAAAA,IAACa,EAAAA,EAAS,CAACC,OAAQpB,EAAUW,SAAA,CACF,mBAAjBf,GAA+BA,EAAa,CAACL,QAAOC,WAE3DA,EAAO6B,KAAIC,IACV,GAAqB,mBAAVA,EACT,OAAOA,IAGT,MAAOC,aAAcC,KAAMC,GAA4BH,EASvD,OALiB,IAAb5B,IACF+B,EAAyB/B,UAAW,EACpC+B,EAAyBC,oBAAiBhB,IAI1CG,EAAAA,EAAAA,IAACc,EAAAA,EAAe,CACdlC,OAAQA,EACRC,SAAUA,KAENK,KACAT,EACJgC,MAAOG,EACPG,YAAa7B,EAAW6B,cAAiB,IAAGN,EAAMO,QAJ7CP,EAAMO,KAKX,IAGmB,mBAAjBlC,GAA+BA,EAAa,CAACJ,QAAOC,gBAIpE,CAhESJ,EAAS0C,YAAA,YAkElB,UAEMhB,GAAWiB,EAAAA,EAAAA,GAAO,OAAM,CAAAC,OAAA,WAAbD,CAAc,CAAAF,KAAA,SAAAI,OAAA,kB,0/BC5F/B,MAAMC,EAAW,oBAQjB,MAAMC,UAAsBC,OAAAA,EAAAA,EAAAA,EAAS,QAAeC,cAAA,SAAAC,YAAAC,EAAAA,EAAAA,GAAA,4BASE,CAACC,EAASC,EAAOjC,UACxDE,IAAPF,IAGJiC,EAAMC,SAASlC,EAAI,IACnBmC,KAAKC,mBAAkB,GACxB,CAdDC,WACE,OAAOC,EAAAA,EAAAA,GAAE,SACX,CAEAC,eACE,MAAO,EACT,CAUAC,aACE,OACE1C,EAAAA,EAAAA,IAAC2C,EAAAA,SAAQ,CAAAtC,SAAA,EACPE,EAAAA,EAAAA,IAACqC,EAAAA,EAAkB,CAAC3D,OAAOuD,EAAAA,EAAAA,GAAE,sBAC7BjC,EAAAA,EAAAA,IAACsC,EAAc,KACftC,EAAAA,EAAAA,IAACuC,EAAAA,EAAI,CACHC,UAAU,OACVC,YAAapB,EACbqB,YAAU,EACVC,WAAW,EACXC,gBAAiBd,KAAKe,oBAAoB/C,UAE1CE,EAAAA,EAAAA,IAAC8C,EAAAA,EAAQ,CAACC,MAAOC,EAAAA,aAGnBhD,EAAAA,EAAAA,IAACiD,EAAAA,EAAS,CAACC,GAAG,kCAAkCC,MAAMnD,EAAAA,EAAAA,IAACoD,EAAAA,GAAS,IAAItD,UACjEmC,EAAAA,EAAAA,GAAE,4EAIX,EAGF,QAAeX,OAAAA,EAAAA,EAAAA,EAAa,KAErB,MAAMgB,UAAuBe,EAAAA,EAA6B7B,cAAA,SAAAC,YAAAC,EAAAA,EAAAA,GAAA,yBAkB3C4B,GAClBxB,KAAKyB,UAAUlC,EAAU,CACvBmC,OAAQ,MACRC,KAAM,CAACH,cACP5B,EAAAA,EAAAA,GAAA,qBAEY4B,GACdxB,KAAKyB,UAAUlC,EAAU,CACvBmC,OAAQ,SACRC,KAAM,CAACH,cACP5B,EAAAA,EAAAA,GAAA,qBAEY4B,GACdxB,KAAKyB,UAAW,GAAElC,YAAoB,CACpCmC,OAAQ,OACRC,KAAM,CAACH,YACP,CAjCJpB,eACE,MAAO,CAAC,CAAC,SAAUb,GACrB,CACAkC,UAAUG,EAAkBC,GAC1B7B,KAAK8B,SAAS,CAACC,SAAS,EAAMC,OAAQ,KAAK,IACzChC,KAAKiC,IACFC,eAAeN,EAAUC,GACzBM,MAAK,IAAMnC,KAAKC,qBAChBmC,OAAMC,IACLrC,KAAKC,mBAEDoC,GAAKC,cAAcd,QACrBe,EAAAA,EAAAA,IAAgBF,EAAIC,aAAad,MACnC,KAGR,CAmBAgB,SACE,MAAM,OAACR,EAAM,QAAED,GAAW/B,KAAKyC,MACzBC,EAAUV,GAAQW,MAAKjG,IAAA,IAAC,UAACkG,GAAUlG,EAAA,OAAKkG,CAAS,IACjDC,EAAYb,GAAQc,QAAOC,IAAA,IAAC,UAACH,GAAUG,EAAA,OAAMH,CAAS,IAE5D,OAAIb,GAEApE,EAAAA,EAAAA,IAACC,EAAAA,GAAK,CAAAI,SAAA,EACJE,EAAAA,EAAAA,IAACD,EAAAA,GAAW,CAAAD,UAAEmC,EAAAA,EAAAA,GAAE,sBAChBjC,EAAAA,EAAAA,IAACM,EAAAA,EAAS,CAAAR,UACRE,EAAAA,EAAAA,IAAC8E,EAAAA,EAAgB,UAMvBrF,EAAAA,EAAAA,IAACC,EAAAA,GAAK,CAAAI,SAAA,EACJE,EAAAA,EAAAA,IAACD,EAAAA,GAAW,CAAAD,UAAEmC,EAAAA,EAAAA,GAAE,sBAChBxC,EAAAA,EAAAA,IAACa,EAAAA,EAAS,CAAAR,SAAA,CACP0E,IACCxE,EAAAA,EAAAA,IAAC+E,EAAQ,CACPC,SAAUlD,KAAKmD,aACfC,SAAUpD,KAAKqD,gBACXX,IAIPG,GAAWnE,KAAI4E,IACdpF,EAAAA,EAAAA,IAAC+E,EAAQ,CAEPM,aAAcvD,KAAKwD,iBACnBN,SAAUlD,KAAKmD,aACfC,SAAUpD,KAAKqD,gBACXC,GAJCA,EAAS9B,cAU1B,EAaF,SAASyB,EAAQQ,GAQC,IARA,MAChBjC,EAAK,SACL0B,EAAQ,SACRE,EAAQ,aACRG,EAAY,WACZG,EAAU,UACVd,EAAS,WACTe,GACcF,EACd,OACE9F,EAAAA,EAAAA,IAACiG,EAAS,CAAA5F,SAAA,EACRL,EAAAA,EAAAA,IAACkG,EAAS,CAAA7F,SAAA,CACPwD,GACCkC,IAAcxF,EAAAA,EAAAA,IAAC4F,EAAAA,EAAG,CAACC,KAAK,UAAS/F,UAAEmC,EAAAA,EAAAA,GAAE,gBACtCyC,IAAa1E,EAAAA,EAAAA,IAAC4F,EAAAA,EAAG,CAACC,KAAK,UAAS/F,UAAEmC,EAAAA,EAAAA,GAAE,iBAEvCxC,EAAAA,EAAAA,IAACqG,EAAAA,GAAS,CAACC,IAAK,EAAEjG,SAAA,EACd4E,GAAac,IACbxF,EAAAA,EAAAA,IAACgG,EAAAA,GAAM,CAAC3F,KAAK,KAAKH,QAAS+F,GAAKZ,IAAe/B,EAAO2C,GAAGnG,UACtDmC,EAAAA,EAAAA,GAAE,qBAGLuD,IACAxF,EAAAA,EAAAA,IAACgG,EAAAA,GAAM,CAAC3F,KAAK,KAAKH,QAAS+F,GAAKf,EAAS5B,EAAO2C,GAAGnG,UAChDmC,EAAAA,EAAAA,GAAE,0BAGLwD,IAAef,IACf1E,EAAAA,EAAAA,IAACgG,EAAAA,GAAM,CACL,cAAY/D,EAAAA,EAAAA,GAAE,gBACd,eAAa,SACbiE,SAAS,SACT7F,KAAK,KACL8C,MAAMnD,EAAAA,EAAAA,IAACmG,EAAAA,GAAU,IACjBjG,QAAS+F,GAAKjB,EAAS1B,EAAO2C,UAM1C,CAhIa3D,EAAcrB,YAAA,iBAwFlB8D,EAAQ9D,YAAA,WA0CjB,MAAM0E,GAAYzE,EAAAA,EAAAA,GAAO,MAAK,CAAAC,OAAA,aAAZD,CAAa,2CAGtBkF,EAAAA,EAAAA,GAAM,GAAE,wBAIXV,GAAYxE,EAAAA,EAAAA,GAAOmF,EAAAA,GAAS,CAAAlF,OAAA,aAAhBD,CAAiB,CAAAF,KAAA,SAAAI,OAAA,iC","sources":["webpack:///./app/components/forms/formPanel.tsx","webpack:///./app/views/settings/account/accountEmails.tsx"],"sourcesContent":["import {useCallback, useState} from 'react';\nimport styled from '@emotion/styled';\n\nimport FieldFromConfig from 'sentry/components/forms/fieldFromConfig';\nimport {Panel, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport {IconChevron} from 'sentry/icons';\nimport {Scope} from 'sentry/types';\nimport {sanitizeQuerySelector} from 'sentry/utils/sanitizeQuerySelector';\n\nimport {FieldObject, JsonFormObject} from './types';\n\ntype Props = {\n  /**\n   * List of fields to render\n   */\n  fields: FieldObject[];\n  access?: Set<Scope>;\n  additionalFieldProps?: {[key: string]: any};\n  /**\n   * Can the PanelBody be hidden with a click?\n   */\n  collapsible?: boolean;\n  /**\n   * Disables the entire form\n   */\n  disabled?: boolean;\n  features?: Record<string, any>;\n  /**\n   * The name of the field that should be highlighted\n   */\n  highlighted?: string;\n  initiallyCollapsed?: boolean;\n  /**\n   * Renders inside of PanelBody before PanelBody close\n   */\n  renderFooter?: (arg: JsonFormObject) => React.ReactNode;\n  /**\n   * Renders inside of PanelBody at the start\n   */\n  renderHeader?: (arg: JsonFormObject) => React.ReactNode;\n  /**\n   * Panel title\n   */\n  title?: React.ReactNode;\n};\n\nfunction FormPanel({\n  additionalFieldProps = {},\n  title,\n  fields,\n  access,\n  disabled,\n  renderFooter,\n  renderHeader,\n  collapsible,\n  initiallyCollapsed = false,\n  ...otherProps\n}: Props) {\n  const [collapsed, setCollapse] = useState(initiallyCollapsed);\n  const handleCollapseToggle = useCallback(() => setCollapse(current => !current), []);\n\n  return (\n    <Panel id={typeof title === 'string' ? sanitizeQuerySelector(title) : undefined}>\n      {title && (\n        <PanelHeader>\n          {title}\n          {collapsible && (\n            <Collapse onClick={handleCollapseToggle}>\n              <IconChevron\n                data-test-id=\"form-panel-collapse-chevron\"\n                direction={collapsed ? 'down' : 'up'}\n                size=\"xs\"\n              />\n            </Collapse>\n          )}\n        </PanelHeader>\n      )}\n      <PanelBody hidden={collapsed}>\n        {typeof renderHeader === 'function' && renderHeader({title, fields})}\n\n        {fields.map(field => {\n          if (typeof field === 'function') {\n            return field();\n          }\n\n          const {defaultValue: _, ...fieldWithoutDefaultValue} = field;\n\n          // Allow the form panel disabled prop to override the fields\n          // disabled prop, with fallback to the fields disabled state.\n          if (disabled === true) {\n            fieldWithoutDefaultValue.disabled = true;\n            fieldWithoutDefaultValue.disabledReason = undefined;\n          }\n\n          return (\n            <FieldFromConfig\n              access={access}\n              disabled={disabled}\n              key={field.name}\n              {...otherProps}\n              {...additionalFieldProps}\n              field={fieldWithoutDefaultValue}\n              highlighted={otherProps.highlighted === `#${field.name}`}\n            />\n          );\n        })}\n        {typeof renderFooter === 'function' && renderFooter({title, fields})}\n      </PanelBody>\n    </Panel>\n  );\n}\n\nexport default FormPanel;\n\nconst Collapse = styled('span')`\n  cursor: pointer;\n`;\n","import {Fragment} from 'react';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage} from 'sentry/actionCreators/indicator';\nimport {RequestOptions} from 'sentry/api';\nimport AlertLink from 'sentry/components/alertLink';\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport {Button} from 'sentry/components/button';\nimport ButtonBar from 'sentry/components/buttonBar';\nimport Form, {FormProps} from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'sentry/components/panels';\nimport Tag from 'sentry/components/tag';\nimport accountEmailsFields from 'sentry/data/forms/accountEmails';\nimport {IconDelete, IconStack} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport {UserEmail} from 'sentry/types';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\n\nconst ENDPOINT = '/users/me/emails/';\n\ntype Props = AsyncView['props'];\n\ntype State = AsyncView['state'] & {\n  emails: UserEmail[];\n};\n\nclass AccountEmails extends AsyncView<Props, State> {\n  getTitle() {\n    return t('Emails');\n  }\n\n  getEndpoints() {\n    return [];\n  }\n\n  handleSubmitSuccess: FormProps['onSubmitSuccess'] = (_change, model, id) => {\n    if (id === undefined) {\n      return;\n    }\n    model.setValue(id, '');\n    this.remountComponent();\n  };\n\n  renderBody() {\n    return (\n      <Fragment>\n        <SettingsPageHeader title={t('Email Addresses')} />\n        <EmailAddresses />\n        <Form\n          apiMethod=\"POST\"\n          apiEndpoint={ENDPOINT}\n          saveOnBlur\n          allowUndo={false}\n          onSubmitSuccess={this.handleSubmitSuccess}\n        >\n          <JsonForm forms={accountEmailsFields} />\n        </Form>\n\n        <AlertLink to=\"/settings/account/notifications\" icon={<IconStack />}>\n          {t('Want to change how many emails you get? Use the notifications panel.')}\n        </AlertLink>\n      </Fragment>\n    );\n  }\n}\n\nexport default AccountEmails;\n\nexport class EmailAddresses extends AsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['emails', ENDPOINT]];\n  }\n  doApiCall(endpoint: string, requestParams: RequestOptions) {\n    this.setState({loading: true, emails: []}, () =>\n      this.api\n        .requestPromise(endpoint, requestParams)\n        .then(() => this.remountComponent())\n        .catch(err => {\n          this.remountComponent();\n\n          if (err?.responseJSON?.email) {\n            addErrorMessage(err.responseJSON.email);\n          }\n        })\n    );\n  }\n  handleSetPrimary = (email: string) =>\n    this.doApiCall(ENDPOINT, {\n      method: 'PUT',\n      data: {email},\n    });\n\n  handleRemove = (email: string) =>\n    this.doApiCall(ENDPOINT, {\n      method: 'DELETE',\n      data: {email},\n    });\n\n  handleVerify = (email: string) =>\n    this.doApiCall(`${ENDPOINT}confirm/`, {\n      method: 'POST',\n      data: {email},\n    });\n\n  render() {\n    const {emails, loading} = this.state;\n    const primary = emails?.find(({isPrimary}) => isPrimary);\n    const secondary = emails?.filter(({isPrimary}) => !isPrimary);\n\n    if (loading) {\n      return (\n        <Panel>\n          <PanelHeader>{t('Email Addresses')}</PanelHeader>\n          <PanelBody>\n            <LoadingIndicator />\n          </PanelBody>\n        </Panel>\n      );\n    }\n    return (\n      <Panel>\n        <PanelHeader>{t('Email Addresses')}</PanelHeader>\n        <PanelBody>\n          {primary && (\n            <EmailRow\n              onRemove={this.handleRemove}\n              onVerify={this.handleVerify}\n              {...primary}\n            />\n          )}\n\n          {secondary?.map(emailObj => (\n            <EmailRow\n              key={emailObj.email}\n              onSetPrimary={this.handleSetPrimary}\n              onRemove={this.handleRemove}\n              onVerify={this.handleVerify}\n              {...emailObj}\n            />\n          ))}\n        </PanelBody>\n      </Panel>\n    );\n  }\n}\n\ntype EmailRowProps = {\n  email: string;\n  onRemove: (email: string, e: React.MouseEvent) => void;\n  onVerify: (email: string, e: React.MouseEvent) => void;\n  hideRemove?: boolean;\n  isPrimary?: boolean;\n  isVerified?: boolean;\n  onSetPrimary?: (email: string, e: React.MouseEvent) => void;\n};\n\nfunction EmailRow({\n  email,\n  onRemove,\n  onVerify,\n  onSetPrimary,\n  isVerified,\n  isPrimary,\n  hideRemove,\n}: EmailRowProps) {\n  return (\n    <EmailItem>\n      <EmailTags>\n        {email}\n        {!isVerified && <Tag type=\"warning\">{t('Unverified')}</Tag>}\n        {isPrimary && <Tag type=\"success\">{t('Primary')}</Tag>}\n      </EmailTags>\n      <ButtonBar gap={1}>\n        {!isPrimary && isVerified && (\n          <Button size=\"sm\" onClick={e => onSetPrimary?.(email, e)}>\n            {t('Set as primary')}\n          </Button>\n        )}\n        {!isVerified && (\n          <Button size=\"sm\" onClick={e => onVerify(email, e)}>\n            {t('Resend verification')}\n          </Button>\n        )}\n        {!hideRemove && !isPrimary && (\n          <Button\n            aria-label={t('Remove email')}\n            data-test-id=\"remove\"\n            priority=\"danger\"\n            size=\"sm\"\n            icon={<IconDelete />}\n            onClick={e => onRemove(email, e)}\n          />\n        )}\n      </ButtonBar>\n    </EmailItem>\n  );\n}\n\nconst EmailTags = styled('div')`\n  display: grid;\n  grid-auto-flow: column;\n  gap: ${space(1)};\n  align-items: center;\n`;\n\nconst EmailItem = styled(PanelItem)`\n  justify-content: space-between;\n`;\n"],"names":["FormPanel","_ref","additionalFieldProps","title","fields","access","disabled","renderFooter","renderHeader","collapsible","initiallyCollapsed","otherProps","collapsed","setCollapse","useState","handleCollapseToggle","useCallback","current","_jsxs","Panel","id","sanitizeQuerySelector","undefined","children","PanelHeader","_jsx","Collapse","onClick","IconChevron","direction","size","PanelBody","hidden","map","field","defaultValue","_","fieldWithoutDefaultValue","disabledReason","FieldFromConfig","highlighted","name","displayName","_styled","target","styles","ENDPOINT","AccountEmails","AsyncView","constructor","arguments","_defineProperty","_change","model","setValue","this","remountComponent","getTitle","t","getEndpoints","renderBody","Fragment","SettingsPageHeader","EmailAddresses","Form","apiMethod","apiEndpoint","saveOnBlur","allowUndo","onSubmitSuccess","handleSubmitSuccess","JsonForm","forms","accountEmailsFields","AlertLink","to","icon","IconStack","AsyncComponent","email","doApiCall","method","data","endpoint","requestParams","setState","loading","emails","api","requestPromise","then","catch","err","responseJSON","addErrorMessage","render","state","primary","find","isPrimary","secondary","filter","_ref2","LoadingIndicator","EmailRow","onRemove","handleRemove","onVerify","handleVerify","emailObj","onSetPrimary","handleSetPrimary","_ref3","isVerified","hideRemove","EmailItem","EmailTags","Tag","type","ButtonBar","gap","Button","e","priority","IconDelete","space","PanelItem"],"sourceRoot":""}