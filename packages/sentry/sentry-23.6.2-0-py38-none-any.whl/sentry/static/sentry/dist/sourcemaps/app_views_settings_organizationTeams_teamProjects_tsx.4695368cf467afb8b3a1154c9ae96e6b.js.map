{"version":3,"file":"chunks/app_views_settings_organizationTeams_teamProjects_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/settings/components/settingsProjectItem.tsx","webpack:///./app/views/settings/organizationTeams/teamProjects.tsx","webpack:///./app/views/settings/project/permissionAlert.tsx"],"sourcesContent":["import styled from '@emotion/styled';\n\nimport ProjectBadge from 'sentry/components/idBadge/projectBadge';\nimport BookmarkStar from 'sentry/components/projects/bookmarkStar';\nimport {space} from 'sentry/styles/space';\nimport {Organization, Project} from 'sentry/types';\n\ntype Props = {\n  organization: Organization;\n  project: Project;\n};\n\nfunction ProjectItem({project, organization}: Props) {\n  return (\n    <Wrapper>\n      <BookmarkStar organization={organization} project={project} />\n      <ProjectBadge\n        to={`/settings/${organization.slug}/projects/${project.slug}/`}\n        avatarSize={18}\n        project={project}\n      />\n    </Wrapper>\n  );\n}\n\nconst Wrapper = styled('div')`\n  display: grid;\n  grid-template-columns: max-content 1fr;\n  align-items: center;\n  gap: ${space(1.5)};\n`;\n\nexport default ProjectItem;\n","import {Component, Fragment} from 'react';\nimport {RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {Client} from 'sentry/api';\nimport {hasEveryAccess} from 'sentry/components/acl/access';\nimport {Button} from 'sentry/components/button';\nimport DropdownAutoComplete from 'sentry/components/dropdownAutoComplete';\nimport DropdownButton from 'sentry/components/dropdownButton';\nimport EmptyMessage from 'sentry/components/emptyMessage';\nimport LoadingError from 'sentry/components/loadingError';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport Pagination from 'sentry/components/pagination';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'sentry/components/panels';\nimport {Tooltip} from 'sentry/components/tooltip';\nimport {IconFlag, IconSubtract} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport ProjectsStore from 'sentry/stores/projectsStore';\nimport {space} from 'sentry/styles/space';\nimport {Organization, Project, Team} from 'sentry/types';\nimport {sortProjects} from 'sentry/utils';\nimport withApi from 'sentry/utils/withApi';\nimport withOrganization from 'sentry/utils/withOrganization';\nimport ProjectListItem from 'sentry/views/settings/components/settingsProjectItem';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\nimport PermissionAlert from 'sentry/views/settings/project/permissionAlert';\n\ntype Props = {\n  api: Client;\n  organization: Organization;\n  team: Team;\n} & RouteComponentProps<{teamId: string}, {}>;\n\ntype State = {\n  error: boolean;\n  linkedProjects: Project[];\n  loading: boolean;\n  pageLinks: null | string;\n  unlinkedProjects: Project[];\n};\n\ntype DropdownAutoCompleteProps = React.ComponentProps<typeof DropdownAutoComplete>;\ntype Item = Parameters<NonNullable<DropdownAutoCompleteProps['onSelect']>>[0];\n\nclass TeamProjects extends Component<Props, State> {\n  state: State = {\n    error: false,\n    loading: true,\n    pageLinks: null,\n    unlinkedProjects: [],\n    linkedProjects: [],\n  };\n\n  componentDidMount() {\n    this.fetchAll();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      prevProps.organization.slug !== this.props.organization.slug ||\n      prevProps.params.teamId !== this.props.params.teamId\n    ) {\n      this.fetchAll();\n    }\n\n    if (prevProps.location !== this.props.location) {\n      this.fetchTeamProjects();\n    }\n  }\n\n  fetchAll = () => {\n    this.fetchTeamProjects();\n    this.fetchUnlinkedProjects();\n  };\n\n  fetchTeamProjects() {\n    const {\n      location,\n      organization,\n      params: {teamId},\n    } = this.props;\n\n    this.setState({loading: true});\n\n    this.props.api\n      .requestPromise(`/organizations/${organization.slug}/projects/`, {\n        query: {\n          query: `team:${teamId}`,\n          cursor: location.query.cursor || '',\n        },\n        includeAllArgs: true,\n      })\n      .then(([linkedProjects, _, resp]) => {\n        this.setState({\n          loading: false,\n          error: false,\n          linkedProjects,\n          pageLinks: resp?.getResponseHeader('Link') ?? null,\n        });\n      })\n      .catch(() => {\n        this.setState({loading: false, error: true});\n      });\n  }\n\n  fetchUnlinkedProjects(query = '') {\n    const {\n      organization,\n      params: {teamId},\n    } = this.props;\n\n    this.props.api\n      .requestPromise(`/organizations/${organization.slug}/projects/`, {\n        query: {\n          query: query ? `!team:${teamId} ${query}` : `!team:${teamId}`,\n        },\n      })\n      .then(unlinkedProjects => {\n        this.setState({unlinkedProjects});\n      });\n  }\n\n  handleLinkProject = (project: Project, action: string) => {\n    const {organization} = this.props;\n    const {teamId} = this.props.params;\n    this.props.api.request(\n      `/projects/${organization.slug}/${project.slug}/teams/${teamId}/`,\n      {\n        method: action === 'add' ? 'POST' : 'DELETE',\n        success: resp => {\n          this.fetchAll();\n          ProjectsStore.onUpdateSuccess(resp);\n          addSuccessMessage(\n            action === 'add'\n              ? t('Successfully added project to team.')\n              : t('Successfully removed project from team')\n          );\n        },\n        error: () => {\n          addErrorMessage(t(\"Wasn't able to change project association.\"));\n        },\n      }\n    );\n  };\n\n  handleProjectSelected = (selection: Item) => {\n    const project = this.state.unlinkedProjects.find(p => p.id === selection.value);\n    if (project) {\n      this.handleLinkProject(project, 'add');\n    }\n  };\n\n  handleQueryUpdate = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    this.fetchUnlinkedProjects(evt.target.value);\n  };\n\n  projectPanelContents(projects: Project[]) {\n    const {organization, team} = this.props;\n    const hasWriteAccess = hasEveryAccess(['team:write'], {organization, team});\n\n    return projects.length ? (\n      sortProjects(projects).map(project => (\n        <StyledPanelItem key={project.id}>\n          <ProjectListItem project={project} organization={organization} />\n          <Tooltip\n            disabled={hasWriteAccess}\n            title={t('You do not have enough permission to change project association.')}\n          >\n            <Button\n              size=\"sm\"\n              disabled={!hasWriteAccess}\n              icon={<IconSubtract isCircled size=\"xs\" />}\n              aria-label={t('Remove')}\n              onClick={() => {\n                this.handleLinkProject(project, 'remove');\n              }}\n            >\n              {t('Remove')}\n            </Button>\n          </Tooltip>\n        </StyledPanelItem>\n      ))\n    ) : (\n      <EmptyMessage size=\"large\" icon={<IconFlag size=\"xl\" />}>\n        {t(\"This team doesn't have access to any projects.\")}\n      </EmptyMessage>\n    );\n  }\n\n  render() {\n    const {organization, team} = this.props;\n    const {linkedProjects, unlinkedProjects, error, loading} = this.state;\n\n    if (error) {\n      return <LoadingError onRetry={() => this.fetchAll()} />;\n    }\n\n    if (loading) {\n      return <LoadingIndicator />;\n    }\n\n    const hasWriteAccess = hasEveryAccess(['team:write'], {organization, team});\n    const otherProjects = unlinkedProjects\n      .filter(p => p.access.includes('project:write'))\n      .map(p => ({\n        value: p.id,\n        searchKey: p.slug,\n        label: <ProjectListElement>{p.slug}</ProjectListElement>,\n      }));\n\n    return (\n      <Fragment>\n        <TextBlock>\n          {t(\n            'If you have Team Admin permissions for other projects, you can associate them with this team.'\n          )}\n        </TextBlock>\n        <PermissionAlert access={['team:write']} team={team} />\n\n        <Panel>\n          <PanelHeader hasButtons>\n            <div>{t('Projects')}</div>\n            <div style={{textTransform: 'none'}}>\n              {!hasWriteAccess ? (\n                <DropdownButton\n                  disabled\n                  title={t('You do not have enough permission to associate a project.')}\n                  size=\"xs\"\n                >\n                  {t('Add Project')}\n                </DropdownButton>\n              ) : (\n                <DropdownAutoComplete\n                  items={otherProjects}\n                  onChange={this.handleQueryUpdate}\n                  onSelect={this.handleProjectSelected}\n                  emptyMessage={t('You are not an admin for any other projects')}\n                  alignMenu=\"right\"\n                >\n                  {({isOpen}) => (\n                    <DropdownButton isOpen={isOpen} size=\"xs\">\n                      {t('Add Project')}\n                    </DropdownButton>\n                  )}\n                </DropdownAutoComplete>\n              )}\n            </div>\n          </PanelHeader>\n          <PanelBody>{this.projectPanelContents(linkedProjects)}</PanelBody>\n        </Panel>\n        <Pagination pageLinks={this.state.pageLinks} {...this.props} />\n      </Fragment>\n    );\n  }\n}\n\nconst StyledPanelItem = styled(PanelItem)`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ${space(2)};\n`;\n\nconst ProjectListElement = styled('div')`\n  padding: ${space(0.25)} 0;\n`;\n\nexport {TeamProjects};\n\nexport default withApi(withOrganization(TeamProjects));\n","import Access from 'sentry/components/acl/access';\nimport {Alert} from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\nimport {Project, Scope, Team} from 'sentry/types';\n\ninterface Props extends React.ComponentPropsWithoutRef<typeof Alert> {\n  access?: Scope[];\n  project?: Project | null | undefined;\n  team?: Team | null | undefined;\n}\n\nexport const permissionAlertText = t(\n  'These settings can only be edited by users with the organization-level owner, manager, or team-level admin roles.'\n);\n\nfunction PermissionAlert({access = ['project:write'], project, team, ...props}: Props) {\n  return (\n    <Access access={access} project={project} team={team}>\n      {({hasAccess}) =>\n        !hasAccess && (\n          <Alert data-test-id=\"project-permission-alert\" type=\"warning\" {...props}>\n            {permissionAlertText}\n          </Alert>\n        )\n      }\n    </Access>\n  );\n}\n\nexport default PermissionAlert;\n"],"names":["ProjectItem","_ref","project","organization","_jsxs","Wrapper","children","_jsx","BookmarkStar","ProjectBadge","to","slug","avatarSize","displayName","_styled","target","space","TeamProjects","Component","constructor","arguments","_defineProperty","error","loading","pageLinks","unlinkedProjects","linkedProjects","this","fetchTeamProjects","fetchUnlinkedProjects","action","props","teamId","params","api","request","method","success","resp","fetchAll","ProjectsStore","onUpdateSuccess","addSuccessMessage","t","addErrorMessage","selection","state","find","p","id","value","handleLinkProject","evt","componentDidMount","componentDidUpdate","prevProps","location","setState","requestPromise","query","cursor","includeAllArgs","then","_","getResponseHeader","catch","length","undefined","projectPanelContents","projects","team","hasWriteAccess","hasEveryAccess","sortProjects","map","StyledPanelItem","ProjectListItem","Tooltip","disabled","title","Button","size","icon","IconSubtract","isCircled","onClick","EmptyMessage","IconFlag","render","LoadingError","onRetry","LoadingIndicator","otherProjects","filter","access","includes","searchKey","label","ProjectListElement","Fragment","TextBlock","PermissionAlert","Panel","PanelHeader","hasButtons","style","textTransform","DropdownAutoComplete","items","onChange","handleQueryUpdate","onSelect","handleProjectSelected","emptyMessage","alignMenu","_ref2","isOpen","DropdownButton","PanelBody","Pagination","PanelItem","withApi","withOrganization","permissionAlertText","Access","hasAccess","Alert","type"],"sourceRoot":""}