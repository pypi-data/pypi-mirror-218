{"version":3,"file":"chunks/app_components_pickProjectToContinue_tsx-app_utils_discover_discoverQuery_tsx-node_modules_lo-cee157.xxxxxxxxxxxxxxxxxxxx.js","mappings":"2mBA4BA,SAASA,EAAqBC,GAMpB,IANqB,sBAC7BC,EAAqB,SACrBC,EAAQ,OACRC,EAAM,SACNC,EAAQ,0BACRC,GAA4B,GACtBL,EACN,MAAMM,EAAgBJ,EAASK,MAC/B,IAAIC,GAAa,EACbC,EAAQ,GAAEP,EAASQ,oBAEvB,GAAIJ,EAAe,CACjB,MAIMK,EAAe,IAJCC,OAAOC,QAAQP,GAClCQ,QAAOC,IAAA,IAAEC,EAAKC,GAAOF,EAAA,MAAa,YAARC,CAAiB,IAC3CE,KAAIC,IAAA,IAAEH,EAAKI,GAAMD,EAAA,MAAM,GAAEH,KAAOI,GAAO,IAEF,YAAYC,KAAK,KAEzDZ,EAAQ,GAAEP,EAASQ,YAAYC,GACjC,CAGA,OAAwB,IAApBP,EAASkB,QACXnB,EAAOoB,QAAQd,EAAOL,EAAS,GAAGoB,IAC3B,QAGTC,EAAAA,EAAAA,YACEC,IACEC,EAAAA,EAAAA,IAACC,EAAAA,EAAkB,IACbF,EACJG,SAAS,EACTC,aAAW,EACX5B,SAAW,GAAEO,YACbsB,SAAUrB,IACRF,GAAa,EACbL,EAAOoB,QAAQb,EAAS,EAE1BsB,aAAc5B,EAASc,KAAIe,GAAKA,EAAEC,OAClC7B,0BAA2BA,KAG/B,CACE8B,UAGO3B,GACHL,EAAOiC,KAAKnC,EAEhB,KAIG0B,EAAAA,EAAAA,IAACU,EAAuB,IACjC,CAtDStC,EAAqBuC,YAAA,wBAwD9B,MAAMD,GAA0BE,EAAAA,EAAAA,GAAO,MAAK,CAAAC,OAAA,aAAZD,CAAa,CAAAE,KAAA,SAAAC,OAAA,4BAK7C,G,oPC5CA,SAASC,EACPC,EACAC,GAEA,OACED,EAAUE,kBAAoBD,EAAUC,iBACxCF,EAAUG,uBAAyBF,EAAUE,sBAC7CH,EAAUI,6BAA+BH,EAAUG,0BAEvD,CAEA,SAASC,EAAcC,GAQrB,OACEvB,EAAAA,EAAAA,IAACwB,EAAAA,GAAoB,CACnBC,MAAM,SACNT,kBAAmBA,EACnBU,WAXeA,CAACC,EAAMC,KACxB,MAAM,OAACC,KAAWC,GAAaH,EAAKI,MAAQ,CAAC,EAC7C,MAAO,IACFJ,EACHI,KAAM,IAAIF,KAAWC,GACtB,KAOKP,GAGV,CAEO,SAASS,EAAiBT,GAC/B,MAQMU,GAAMC,EAAAA,EAAAA,IAAqE,CAC/ET,MAAO,SACPT,oBACAU,WAXiBA,CAACC,EAAMC,KACxB,MAAM,OAACC,KAAWC,GAAaH,EAAKI,MAAQ,CAAC,EAC7C,MAAO,IACFJ,EACHI,KAAM,IAAIF,KAAWC,GACtB,KAOEP,IAGCY,EAAYF,EAAIG,UAAUC,kBAAkB,cAAWC,EAE7D,MAAO,IAAIL,EAAKE,YAClB,CArCSb,EAAaX,YAAA,gBAuCtB,S,yCCxDA4B,EAAOC,QAhBP,SAAgBC,GACd,GAAwB,mBAAbA,EACT,MAAM,IAAIC,UAxBQ,uBA0BpB,OAAO,WACL,IAAIC,EAAOC,UACX,OAAQD,EAAKhD,QACX,KAAK,EAAG,OAAQ8C,EAAUI,KAAKC,MAC/B,KAAK,EAAG,OAAQL,EAAUI,KAAKC,KAAMH,EAAK,IAC1C,KAAK,EAAG,OAAQF,EAAUI,KAAKC,KAAMH,EAAK,GAAIA,EAAK,IACnD,KAAK,EAAG,OAAQF,EAAUI,KAAKC,KAAMH,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAE9D,OAAQF,EAAUM,MAAMD,KAAMH,EAChC,CACF,C,+CCrCA,IAAIK,EAAe,EAAQ,2CACvBC,EAAS,EAAQ,oCACjBC,EAAS,EAAQ,oCA0BrBX,EAAOC,QAJP,SAAgBW,EAAQV,GACtB,OAAOS,EAAOC,EAAQF,EAAOD,EAAaP,IAC5C,C","sources":["webpack:///./app/components/pickProjectToContinue.tsx","webpack:///./app/utils/discover/discoverQuery.tsx","webpack:///../node_modules/lodash/negate.js","webpack:///../node_modules/lodash/omitBy.js"],"sourcesContent":["import {InjectedRouter} from 'react-router';\nimport styled from '@emotion/styled';\nimport {LocationDescriptor, LocationDescriptorObject} from 'history';\n\nimport {openModal} from 'sentry/actionCreators/modal';\nimport ContextPickerModal from 'sentry/components/contextPickerModal';\n\ntype Project = {\n  id: string;\n  slug: string;\n};\n\ntype Props = {\n  /**\n   * Path used on the redirect router if the user did select a project\n   */\n  nextPath: Pick<LocationDescriptorObject, 'query'> & {\n    pathname: NonNullable<LocationDescriptorObject['pathname']>;\n  };\n  /**\n   * Path used on the redirect router if the user did not select a project\n   */\n  noProjectRedirectPath: LocationDescriptor;\n  projects: Project[];\n  router: InjectedRouter;\n  allowAllProjectsSelection?: boolean;\n};\n\nfunction PickProjectToContinue({\n  noProjectRedirectPath,\n  nextPath,\n  router,\n  projects,\n  allowAllProjectsSelection = false,\n}: Props) {\n  const nextPathQuery = nextPath.query;\n  let navigating = false;\n  let path = `${nextPath.pathname}?project=`;\n\n  if (nextPathQuery) {\n    const filteredQuery = Object.entries(nextPathQuery)\n      .filter(([key, _value]) => key !== 'project')\n      .map(([key, value]) => `${key}=${value}`);\n\n    const newPathQuery = [...filteredQuery, 'project='].join('&');\n\n    path = `${nextPath.pathname}?${newPathQuery}`;\n  }\n\n  // if the project in URL is missing, but this release belongs to only one project, redirect there\n  if (projects.length === 1) {\n    router.replace(path + projects[0].id);\n    return null;\n  }\n\n  openModal(\n    modalProps => (\n      <ContextPickerModal\n        {...modalProps}\n        needOrg={false}\n        needProject\n        nextPath={`${path}:project`}\n        onFinish={pathname => {\n          navigating = true;\n          router.replace(pathname);\n        }}\n        projectSlugs={projects.map(p => p.slug)}\n        allowAllProjectsSelection={allowAllProjectsSelection}\n      />\n    ),\n    {\n      onClose() {\n        // we want this to be executed only if the user didn't select any project\n        // (closed modal either via button, Esc, clicking outside, ...)\n        if (!navigating) {\n          router.push(noProjectRedirectPath);\n        }\n      },\n    }\n  );\n\n  return <ContextPickerBackground />;\n}\n\nconst ContextPickerBackground = styled('div')`\n  height: 100vh;\n  width: 100%;\n`;\n\nexport default PickProjectToContinue;\n","import {EventsMetaType, MetaType} from 'sentry/utils/discover/eventView';\nimport {TransactionThresholdMetric} from 'sentry/views/performance/transactionSummary/transactionThresholdModal';\n\nimport GenericDiscoverQuery, {\n  DiscoverQueryProps,\n  GenericChildrenProps,\n  useGenericDiscoverQuery,\n} from './genericDiscoverQuery';\n\n/**\n * An individual row in a DiscoverQuery result\n */\nexport type TableDataRow = {\n  [key: string]: React.ReactText;\n  id: string;\n};\n\n/**\n * A DiscoverQuery result including rows and metadata.\n */\nexport type TableData = {\n  data: Array<TableDataRow>;\n  meta?: MetaType;\n};\n\n/**\n * A DiscoverQuery result including rows and metadata from the events endpoint.\n */\nexport type EventsTableData = {\n  data: Array<TableDataRow>;\n  meta?: EventsMetaType;\n};\n\nexport type TableDataWithTitle = TableData & {title: string};\n\nexport type DiscoverQueryPropsWithThresholds = DiscoverQueryProps & {\n  transactionName?: string;\n  transactionThreshold?: number;\n  transactionThresholdMetric?: TransactionThresholdMetric;\n};\n\nexport type DiscoverQueryComponentProps = DiscoverQueryPropsWithThresholds & {\n  children: (props: GenericChildrenProps<TableData>) => React.ReactNode;\n};\n\nfunction shouldRefetchData(\n  prevProps: DiscoverQueryPropsWithThresholds,\n  nextProps: DiscoverQueryPropsWithThresholds\n) {\n  return (\n    prevProps.transactionName !== nextProps.transactionName ||\n    prevProps.transactionThreshold !== nextProps.transactionThreshold ||\n    prevProps.transactionThresholdMetric !== nextProps.transactionThresholdMetric\n  );\n}\n\nfunction DiscoverQuery(props: DiscoverQueryComponentProps) {\n  const afterFetch = (data, _) => {\n    const {fields, ...otherMeta} = data.meta ?? {};\n    return {\n      ...data,\n      meta: {...fields, ...otherMeta},\n    };\n  };\n  return (\n    <GenericDiscoverQuery<TableData, DiscoverQueryPropsWithThresholds>\n      route=\"events\"\n      shouldRefetchData={shouldRefetchData}\n      afterFetch={afterFetch}\n      {...props}\n    />\n  );\n}\n\nexport function useDiscoverQuery(props: Omit<DiscoverQueryComponentProps, 'children'>) {\n  const afterFetch = (data, _) => {\n    const {fields, ...otherMeta} = data.meta ?? {};\n    return {\n      ...data,\n      meta: {...fields, ...otherMeta},\n    };\n  };\n\n  const res = useGenericDiscoverQuery<TableData, DiscoverQueryPropsWithThresholds>({\n    route: 'events',\n    shouldRefetchData,\n    afterFetch,\n    ...props,\n  });\n\n  const pageLinks = res.response?.getResponseHeader('Link') ?? undefined;\n\n  return {...res, pageLinks};\n}\n\nexport default DiscoverQuery;\n","/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that negates the result of the predicate `func`. The\n * `func` predicate is invoked with the `this` binding and arguments of the\n * created function.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Function\n * @param {Function} predicate The predicate to negate.\n * @returns {Function} Returns the new negated function.\n * @example\n *\n * function isEven(n) {\n *   return n % 2 == 0;\n * }\n *\n * _.filter([1, 2, 3, 4, 5, 6], _.negate(isEven));\n * // => [1, 3, 5]\n */\nfunction negate(predicate) {\n  if (typeof predicate != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  return function() {\n    var args = arguments;\n    switch (args.length) {\n      case 0: return !predicate.call(this);\n      case 1: return !predicate.call(this, args[0]);\n      case 2: return !predicate.call(this, args[0], args[1]);\n      case 3: return !predicate.call(this, args[0], args[1], args[2]);\n    }\n    return !predicate.apply(this, args);\n  };\n}\n\nmodule.exports = negate;\n","var baseIteratee = require('./_baseIteratee'),\n    negate = require('./negate'),\n    pickBy = require('./pickBy');\n\n/**\n * The opposite of `_.pickBy`; this method creates an object composed of\n * the own and inherited enumerable string keyed properties of `object` that\n * `predicate` doesn't return truthy for. The predicate is invoked with two\n * arguments: (value, key).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The source object.\n * @param {Function} [predicate=_.identity] The function invoked per property.\n * @returns {Object} Returns the new object.\n * @example\n *\n * var object = { 'a': 1, 'b': '2', 'c': 3 };\n *\n * _.omitBy(object, _.isNumber);\n * // => { 'b': '2' }\n */\nfunction omitBy(object, predicate) {\n  return pickBy(object, negate(baseIteratee(predicate)));\n}\n\nmodule.exports = omitBy;\n"],"names":["PickProjectToContinue","_ref","noProjectRedirectPath","nextPath","router","projects","allowAllProjectsSelection","nextPathQuery","query","navigating","path","pathname","newPathQuery","Object","entries","filter","_ref2","key","_value","map","_ref3","value","join","length","replace","id","openModal","modalProps","_jsx","ContextPickerModal","needOrg","needProject","onFinish","projectSlugs","p","slug","onClose","push","ContextPickerBackground","displayName","_styled","target","name","styles","shouldRefetchData","prevProps","nextProps","transactionName","transactionThreshold","transactionThresholdMetric","DiscoverQuery","props","GenericDiscoverQuery","route","afterFetch","data","_","fields","otherMeta","meta","useDiscoverQuery","res","useGenericDiscoverQuery","pageLinks","response","getResponseHeader","undefined","module","exports","predicate","TypeError","args","arguments","call","this","apply","baseIteratee","negate","pickBy","object"],"sourceRoot":""}