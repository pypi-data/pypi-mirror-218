{"version":3,"file":"ShareButton-792925e9.js","sources":["../../../../js/utils/src/utils.ts","../../../../js/atoms/src/ShareButton.svelte"],"sourcesContent":["export interface SelectData {\r\n\tindex: number | [number, number];\r\n\tvalue: any;\r\n\tselected?: boolean;\r\n}\r\n\r\nexport interface ShareData {\r\n\tdescription: string;\r\n\ttitle?: string;\r\n}\r\n\r\nexport class ShareError extends Error {\r\n\tconstructor(message: string) {\r\n\t\tsuper(message);\r\n\t\tthis.name = \"ShareError\";\r\n\t}\r\n}\r\n\r\nexport const uploadToHuggingFace = async (\r\n\tdata: string,\r\n\ttype: \"base64\" | \"url\"\r\n) => {\r\n\tif (window.__gradio_space__ == null) {\r\n\t\tthrow new ShareError(\"Must be on Spaces to share.\");\r\n\t}\r\n\tlet blob: Blob;\r\n\tlet contentType: string;\r\n\tlet filename: string;\r\n\tif (type === \"url\") {\r\n\t\tconst response = await fetch(data);\r\n\t\tblob = await response.blob();\r\n\t\tcontentType = response.headers.get(\"content-type\") || \"\";\r\n\t\tfilename = response.headers.get(\"content-disposition\") || \"\";\r\n\t} else {\r\n\t\tblob = dataURLtoBlob(data);\r\n\t\tcontentType = data.split(\";\")[0].split(\":\")[1];\r\n\t\tfilename = \"file\" + contentType.split(\"/\")[1];\r\n\t}\r\n\r\n\tconst file = new File([blob], filename, { type: contentType });\r\n\r\n\t// Send file to endpoint\r\n\tconst uploadResponse = await fetch(\"https://huggingface.co/uploads\", {\r\n\t\tmethod: \"POST\",\r\n\t\tbody: file,\r\n\t\theaders: {\r\n\t\t\t\"Content-Type\": file.type,\r\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\r\n\t\t}\r\n\t});\r\n\r\n\t// Check status of response\r\n\tif (!uploadResponse.ok) {\r\n\t\tif (\r\n\t\t\tuploadResponse.headers.get(\"content-type\")?.includes(\"application/json\")\r\n\t\t) {\r\n\t\t\tconst error = await uploadResponse.json();\r\n\t\t\tthrow new ShareError(`Upload failed: ${error.error}`);\r\n\t\t}\r\n\t\tthrow new ShareError(`Upload failed.`);\r\n\t}\r\n\r\n\t// Return response if needed\r\n\tconst result = await uploadResponse.text();\r\n\treturn result;\r\n};\r\n\r\nfunction dataURLtoBlob(dataurl: string) {\r\n\tvar arr = dataurl.split(\",\"),\r\n\t\tmime = (arr[0].match(/:(.*?);/) as RegExpMatchArray)[1],\r\n\t\tbstr = atob(arr[1]),\r\n\t\tn = bstr.length,\r\n\t\tu8arr = new Uint8Array(n);\r\n\twhile (n--) {\r\n\t\tu8arr[n] = bstr.charCodeAt(n);\r\n\t}\r\n\treturn new Blob([u8arr], { type: mime });\r\n}\r\n","<script lang=\"ts\">\r\n\timport IconButton from \"./IconButton.svelte\";\r\n\timport { createEventDispatcher } from \"svelte\";\r\n\timport type { ShareData } from \"@gradio/utils\";\r\n\timport { ShareError } from \"@gradio/utils\";\r\n\t``;\r\n\tconst dispatch = createEventDispatcher<{\r\n\t\tshare: ShareData;\r\n\t\terror: string;\r\n\t}>();\r\n\r\n\texport let formatter: (arg0: any) => Promise<string>;\r\n\texport let value: any;\r\n\tlet pending: boolean = false;\r\n</script>\r\n\r\n<IconButton\r\n\tIcon={null}\r\n\tlabel=\"Share\"\r\n\t{pending}\r\n\ton:click={async () => {\r\n\t\ttry {\r\n\t\t\tpending = true;\r\n\t\t\tconst formatted = await formatter(value);\r\n\t\t\tdispatch(\"share\", {\r\n\t\t\t\tdescription: formatted\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\tlet message = e instanceof ShareError ? e.message : \"Share failed.\";\r\n\t\t\tdispatch(\"error\", message);\r\n\t\t} finally {\r\n\t\t\tpending = false;\r\n\t\t}\r\n\t}}\r\n/>\r\n"],"names":["ShareError","message","uploadToHuggingFace","data","type","blob","contentType","filename","response","dataURLtoBlob","file","uploadResponse","error","dataurl","arr","mime","bstr","u8arr","dispatch","createEventDispatcher","formatter","$$props","value","pending","$$invalidate","formatted","e"],"mappings":"+IAWO,MAAMA,UAAmB,KAAM,CACrC,YAAYC,EAAiB,CAC5B,MAAMA,CAAO,EACb,KAAK,KAAO,YACb,CACD,CAEa,MAAAC,EAAsB,MAClCC,EACAC,IACI,CACA,GAAA,OAAO,kBAAoB,KACxB,MAAA,IAAIJ,EAAW,6BAA6B,EAE/C,IAAAK,EACAC,EACAC,EACJ,GAAIH,IAAS,MAAO,CACb,MAAAI,EAAW,MAAM,MAAML,CAAI,EAC1BE,EAAA,MAAMG,EAAS,OACtBF,EAAcE,EAAS,QAAQ,IAAI,cAAc,GAAK,GACtDD,EAAWC,EAAS,QAAQ,IAAI,qBAAqB,GAAK,QAE1DH,EAAOI,EAAcN,CAAI,EACXG,EAAAH,EAAK,MAAM,GAAG,EAAE,CAAC,EAAE,MAAM,GAAG,EAAE,CAAC,EAC7CI,EAAW,OAASD,EAAY,MAAM,GAAG,EAAE,CAAC,EAGvC,MAAAI,EAAO,IAAI,KAAK,CAACL,CAAI,EAAGE,EAAU,CAAE,KAAMD,CAAA,CAAa,EAGvDK,EAAiB,MAAM,MAAM,iCAAkC,CACpE,OAAQ,OACR,KAAMD,EACN,QAAS,CACR,eAAgBA,EAAK,KACrB,mBAAoB,gBACrB,CAAA,CACA,EAGG,GAAA,CAACC,EAAe,GAAI,CACvB,GACCA,EAAe,QAAQ,IAAI,cAAc,GAAG,SAAS,kBAAkB,EACtE,CACK,MAAAC,EAAQ,MAAMD,EAAe,OACnC,MAAM,IAAIX,EAAW,kBAAkBY,EAAM,OAAO,EAE/C,MAAA,IAAIZ,EAAW,gBAAgB,EAK/B,OADQ,MAAMW,EAAe,MAErC,EAEA,SAASF,EAAcI,EAAiB,CAMvC,QALIC,EAAMD,EAAQ,MAAM,GAAG,EAC1BE,EAAQD,EAAI,CAAC,EAAE,MAAM,SAAS,EAAuB,CAAC,EACtDE,EAAO,KAAKF,EAAI,CAAC,CAAC,EAClB,EAAIE,EAAK,OACTC,EAAQ,IAAI,WAAW,CAAC,EAClB,KACNA,EAAM,CAAC,EAAID,EAAK,WAAW,CAAC,EAEtB,OAAA,IAAI,KAAK,CAACC,CAAK,EAAG,CAAE,KAAMF,EAAM,CACxC,mDC5DO,0PAXA,MAAAG,EAAWC,QAKN,UAAAC,CAAyC,EAAAC,GACzC,MAAAC,CAAU,EAAAD,EACjBE,EAAmB,yBASrBC,EAAA,EAAAD,EAAU,EAAI,QACRE,EAAS,MAASL,EAAUE,CAAK,EACvCJ,EAAS,QACR,CAAA,YAAaO,CAAS,CAAA,QAEfC,GACR,QAAQ,MAAMA,CAAC,MACXzB,EAAUyB,aAAa1B,EAAa0B,EAAE,QAAU,gBACpDR,EAAS,QAASjB,CAAO,UAEzBuB,EAAA,EAAAD,EAAU,EAAK"}