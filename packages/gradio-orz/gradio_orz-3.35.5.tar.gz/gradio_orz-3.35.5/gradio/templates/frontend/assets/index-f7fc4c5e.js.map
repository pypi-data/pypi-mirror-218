{"version":3,"file":"index-f7fc4c5e.js","sources":["../../../../js/app/src/components/AnnotatedImage/AnnotatedImage.svelte","../../../../js/app/src/components/AnnotatedImage/index.ts"],"sourcesContent":["<script lang=\"ts\">\r\n\timport { createEventDispatcher } from \"svelte\";\r\n\timport { Block, BlockLabel, Empty } from \"@gradio/atoms\";\r\n\timport { Image } from \"@gradio/icons\";\r\n\timport StatusTracker from \"../StatusTracker/StatusTracker.svelte\";\r\n\timport type { LoadingStatus } from \"../StatusTracker/types\";\r\n\timport { FileData, normalise_file } from \"@gradio/upload\";\r\n\timport type { SelectData } from \"@gradio/utils\";\r\n\r\n\texport let elem_id: string = \"\";\r\n\texport let elem_classes: Array<string> = [];\r\n\texport let visible: boolean = true;\r\n\texport let value: [FileData, Array<[FileData, string]>] | null;\r\n\tlet old_value: [FileData, Array<[FileData, string]>] | null;\r\n\tlet _value: [FileData, Array<[FileData, string]>] | null;\r\n\texport let label: string = \"Annotated Image\";\r\n\texport let show_label: boolean = true;\r\n\texport let show_legend: boolean = true;\r\n\texport let height: number | undefined;\r\n\texport let width: number | undefined;\r\n\texport let color_map: Record<string, string>;\r\n\texport let container: boolean = false;\r\n\texport let scale: number | null = null;\r\n\texport let min_width: number | undefined = undefined;\r\n\texport let root: string;\r\n\texport let root_url: string;\r\n\tlet active: string | null = null;\r\n\texport let loading_status: LoadingStatus;\r\n\r\n\tconst dispatch = createEventDispatcher<{\r\n\t\tchange: undefined;\r\n\t\tselect: SelectData;\r\n\t}>();\r\n\r\n\t$: {\r\n\t\tif (value !== old_value) {\r\n\t\t\told_value = value;\r\n\t\t\tdispatch(\"change\");\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\t_value = [\r\n\t\t\t\tnormalise_file(value[0], root, root_url) as FileData,\r\n\t\t\t\tvalue[1].map(([file, label]) => [\r\n\t\t\t\t\tnormalise_file(file, root, root_url) as FileData,\r\n\t\t\t\t\tlabel\r\n\t\t\t\t])\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\t_value = null;\r\n\t\t}\r\n\t}\r\n\tfunction handle_mouseover(label: string) {\r\n\t\tactive = label;\r\n\t}\r\n\tfunction handle_mouseout() {\r\n\t\tactive = null;\r\n\t}\r\n</script>\r\n\r\n<Block\r\n\t{visible}\r\n\t{elem_id}\r\n\t{elem_classes}\r\n\tpadding={false}\r\n\t{height}\r\n\t{width}\r\n\tallow_overflow={false}\r\n\t{container}\r\n\t{scale}\r\n\t{min_width}\r\n>\r\n\t<StatusTracker {...loading_status} />\r\n\t<BlockLabel {show_label} Icon={Image} label={label || \"Image\"} />\r\n\r\n\t<div class=\"container\">\r\n\t\t{#if _value == null}\r\n\t\t\t<Empty size=\"large\" unpadded_box={true}><Image /></Empty>\r\n\t\t{:else}\r\n\t\t\t<div class=\"image-container\">\r\n\t\t\t\t<!-- svelte-ignore a11y-missing-attribute -->\r\n\t\t\t\t<img\r\n\t\t\t\t\tclass=\"base-image\"\r\n\t\t\t\t\tclass:fit-height={height}\r\n\t\t\t\t\tsrc={_value ? _value[0].data : null}\r\n\t\t\t\t/>\r\n\t\t\t\t{#each _value ? _value[1] : [] as [file, label], i}\r\n\t\t\t\t\t<!-- svelte-ignore a11y-missing-attribute -->\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclass=\"mask fit-height\"\r\n\t\t\t\t\t\tclass:active={active == label}\r\n\t\t\t\t\t\tclass:inactive={active != label && active != null}\r\n\t\t\t\t\t\tsrc={file.data}\r\n\t\t\t\t\t\tstyle={color_map && label in color_map\r\n\t\t\t\t\t\t\t? null\r\n\t\t\t\t\t\t\t: `filter: hue-rotate(${Math.round(\r\n\t\t\t\t\t\t\t\t\t(i * 360) / _value[1].length\r\n\t\t\t\t\t\t\t  )}deg);`}\r\n\t\t\t\t\t/>\r\n\t\t\t\t{/each}\r\n\t\t\t</div>\r\n\t\t\t{#if show_legend && _value}\r\n\t\t\t\t<div class=\"legend\">\r\n\t\t\t\t\t{#each _value[1] as [_, label], i}\r\n\t\t\t\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass=\"legend-item\"\r\n\t\t\t\t\t\t\tstyle=\"background-color: {color_map && label in color_map\r\n\t\t\t\t\t\t\t\t? color_map[label] + '88'\r\n\t\t\t\t\t\t\t\t: `hsla(${Math.round(\r\n\t\t\t\t\t\t\t\t\t\t(i * 360) / _value[1].length\r\n\t\t\t\t\t\t\t\t  )}, 100%, 50%, 0.3)`}\"\r\n\t\t\t\t\t\t\ton:mouseover={() => handle_mouseover(label)}\r\n\t\t\t\t\t\t\ton:focus={() => handle_mouseover(label)}\r\n\t\t\t\t\t\t\ton:mouseout={() => handle_mouseout()}\r\n\t\t\t\t\t\t\ton:blur={() => handle_mouseout()}\r\n\t\t\t\t\t\t\ton:click={() => dispatch(\"select\", { index: i, value: label })}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{label}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t{/if}\r\n\t</div>\r\n</Block>\r\n\r\n<style>\r\n\t.base-image {\r\n\t\tdisplay: block;\r\n\t\twidth: 100%;\r\n\t\theight: auto;\r\n\t}\r\n\t.container {\r\n\t\tdisplay: flex;\r\n\t\tposition: relative;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\twidth: var(--size-full);\r\n\t\theight: var(--size-full);\r\n\t}\r\n\t.image-container {\r\n\t\tposition: relative;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tflex-grow: 1;\r\n\t\twidth: 100%;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t.fit-height {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tobject-fit: contain;\r\n\t}\r\n\t.mask {\r\n\t\topacity: 0.85;\r\n\t\ttransition: all 0.2s ease-in-out;\r\n\t}\r\n\t.image-container:hover .mask {\r\n\t\topacity: 0.3;\r\n\t}\r\n\t.mask.active {\r\n\t\topacity: 1;\r\n\t}\r\n\t.mask.inactive {\r\n\t\topacity: 0;\r\n\t}\r\n\t.legend {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tflex-wrap: wrap;\r\n\t\talign-content: center;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tgap: var(--spacing-sm);\r\n\t\tpadding: var(--spacing-sm);\r\n\t}\r\n\t.legend-item {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tcursor: pointer;\r\n\t\tborder-radius: var(--radius-sm);\r\n\t\tpadding: var(--spacing-sm);\r\n\t}\r\n</style>\r\n","export { default as Component } from \"./AnnotatedImage.svelte\";\r\nexport const modes = [\"static\"];\r\n\r\nexport const document = (config: Record<string, any>) => ({\r\n\ttype: {\r\n\t\tpayload: \"[string, Array<[string, string]>]\"\r\n\t},\r\n\tdescription: {\r\n\t\tpayload:\r\n\t\t\t\"path to base image, followed by a list of tuples [mask image path, label]\"\r\n\t}\r\n});\r\n"],"names":["ctx","i","if_block","create_if_block_1","src_url_equal","img","img_src_value","attr","insert","target","div","anchor","append","dirty","toggle_class","each_value","set_data","t0","t0_value","Image","blocklabel_changes","elem_id","$$props","elem_classes","visible","value","old_value","_value","label","show_label","show_legend","height","width","color_map","container","scale","min_width","root","root_url","active","loading_status","dispatch","createEventDispatcher","handle_mouseover","$$invalidate","handle_mouseout","mouseover_handler","focus_handler","normalise_file","file","modes","document","config"],"mappings":"+vBAqFWA,EAAM,EAAA,EAAGA,EAAM,EAAA,EAAC,CAAC,EAAA,wBAAtB,OAAIC,GAAA,mBAeF,IAAAC,EAAAF,MAAeA,EAAM,EAAA,GAAAG,EAAAH,CAAA,4IAjBnBI,EAAAC,EAAA,IAAAC,EAAAN,MAASA,EAAM,EAAA,EAAC,CAAC,EAAE,KAAO,IAAI,GAAAO,EAAAF,EAAA,MAAAC,CAAA,mBADjBN,EAAM,CAAA,CAAA,uDAJ1BQ,EAqBMC,EAAAC,EAAAC,CAAA,EAnBLC,EAIEF,EAAAL,CAAA,mGADIQ,EAAA,CAAA,EAAA,MAAA,CAAAT,EAAAC,EAAA,IAAAC,EAAAN,MAASA,EAAM,EAAA,EAAC,CAAC,EAAE,KAAO,IAAI,0CADjBA,EAAM,CAAA,CAAA,gBAGlBA,EAAM,EAAA,EAAGA,EAAM,EAAA,EAAC,CAAC,EAAA,qBAAtB,OAAIC,GAAA,EAAA,iHAAJ,OAeED,MAAeA,EAAM,EAAA,qMAxBQ,qUAe1BI,EAAAC,EAAA,IAAAC,EAAAN,MAAK,IAAI,GAAAO,EAAAF,EAAA,MAAAC,CAAA,gBACPN,EAAS,CAAA,GAAIA,EAAK,EAAA,IAAIA,EAAS,CAAA,EACnC,2BACsB,KAAK,MAC1BA,EAAC,EAAA,EAAG,IAAOA,EAAM,EAAA,EAAC,CAAC,EAAE,MAAM,QAAA,EANjBc,EAAAT,EAAA,SAAAL,OAAUA,EAAK,EAAA,CAAA,EACbc,EAAAT,EAAA,WAAAL,EAAU,EAAA,GAAAA,EAAS,EAAA,GAAAA,OAAU,IAAI,UAHlDQ,EAUEC,EAAAJ,EAAAM,CAAA,UANIE,EAAA,CAAA,EAAA,MAAA,CAAAT,EAAAC,EAAA,IAAAC,EAAAN,MAAK,IAAI,kCACPA,EAAS,CAAA,GAAIA,EAAK,EAAA,IAAIA,EAAS,CAAA,EACnC,2BACsB,KAAK,MAC1BA,EAAC,EAAA,EAAG,IAAOA,EAAM,EAAA,EAAC,CAAC,EAAE,MAAM,sCANjBc,EAAAT,EAAA,SAAAL,OAAUA,EAAK,EAAA,CAAA,cACbc,EAAAT,EAAA,WAAAL,EAAU,EAAA,GAAAA,EAAS,EAAA,GAAAA,OAAU,IAAI,sCAY3Ce,EAAAf,MAAO,CAAC,uBAAb,OAAIC,GAAA,0HADPO,EAmBMC,EAAAC,EAAAC,CAAA,2EAlBEI,EAAAf,MAAO,CAAC,oBAAb,OAAIC,GAAA,EAAA,iHAAJ,qDAeCD,EAAK,EAAA,EAAA,wNAXoBA,EAAS,CAAA,GAAIA,EAAK,EAAA,IAAIA,EAAS,CAAA,EACtDA,EAAS,CAAA,EAACA,EAAK,EAAA,CAAA,EAAI,aACX,KAAK,MACZA,EAAC,EAAA,EAAG,IAAOA,EAAM,EAAA,EAAC,CAAC,EAAE,MAAM,oBAAA,UALhCQ,EAcMC,EAAAC,EAAAC,CAAA,qJADJX,EAAK,EAAA,EAAA,KAAAgB,GAAAC,EAAAC,CAAA,oCAXoBlB,EAAS,CAAA,GAAIA,EAAK,EAAA,IAAIA,EAAS,CAAA,EACtDA,EAAS,CAAA,EAACA,EAAK,EAAA,CAAA,EAAI,aACX,KAAK,MACZA,EAAC,EAAA,EAAG,IAAOA,EAAM,EAAA,EAAC,CAAC,EAAE,MAAM,oBAAA,+OAtClBA,EAAc,EAAA,CAAA,8GACFmB,EAAc,MAAAnB,OAAS,gDAGhD,OAAAA,OAAU,KAAI,wLADpBQ,EAiDMC,EAAAC,EAAAC,CAAA,yDApDaX,EAAc,EAAA,CAAA,CAAA,CAAA,sDACYa,EAAA,CAAA,EAAA,OAAAO,EAAA,MAAApB,OAAS,maAT7C,yCAGO,wgBAzDL,GAAA,CAAA,QAAAqB,EAAkB,EAAE,EAAAC,GACpB,aAAAC,EAAY,EAAA,EAAAD,EACZ,CAAA,QAAAE,EAAmB,EAAI,EAAAF,GACvB,MAAAG,CAAmD,EAAAH,EAC1DI,EACAC,EACO,CAAA,MAAAC,EAAgB,iBAAiB,EAAAN,EACjC,CAAA,WAAAO,EAAsB,EAAI,EAAAP,EAC1B,CAAA,YAAAQ,EAAuB,EAAI,EAAAR,GAC3B,OAAAS,CAA0B,EAAAT,GAC1B,MAAAU,CAAyB,EAAAV,GACzB,UAAAW,CAAiC,EAAAX,EACjC,CAAA,UAAAY,EAAqB,EAAK,EAAAZ,EAC1B,CAAA,MAAAa,EAAuB,IAAI,EAAAb,EAC3B,CAAA,UAAAc,EAAgC,MAAS,EAAAd,GACzC,KAAAe,CAAY,EAAAf,GACZ,SAAAgB,CAAgB,EAAAhB,EACvBiB,EAAwB,MACjB,eAAAC,CAA6B,EAAAlB,EAElC,MAAAmB,EAAWC,KAsBR,SAAAC,EAAiBf,EAAa,CACtCgB,EAAA,GAAAL,EAASX,CAAK,WAENiB,GAAe,CACvBD,EAAA,GAAAL,EAAS,IAAI,EAwDY,MAAAO,EAAAlB,GAAAe,EAAiBf,CAAK,EAC1BmB,EAAAnB,GAAAe,EAAiBf,CAAK,QACnBiB,WACJA,cACCJ,EAAS,SAAY,CAAA,MAAOxC,EAAG,MAAO2B,CAAK,CAAA,imBAhF5DH,IAAUC,IACbkB,EAAA,GAAAlB,EAAYD,CAAK,EACjBgB,EAAS,QAAQ,GAEdhB,OACHE,EAAM,CACLqB,EAAevB,EAAM,CAAC,EAAGY,EAAMC,CAAQ,EACvCb,EAAM,CAAC,EAAE,IAAG,CAAA,CAAGwB,EAAMrB,CAAK,IACzB,CAAAoB,EAAeC,EAAMZ,EAAMC,CAAQ,EACnCV,CAAA,CAAA,IAIFgB,EAAA,GAAAjB,EAAS,IAAI,6UC/CHuB,GAAQ,CAAC,QAAQ,EAEjBC,GAAYC,IAAiC,CACzD,KAAM,CACL,QAAS,mCACV,EACA,YAAa,CACZ,QACC,2EACF,CACD"}